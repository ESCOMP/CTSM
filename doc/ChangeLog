===============================================================
Tag name:  clm4_5_18_r274
Originator(s):  sacks (Bill Sacks)
Date: Tue Jan 30 05:55:53 MST 2018
One-line Summary: Fix auto-detection of CIME_MODEL in a standalone checkout

Purpose of changes
------------------

The auto-detection of whether CIME_MODEL is acme or cesm is broken in
standalone checkouts of clm4_5_18_r273. (This auto-detection relied on
whether there was an SVN_EXTERNAL_DIRECTORIES file present at the top
level.)

This tag points to a new cime version that fixes this issue.


Bugs fixed or introduced
------------------------

Issues fixed (include CTSM Issue #):
- #238 - clm4_5_18_r273 requires setting CIME_MODEL


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing: none

Code reviewed by: Erik Kluzek

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    cheyenne - not run

  unit-tests (components/clm/src):

    cheyenne - pass

  tools-tests (components/clm/test/tools):

    cheyenne - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     cheyenne - not run

  regular tests (aux_clm):

    cheyenne_intel ---- pass
    cheyenne_gnu ------ pass
    hobart_nag -------- pass
    hobart_pgi -------- pass
    hobart_intel ------ pass

    Note: I ran the cheyenne tests with CIME_MODEL=cesm defined in my
    environment, and the hobart tests without this setting.

CLM tag used for the baseline comparisons: clm4_5_18_r273


Answer changes
--------------

Changes answers relative to baseline: NO

Detailed list of changes
------------------------

List any externals directories updated (cime, rtm, mosart, cism, fates, etc.):

- cime: clm4518/n03/cime5.4.0-alpha.03 -> clm4518/n04/cime5.4.0-alpha.03
  Fix to auto-detect that CIME_MODEL=cesm based on presence of
  manage_externals rather than SVN_EXTERNAL_DIRECTORIES

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Fix the documentation of some expected fails
M       cime_config/testdefs/ExpectedTestFails.xml

===============================================================
===============================================================
Tag name:  clm4_5_18_r273
Originator(s):  sacks (Bill Sacks)
Date: Fri Jan 26 15:26:06 MST 2018
One-line Summary: Support a standalone checkout from git

Purpose of changes
------------------

This PR allows a standalone git-based checkout to work. Starting with
this tag, we'll be using git rather than svn for CLM/CTSM development.

The biggest changes here are pulling in manage_externals, which serves
the role of svn externals. After cloning the repository, you can get all
of the necessary externals by running:

./manage_externals/checkout_externals

See the file README_EXTERNALS.rst at the top level of the repository for
more details on using this tool.

Other than that, this PR mostly involves changes to allow you to run
from the new directory structure of a standalone checkout: Now all of
the CLM/CTSM directories appear at the top level of the checkout, rather
than nested under components/clm.

Bugs fixed or introduced
------------------------

Known bugs introduced in this tag (include github issue ID):

- https://github.com/ESCOMP/ctsm/issues/220 For new standalone
  organization, need to generalize paths for tools and testing


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions):

- The svn trunk is now frozen. All future development will occur in the
  master branch of https://github.com/ESCOMP/ctsm

- A standalone git checkout will have all CLM directories (src, bld,
  etc.) at the top level, rather than under components/clm.

- To get all externals after cloning the git repository, run
  ./manage_externals/checkout_externals

  See the file README_EXTERNALS.rst at the top level of the repository
  for more details on using this tool.

- More details on working with the git repository will be coming soon

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance):

- build-namelist unit tests currently do not run (#220)

- tools tests, and the tools builds themselves, are expected not to work (#220)

Changes to tests or testing: none

Code reviewed by: Ben Andre, Erik Kluzek

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    cheyenne - FAIL (#220)

  unit-tests (components/clm/src):

    cheyenne - pass

  tools-tests (components/clm/test/tools):

    cheyenne - NOT RUN; EXPECTED TO FAIL (#220)

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     cheyenne - NOT RUN; MAY FAIL DUE TO #220

  regular tests (aux_clm):

    cheyenne_intel ---- pass
    cheyenne_gnu ------ pass
    hobart_nag -------- pass
    hobart_pgi -------- pass
    hobart_intel ------ pass

CLM tag used for the baseline comparisons: clm4_5_18_r272
Answer changes
--------------

Changes answers relative to baseline: NO

Detailed list of changes
------------------------

List any externals directories updated (cime, rtm, mosart, cism, fates, etc.):

- cime: clm4518/n02/cime5.4.0-alpha.03 -> clm4518/n03/cime5.4.0-alpha.03
  Has some changes needed for new standalone directory structure to work
  (these changes are now on cime master, though see #225 before updating
  to cime master)

- cism: cism2_1_40 -> cism2_1_46
  Points to cism in git
  cism2_1_41, 42, 43 and 44 contained very minor changes
  cism2_1_45 and 46 are the git migration

List all files eliminated:

========= Handle externals via manage_externals rather than svn externals
D	README_EXTERNALS
D	SVN_EXTERNAL_DIRECTORIES
D	SVN_EXTERNAL_DIRECTORIES.standalone

List all files added and what they do:

========= Added this directory and everything below it. Pulled in via
          git subtree from
          https://github.com/NCAR/manage_externals/. This is the new
          tool for pulling in and updating externals (replacing svn
          externals).
A	manage_externals/

========= Handle externals via manage_externals rather than svn externals
A	Externals.cfg
A	Externals_CLM.cfg
A	README_EXTERNALS.rst

========= Handle new directory structure of standalone checkouts
A	.config_files.xml

========= Add some .gitignore files
A	src/dyn_subgrid/.gitignore
A	src/unit_test_shr/.gitignore
A	src/unit_test_stubs/main/.gitignore
A	src/unit_test_stubs/utils/.gitignore
A	src/utils/.gitignore
A	cime_config/.gitignore

List all existing files that have been modified, and describe the changes:

========= Handle new directory structure of standalone checkouts
M	bld/CLMBuildNamelist.pm
M	bld/configure
M	cime_config/buildcpp
M	cime_config/buildlib
M	cime_config/buildnml
M	src/CMakeLists.txt

========= Documentation updates for move to git
M	.CLMTrunkChecklist
M	.gitignore
M	LICENSE
M	README.rst
M	src/README.unit_testing

========= Separately document expected fails for aux_clm vs fates test
          lists
M	cime_config/testdefs/ExpectedTestFails.xml

========= ChangeLog now only stored in doc directory, not in top-level
          directory
R095	.ChangeLog_template	doc/.ChangeLog_template
R070	UpDateChangeLog.pl	doc/UpdateChangelog.pl

===============================================================
===============================================================
Tag name:  clm4_5_18_r272
Originator(s):  erik (Erik Kluzek)
Date: Thu Jan 25 01:17:01 MST 2018
One-line Summary: Bring in latest FATES release version to CLM trunk: fates_s1.4.1_a3.0.0_rev2

Purpose of changes
------------------

Bring in the latest version of FATES from NGEET/fates-release and the associated interface
changes in CLM from NGEET/fates-clm. The new version is 1.4.1 for science and version 3.0 of
the API updated from 1.3.0 for science and 1.0.0 for the API.


Bugs fixed or introduced
------------------------

Issues fixed (include CCTSM Issue #): #219
  #219 -- Options listed incorrectly in testlist_clm.xml

Known bugs introduced in this tag (include github issue ID): (or found)
  #216 -- PE layout for hcru_hcru needs to be increased so that it can run
  #213 -- CPLHIST case is matching the wrong CLM_NML_USE_CASE
  #212 -- Can't use a non-fates restart file to interpolate to a simulation with fates
  #211 -- Can't handle interpolating from a fates restart file because of the cohort dimension

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): Simple FATES initial-condition
   files were added for present day at f45 and 1x1_brazil. FATES IC can't be interpolated from
   so you either have to have an exact match or do a cold start.

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): New FATES namelist items:
   use_fates_planthydro, use_fates_ed_st3, use_fates_ed_prescribed_phys, 
   use_fates_inventory_init, fates_inventory_ctrl_filename,use_fates_logging

Changes made to namelist defaults (e.g., changed parameter values): when FATES on, non-fates finidat
   files won't be matched

Changes to the datasets (e.g., parameter, surface or initial files): New fates param file
    and finidat files for f45 and 1x1_brazil

Substantial timing or memory changes: None

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance):

Changes to tests or testing: ed test list removed and updated fates list added in
   with new version=2.0 format, fates test list now sets machine/compiler rather than
   using generic "fates" for both.

Code reviewed by: self, rgknox, ckoven

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing: regular

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    cheyenne - PASS (33 fates namelist tests are different)

  unit-tests (components/clm/src):

    cheyenne - PASS

  regular tests (aux_clm):

    cheyenne_intel ---- OK
    cheyenne_gnu ------ OK
    hobart_nag -------- OK
    hobart_pgi -------- OK
    hobart_intel ------ OK

CLM tag used for the baseline comparisons: clm4_5_18_r271


Answer changes
--------------

Changes answers relative to baseline: Only simulations with fates on

  Summarize any changes to answers, i.e.,
    - what code configurations: Only "-bgc fates"
    - what platforms/compilers: All
    - nature of change: new climate, fates science updated from 1.3.0 to 1.4.1

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): rtm, mosart, fates
   rtm    to rtm1_0_65
   mosart to mosart1_0_30
   fates  to fates_s1.4.1_a3.0.0_rev2

List all files eliminated:

          fates test directory changed to one capitolized to be similar to new tests added
   D    components/clm/cime_config/testdefs/testmods_dirs/clm/fates/user_nl_clm
   D    components/clm/cime_config/testdefs/testmods_dirs/clm/fates/shell_commands

List all files added and what they do:

         New tests for exercising more Fates options, all are based on the Fates test-mod
         and add a few changes on top of it
   A    components/clm/cime_config/testdefs/testmods_dirs/clm/FatesShortList/user_nl_clm ------- Short list of hist_fincl1
   A    components/clm/cime_config/testdefs/testmods_dirs/clm/FatesShortList/include_user_mods
   A    components/clm/cime_config/testdefs/testmods_dirs/clm/FatesST3/user_nl_clm ------------- use_fates_ed_st3=T
   A    components/clm/cime_config/testdefs/testmods_dirs/clm/FatesST3/include_user_mods
   A    components/clm/cime_config/testdefs/testmods_dirs/clm/FatesAllVars/user_nl_clm --------- Long list of FATES variables
   A    components/clm/cime_config/testdefs/testmods_dirs/clm/FatesAllVars/include_user_mods
   A    components/clm/cime_config/testdefs/testmods_dirs/clm/FatesAllVars/shell_commands ----- Cold-start
   A    components/clm/cime_config/testdefs/testmods_dirs/clm/FatesLogging/user_nl_clm -------- use_fates_logging=T
   A    components/clm/cime_config/testdefs/testmods_dirs/clm/FatesLogging/include_user_mods
   A    components/clm/cime_config/testdefs/testmods_dirs/clm/FatesColdDef/user_nl_clm -------- Longer list of hist_fincl1
   A    components/clm/cime_config/testdefs/testmods_dirs/clm/FatesColdDef/include_user_mods
   A    components/clm/cime_config/testdefs/testmods_dirs/clm/FatesColdDef/shell_commands ----- Cold-start
   A    components/clm/cime_config/testdefs/testmods_dirs/clm/FatesPPhys/user_nl_clm ---------- use_fates_ed_prescribed_phys=T
   A    components/clm/cime_config/testdefs/testmods_dirs/clm/FatesPPhys/include_user_mods
   A    components/clm/cime_config/testdefs/testmods_dirs/clm/Fates/user_nl_clm -------------- Moved from fates directory, longer
            hist_fincl1 list
   A    components/clm/cime_config/testdefs/testmods_dirs/clm/Fates/shell_commands ----------- Moved from fates directory, no longer
            a cold-start
   A    components/clm/cime_config/testdefs/testmods_dirs/clm/FatesNoFire/user_nl_clm -------- use_fates_spitfire=F
   A    components/clm/cime_config/testdefs/testmods_dirs/clm/FatesNoFire/include_user_mods

List all existing files that have been modified, and describe the changes:

   M    components/clm/bld/CLMBuildNamelist.pm - Handle new FATES namelist items, send
          use_fates down for setting of finidat, if use_fates_inventory_init=T, make
          sure fates_inventory_ctrl_filename is set

   M    components/clm/bld/unit_testers/build-namelist_test.pl - Change ED to FATES, test new FATES features

   M    components/clm/bld/namelist_files/namelist_defaults_overall.xml -- clm_start_type is arb_ic when use_fates=T
   M    components/clm/bld/namelist_files/namelist_definition_clm4_5.xml - Update fates var descriptsion, and add
           new namelist items: use_fates_logging, use_fates_planthydro, use_fates_ed_st3, use_fates_ed_prescribed_phys,
                               use_fates_inventory_init, fates_inventory_ctrl_filename, remove use of ED for FATES
   M    components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml --- Update fates_paramfile, use_init_interp=T
          only if use_fates=F, add use_fates=F to init_interp_attributes, add use_fates setting for finidat files,
          and add new f45 and 1x1_brazil FATES finidat files, by default new use_fates_* options are False.

   M    components/clm/cime_config/config_compsets.xml ------------- Add a stub-GLC FATES compset: I2000Clm50FatesCruGs
   M    components/clm/cime_config/testdefs/ExpectedTestFails.xml -- Many new expected fails for #221 and NGEET/fates#315
   M    components/clm/cime_config/testdefs/testlist_clm.xml ------- Remove "ed" test-category, new "fates" test category
          Move <options> to after <machines> rather than nested inside (issue #219).

   M    components/clm/src/utils/clmfates_paraminterfaceMod.F90 - Add write about dimension shape on abort
   M    components/clm/src/utils/clmfates_interfaceMod.F90 ------ New interface control variables, add call to
          FatesReportParameters, use_fates_plant_hydro=>use_fates_planthydro, fix restart_map, zero_site=>init_site_vars
          use numpft_ed

   M    components/clm/src/main/decompInitMod.F90 --------- Set gi rather than ci for cohorts
   M    components/clm/src/main/subgridMod.F90 ------------ Add call subgrid_get_info_cohort, change subgrid_get_info_natveg call
   M    components/clm/src/main/histFileMod.F90 ----------- Change some of the parameter names, EDTypesMod interfaces get moved
           to FatesInterfaceMod, nlevsclass_ed=>nlevsclass, maxpft=>numpft_ed, 
   M    components/clm/src/main/controlMod.F90 ------------ Add new fates flags to namelist and broadcast/print them
   M    components/clm/src/main/clm_varctl.F90 ------------ New FATES flags, change ED=>FATES and some formatting
   M    components/clm/src/main/initGridCellsMod.F90 ------ ncohorts=>npatches
   M    components/clm/src/main/initVerticalMod.F90 ------- Remove call to ed_hist_scpfmaps
   M    components/clm/src/main/readParamsMod.F90 --------- Remove call to FatesReadParameters
   M    components/clm/src/biogeophys/CanopyFluxesMod.F90 - Add blank line
   M    components/clm/src/biogeophys/OzoneMod.F90 -------- Comment out setting of o3* variables to spval

   M    components/clm/src/CMakeLists.txt -- Add fates/main to unit-test directories

===============================================================
===============================================================
Tag name:  clm4_5_18_r271
Originator(s):  erik (Erik Kluzek)
Date: Sat Jan 20 20:27:00 MST 2018
One-line Summary: Update testlist to v2 and remove yellowstone

Purpose of changes
------------------

Redo the testlist in version 2 format and remove yellowstone from it. Also update mosart and rtm with updated
test lists. The new testlist format also allows wallclock times to be set (and they are) so that they can run 
in the queue faster. Change some files that referenced bugzilla ID's to github issue #'s. Update tools testing 
for gen_domain to use version under cime/tools rather than the copy under clm.

Bugs fixed or introduced
------------------------

Known bugs introduced in this tag (include github issue ID):
   #216 -- PE layout for hcru_hcru
   #213 -- CPLHIST case is matching the wrong CLM_NML_USE_CASE
   #212 -- Can't use a non-fates restart file to interpolate to a simulation with fates
   #211 -- Can't handle interpolating from a fates restart file because of the cohort dimension

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): None

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): None

Changes made to namelist defaults (e.g., changed parameter values): None

Changes to the datasets (e.g., parameter, surface or initial files): None

Substantial timing or memory changes: None

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): 
   MEMLEAK, TPUTCOMP and MEMCOMP tests now seem to be robust and can be trusted.

Changes to tests or testing: Test list completely redone

Code reviewed by: self

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing: regular

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    cheyenne - PASS

  unit-tests (components/clm/src):

    cheyenne - PASS

  tools-tests (components/clm/test/tools):

    cheyenne - OK

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     cheyenne - OK

  regular tests (aux_clm):

    cheyenne_intel ---- OK
    cheyenne_gnu ------ OK
    hobart_nag -------- OK
    hobart_pgi -------- PASS
    hobart_intel ------ PASS

CLM tag used for the baseline comparisons:  clm4_5_18_r270


Answer changes
--------------

Changes answers relative to baseline: no bit-for-bit, no source code changed

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): cime, mosart, rtm
   cime   to clm4518/n02/cime5.4.0-alpha.03 which allows CLM grids in testlist
   mosart to mosart1_0_29 with redone test list in v2 format
   rtm    to rtm1_0_64 with redone test list in v2 format

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

  M  parse_cime.cs.status -- MEMLEAK, MEMCOMP, and TPUTCOMP don't need to be ignored anymore

  M  .ChangeLog_template -- Remove bugzilla in place for github issue ids

        Update to test gen_domain under cime/tools rather than the copy under components/clm/tools/gen_domain
        The copy won't be able to be done in the new github world.
  M  components/clm/test/tools/TBLCFGtools.sh ----- Set name of test directory by basename (so relative path can be passed in)
  M  components/clm/test/tools/input_tests_master - gen_domain path is relative to tools directory but under cime now
  M  components/clm/test/tools/test_driver.sh ----- Remove yellowstone set "--mpilib mpi-serial" for TOOLS CFG string
  M  components/clm/test/tools/TSMCFGtools.sh ----- Set name of test directory by basename
  M  components/clm/test/tools/TCBCFGtools.sh ----- Set name of test directory by basename

  M  components/clm/bld/unit_testers/build-namelist_test.pl - Fix number of tests

  M  components/clm/cime_config/testdefs/testlist_clm.xml ------- Completely redo in version 2 format
  M  components/clm/cime_config/testdefs/ExpectedTestFails.xml -- Update to github issues rather than bugzilla

===============================================================
===============================================================
Tag name:  clm4_5_18_r270
Originator(s):  sacks (Bill Sacks)
Date: Wed Dec 20 12:04:25 MST 2017
One-line Summary: Always use multiple elevation classes for glacier, even with stub glc

Purpose of changes
------------------

Up until now, we have been using the glacier_mec (multiple elevation
class) scheme when running with CISM, but the old non-elevation class
scheme when running with a stub glacier model (SGLC). This is
problematic because it means that simply switching from CISM to SGLC
fundamentally changes CLM's glacier physics. (Note: with the current
configuration, the multiple elevation class scheme is enabled over
Greenland and Antarctica but not elsewhere.)

There are a few use cases where this is important:

- Single-point and regional runs over glacier regions: In this case, you
  cannot use CISM. Members of the LIWG want to do runs like this so they
  can do single-point testing with the multiple elevation class scheme.

- Currently, CISM does not support a Gregorian calendar (i.e., with leap
  years). So cases with a Gregorian calendar need to use SGLC. This
  includes data assimilation and CAM specified dynamics runs. We want
  the physics of these runs to match the standard CLM physics as closely
  as is feasible.

- There may be other cases where a user doesn't want to include CISM
  because of the extra complexity this involves, such as when setting up
  a new grid (which would require additional mapping files for
  CISM). Again, we want the physics of these runs to match the standard
  CLM physics as closely as is feasible.

Note that runs with SGLC will still differ somewhat from runs with CISM,
even when CISM is running in the typical NOEVOLVE mode. This is because
there will be differences in % glacier and topographic heights over
Greenland: in a run with CISM, this information comes from CISM at the
start of the run so that CLM and CISM agree in this respect; in a run
with SGLC this information comes from CLM's surface dataset.

However: Running with SGLC now gives the same answers as running with
CISM with GLC_TWO_WAY_COUPLING set to FALSE. (These both differ from the
standard configuration that uses CISM with GLC_TWO_WAY_COUPLING TRUE
just over Greenland.)

Mostly-unrelated change: Remove tropicAtl grid


Bugs fixed or introduced
------------------------

Known bugs introduced in this tag (include bugzilla ID):
- https://github.com/ESCOMP/ctsm/issues/158 now causes test failures for
  ERS_Lm20_Mmpi-serial.1x1_smallvilleIA.I2000Clm50BgcCropGs.yellowstone_pgi.clm-monthly,
  since we're now using a new and buggy surface dataset for that case.

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions):
- If you use an finidat file from an old run that used SGLC, you'll need
  to run init_interp and will need to set
  init_interp_fill_missing_with_natveg = .true. in user_nl_clm. Note
  that this will initialize glacier_mec landunits with information from
  vegetated landunits, which is not a very good initialization, so
  you'll want to spin up for a while to spin up the new glacier_mec
  landunits.

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): no

Changes made to namelist defaults (e.g., changed parameter values): no

Changes to the datasets (e.g., parameter, surface or initial files):
- New surface datasets for single-point and regional runs: These now
  have the data necessary to run with the multiple elevation class
  glacier scheme. None of our out-of-the-box single-point or regional
  datasets have any glacier cover, so this doesn't lead to substantive
  changes. Note, though, that the smallville datasets hadn't been
  updated in a while, so there are bigger changes to the smallville
  datasets. The new smallville datasets are buggy (due to
  https://github.com/ESCOMP/ctsm/issues/158), but the old ones wouldn't
  have worked with the new code due to missing glacier_mec
  information. Note that I have NOT changed the landuse.timeseries
  files, because those don't change in any substantive way with the
  setting of -glc_nec in mksurfdata_map.

- Runs with SGLC now point to different finidat files by default: they
  now point to finidat files that were generated with glacier_mec, which
  may differ substantially from the files that were generated without
  glacier_mec (since I think these came from completely different
  spinups).

Substantial timing or memory changes: Expect some performance
degradation in SGLC runs, since now we're using multiple elevation
classes over Greenland and Antarctica, though I haven't investigated it
carefully.

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing: Delete tropicAtl_subset tests: these tests
didn't provide much value, and the code they cover is also covered by
unit tests

Code reviewed by: self

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    cheyenne - ok

    prove test_build_namelist fails as on trunk

    main build-namelist tests pass, clm4_5 and clm5_0 lnd_in files
    differ from trunk as expected

  unit-tests (components/clm/src):

    cheyenne - pass

  tools-tests (components/clm/test/tools):

    cheyenne - ok

    Tests pass other than these known issues:

    smfg4 TSMscript_tools.sh PTCLM PTCLMmkdata PTCLM_USUMB_Global_clm4_5^buildtools
      See https://github.com/ESCOMP/ctsm/issues/188

    blf84 TBLscript_tools.sh PTCLM PTCLMmkdata PTCLM_USUMB_clm4_5^buildtools
    blfc4 TBLscript_tools.sh PTCLM PTCLMmkdata PTCLM_USUMB_Cycle_clm4_5^buildtools
      See https://github.com/ESCOMP/ctsm/issues/187

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     cheyenne - ok

     1 failure, as on the trunk

     compare tests: 40 PASS, 1 Fail; on the trunk, all 41 Failed. I'm
     not sure why my branch improves things in this respect.

  regular tests (aux_clm):

    yellowstone_intel - ok
    yellowstone_pgi --- ok
    yellowstone_gnu --- ok
    cheyenne_intel ---- ok
    cheyenne_gnu ------ ok
    hobart_nag -------- ok
    hobart_pgi -------- ok
    hobart_intel ------ ok

    Tests pass. Baseline comparisons fail for compsets with SGLC (both
    global tests and single-point and regional tests). This is expected
    and is described in detail below.

CLM tag used for the baseline comparisons: clm4_5_18_r269


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: All compsets with SGLC (as opposed to CISM)
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      Potentially new climate, though not investigated carefully

      Answers change in runs with SGLC due to the use of different
      out-of-the-box finidat files: they now point to finidat files that
      were generated with glacier_mec, which may differ substantially
      from the files that were generated without glacier_mec (since I
      think these came from completely different spinups).

      For global runs, even without finidat differences, answers change
      over Greenland and Antarctica, since we're now using the
      multiple-elevation-class scheme there. Answers are the same
      outside of Greenland and Antarctica, where we still use a single
      glacier elevation class. (Based on spot-checking FSH in a 3-year
      cold start run.)

      (For single-point and regional runs, differences are mainly just
      due to changes in finidat. One exception may be smallville tests,
      since the smallville surface datasets have changed more
      extensively; I did not investigate the smallville answer changes
      carefully.)

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.):
- cime: cime5.4.0-alpha.03 -> billsacks/always_glcmec_n01
  The changes here are:
  - always use GLC_NEC=10, except for CLM40
  - delete references to tropicAtl

List all files eliminated:

========= These glacierMEC use cases weren't accomplishing anything:
          compared with the similar non-glacierMEC use cases, they just
          set the glc_nec namelist variable, but this variable didn't
          even exist! So I have switched cases to use the corresponding
          non-glacierMEC use cases
D       components/clm/bld/namelist_files/use_cases/1850_glacierMEC_control.xml
D       components/clm/bld/namelist_files/use_cases/1850-2100_rcp2.6_glacierMEC_transient.xml
D       components/clm/bld/namelist_files/use_cases/1850-2100_rcp6_glacierMEC_transient.xml
D       components/clm/bld/namelist_files/use_cases/1850-2100_rcp4.5_glacierMEC_transient.xml
D       components/clm/bld/namelist_files/use_cases/1850-2100_rcp8.5_glacierMEC_transient.xml
D       components/clm/bld/namelist_files/use_cases/20thC_glacierMEC_transient.xml
D       components/clm/bld/namelist_files/use_cases/2000_glacierMEC_control.xml

========= This use case appeared to be unused
D       components/clm/bld/namelist_files/use_cases/glacierMEC_pd.xml

========= These tropicAtl_subset tests were hard to maintain and didn't
          provide much value: the code they covered is also covered via
          unit tests
D       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subsetMid/include_user_mods
D       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subsetMid/shell_commands
D       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subsetMid/README
D       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subsetMid
D       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subsetEarly/include_user_mods
D       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subsetEarly/shell_commands
D       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subsetEarly/README
D       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subsetEarly
D       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subsetLate/README
D       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subsetLate/include_user_mods
D       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subsetLate/shell_commands
D       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subsetLate
D       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subset/shell_commands
D       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subset/README
D       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subset/user_nl_clm
D       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subset


List all files added and what they do:

List all existing files that have been modified, and describe the changes:

========= Always use -glc_nec 10, delete tropicAtl, and other minor fixes
M       components/clm/tools/mksurfdata_map/Makefile.data

========= Require glc_nec >= 1 when making surface datasets
M       components/clm/tools/mksurfdata_map/src/mkfileMod.F90
M       components/clm/tools/mksurfdata_map/src/mkglcmecMod.F90
M       components/clm/tools/mksurfdata_map/src/mksurfdat.F90
M       components/clm/tools/mksurfdata_map/mksurfdata.pl

========= Require glc_nec >= 1 for clm45/clm50
M       components/clm/bld/CLMBuildNamelist.pm
M       components/clm/bld/unit_testers/build-namelist_test.pl
M       components/clm/bld/namelist_files/namelist_definition_clm4_5.xml
M       components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml
M       components/clm/cime_config/buildnml

========= Remove istice; always use glacier_mec type
M       components/clm/src/biogeochem/DryDepVelocity.F90
M       components/clm/src/main/controlMod.F90
M       components/clm/src/main/LandunitType.F90
M       components/clm/src/main/TopoMod.F90
M       components/clm/src/main/filterMod.F90
M       components/clm/src/main/lnd2glcMod.F90
M       components/clm/src/main/clm_varctl.F90
M       components/clm/src/main/clm_driver.F90
M       components/clm/src/main/subgridAveMod.F90
M       components/clm/src/main/initGridCellsMod.F90
M       components/clm/src/main/initVerticalMod.F90
M       components/clm/src/main/atm2lndMod.F90
M       components/clm/src/main/surfrdMod.F90
M       components/clm/src/main/clm_instMod.F90
M       components/clm/src/main/landunit_varcon.F90
M       components/clm/src/main/subgridWeightsMod.F90
M       components/clm/src/main/clm_initializeMod.F90
M       components/clm/src/main/subgridMod.F90
M       components/clm/src/main/ColumnType.F90
M       components/clm/src/main/histFileMod.F90
M       components/clm/src/main/restFileMod.F90
M       components/clm/src/biogeophys/WaterStateType.F90
M       components/clm/src/biogeophys/SnowHydrologyMod.F90
M       components/clm/src/biogeophys/HydrologyDrainageMod.F90
M       components/clm/src/biogeophys/BalanceCheckMod.F90
M       components/clm/src/biogeophys/TemperatureType.F90
M       components/clm/src/biogeophys/SurfaceAlbedoMod.F90
M       components/clm/src/biogeophys/PhotosynthesisMod.F90
M       components/clm/src/biogeophys/CanopyTemperatureMod.F90
M       components/clm/src/biogeophys/SoilHydrologyInitTimeConstMod.F90
M       components/clm/src/biogeophys/SurfaceResistanceMod.F90
M       components/clm/src/biogeophys/TotalWaterAndHeatMod.F90
M       components/clm/src/biogeophys/WaterfluxType.F90
M       components/clm/src/biogeophys/CanopyHydrologyMod.F90
M       components/clm/src/biogeophys/GlacierSurfaceMassBalanceMod.F90
M       components/clm/src/biogeophys/SoilStateInitTimeConstMod.F90
M       components/clm/src/biogeophys/SoilTemperatureMod.F90
M       components/clm/src/dyn_subgrid/dynInitColumnsMod.F90
M       components/clm/src/dyn_subgrid/dynLandunitAreaMod.F90
M       components/clm/src/dyn_subgrid/test/dynLandunitArea_test/test_update_landunit_weights.pf
M       components/clm/src/dyn_subgrid/test/dynLandunitArea_test/test_update_landunit_weights_one_gcell.pf
M       components/clm/src/dyn_subgrid/dynSubgridDriverMod.F90
M       components/clm/src/cpl/clm_cpl_indices.F90
M       components/clm/src/cpl/lnd_import_export.F90
M       components/clm/src/cpl/lnd_comp_mct.F90

========= In addition to supporting the main changes of this tag, also
          do a fairly major refactor: set fields internally rather than
          letting lnd_import set the fields
M       components/clm/src/main/glc2lndMod.F90

========= Fixes to unit tests for changes in glc2lnd
M       components/clm/src/main/test/topo_test/test_topo.pf

========= Remove tropicAtl tests and references to tropicAtl grid (see
          above for more notes on this)
M       components/clm/cime_config/testdefs/testlist_clm.xml
M       components/clm/bld/test_build_namelist/t/input/namelist_defaults_clm4_5_test.xml
M       components/clm/bld/test_build_namelist/t/input/namelist_definition_clm4_5_test.xml
M       components/clm/bld/namelist_files/namelist_definition_clm4_0.xml
M       components/clm/bld/namelist_files/namelist_defaults_clm4_5_tools.xml
M       components/clm/bld/namelist_files/namelist_defaults_overall.xml
M       components/clm/bld/namelist_files/namelist_defaults_clm4_0.xml
M       components/clm/bld/namelist_files/checkmapfiles.ncl
M       components/clm/doc/UsersGuide/adding_files.xml

========= No longer use glacierMEC-specific use cases (see above for
          more notes on this)
M       components/clm/cime_config/config_component.xml

========= Fix creation date of files pointed to by tests
M       components/clm/test/tools/nl_files/PTCLM_USUMB_clm4_5
M       components/clm/test/tools/nl_files/PTCLM_USUMB_Cycle_clm4_5
M       components/clm/test/tools/nl_files/PTCLM_USUMB_Global_clm4_5

========= No longer need init_interp_fill_missing_with_natveg (I think
          this could have been removed a while ago)
M       components/clm/cime_config/testdefs/testmods_dirs/clm/clm50KSinkMOut/user_nl_clm

========= New expected failure:
          ERS_Lm20_Mmpi-serial.1x1_smallvilleIA.I2000Clm50BgcCropGs.yellowstone_pgi.clm-monthly
M       components/clm/cime_config/testdefs/ExpectedTestFails.xml

===============================================================
===============================================================
Tag name:  clm4_5_18_r269
Originator(s):  erik (Erik Kluzek,UCAR/TSS,303-497-1326)
Date:  Sat Dec 16 19:49:41 MST 2017
One-line Summary: Move externals to version in github

Purpose of changes
------------------

Move the CLM externals to the version in github for MOSART, RTM and
PTCLM. For PTCLM this meant updating to a version that didn't take
advantage of subversion keywords. I also updated to a version that
can properly compare to the files it keeps even with differences
of user, machine, path, or date.


Bugs fixed or introduced None
------------------------

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): None

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): None

Changes made to namelist defaults (e.g., changed parameter values): None

Changes to the datasets (e.g., parameter, surface or initial files): None

Substantial timing or memory changes: None

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): None

Changes to tests or testing: None

Code reviewed by: self,andre

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing: regular

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    cheyenne - PASS

  unit-tests (components/clm/src):

    cheyenne - PASS

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     cheyenne - OK

  regular tests (aux_clm):

    yellowstone_intel - OK
    yellowstone_pgi --- OK
    yellowstone_gnu --- OK
    cheyenne_intel ---- OK
    cheyenne_gnu ------ OK
    hobart_nag -------- OK
    hobart_pgi -------- OK
    hobart_intel ------ OK

CLM tag used for the baseline comparisons:  clm4_5_18_r268


Answer changes
--------------

Changes answers relative to baseline: no bit-for-bit

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): rtm, mosart, PTCLM

   mosart1_0_28 to github version
   rtm1_0_63    to github version
   PTCLM        to PTCLM2_171216c and github version

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes: None

===============================================================
===============================================================
Tag name:  clm4_5_18_r268
Originator(s):  erik (Erik Kluzek)
Date: Mon Dec 11 16:47:24 MST 2017
One-line Summary: Fix calculation of stomatal resistence used in dry-deposition, increase threshold of totvegc for soil decomposition to 0.1

Purpose of changes
------------------

Changes from Louisa Emmons to fix the calculation of stomatal resistence in the dry-deposition code so it's the inverse
of the previous calculation (and the arbitrary multiplicitive factor to reduce it was removed). Add new optional history
fields for dry-deposition.

Increase the threshold of total vegetation carbon for when decomposition pools are reset from 1.e-8 to 0.1. This change comes from
Dave Lawrence and Keith Oleson. The code was also modified to use better names for this rather than ccrit and ncrit which came in
clm4_5_17_r264. Add some new checking for these settings at initialization. Add some changes to the default CMIP6 output from
Keith Oleson.

Add in f05 fsurdat and one landuse.timeseries datasets. Add check in SSP test that makes sure the compset used includes MOSART as
expected.


Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID): 2545, 2546
   2526 -- Fix calculation of stomatal resistance for dry deposition
   2545 -- SSP test assumes that MOSART is being used, and dies inexplicably if not

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions):

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables):
   Add new optional history fields when drydeposition is on:  DRYDEPV_*, RS_DRYDEP_O3

Changes made to namelist defaults (e.g., changed parameter values):

Changes to the datasets (e.g., parameter, surface or initial files) Add f05 fsurdat and one landuse.timeseries file:

Substantial timing or memory changes: None

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance):
    RS_DRYDEP_O3 history field is hardcoded for Ozone. In most cases the same value would apply to other species, but it is
    hardcoded to give values for Ozone.

Changes to tests or testing: Add ciso SSP test

Code reviewed by: self,tilmes,emmons,fvitt

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing: regular

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    cheyenne - PASS

  unit-tests (components/clm/src):

    cheyenne - PASS

  regular tests (aux_clm):

    yellowstone_intel - OK
    yellowstone_pgi --- OK
    yellowstone_gnu --- OK
    cheyenne_intel ---- OK
    cheyenne_gnu ------ OK
    hobart_nag -------- OK
    hobart_pgi -------- OK
    hobart_intel ------ OK

CLM tag used for the baseline comparisons:  clm4_5_18_r267


Answer changes
--------------

Changes answers relative to baseline: Yes, but only for drydep and/or exit_spinup

  Summarize any changes to answers, i.e.,
    - what code configurations: with drydep on, or in exit_spinup mode for either clm4_5 or clm5_0
    - what platforms/compilers: All
    - nature of change: modest

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): None

List all files eliminated: None

List all files added and what they do: Add new ciso_rtmColdSSP testmod -- includes ciso and rtmColdSSP testmods

  A /clm/cime_config/testdefs/testmods_dirs/clm/ciso_rtmColdSSP/include_user_mods

List all existing files that have been modified, and describe the changes:

  M components/clm/bld/unit_testers/build-namelist_test.pl -- Increase test numbers as now testing f05 datasets
  M components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml ---- Add f05 fsurdat files and one landuse.timeseries file
  M components/clm/bld/namelist_files/namelist_definition_clm4_5.xml -- Add f05 to list of supported resolutions

  M components/clm/cime_config/testdefs/testlist_clm.xml --------------- Add SSP ciso test
  M components/clm/cime_config/usermods_dirs/cmip6_output/user_nl_clm -- Added FCTR, FCEV, FGEV, FIRE, FSR, and HTOP; 
     and removed QVEGT; all from the h1 file (fincl2) (from Keith Oleson)
  M /clm/cime_config/SystemTests/ssp.py ---------------------- Update comments, add expect that compset uses mosart

  M components/clm/src/soilbiogeochem/SoilBiogeochemNitrogenStateType.F90 --- Change ncrit to totvegcthresh and SetNCrit to SetTotVgCThresh
       add abort if totvegcthresh is unset, and check that it's greater than zero
  M components/clm/src/soilbiogeochem/SoilBiogeochemPrecisionControlMod.F90 - Set totvegcthresh to 0.1 and pass down via setTotVgCThresh methods
  M components/clm/src/soilbiogeochem/SoilBiogeochemCarbonStateType.F90 ----- Change ccrit to totvegcthresh and SetNCrit to SetTotVgCThresh
       add abort if totvegcthresh is unset, and check that it's greater than zero
  M components/clm/src/biogeochem/DryDepVelocity.F90 ------------------------ Modifications from Louisa Emmons, Corrected the equation 
      calculating stomatal resistance from rssun and rssha, add new array rs_drydep_patch, add new history 
      output possibilities: DRYDEPV_*, RS_DRYDEP_O3, use spval instead of hardcoded magic number 1.e36

===============================================================
===============================================================
Tag name:  clm4_5_18_r267
Originator(s):  sacks (Bill Sacks)
Date: Thu Dec  7 19:26:48 MST 2017
One-line Summary: Fixes to accumulator fields

Purpose of changes
------------------

(1) Only accumulate accumulators over active (typically,
    non-zero-weight) patches/columns. This changes answers for transient
    runs. Previously, accumulator fields were being accumulated even
    when a patch/column was inactive. In many cases this was relatively
    harmless, but in some cases it was accumulating garbage like
    spval. Then, once the point became active, it could take a while for
    the garbage accumulated values to be worked out.

    This changes answers for transient runs. I have examined all
    accumulator fields used in a typical BgcCrop run (this does NOT
    include fields that are only used for CNDV or FATES). Most changes
    only last for the first month or so that a point is active, but
    there are larger changes for:

    - PREC10 and PREC60: The changes in these are probably the most
      extreme. In the old code, these started as spval (rather than a
      blank slate) over newly-active patches. PREC10 is garbage for the
      first few years after a point becomes active. I didn't look at
      PREC60, but its logic is the same as PREC10, so I would expect it
      to be garbage for about the first 20 years after a point becomes
      active. PREC10 is used in the fire code and for stress deciduous
      phenology. PREC60 is used in the fire code.

    - AnnET: In the old code, this started as 0 (rather than a blank
      slate) over newly-active points. This affects answers for the
      first year or two. This is used in N fixation code.

    - FSUN24 and FSUN240: In the old code, these started out as spval;
      it takes a few years for the FSUN240 accumulator to come back down
      to reasonable values (even though it's a 10-day accumulator, its
      "exponential running average" behavior means that it takes much
      longer for memory of a huge value like spval to disappear). These
      are just used in VOCEmissionsMod.

    I have not investigated how much these changes in accumulators
    affect the science of the model. The biggest effects will probably
    be in the fire code in transient runs, but I haven't looked at how
    big of an effect these errors in PREC60 have.

    There are also potentially very large changes in CNDV, due to change
    in behavior of some patch-level accumulators which are needed for
    PFT establishment (and thus should be available over inactive
    patches, but no longer are valid for inactive patches). However,
    these fields were already buggy (see bug 2537).

(2) For startup/hybrid runs with non-blank finidat (including runs with
    use_init_interp): Continue accumulating continuously from where
    things were in the finidat file. Previously, many of the
    accumulators were being reset in startup/hybrid runs. This appeared
    to be an accident of the implementation details, whose fix was easy
    as a side-effect of the fix for (1). This shouldn't have a huge
    effect: most accumulators are order 10 days, with the longest being
    365 days, so differences should work themselves out within the first
    year or so. But this could be important if you expect a spinup run
    to transition continuously into a transient run (for example).

    This changes answers for any startup or hybrid case with non-blank
    finidat, where the restart file is from this tag or later. It does
    NOT change answers for old restart files. (These old files are
    missing the new _NSTEPS fields associated with each accumulator
    field, and so nsteps values are set to 0 in a startup/hybrid run,
    similarly to the old behavior.)

Also, a somewhat-unrelated change: Abort if a field is missing from the
restart file in a branch run (just as we do for a continue run); tell
the user to do a startup or hybrid run in this case. My reason for
folding this change into this tag was so that I don't need to worry
about backwards compatibility of branch runs with old restart files.

Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID):
- 2526: Some CLM accumulated fields (via accumulMod) are incorrect with dynamic landunits

Known bugs introduced in this tag (include bugzilla ID):
- The following pre-existing bugs may be somewhat worse now:
  - 2537: Climate accumulator fields incorrect for CNDV
  - 2539: CNDV logic for agdd20 and tmomin20 needs to be revised to
          account for when a given patch/column becomes active

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions):

- Can no longer do a branch run if some fields are missing from the
  restart file, either due to code changes or configuration changes (need
  to do hybrid or startup).

- Cannot do a branch from restart files generated with prior tags,
  because the _NSTEPS restart fields associated with accumulation fields
  are missing.

- Startup or hybrid runs using restart files that were generated from
  prior tags will not take advantage of fix (2) above.

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing: none

Code reviewed by: self

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    cheyenne - not run

  unit-tests (components/clm/src):

    cheyenne - pass

  tools-tests (components/clm/test/tools):

    cheyenne - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     cheyenne - not run

  regular tests (aux_clm):

    yellowstone_intel - ok 
    yellowstone_pgi --- ok
    yellowstone_gnu --- ok
    cheyenne_intel ---- ok
    cheyenne_gnu ------ ok
    hobart_nag -------- ok
    hobart_pgi -------- ok
    hobart_intel ------ ok

    ok means tests pass, answer changes as expected (see below)

CLM tag used for the baseline comparisons: clm4_5_17_r266


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations:
      - Cases with transient vegetation (Hist, Dv)
      - Startup / hybrid cases using restart files generated from this
        code base. In the test suite, this just shows up as answer
        changes in ERI and SSP tests, since other tests use old initial
        conditions files.
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      Larger than roundoff. Not yet investigated as to whether this is
      the same or different climate.

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: none

List all files added and what they do:

========= Cover accumulMod with unit tests
A       components/clm/src/main/test/accumul_test/test_accumul.pf
A       components/clm/src/main/test/accumul_test/CMakeLists.txt
A       components/clm/src/main/test/accumul_test

List all existing files that have been modified, and describe the changes:

========= Main changes, as described above
M       components/clm/src/main/accumulMod.F90
M       components/clm/src/biogeophys/TemperatureType.F90

========= Change PREC365 to col-level: with these changes, when it was
          at patch-level, it would be invalid over not-yet-active
          patches - yet it's needed there for the sake of PFT
          establishment in CNDV. Also initialize pbot to spval now that
          bug 2526 is resolved.
M       components/clm/src/main/atm2lndType.F90
M       components/clm/src/biogeochem/CNDVEstablishmentMod.F90

========= Need 'active' flag in gridcell_type (always true), so that
          gridcell_type has the same interface as other subgrid types in
          this respect
M       components/clm/src/main/GridcellType.F90

========= Abort if a field is missing from the restart file in a branch
          run (see above for details)
M       components/clm/src/utils/restUtilMod.F90.in

========= Cover accumulMod with unit tests
M       components/clm/src/main/test/CMakeLists.txt

========= Changes needed so that code under test can call get_proc_bounds
M       components/clm/src/unit_test_shr/unittestSubgridMod.F90

===============================================================
===============================================================
Tag name:  clm4_5_17_r266
Originator(s):  sacks (Bill Sacks)
Date: Mon Nov 27 19:43:39 MST 2017
One-line Summary: Avoid negative snow densities

Purpose of changes
------------------

For very low temperatures, fresh snow densities were negative. This was
only happening at extremely low temperatures (below -100 deg C), but
caused snow balance errors when it occurred.

In exploring the LoTmpDnsSlater2017 parameterization in
NewSnowBulkDensity, I came away with the following thoughts:

   It seems like there should be a limit on the temperature-dependent
   bifall value. I extracted this function into python and played with
   it for a few minutes:

          else if (new_snow_density == LoTmpDnsSlater2017) then 
             ! Andrew Slater: A temp of about -15C gives the nicest
             ! "blower" powder, but as you get colder the flake size decreases so
             ! density goes up. e.g. the smaller snow crystals from the Arctic and Antarctic
             ! winters
             bifall(c) = -(50._r8/15._r8 + 0.0333_r8*15_r8)*(forc_t(c)-tfrz) - 0.0333_r8*(forc_t(c)-tfrz)**2
          end if

   It looks like the intention is to have snow densities that increase
   with decreasing temperature (below -15 C), but the effect of this
   parabolic function is to have densities start coming back down as
   temperature decreases too low (below about -58 C). My sense is that
   we should do one of the following in the above block of code:

   (1) Limit bifall(c) to be no less than 50... my read of this code is
   that temperature-dependent bifall is never meant to go below 50.

   (2) For this cold-temperature-based bifall, use an "effective" forc_t
   that is never colder than about -58 C  or the point at which this
   function begins to decrease with further-decreasing temperatures. (We
   could determine the exact temperature at which this function turns
   over... -58 C is just an approximation.) I'm not positive that this
   is what's intended, but my read of the comment suggests that
   densities were never intended to start decreasing with
   further-cooling temperatures.

See comments and figures in
http://bugs.cgd.ucar.edu/show_bug.cgi?id=2536 for more details.

Leo van Kampenhout and Jan Lenaerts support limitation option 2, which
is my preference as well. Thus, this tag implements that limitation.

This change changes answers for (downscaled) atmospheric forcing
temperatures below -57.55 deg C. These very low temperatures are rare,
but they do sometimes occur, both in coupled runs and in offline runs.

Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID):
- 2536: Snow balance error

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing: none

Code reviewed by: Leo van Kampenhout

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    cheyenne - not run

  unit-tests (components/clm/src):

    cheyenne - pass

  tools-tests (components/clm/test/tools):

    cheyenne - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     cheyenne - not run

  regular tests (aux_clm):

    yellowstone_intel - ok 
    yellowstone_pgi --- ok
    yellowstone_gnu --- ok
    cheyenne_intel ---- ok
    cheyenne_gnu ------ ok
    hobart_nag -------- ok
    hobart_pgi -------- ok
    hobart_intel ------ ok

    ok means tests pass, answers change as expected

CLM tag used for the baseline comparisons: clm4_5_17_r265


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: all
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      larger than roundoff/same climate

      Many (but not all) tests show answer changes. Answers should only
      change for (downscaled) forcing temperatures below -57.55 deg C. I
      spot-checked one test with answer changes
      (SMS_D_Ld3.f10_f10_musgs.I1850Clm50BgcCrop.cheyenne_intel.clm-default). I
      checked H2OSNO and FSH in this test, in the last day's h0 file;
      these fields differ (relative to the baseline) in only one
      gridcell. TBOT was about -55 deg C in the daily average of the
      last day, so it seems reasonable that this forcing temperature was
      below -57.55 deg C at some point in the 3-day simulation.

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

M       components/clm/src/biogeophys/SnowHydrologyMod.F90
M       components/clm/src/biogeophys/test/SnowHydrology_test/test_SnowHydrology_newSnowBulkDensity.pf

===============================================================
===============================================================
Tag name:  clm4_5_17_r265
Originator(s):  erik (Erik Kluzek)
Date: Sat Nov 18 12:40:20 MST 2017
One-line Summary: Update the clm50 parameter file for better behavior with prognostic crop, and fix a bug in clm50 urban model

Purpose of changes
------------------

Update a few parameters to tweak prognostic crop harvest yields, adjusting FUN costs, and changing C4 crops and 
wheat by Keith Oleson, Dave Lawrence, and Danica Lombardozzi. Danica had this to say: 
  Overall, the wheat parameters work well (give us correct Fertilized - Unfertilized behavior 
  and reasonable crop yields), but the C4 crop parameters are less satisfying. The 2A parameter 
  changes still have trouble with the fertilized - unfertilized behavior in some regions and 
  lower yields, but seems to be the best combined set of behaviors since there seems to be 
  a direct tradeoff between the fertilized behavior and crop yields

Also a fix to urban initialization of rootfr for pervious road. It had used a magic number to assuming nlevsoi
was 10. Now we divide by the actual nlevsoi.


Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID): 2434
   2434 -- urban assumed to have 10 soil layers

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): None

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): None

Changes made to namelist defaults (e.g., changed parameter values): clm50 params file

Changes to the datasets (e.g., parameter, surface or initial files): clm50 parameter file

Substantial timing or memory changes: None

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): None

Changes to tests or testing: None

Code reviewed by: self,oleson

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing: regular

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    cheyenne - PASS

  unit-tests (components/clm/src):

    cheyenne - PASS

  regular tests (aux_clm):

    yellowstone_intel - OK
    yellowstone_pgi --- OK
    yellowstone_gnu --- OK
    cheyenne_intel ---- OK
    cheyenne_gnu ------ OK
    hobart_nag -------- OK
    hobart_pgi -------- OK
    hobart_intel ------ OK

CLM tag used for the baseline comparisons:  clm4_5_17_r264


Answer changes
--------------

Changes answers relative to baseline: YES, for CLM50

  Summarize any changes to answers, i.e.,
    - what code configurations: all clm50 (except non-urban and non-crop)
    - what platforms/compilers: all
    - nature of change: crop behavior changes, urban working better

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): None

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

M       components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml -- new params file
M       components/clm/src/biogeophys/SoilStateInitTimeConstMod.F90 ----- Divide by nlevsoi
            rather than assume nlevsoi is 10 with a magic number.

===============================================================
===============================================================
Tag name:  clm4_5_17_r264
Originator(s):  erik (Erik Kluzek)
Date: Thu Nov 16 13:35:59 MST 2017
One-line Summary: Changes from Dave Lawrenece on resetting soil carbon for spinup

Purpose of changes
------------------

Changes from Dave Lawrence so that total vegetation carbon (totvegc) is used for resetting soil carbon
stocks during the AD spinup exit (to determine if you should reset both carbon and nitrogen). Also read 
in totvegc for C13, and C14. These are then passed down into soilbiogechemistry nitrogenstate and carbonstate
restart to determine if the decomposition pools should be reset. The resetting is only done over non-crop
vegetation (ignoring both prognostic and generic crop types) and is only done on the exit_spinup phase
going out of accellerated decomposition mode.

Fix a couple small issues that in principle could change answers, but we didn't see answer changes in testing.
There was an error in how rootfr was initialized if it wasn't on the restart file. Made sure the crop patch
level restart variables are read after the enter_spinup code.

Bugs fixed or introduced
------------------------
  2406 -- Crop patch-level restart variables read after enter_spinup code
  2426 -- Error in rootfr for SoilStateType restart
  2447 -- dayl_factor not just exactly zero, but small

Bugs fixed (include bugzilla ID):

Known bugs introduced in this tag (include bugzilla ID): Following found
  2534 -- rootfr_road_perv calculation now incorrect for CLM50
  2533 -- c13/c14 isotope time-series is awkward for 1850 control (convert to streams file)
  2531 -- FATES doesn't call SoilBiogeochemCompetitionInit

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): None

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): None

Changes made to namelist defaults (e.g., changed parameter values): None

Changes to the datasets (e.g., parameter, surface or initial files): None

Substantial timing or memory changes: None

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): 
  SetNCrit in SoilBiogeochemNitrogenStateType.F90, should be SetCCrit, because totvegc is
  used rather than totvegn. 
  SoilBiogeochemPrecisionControlInit was added as a new method that could be extended to
  set ncrit and ccrit from namelist, or to set them from the settings for CNPrecisionControl
  that are read in by namelist

Changes to tests or testing: None

Code reviewed by: self,dlawren

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing: regular (without testing on cheyenne when tag was made)

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - PASS

  unit-tests (components/clm/src):

    yellowstone - PASS

  regular tests (aux_clm):

    yellowstone_intel - OK
    yellowstone_pgi --- OK
    yellowstone_gnu --- OK
    cheyenne_intel ---- Ran on yellowstone OK
    cheyenne_gnu ------ Ran on yellowstone OK
    hobart_nag -------- OK
    hobart_pgi -------- OK
    hobart_intel ------ OK

CLM tag used for the baseline comparisons:  clm4_5_17_r263


Answer changes
--------------

Changes answers relative to baseline: Yes, but only for spinup!

  Summarize any changes to answers, i.e.,
    - what code configurations: Only during spinup (at exit_spinup stage)
    - what platforms/compilers: All
    - nature of change: minor for spinup

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): None

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:
   M   components/clm/src/biogeochem/CNVegCarbonStateType.F90 --- Add totvegc_col (and cor c13/c14) to restart
   M   components/clm/src/biogeochem/CNVegetationFacade.F90 ----- Add get_totvegc_col to get the column level totvegc
   M   components/clm/src/main/clm_initializeMod.F90 ------------ Remove use of CNDriverInit, not needed
   M   components/clm/src/main/clm_instMod.F90 ------------------ Add call to SoilBiogeochemCompetitionInit
           do vegetation restart before soil bgc restart, pass totvegc down to soilbiogeochem_carbonstate restart (and nitrogenstate)
   M   components/clm/src/biogeophys/PhotosynthesisMod.F90 ------ Fix bug 2447 checking for small dayl_factor and not just exactly zero
   M   components/clm/src/biogeophys/SoilStateType.F90 ---------- Fix bug 2446 initialize rootfr only if rootfr not read in
   M   components/clm/src/soilbiogeochem/SoilBiogeochemNitrogenStateType.F90 ---- Add SetNCrit to set new module variable ncrit
           pass totvegc_col into restart, if it is lower than ncrit (and not crop) reset decomposition pools to zero
   M   components/clm/src/soilbiogeochem/SoilBiogeochemPrecisionControlMod.F90 -- Add SoilBiogeochemPrecisionControlInit, to set
           ncrit and ccrit now module variables and pass them down to carbonstate and nitrogenstate
   M   components/clm/src/soilbiogeochem/SoilBiogeochemCarbonStateType.F90 ------ Add SetCCrit to set new module variable ccrit
           pass totvegc_col into restart, if it is lower than ccrit (and not crop) reset decomposition pools to zero
           save restart_file_spinup_state and read it in with C12

===============================================================
===============================================================
Tag name:  clm4_5_17_r263
Originator(s):  erik (Erik Kluzek)
Date: Wed Nov  8 15:36:41 MST 2017
One-line Summary: Drydep vel. for SO2 doubled, influence of organic mater in soil calmed, max daylength not hardwired to present day

Purpose of changes
------------------

Keep the hydraulic conductivity for organic soil higher than it is for mineral soil. This was found to be an issue and fixed by 
Sean Swenson, Dave Lawrence, and Keith Oleson. Double dry deposition velocity for SO2 (Jean-Francois Lamaruque) for both clm4_5
and clm5_0.  Fix bug for value of NACTIVE at first time-step. Partial fix so that max daylengh isn't hardwired to present day at least
at initialization (see caveat below). Move the sample files for the mkprocdata_map tool (for mapping between unstructured grids
and regular lat lon grids) out of CLM and into $CSMDATA. Update the c13/c14 timeseries files to the 2.0 version as per Keith Lindsay.

Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID): 
 2530 -- organic soil influence varies wildly
 2304 -- NACTIVE at first time step
 1843 -- Max daylength now uses orbital parameters at initialization rather than hardwired to present day (partial)

Known bugs introduced in this tag:
 2529 -- SSP case that runs on cheyenne fails on hobart

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): None

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): None

Changes made to namelist defaults (e.g., changed parameter values): None

Changes to the datasets (e.g., parameter, surface or initial files): c13/c14 time-series files

Substantial timing or memory changes: None

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance):
  Max daylength will still be wrong in cases where variable_years is used, where the orbit
  changes after initializaiton. It'll start out correct and begin to diverge each year.
  Since, this feature is untested it's not worth going through the additional changes to
  correct it during the run.

  At the time the tag was made, cheyenne was down, so there are six tests that weren't confirmed to pass:
     ERS_D_Ld3.f19_f19_mg16.IHistClm40SpCruGs.cheyenne_intel.clm-40default
     ERS_Ly5_P60x1.f10_f10_musgs.IHistClm50BgcCrop.cheyenne_intel.clm-cropMonthOutput
     SMS_D_Ld5.f10_f10_musgs.I2000Clm50Fates.cheyenne_intel.clm-fates
     SMS_D_Ly2.1x1_numaIA.IHistClm50BgcCropGs.cheyenne_intel.clm-ciso_bombspike1963
     SMS_Ld1.f19_f19_mg16.IHistClm40SpCruGs.cheyenne_intel.clm-40default
     SMS_Ld1.f19_g17.I2000Clm50Vic.cheyenne_intel.clm-default

Changes to tests or testing: tools testing modified to point to files in CSMDATA

Code reviewed by: self,lamar,oleson,sacks,dlawren

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing: regular, tools

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    cheyenne - PASS

  unit-tests (components/clm/src):

    cheyenne - PASS

  tools-tests (components/clm/test/tools):

    cheyenne - PASS

  regular tests (aux_clm):

    yellowstone_intel - OK
    yellowstone_pgi --- OK
    yellowstone_gnu --- OK
    cheyenne_intel ---- OK
    cheyenne_gnu ------ OK
    hobart_nag -------- OK
    hobart_pgi -------- OK
    hobart_intel ------ OK

CLM tag used for the baseline comparisons:  clm4_5_16_r262


Answer changes
--------------

Changes answers relative to baseline: Yes!

  Summarize any changes to answers, i.e.,
    - what code configurations: clm4_5 and clm5_0
    - what platforms/compilers: all
    - nature of change: changes answers with bug fixes in a significant way

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: oleson/csm/clm50_r243_1deg_GSWP3V2_cropopt_nsc_hksat_hist


Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated:

        Remove sample files, move to CSMDATA, remove sample namelist
   D components/clm/tools/mkprocdata_map/clm4054_f19g16_I2000.clm2.h0.2000-01_c170430.nc
   D components/clm/tools/mkprocdata_map/map_ne30np4_nomask_to_fv1.9x2.5_nomask_aave_da_c121107.nc
   D components/clm/tools/mkprocdata_map/clm4054_ne30g16_I2000.clm2.h0.2000-01_c170430.nc
   D components/clm/tools/mkprocdata_map/mkprocdata_map_in

List all files added and what they do:

   A components/clm/tools/mkprocdata_map/README.filedescriptions -- Describe the files in this directory

List all existing files that have been modified, and describe the changes:

   M components/clm/test/tools/nl_files/mkprocdata_ne30_to_f19_I2000 - Point to files in CSMDATA rather than mkprocdata_map dir.

   M components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml -- Point to new v2.0 of the c13/c14 timeseries files

   M components/clm/src/biogeophys/SoilStateInitTimeConstMod.F90 -- Fix bug 2530 for organic mater influence in soil
   M components/clm/src/biogeochem/DryDepVelocity.F90 ------------- Double SO2 dry deposition rate
   M components/clm/src/biogeochem/CNFUNMod.F90 ------------------- Bug, 2304 for NACTIVE on history for first time-step
   M components/clm/src/biogeochem/ch4Mod.F90 --------------------- Bug, 2528, floating overflow for methane (doesn't change answers)
   M components/clm/src/main/clm_initializeMod.F90 ---------------- Bug, 1843, max daylength no longer hardwired to present day at initialization

===============================================================
===============================================================
Tag name:  clm4_5_16_r262
Originator(s):  sacks (Bill Sacks)
Date: Fri Oct 27 10:17:54 MDT 2017
One-line Summary: Rename atm2lnd history fields for downscaled fields, properly turn on vic for clm45, and other minor fixes

Purpose of changes
------------------

(1) Rename atm2lnd history fields for downscaled fields. The downscaled
    version is now the default. Non-downscaled history fields are now
    noted explicitly with a "_FROM_ATM" suffix. A detailed list of
    changes is given below.

(2) Properly turn on VIC for CLM45 compsets (fixes bug 2465)

(3) Use correct PE layouts for CISM1

(4) Remove CWDC_HR diagnostic field, which was always 0 (fixes bug 2502)

(5) Turn on U10_DUST diagnostic field by default (fixes bug 2246)

(6) Fix documentation of some variables

Detailed list of changes related to (1):

  Rain and snow:

    Old:
    - RAIN: "atmospheric rain" - NOT downscaled
    - Rainf: "atmospheric rain" - NOT downscaled
    - SNOW: "atmospheric snow" - NOT downscaled
    - RAIN_REPARTITIONED: "atmospheric rain, after rain/snow repartitioning based on temperature" - DOWNSCALED
    - SNOW_REPARTITIONED: "atmospheric snow, after rain/snow repartitioning based on temperature" - DOWNSCALED

    New:
    - RAIN: "atmospheric rain, after rain/snow repartitioning based on temperature" - DOWNSCALED
    - Rainf: "atmospheric rain, after rain/snow repartitioning based on temperature" - DOWNSCALED
    - SNOW: "atmospheric snow, after rain/snow repartitioning based on temperature" - DOWNSCALED
    - RAIN_FROM_ATM: "atmospheric rain received from atmosphere (pre-repartitioning)" - NOT downscaled
    - SNOW_FROM_ATM: "atmospheric snow received from atmosphere (pre-repartitioning)" - NOT downscaled

  Air temperature:

    Old:
    - TBOT: "atmospheric air temperature" - NOT downscaled
    - Tair: "atmospheric air temperature" - NOT downscaled
    - Tair_downscaled: "atmospheric air temperature downscaled to columns" - DOWNSCALED

    New:
    - TBOT: "atmospheric air temperature (downscaled to columns in glacier regions)" - DOWNSCALED
    - Tair: "atmospheric air temperature (downscaled to columns in glacier regions)" - DOWNSCALED
    - Tair_from_atm: "atmospheric air temperature received from atmosphere (pre-downscaling)" - NOT downscaled

  Atmospheric pressure:

    Old:
    - PBOT: "atmospheric pressure" - NOT downscaled
    - Psurf: "surface pressure" - NOT downscaled

    New:
    - PBOT: "atmospheric pressure at surface (downscaled to columns in glacier regions)" - DOWNSCALED
    - Psurf: "atmospheric pressure at surface (downscaled to columns in glacier regions)" - DOWNSCALED

  Atmospheric longwave radiation:

    Old:
    - FLDS: "atmospheric longwave radiation" - NOT downscaled
    - LWdown: "atmospheric longwave radiation" - NOT downscaled

    New:
    - FLDS: "atmospheric longwave radiation (downscaled to columns in glacier regions)" - DOWNSCALED
    - LWdown: "atmospheric longwave radiation (downscaled to columns in glacier regions)" - DOWNSCALED

  Potential temperature:

    Old:
    - THBOT: "atmospheric air potential temperature" - NOT downscaled

    New
    - THBOT: "atmospheric air potential temperature (downscaled to columns in glacier regions)" - DOWNSCALED

  Specific humidity:

    Old:
    - QBOT: "atmospheric specific humidity" - NOT downscaled
    - Qair: "atmospheric specific humidity" - NOT downscaled

    New:
    - QBOT: "atmospheric specific humidity (downscaled to columns in glacier regions)" - DOWNSCALED
    - Qair: "atmospheric specific humidity (downscaled to columns in glacier regions)" - DOWNSCALED


Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID):
- 2192: wrong units in comment for variables qflx_ev_snow, qflx_ev_soil,
  qflx_ev_h2osfc
- 2246: Turn on U10_DUST history field variable by default
- 2363: inline documentation is wrong in SoilTemperatureMod.F90
- 2401: Need to put in an "override" for PE layouts for CISM1
- 2465: ICLM45VIC compset doesn't actually turn VIC on
- 2502: CWDC_HR is identically zero
- 2503: Wrong units for FAREA_BURNED


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions):
- Changed meaning of some atm2lnd history fields: see above

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing: none

Code reviewed by: self; Sean Swenson did a conceptual review of the
changes in atm2lnd diagnostic fields

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    cheyenne - not run

  unit-tests (components/clm/src):

    cheyenne - pass

  tools-tests (components/clm/test/tools):

    cheyenne - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     cheyenne - not run

  regular tests (aux_clm):

    yellowstone_intel - ok 
    yellowstone_pgi --- ok
    yellowstone_gnu --- ok
    cheyenne_intel ---- ok
    cheyenne_gnu ------ ok
    hobart_nag -------- ok
    hobart_pgi -------- ok
    hobart_intel ------ ok

    ok means tests pass, answers change for some atm2lnd diagnostic
    fields as noted below

CLM tag used for the baseline comparisons: clm4_5_16_r261


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: all
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      - For most configurations: Changes diagnostic fields only (see
        below for list)
      - Changes CLM45 compsets with VIC: actually turns on VIC (there
        are no CLM45 tests with VIC in the test suite)

      Changes the following fields: FLDS, PBOT, QBOT, RAIN, SNOW, TBOT,
      THBOT: These now give downscaled versions of these fields.

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Rename atm2lnd history fields for downscaled fields
M       components/clm/src/main/atm2lndType.F90

========= Properly turn on VIC for CLM45 compsets
M       components/clm/cime_config/config_component.xml

========= Use correct PE layouts for cism1
M       components/clm/cime_config/config_pes.xml

========= Remove CWDC_HR diagnostic field
M       components/clm/src/biogeochem/CNVegCarbonFluxType.F90

========= Turn on U10_DUST by default
M       components/clm/src/biogeophys/FrictionVelocityMod.F90

========= Fix various documentation
M       components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml
M       components/clm/src/biogeophys/BareGroundFluxesMod.F90
M       components/clm/src/biogeophys/WaterfluxType.F90
M       components/clm/src/biogeophys/SoilTemperatureMod.F90
M       components/clm/src/biogeophys/SoilFluxesMod.F90
M       components/clm/src/biogeophys/CanopyFluxesMod.F90
M       components/clm/src/biogeophys/SoilHydrologyMod.F90
M       components/clm/src/biogeochem/CNVegStateType.F90

===============================================================
===============================================================
Tag name:  clm4_5_16_r261
Originator(s):  sacks (Bill Sacks)
Date: Wed Oct 25 07:37:24 MDT 2017
One-line Summary: Add option to reset snow over glacier columns

Purpose of changes
------------------

We have had an option to reset snow over non-glacier columns, using the
reset_snow namelist variable. This is useful when transitioning from a
spinup with one set of atmospheric forcings to a run with substantially
different atmospheric forcings. We originally did not provide an option
to reset snow over glacier columns, because we couldn't find a
satisfactory way to determine which glacier columns should and should
not be reset. However, members of the LIWG have found that it's hard to
analyze some test runs without this option.

This tag, therefore, provides an option to reset snow over glacier
columns, using a new namelist flag reset_snow_glc. You can optionally
provide an elevation threshold for this resetting: By setting
reset_snow_glc_ela to some elevation (in meters), only glacier columns
below this elevation get their snow packs reset. Note that you run the
risk of baking in answers with this (how much of the resulting spatial
patterns are due to your choice of where to reset snow?), but this can
still be useful in some cases. In general, this is meant for testing,
and not for "real" scientific production runs.

Original changes were from Leo van Kampenhout, with some refactoring by
Bill Sacks.


Bugs fixed or introduced
------------------------

Known bugs introduced in this tag (include bugzilla ID):
- 2525: test_build_namelist.pl fails in clm4_5_16_r260
  (this bug existed prior to this tag, but was first discovered here)

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables):
- New namelist variables:
  - reset_snow_glc: logical; if set to .true., resets the snow pack over
    glacier columns
  - reset_snow_glc_ela: elevation threshold for resetting snow pack over
    glacier columns

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing:
- reseedresetsnow testmod turns on snow resetting over glacier points,
  and so changes answers. It uses the reset_snow_glc_ela threshold that
  Leo has been using.

Code reviewed by: self, Leo van Kampenhout

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    cheyenne - ok (run on yellowstone)
    Tests in build-namelist_test.pl pass but change answers as expected
    due to new namelist options.

    NOTE: prove test_build_namelist.pl fails (see bug 2525)

  unit-tests (components/clm/src):

    cheyenne - pass

  tools-tests (components/clm/test/tools):

    cheyenne - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     cheyenne - not run

  regular tests (aux_clm):

    yellowstone_intel - ok 
    yellowstone_pgi --- ok
    yellowstone_gnu --- ok
    cheyenne_intel ---- ok
    cheyenne_gnu ------ ok
    hobart_nag -------- ok
    hobart_pgi -------- ok
    hobart_intel ------ ok

    ok means tests pass, NLCOMP failures as expected. Also, expected
    baseline failure:
    ERS_D.f19_g17.I1850Clm50BgcCrop.cheyenne_intel.clm-reseedresetsnow

    However, there were also baseline failures in these tests, due to
    problems with r260:

    (1)

    SMS_Ld5.f19_g17.IHistClm50Bgc.cheyenne_intel.clm-decStart
    SMS_Ld5.f19_g17.IHistClm50Bgc.yellowstone_pgi.clm-decStart
    SMS_Ld5.f19_g17.IHistClm50Bgc.yellowstone_intel.clm-decStart

    These are due to problems with the baseline, in terms of which cism
    history files are present. Baseline comparisons failed in the same
    way when using out-of-the-box r260. The current code seems correct
    in this respect, so this is just a problem with the baseline
    directories.

    (2)

    SMS_D_Ly2.1x1_brazil.IHistClm50BgcQianGs.cheyenne_intel.clm-ciso_bombspike1963

    Differences in C14 history fields. Baseline comparisons failed in
    the same way when using out-of-the-box r260. I can't tell if the
    baselines are correct or the trunk code is correct. I have asked
    Erik to look into this.

CLM tag used for the baseline comparisons: clm4_5_16_r260


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: Only tests with reseedresetsnow testmod
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      new climate for tests with this testmod

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Main changes
M       components/clm/src/biogeophys/SnowHydrologyMod.F90

========= Unit tests of new changes
M       components/clm/src/biogeophys/test/SnowHydrology_test/test_SnowHydrology_SnowCappingExcess.pf

========= Pass down new arguments
M       components/clm/src/main/clm_driver.F90
M       components/clm/src/biogeophys/HydrologyNoDrainageMod.F90
M       components/clm/src/biogeophys/LakeHydrologyMod.F90

========= New namelist variables
M       components/clm/bld/namelist_files/namelist_definition_clm4_5.xml
M       components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml
M       components/clm/bld/CLMBuildNamelist.pm

========= Changes to reseedresetsnow testmod to turn on the new option
M       components/clm/cime_config/testdefs/testmods_dirs/clm/reseedresetsnow/user_nl_clm

===============================================================
===============================================================
Tag name:  clm4_5_16_r260
Originator(s):  erik (Erik Kluzek)
Date: Tue Oct 24 15:59:41 MDT 2017
One-line Summary: Update paramater file for CLM50 as well as fates, fix a few issues

Purpose of changes
------------------

Update the parameter file for CLM5.0, changing: ekc_active,ekn_active,kn_nonmyc,psi50, and stem_leaf. Dave Lawrence,
Keith Oleson, Will Wieder, and Rosie Fischer were involved in changing these parameters to increase survivability of 
BDT Tropical and NDT Boreal and to slightly decrease the over-productivity of BDS boreal.

The version of FATES used was updated to one with the same API, but updated science (science_1.3.0 api_1.0.0).

There were a couple issues fixed as well. PTCLM was updated to fix a few issues and also allow us to test running
with an updated PTCLM user-mods-directory. So the US-UMB testing was updated to point to a freshly created directory.


Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID):
   2524 -- Run with decStart tests
   2523 -- Run with cnonly
   2522 -- PTCLMmkdata doesn't handle crop on or off well in latest CLM45/CLM50
   2521 -- Add warning for when PTCLMmkdata sets MPILIB to mpi-serial by default

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): None

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): 
    -crop option becomes a toggle for CLM_BLDNML_OPTS (so -no-crop is valid as well)
    Same setup for mksurfdata.pl was introduced as well (and for PTCLMmkdata)

Changes made to namelist defaults (e.g., changed parameter values): None

Changes to the datasets (e.g., parameter, surface or initial files): New parameter file for CLM5.0

Substantial timing or memory changes: None

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): None

Changes to tests or testing: USUMB tests updated, tests for PTCLM updated

Code reviewed by: self

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing: regular, tools

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    cheyenne - PASS (118 compare tests fail)

  unit-tests (components/clm/src):

    cheyenne - PASS

  tools-tests (components/clm/test/tools):

    cheyenne - PASS

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     cheyenne - OK (one expected fail)

  regular tests (aux_clm):

    yellowstone_intel - OK
    yellowstone_pgi --- OK
    yellowstone_gnu --- OK
    cheyenne_intel ---- OK
    cheyenne_gnu ------ OK
    hobart_nag -------- OK
    hobart_pgi -------- OK
    hobart_intel ------ OK

CLM tag used for the baseline comparisons:  clm4_5_16_r259


Answer changes
--------------

Changes answers relative to baseline: Yes for CLM50 and/or with fates

  Summarize any changes to answers, i.e.,
    - what code configurations: all configurations with CLM50 or CLM45 with Fates
    - what platforms/compilers: All
    - nature of change: Improvements in survivability of certain trees

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): PTCLM

    PTCLM to PTCLM2_171024b

List all files eliminated: None

List all files added and what they do: Missing file from previous tag

   A    components/clm/cime_config/testdefs/testmods_dirs/clm/decStart/user_nl_cism

List all existing files that have been modified, and describe the changes:

   M    components/clm/test/tools/TSMscript_tools.sh --------------------- Update PTCLM version of mapping data being pointed to
   M    components/clm/test/tools/nl_files/mksrfdt_10x15_1850 ------------ Change -no_crop option to -no-crop
   M    components/clm/test/tools/nl_files/mksrfdt_1x1_vancouverCAN_2000 - Change -no_crop option to -no-crop
   M    components/clm/tools/mksurfdata_map/mksurfdata.pl ---------------- Change -no_crop option to -no-crop toggle
   M    components/clm/bld/CLMBuildNamelist.pm --------------------------- Change -crop option to a toggle (so -no-crop is valid)
             Fix bug 2523 by setting bgc_spinup
   M    components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml --- Update parameter file for CLM50
   M    components/clm/cime_config/testdefs/testmods_dirs/clm/USUMB/user_nl_clm ---- Point to c171024 version of PTCLM data
   M    components/clm/cime_config/testdefs/testmods_dirs/clm/USUMB/shell_commands - Point to c171024 version of PTCLM data

===============================================================
===============================================================
Tag name:  clm4_5_16_r259
Originator(s):  erik (Erik Kluzek)
Date: Tue Oct 17 10:39:36 MDT 2017
One-line Summary: Update to latest cime from cesm2_0_beta07 and config_components version 3

Purpose of changes
------------------

Update CLM to use version 3 for config_components.xml which has additional error checking of compset names. Also
update it for mosart, cism and rtm. And cime is updated to the version used in cesm2_0_beta07. There are a few
new features brought in with the latest cime that are described below. CLM now requires one and only one modifier 
for what type it is in the compset name (i.e. only one "%" as in CLM45%BGC or CLM50%SP). Will now abort when
CLM build-namelist encounters a warning (after printing information on all warnings). To ignore the warnings
and continue add the new "-ignore_warnings" to CLM_BLDNML_OPTS. "-irrig" is now an option to CLM_BLDNML_OPTS
only for clm4_0, set "irrigate" namelist item in your user_nl_clm file for clm4_5 or clm5_0. By default build-namelist
sets irrigate to true for transient or present-day configurations if crop is on and clm5_0 (unless DV on). Get PTCLMmkdata fully
converted over to cheyenne, and create a new set of files for testing it's ability to create cases. Checking for
.true. or .false. in CLM build-namelist is now more robust and allows for "F" or "T" as newer FORTRAN versions do.


Fix several bugs as described below. PTCLM and CLM tools were both verified to work and pass testing.
The PE layout for f10 on hobart was changed to a single-node so that it would compare exactly to previous versions.
Fix a bug for NCK tests in RTM and MOSART. Get mksurfdata_map working correctly for f05. Error message when
you set finidat=' ' is more clear on what to do. You can also now do a cold-start for a hybrid case prints a warning),
but not allowed on a branch case.

Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID): 
  2519 -- Trouble setting use_aereoxid_prog=.false./
  2515 -- Setting finidat=' ' gives cryptic error message
  2510 -- Mapping files from the 1km grid can only be created on geyser
  2509 -- Bad mapping files for f05 resolution
  2504 -- hybrid/branch cases don't allow CLM_FORCE_COLDSTART to be on
  2494 -- MOSART test NLCOMP fails due to duplicate mosart_inparam in user_nl_mosart
  2477 -- Multiinstance mosart with REFCASE does not initialize

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions):
   This includes an update to cime, so some behavior is a little different than before (see section below)

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables):
    CLM now allows one and only one modifier for the type of configuration in the compset name 
    (i.e. CLM50%BGC or CLM45%SP (only one "%" modifier is allowed) ). "-irrig" is now only allowed as an option
    to CLM_BLDNML_OPTS for clm4_0, for clm4_5/clm5_0 the handling of irrigate is handled inside CLM build-namelist.
    Remove some no longer needed forcing definitions for compsets (the year range at the beginning of the compset name).
    Now abort on build-namelist warnings (but adding "-ignore_warnings" option to CLM_BLDNML_OPTS allow it to run without it).
    Remove compset forcings that aren't being used: 5505, C2R6, C2R8, C2R4, C1, GEOS (start of long compset names)

Changes to CIME user interface:
- Eleminate --user-compset. Clean up caseroot directory upon failed creation. 
- Check coupler fields for nan.
- New xml variable, readmode, 
- xmlquery --group has been changed go xmlquery --get-group
- New case.qstatus tool.
- Autodeletion of broken case dirs.
- Add --mail-user and --mail-type to case.submit.
- Remove --user-compset from create_newcase, allow compset longname in testname argument to create_test.
- New argument to create_clone (--user-mods-dir to also point to user-mods directory that will be used)

Changes made to namelist defaults (e.g., changed parameter values):
    Correct SCRIP grid file for f05 and add mapping files for them

Changes to the datasets (e.g., parameter, surface or initial files): None

Substantial timing or memory changes: None

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): None

Changes to tests or testing:
  clm-decStarts cism history is a bit different (shown as changing answers)
  Allow longname in tests
- Add --pesfile option to create_test.
- New --timeout flag for wait_for_tests
- CLM now needs to define its own LII and SSP tests (they already were put in place, now it's actually using them)

Code reviewed by: self

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing: regular, tools

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    cheyenne - PASS
          (216 compare tests fail comparing to clm4_5_16_r258 tag)

  unit-tests (components/clm/src):

    cheyenne - PASS

  tools-tests (components/clm/test/tools):

    cheyenne - PASS

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     cheyenne - OK

  regular tests (aux_clm):

    yellowstone_intel - OK
    yellowstone_pgi --- OK
    yellowstone_gnu --- OK
    cheyenne_intel ---- OK
    cheyenne_gnu ------ OK
    hobart_nag -------- OK
    hobart_pgi -------- OK
    hobart_intel ------ OK

CLM tag used for the baseline comparisons:  clm4_5_16_r258


Answer changes
--------------

Changes answers relative to baseline: No (bit for bit)

    clm/decStart tests were changed though

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): cime, cism, rtm, mosart
   cime   to cime5.4.0-alpha.03
   cism   to cism2_1_40
   rtm    to rtm1_0_63
   mosart to mosart1_0_28

List all files eliminated: Remove -irrig option for clm4_5/clm5_0 tests

  D   components/clm/cime_config/testdefs/testmods_dirs/clm/irrig_spunup/shell_commands
  D   components/clm/cime_config/testdefs/testmods_dirs/clm/clm50cropIrrigMonth_interp/shell_commands
  D   components/clm/cime_config/testdefs/testmods_dirs/clm/irrigOn_reduceOutput/shell_commands

List all files added and what they do: 

  A   components/clm/bld/namelist_files/LogMessages.pm - Log message, warning, exit and abort handling for perl

List all existing files that have been modified, and describe the changes:

          Update to new PTCLM directory for testing PTCLM cases
  M   components/clm/test/tools/nl_files/PTCLM_USUMB_Cycle_clm4_5 -- Change map_gdate
  M   components/clm/test/tools/nl_files/PTCLM_USUMB_Global_clm4_5 - Change map_gdate
  M   components/clm/test/tools/nl_files/PTCLM_USUMB_clm4_5 --------- Change map_gdate
  M   components/clm/test/tools/TSMscript_tools.sh -- Change user_mods directory used for PTCLM case

  M   components/clm/tools/mkmapdata/regridbatch.sh -- Get working on cheyenne

  M   components/clm/bld/namelist_files/namelist_defaults_clm4_5_tools.xml - Working f05 SCRIP grid file
  M   components/clm/bld/namelist_files/namelist_definition_clm4_5.xml ----- Remove irrig
  M   components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml ------- Change irrig to irrigate
           add mapping files for f05

         Set irrigate for use-cases, .true. for use_crop=T, use_cndv=F and not 1850
  M   components/clm/bld/namelist_files/use_cases/2000-2100_rcp8.5_transient.xml
  M   components/clm/bld/namelist_files/use_cases/stdurbpt_pd.xml
  M   components/clm/bld/namelist_files/use_cases/2000_glacierMEC_control.xml
  M   components/clm/bld/namelist_files/use_cases/1850_control.xml
  M   components/clm/bld/namelist_files/use_cases/1850-2100_rcp6_transient.xml
  M   components/clm/bld/namelist_files/use_cases/1850-2100_rcp2.6_transient.xml
  M   components/clm/bld/namelist_files/use_cases/1850-2100_rcp4.5_transient.xml
  M   components/clm/bld/namelist_files/use_cases/1850-2100_rcp8.5_transient.xml
  M   components/clm/bld/namelist_files/use_cases/20thC_transient.xml
  M   components/clm/bld/namelist_files/use_cases/1850_glacierMEC_control.xml
  M   components/clm/bld/namelist_files/use_cases/1850-2100_rcp2.6_glacierMEC_transient.xml
  M   components/clm/bld/namelist_files/use_cases/1850-2100_rcp6_glacierMEC_transient.xml
  M   components/clm/bld/namelist_files/use_cases/1850-2100_rcp4.5_glacierMEC_transient.xml
  M   components/clm/bld/namelist_files/use_cases/glacierMEC_pd.xml
  M   components/clm/bld/namelist_files/use_cases/2000_control.xml
  M   components/clm/bld/namelist_files/use_cases/1850-2100_rcp8.5_glacierMEC_transient.xml
  M   components/clm/bld/namelist_files/use_cases/20thC_glacierMEC_transient.xml

  M   components/clm/bld/CLMBuildNamelist.pm -- moving warnings, logging, exit, and fatal_error to LogMessages
        Add -ignore_warnings, -irrig is now only for clm4_0, pass $opts to add_default, not just {test},
        use value_is_true for all logical evalutions (extend it to all T or F), warnings will all be
        written out, and abort at the end (unless -ignore_warnings is used)
        don't die if clm_usr_name is set and didn't find user datasets, add final_exit on completion
  M   components/clm/bld/unit_testers/build-namelist_test.pl - Add tests for -ignore_warnings option
        handle -irrig for clm4_5

  M   components/clm/cime_config/config_compsets.xml -- Add I2000Clm50BgcCruGs compset
  M   components/clm/cime_config/config_pes.xml ------- Set PE count for f10 on hobart to single node
  M   components/clm/cime_config/testdefs/testmods_dirs/clm/irrig_spunup/user_nl_clm --------------- turn irrigate on
  M   components/clm/cime_config/testdefs/testmods_dirs/clm/clm50cropIrrigMonth_interp/user_nl_clm - turn irrigate on
  M   components/clm/cime_config/testdefs/testmods_dirs/clm/irrigOn_reduceOutput/user_nl_clm ------- turn irrigate on
  M   components/clm/cime_config/testdefs/testlist_clm.xml - 1x1_camdenNJ test with stub-GLC: I2000Clm50BgcCruGs
  M   components/clm/cime_config/config_component.xml --- Update to config_component version 3. CLM must have 1 and exactly
         one modifier, move setting of -irrig for 2000 and transient compsets to inside of CLM build-namelist
         remove some no longer needed forcing definitions for compsets
  M   components/clm/cime_config/buildnml - Print warning if branch and coldstart, allow colstart with hybrid
         Add warning if doing a coldstart

  M   components/clm/src/CMakeLists.txt - Add additional subdirectory for unit testing (from Bill Sacks)

  M   components/clm/src/main/controlMod.F90 - Allow use_crop=F and irrigate

  M   parse_cime.cs.status - Seperate out differences when baselines don't exist

===============================================================
===============================================================
Tag name:  clm4_5_16_r258
Originator(s):  erik (Erik Kluzek)
Date: Fri Oct  6 22:25:29 MDT 2017
One-line Summary: Revert change to fire, set n_melt_glcmec=10, update mosart to version that doesn't accumulate water in short rivers

Purpose of changes
------------------

Revert the changes to fire that came in clm4_5_16_r257. Add some notes that clarify that the code as is, is correct.
Set n_melt_glcmec=10.0 for clm5.0 (This should have happened in the fresh snow grain size change in clm4_5_16_r256).
Update mosart to a version that doesn't accumulate water in short rivers. This is done by explicitly making sure river length
isn't smaller than a minimum value.

Bugs fixed or introduced
------------------------

   2516 -- Mistaken bug for fire mortality calculations for some 

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): None

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): None

Changes made to namelist defaults (e.g., changed parameter values): 
     Changed n_melt_glcmec to 10.0d00 for clm5_0 (same as clm4_5, but double precision)

Changes to the datasets (e.g., parameter, surface or initial files): None

Substantial timing or memory changes: None

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): Some of the
   fire mortality code is confusing, we added some notes to clarify that's it's correct

Changes to tests or testing: None

Code reviewed by: self, dlawren, oleson, swenson

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing: regular

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    cheyenne - PASS (231 compare tests fail)

  unit-tests (components/clm/src):

    cheyenne - PASS

  regular tests (aux_clm):

    yellowstone_intel - OK
    yellowstone_pgi --- OK
    yellowstone_gnu --- OK
    cheyenne_intel ---- OK
    cheyenne_gnu ------ OK
    hobart_nag -------- OK
    hobart_pgi -------- OK
    hobart_intel ------ OK

CLM tag used for the baseline comparisons:  clm4_5_16_r257


Answer changes
--------------

Changes answers relative to baseline: Yes!

  Summarize any changes to answers, i.e.,
    - what code configurations: clm45/clm50 and/or with mosart
    - what platforms/compilers: all
    - nature of change: small

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): mosart
    mosart to rlen_min_n01_mosart1_0_26 (will bring trunk version of mosart in an upcoming tag)

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

M       components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml - set
M       components/clm/src/biogeochem/CNFireBaseMod.F90 --- Revert fire changes (bug 2516) add comments 
              use fm_droot as it's used to represent fraction of transport from livestem/livecroot to litter
              or to represent the fraction of plant-tissue mortality for deadstem/deadcroot
M       components/clm/src/biogeochem/CNFireLi2014Mod.F90 - Revert fire changes

===============================================================
===============================================================
Tag name:  clm4_5_16_r257
Originator(s):  erik (Erik Kluzek)
Date: Fri Sep 29 10:17:36 MDT 2017
One-line Summary: Fix two bugs found by Hui Tang, one for Carbon isotopes and one in the fire model

Purpose of changes
------------------

This is a fix for two bugs found by Hui Tang. One is for Carbon isotopes where a fix that came in for
clm4_5_11_r188, used leafc for too many of the isotope flux calculation calls. This changes it so the
correct terms are used for the particular flux.

The other fix is in the fire model where fire emissions were using the wrong fire related
mortality term for dead stem and should have been using a different type. Now it matches the
flux type, as well as the term used in combustion completness for the particular fire emission.

Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID): 
  2517 -- Bug in CNFireFluxes for some fire fluxes
  2516 -- Leafc wrongly used in too many CIsoFluxCalc calls.

Known bugs introduced in this tag (include bugzilla ID):  (new one found)
  2518 -- --- warnings from CLM build-namelist don't get sent out of preview_namelist


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): None

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): None

Changes made to namelist defaults (e.g., changed parameter values): None

Changes to the datasets (e.g., parameter, surface or initial files): None

Substantial timing or memory changes: None

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): None

Changes to tests or testing: None

Code reviewed by: self,oleson,dlawren,Hui Tang

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing: regular

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    cheyenne - PASS

  unit-tests (components/clm/src):

    cheyenne - PASS

  regular tests (aux_clm):

    yellowstone_intel - OK
    yellowstone_pgi --- OK
    yellowstone_gnu --- OK
    cheyenne_intel ---- OK
    cheyenne_gnu ------ OK
    hobart_nag -------- OK
    hobart_pgi -------- OK
    hobart_intel ------ OK

CLM tag used for the baseline comparisons:  clm4_5_16_r256


Answer changes
--------------

Changes answers relative to baseline: Yes!

  Summarize any changes to answers, i.e.,
    - what code configurations: clm45/clm50 with CN and fire on, and also for carbon isotopes
    - what platforms/compilers: all
    - nature of change: very small impact

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: /oleson/clm50_r255_fireiso_1deg_GSWP3V1_1850

   URL for LMWG diagnostics output used to validate new climate:
http://webext.cgd.ucar.edu/I1850/clm50_r255_fireiso_1deg_GSWP3V1_1850/lnd/clm50_r255_fireiso_1deg_GSWP3V1_1850_21_50-clm50_r255_coniso_1deg_GSWP3V1_1850_21_50/setsIndex.html
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): None

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

   M  components/clm/src/biogeochem/CNFireBaseMod.F90 --- Some fire emissions were using 
        fire related mortality for dead stem and should have been using a different type
        it should match the one used in the combustion completeness factor and the main
        type
   M  components/clm/src/biogeochem/CNFireLi2014Mod.F90 - Same change as above

   M  components/clm/src/biogeochem/CNCIsoFluxMod.F90 -- In the fix for bug 2116 that came
        in with clm4_5_11_r188, leafc was used in too many CNCIsoFluxCalc calls this corrects
        it to use the correct term

===============================================================
===============================================================
Tag name:  clm4_5_16_r256
Originator(s):  erik (Erik Kluzek)
Date: Wed Sep 20 15:42:17 MDT 2017
One-line Summary: Fresh snow grain radius is temperature dependent

Purpose of changes
------------------

Changes from Leo VanKampenhout to have fresh snow grain size a function of air temperature for CLM50.
Behavior is the same as before for CLM45 with fresh snow grain size a fixed parameter.  For CLM50
it's that same value (54.526) less than -30C and linear with T up to 204.526 at 0C, and 204.526 for 
temperatures greater than 0C.


Bugs fixed or introduced
------------------------

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): None

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables):
   Added namelist item: fresh_snw_rds_max

Changes made to namelist defaults (e.g., changed parameter values):
    fresh_snw_rds_max is snw_rds_min for clm4_5
    fresh_snw_rds_max is 204.526     for clm5_0

Changes to the datasets (e.g., parameter, surface or initial files): None

Substantial timing or memory changes:  None

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): None

Changes to tests or testing: None

Code reviewed by: self,L.vanKampenhout@uu.nl

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing: regular

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    cheyenne - PASS (343 compare tests fail since namelists change)

  unit-tests (components/clm/src):

    cheyenne - PASS

  regular tests (aux_clm):

    yellowstone_intel - OK
    yellowstone_pgi -   OK
    yellowstone_gnu -   OK
    cheyenne_intel -    OK
    cheyenne_gnu -      OK
    hobart_nag -        OK
    hobart_pgi -        PASS
    hobart_intel -      PASS

CLM tag used for the baseline comparisons:  clm4_5_16_r255


Answer changes
--------------

Changes answers relative to baseline: Yes, for clm5_0

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: clm5_0
    - what platforms/compilers: All
    - nature of change: more snow melt at expense of ice melt

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: oleson clm50_r251_SNOWGRAIN_2000

   URL for LMWG diagnostics output used to validate new climate:

http://webext.cgd.ucar.edu/B1850/b.e20.B1850.f09_g17.pi_control.all.196/lnd/b.e20.B1850.f09_g17.pi_control.all.196.8_27-b.e20.B1850.f09_g17.pi_control.all.195.8_27/set1/set1.html
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

   M  components/clm/src/biogeophys/SnowSnicarMod.F90 -- Pass atm2lnd_inst in, make sure snw_rds isn't less than the min parameter
        create a function for setting FreshSnowRadius, dependent on atm2lnd_inst (for air temperature), the function sets to min
        parameter if fresh_snw_rds_max is same as min (clm45), or to min at less than -30C linear between fresh_snw_rds_max and min parameter
        up to 0C, and then at fresh_snw_rds_max value for clm50.
   M  components/clm/src/biogeophys/AerosolMod.F90 ----- Add InitReadNML and fresh_snw_rds_max
   M  components/clm/src/main/clm_driver.F90 ----------- Pass atm2lnd_inst down to SnowAgeGrain
   M  components/clm/src/main/clm_instMod.F90 ---------- Pass NLFilename to aerosol_inst%Init

   M  components/clm/bld/CLMBuildNamelist.pm - Set fresh_snw_rds_max, and add aerosol namelist

   M  components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml --- Set fresh_snw_rds_max for clm45 and clm50
   M  components/clm/bld/namelist_files/namelist_definition_clm4_5.xml - Define fresh_snw_rds_max

===============================================================
===============================================================
Tag name:  clm4_5_16_r255
Originator(s):  erik (Erik Kluzek)
Date: Mon Sep 18 21:21:29 MDT 2017
One-line Summary: Changes to crop and enabling Carbon isotopes for crop and some miscellaneous small changes

Purpose of changes
------------------

Changes for crop on as well as enabling carbon isotopes when crop is on. Fix some small answer changing issues. 
Also bring in new timeseries datasets for C14 as well as now C13. The C14 dataset has hardwired latitude sectors 
it uses (so previous file can NOT be used). Properly handle and update C13/C14 variables when crop is on.
Handle CIsoFluxCalc calls for a list of crop specific fields. Add cropseedc_deficit, to storvegc as well as totveg.
Send livestemc to litter for prognostic crop. Ignore downreg for carbon isotopes in Fractionation subroutine.
For dynamic roots, use rooting values on parameter dataset which is set to values from PFT=1.

Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID): 
  2508 -- Incorrect landuse.timeseries datasets for f09 and hcru for rcp=8.5 in r254
  2489 -- Set c/nnegcrit for clm45/clm50 (10X higher for clm45 than clm50)
  2412 -- Initialize rootfr to PFT==1 value for dynamic roots -- update params files
  2396 -- make subtraction the default behavior for clm4_5.
  2316 -- update carbon isotopes same as C12: CNVegCarbonStateType.F90
  2211 -- Fix time used for Ciso time series

Known bugs introduced in this tag (include bugzilla ID):
  2511 -- Overflow with Carbon isotopes

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions):
   Change to restarts when c-isotopes on

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables):
   New namelist items: use_c13_timeseries, atm_c13_filename
   New history vars:   C13_GRAINC, C13_CROPSEEDC_DEFICIT, C14_GRAINC, C14_CROPSEEDC_DEFICIT

Changes made to namelist defaults (e.g., changed parameter values):
   Set cnegcrit/nnegcrit for CLM45/CLM50

Changes to the datasets (e.g., parameter, surface or initial files):
   New C13 and C14 timeseries files
   New params files, but only answer changing part is for dynamic roots 
       (setup bare-soil on file to match what's used for PFT=1)
   Bring in correct datasets for rcp8.5 for f09 and hcru
   1x1_numaIA 1850 and 1850-2000 transient files

Substantial timing or memory changes: None

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance):
   The C13/C14 timeseries should be implemented with streams for greater flexibility, robustness, and code
   reuse. The new C14 timeseries file is hardcoded for three specific latitude sectors, and thus can't use
   the previous file, nor a file of a different configuration. Downreg is passed down from get_downreg_patch 
   in clm_driver, to CanopyFluxes to Fractionation, but no longer used (it should be removed).
  
   Note the following from Dave: While debugging crop isotope code, found that cpool_patch and frootc_patch 
     could occasionally be very small but nonzero numbers after crop harvest, which persists 
     through to next planting and for reasons that could not 100% isolate, caused C12/C13 ratios to occasionally 
     go out of bounds. Zeroing out these small pools and putting them into the flux to the atmosphere solved many 
     of the crop isotope problems

Changes to tests or testing: Added some tests, two of the new tests fail due to bug 2511

Code reviewed by: self, koven, dlawren, dll, oleson

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing: regular

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    cheyenne - PASS (234 comparison tests fail)

  unit-tests (components/clm/src):

    cheyenne - PASS

  regular tests (aux_clm):

    yellowstone_intel - OK
    yellowstone_pgi -   OK
    yellowstone_gnu -   OK
    cheyenne_intel -    OK
    cheyenne_gnu -      OK
    hobart_nag -        OK
    hobart_pgi -        OK
    hobart_intel -      OK

CLM tag used for the baseline comparisons:  clm4_5_16_r254


Answer changes
--------------

Changes answers relative to baseline: Yes!

  Summarize any changes to answers, i.e.,
    - what code configurations: Crop, Carbon-isotopes

    - what platforms/compilers: All
    - nature of change:  
        small change to crop with missing updates, crop with carbon-isotopes are now enabled

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): None

List all files eliminated:

D       components/clm/src/biogeochem/C14BompbSpikeMod.F90 --- Change name to more general

List all files added and what they do:

A       components/clm/src/biogeochem/CNCIsoAtmTimeSeriesReadMod.F90 -- Handle time series
             for both C13 and C14

List all existing files that have been modified, and describe the changes:

M       components/clm/src/biogeochem/CNPhenologyMod.F90 -------- Remove subtract_cropseed always do when crop on, pass c13/c14
           instances down to CNPhenology and CropPhenology. After setting C12-leafc_xfer/totvegc set the c13/c14 
           leafc_xfer/totvegc as well
M       components/clm/src/biogeochem/CNCStateUpdate1Mod.F90 ---- Change location of xsmrpool update. Dave added this note:
             While debugging crop isotope code, found that cpool_patch and frootc_patch 
             could occasionally be very small but nonzero numbers after crop harvest, which persists 
             through to next planting and for reasons that could not 100%
             isolate, caused C12/C13 ratios to occasionally go out of
             bounds. Zeroing out these small pools and putting them into the flux to the
             atmosphere solved many of the crop isotope problems
M       components/clm/src/biogeochem/CNCIsoFluxMod.F90 --------- Add CIsoFluxCalc calls for: soilc_change, cpool_to_resp, 
           grainc_xfer_to_|grainc|food|seed, crop_seedc_to_leaf, grain_|curmr|xsmr, cpool_|grain|grain_storage|_gr, cpool_to_|grainc|grainc_storage,
           transfer_grain_gr, grainc_storage_to_xfer, livestemc_to_litter, and if use_grainproduct for ciso-grainc_to_cropprodc/grain_mr
           pass iso totvegc_path for hrv_xsmrpool_to_atm CIsoFluxCalc, section adding livestemc to litter for crop
           add additional check for ciso_state(i) /= 0 for divide by check in CIsoFluxCalc
M       components/clm/src/biogeochem/CNPrecisionControlMod.F90 - Handle c13/c14 TruncateCandNStates for grainc/storage/xfer,
           cropseedc_deficit_patch and xsmrpool
M       components/clm/src/biogeochem/CNVegCarbonStateType.F90 -- Add: C13_GRAINC, C13_CROPSEEDC_DEFICIT, C14_GRAINC, C14_CROPSEEDC_DEFICIT
           restartvar calls explicit for c12, c13, c14: grainc, grainc_storage, grainc_xfer (with c13 and c14 for ciso)
           add cropseedc_deficit, to storvegc as well as totvegc, fix bug 2316 make cisotopes the same as C12
M       components/clm/src/biogeochem/CNDriverMod.F90 ----------- Pass more c13/c14 instances down to CNPhenology calls
M       components/clm/src/main/controlMod.F90 ------------------ Add namelist items: use_c13_timeseries, atm_c13_filename
            remove abort when crop and use_c13/use_c14 is on
M       components/clm/src/main/clm_initializeMod.F90 ----------- Add call to C13_init_TimeSeries
M       components/clm/src/biogeophys/PhotosynthesisMod.F90 ----- Handle C13 timeseries (call C13TimeSeries), put C14 bombspike data in 
            hard-wired latitude sectors, ignore downreg for carbon isotopes in Fractionation subroutine
M       components/clm/src/biogeophys/RootBiophysMod.F90 -------- Use parameters for roots from params file for bare-soil rather than
            an explicit if statement for it

M       components/clm/bld/CLMBuildNamelist.pm ------------------- Add cnegcrit/nnegcrit, allow crop and C-isotopes to be
            on at the same time, add c13 time-series
M       components/clm/bld/unit_testers/build-namelist_test.pl --- Change testing for time-series

M       components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml ----- New datasets for atm_c14_filename, and 
            atm_c13_filename, new paramdata files, set cnegcrit/nnegcrit, flanduse_timeseries for f09 and hcru @ rcp=8.5
M       components/clm/bld/namelist_files/namelist_definition_clm4_5.xml --- Add: use_c13_timeseries, atm_c13_filename
            update similar documenation on c14 bombspike
M       components/clm/bld/test_build_namelist/t/input/namelist_definition_clm4_5_test.xml -- Same as changes above

M       components/clm/cime_config/testdefs/testmods_dirs/clm/ciso_bombspike1963/user_nl_clm - Set use_c13_timeseries=T
M       components/clm/cime_config/testdefs/testlist_clm.xml - Change two ciso transient tests to include crop, add transient
                crop ciso test

M       components/clm/cime_config/testdefs/ExpectedTestFails.xml -- Add expected fails for new ciso overflow bug 2511

===============================================================
===============================================================
Tag name:  clm4_5_16_r254
Originator(s):  erik (Erik Kluzek)
Date: Fri Sep  1 00:09:25 MDT 2017
One-line Summary: Update surface datasets, and point to new CMIP6 population density dataset

Purpose of changes
------------------

Update all surface datasets to new versions that have updated soil albedo, and use latest PFTCFT files. Also
get mksurdata_map fully working on cheyenne for batch mode. Point to latest CMIP6 population density dataset
for historical case, this is with HYDE3.2 data. New fsurdat files for 16pft are with irrigation on. If ask for
irrig=F and 16pft won't be able to find any files.

Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID):
 2479 --- Irrigation is occurring in non-prognostic-crop runs

Known bugs introduced in this tag (include bugzilla ID): (found ...)
 2506 --- ntree used before it's set in pftconMod.F90 2017-08-25
 2505 --- Set stream_year_first_urbantv/last for CLM4.5 just for consistency  2017-08-25
 2504 --- hybrid/branch cases don't allow CLM_FORCE_COLDSTART to be on  2017-08-18
 2503 --- Wrong units for FAREA_BURNED  2017-08-16
 2502 --- CWDC_HR is identically zero 2017-08-16
 2500 --- ne30 case fails on hobart_nag due to floating overflow


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): -irrig .true. is needed without -crop
   fsurdat files without crop are all just with irrigation on.

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): None

Changes made to namelist defaults (e.g., changed parameter values): Datasets

Changes to the datasets (e.g., parameter, surface or initial files): new fsurdat, landuse.timeseries, popdens

Substantial timing or memory changes: None

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers: none

Changes to tests or testing: none

Code reviewed by: self

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing: regular

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    cheyenne - PASS

  unit-tests (components/clm/src):

    cheyenne - PASS

  tools-tests (components/clm/test/tools):

    cheyenne - PASS

  regular tests (aux_clm):

    yellowstone_intel - OK
    yellowstone_pgi -   OK
    yellowstone_gnu -   OK
    cheyenne_intel -    OK
    cheyenne_gnu -      OK
    hobart_nag -        OK
    hobart_pgi -        OK
    hobart_intel -      OK

CLM tag used for the baseline comparisons:  clm4_5_16_r253


Answer changes
--------------

Changes answers relative to baseline: Yes!

  Summarize any changes to answers, i.e.,
    - what code configurations:   CLM45/CLM50
    - what platforms/compilers:   All
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
       similar climate CLM4.5/CLM5.0 surface datasets change with latest soil albedo and small changes form raw PFTCFT files.
       also an updated population-density dataset used for historical

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): None

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

   M   components/clm/tools/mksurfdata_map/mksurfdata.pl -- Add rundir option, if 16pfts add Irrig to filename
   M   components/clm/tools/mksurfdata_map/Makefile.data -- Get working on cheyenne or yellowstone

   M   components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml ------- Default resolution and sim_year,
            set irrig to .true. when crop off, update fsurdat, flanduse_timeseries, stream_fldfilename_popdens
   M   components/clm/bld/namelist_files/namelist_defaults_clm4_5_tools.xml - Update soil-color and PFTCFT files

   M   components/clm/bld/CLMBuildNamelist.pm --- check irrig for fsurdat files, fsurdat with 16pft is with irrig=T
            make sure set only set irrigate when use_crop on
   M   components/clm/bld/unit_testers/build-namelist_test.pl -- More tests w clm5_0, irrigate=T set without crop
   M   components/clm/bld/unit_testers/NMLTest/CompFiles.pm ---- Add more documentation

   M   components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_spunup_1way/user_nl_clm - Update finidat with
            updated fsurdat file

   M   components/clm/src/biogeophys/PhotosynthesisMod.F90 -- FPSN_W? variables are default off, and instant averaged

===============================================================
===============================================================
Tag name:  clm4_5_16_r253
Originator(s):  erik (Erik Kluzek)
Date: Fri Aug  4 20:23:25 MDT 2017
One-line Summary: Check on reasonable import/export from CLM, check ndep units from input file

Purpose of changes
------------------

Do some reasonable physical checks on the import/export state to/from CLM. Checking for NaN's and
that solar should be greater or equal to zero, LW down, specific humidity greater than zero.
Check the units on the input nitrogen deposition file and if per year divide by seconds per year,
leave alone if per seconds, and die if units aren't recognized. Increase the tolerence for warnings
for Nitrogen, Carbon, and soil energy balance. Add missing MPI broadcasts for two ndep namelist variables.
Fix an LII test that was failing. Change the PE layout for f4x5 grids for yellowstone and cheyenne.
Add -die_on_duplicate option to parse_cime.cs.status and have summary option add notes about expected fails.


Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID): [If none, remove this line]
  2498 -- missing MPI bcast
  2499 -- Update finidat file so LII case will work
  2484 -- Check for units of ndep only divide by seconds in a year if units are per year

Known bugs introduced in this tag (include bugzilla ID): [If none, remove this line]
  NGEET/fates-clm/#16 -- FATES changes answers at a level of at least roundoff when the PE layout changes
  NGEET/fates-clm/#15 -- CLM-FATES can't restart when PE layout is change
  ESMCI/cime/#1793 ----- Run time error for mpi-serial case on cheyenne_intel when created with aux_clm create_testd


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions):
   units for ndep input files can either be g(N)/m2/yr or g(N)/m2/s, will now abort for anything else

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): None

Changes made to namelist defaults (e.g., changed parameter values): None

Changes to the datasets (e.g., parameter, surface or initial files): None

Substantial timing or memory changes: None

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): None

Changes to tests or testing: Added test with CMIP6 ndep file

Code reviewed by: self

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing: regular

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    cheyenne - PASS

  unit-tests (components/clm/src):

    cheyenne - PASS

  regular tests (aux_clm):

    yellowstone_intel - OK
    yellowstone_pgi - OK
    yellowstone_gnu - OK
    cheyenne_intel - OK
    cheyenne_gnu - OK
    hobart_nag - OK
    hobart_pgi - OK
    hobart_intel - OK

CLM tag used for the baseline comparisons:  clm4_5_16_r253


Answer changes
--------------

Changes answers relative to baseline: No bit-for-bit (although FATES tests change because of the PE layout change)

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): None

List all files eliminated: None

List all files added and what they do: Add test mods for case with CMIP6 ndep forcing that has different units/variable name

A  +    components/clm/cime_config/testdefs/testmods_dirs/clm/clm50CMIP6frc

List all existing files that have been modified, and describe the changes:

M       components/clm/cime_config/config_pes.xml ------------- Update f45 PE layout for yellowstone/cheyenne
M       components/clm/cime_config/testdefs/testlist_clm.xml -- Add clm50CMIP6frc test
M       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_spunup_1way/user_nl_clm - Update finidat file so
            LII test will pass

M       components/clm/src/biogeochem/CNBalanceCheckMod.F90 - Lower amount of warnings written out for C and N by order of mag.
M       components/clm/src/biogeochem/CropType.F90 ---------- Add if-masterproc to write statement
M       components/clm/src/biogeophys/BalanceCheckMod.F90 --- Lower amount of warnings written out for soil energy balance 
M       components/clm/src/cpl/lnd_import_export.F90 -------- Add checking for physically bad import or export data
           ensuring no NaN's are exchanged, solar >= 0, LW-dn > 0, q > 0
M       components/clm/src/main/ncdio_pio.F90.in ------------ Remove write to log file from all tasks
M       components/clm/src/main/ndepStreamMod.F90 ----------- Do mpi_bast for ndep_varlist/ndep_taxmode, check units
          of input ndep variable and divide by seconds in a year if g(N)/m2/yr, but leave alone for g(N)/m2/s otherwise die

M       parse_cime.cs.status - Add -die_on_duplicate option, and have summarize option make notes about expected fails

===============================================================
===============================================================
Tag name:  clm4_5_16_r252
Originator(s):  erik (Erik Kluzek)
Date: Mon Jul 24 16:57:42 MDT 2017
One-line Summary: Update parameter file for some crop albedo issues, and fix a bug in urban albedo for nightime

Purpose of changes
------------------

Bring in a new CLM50 parameter file that updates a few fields for prognostic crop with affect on crop albedo
(rholnir,taulnir,taulvis,xl). Bring in changes to fix urban albedo for nighttime from Keith Oleson. Rather than set 
albedo's for the urban canyon all to 1.0, set them to the viewfactors, as that will result in combined albedo of
one, whereas the previous way ended up with albedo's greater than one.

Here's a description from Keith about the change in urban albedo. " For diffuse radiation, which is 
independent of solar zenith angle, the road albedos appear to be exactly equal to the road-sky view 
factor.  And the wall albedos are equal to the wall-sky view factor. So the albedos are the albedo 
of the surface (1.0) times the appropriate view factor.  This makes sense.  All incident radiation
entering the canyon should be reflected to the sky and the contribution of each surface is according 
to the view factor of each surface to the sky as determined by the height to width ratio.  The view 
factors of the two walls and the road to the sky sums to 1.0.  So setting the diffuse albedos to 
these values when the sun is below the horizon results in a scaled diffuse albedo of 1.0.  For direct 
radiation, it's more complicated because the solar zenith angle is involved when running the 
radiation model.  However, it seems reasonable to assume the same albedos for direct as for diffuse."

Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID):
 2492 -- Urban scalings can lead to albedo values greater than 1

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): None

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): None

Changes made to namelist defaults (e.g., changed parameter values): None

Changes to the datasets (e.g., parameter, surface or initial files):New params file for CLM50
   Updates rholnir,taulnir,taulvis,xl for prognostic crop fields

Substantial timing or memory changes: None

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): None

Changes to tests or testing: None

Code reviewed by: self,oleson

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing: regular

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    cheyenne ---- PASS (60 clm50 tests are different as expected)

  unit-tests (components/clm/src):

    cheyenne ---- PASS

  regular tests (aux_clm): (31 Clm45 tests are different than baseline in cpl hist files for: 
                           l2x_Sl_avsdr ("dr" and "df" and "av" and "an") as expected)

    yellowstone_intel - OK
    yellowstone_pgi --- OK
    yellowstone_gnu --- OK
    cheyenne_intel ---- OK
    cheyenne_gnu ------ OK
    hobart_nag -------- OK
    hobart_pgi -------- OK
    hobart_intel ------ OK

  Tests: ERS_Ld5_Mmpi-serial.1x1_vancouverCAN.I1PtClm45SpGs.cheyenne_intel.clm-default,
         ERS_Ld5_Mmpi-serial.1x1_vancouverCAN.I1PtClm45SpGs.yellowstone_intel.clm-default
        show: FSR, FSRND, and FSRVD different

CLM tag used for the baseline comparisons:  clm4_5_16_r251


Answer changes
--------------

Changes answers relative to baseline: Yes for CLM50, and for CLM45 when coupled to CAM

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM50 (CLM45 when coupled to CAM and albedos passed to coupler for any case)
    - what platforms/compilers: all
    - nature of change: similar climate

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: 
       oleson/b.e20.B1850.f09_g17.pi_control.all.186.alb

   URL for LMWG diagnostics output used to validate new climate:

http://webext.cgd.ucar.edu/B1850/b.e20.B1850.f09_g17.pi_control.all.186.alb/lnd/b.e20.B1850.f09_g17.pi_control.all.186.alb.17_36-b.e20.B1850.f09_g17.pi_control.all.186.17_36/setsIndex.html
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): None

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

   M  components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml - Updated params file for CLM50
   M  components/clm/src/biogeophys/UrbanAlbedoMod.F90 --------------- Fix bug 2492. Set albedo's of
        urban surfaces to view factors, by default and for solar zenith angles below horizon.

===============================================================
===============================================================
Tag name:  clm4_5_16_r251
Originator(s):  erik (Erik Kluzek)
Date: Fri Jul 14 01:38:38 MDT 2017
One-line Summary: Update mksurfdata_map for soil depth/color, add new mapping files

Purpose of changes
------------------

Bring in new soil color (from Peter Lawrence) dataset for mksurfdata_map. Also bring
in a new soil depth dataset that uses a mask for when soil depth > 0. Bring in a version
of PTCLM that's working with this cime.

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): None

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): None

Changes made to namelist defaults (e.g., changed parameter values):
    New mapping files for soil depth for mksurfdata_map
    New soil color data for mksurfdata_map
    New soil depth dataset on the map defined by when soil depth > 0

Changes to the datasets (e.g., parameter, surface or initial files): None

Substantial timing or memory changes: None

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers: None

Changes to tests or testing: None

Code reviewed by: self

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing: tools

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - PASS

  unit-tests (components/clm/src):

    yellowstone - PASS

  tools-tests (components/clm/test/tools):

    yellowstone - PASS
    cheyenne - PASS

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - OK

CLM tag used for the baseline comparisons:  none


Answer changes
--------------

Changes answers relative to baseline: No, bit-for-bit (CLM code wasn't changed)

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): PTCLM

    PTCLM to PTCLM2_170706

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

   M   components/clm/tools/mkmapdata/regridbatch.sh -- go back to using 8 processors
   M   components/clm/tools/mkmapdata/mkmapdata.sh ---- add mapping for 5x5min_ORNL-Soil,
           change check for $MPIEXEC, so ignores arguments
   M   components/clm/tools/mksurfdata_map/mksurfdata.pl -- Remove extra "_" in "__CMIP6_"
   M   components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml -- New
           5x5min-ORNL-Soil mapping files
   M   components/clm/bld/namelist_files/namelist_defaults_clm4_5_tools.xml - SCRIP
           grid file for 5x5min-ORNL-Soil, change soildepth mask to ORNL-Soil
           update soil color and soil depth datasets
   M   components/clm/bld/namelist_files/namelist_definition_clm4_5.xml - Add
           ORNL-Soil mask

===============================================================
===============================================================
Tag name:  clm4_5_16_r250
Originator(s):  erik (Erik Kluzek)
Date: Thu Jul 13 13:54:13 MDT 2017
One-line Summary: Update finundation dataset, new fsurdat files with updated soil color 
                  and soil depth, update mosart areas, fix cheyenne_gnu

Purpose of changes
------------------

Update all fsurdat datasets with updated soil color and soil depth. Soil color as modified by Peter Lawrence.
Soil depth was modified to use a mask for soil depth>0 which makes the minimum soil depth 3cm (model still has
a minimum of 40cm). Also updated area's for the mosart routing file (the previous areas were off by up to about 1%).
the update to the area's will influence fluxes. Also fix a problem so that cheyenne_gnu will work (remove pure
attribute from two functions).

Also bring in the updated finundation inversion from Sean Swenson. This will change the methane output
significantly for CLM50BGC cases. The previous inversion file was incorrect and shouldn't be used! The new file is also
at a higher resolution 1-degree rather than 2-degree.


Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID):
  2493 (gnu6.3.0 compiler doesn't like "pure" functions that use outside modules, especially public ones)

Known bugs introduced in this tag (include bugzilla ID):
  2491 (Error in Banddiagonal in latest CESM simulation) (found in Cecile's coupled simulation)


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): None

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): None

Changes made to namelist defaults (e.g., changed parameter values): Just datasets see below

Changes to the datasets (e.g., parameter, surface or initial files): Update all fsurdat and the
   stream_fldfilename_ch4finundated file

   fsurdat files have soil color and soil depth updated. The finundated file is now at f09 resolution
   rather than f19, and the previous file was incorrect.

Substantial timing or memory changes: None

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): None

Changes to tests or testing: None

Code reviewed by: self

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing: regular

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - PASS

  unit-tests (components/clm/src):

    yellowstone - PASS

  regular tests (aux_clm):

    yellowstone_intel - OK
    yellowstone_pgi - OK
    yellowstone_gnu - OK
    cheyenne_intel - OK
    cheyenne_gnu - OK
    hobart_nag - OK
    hobart_pgi - OK
    hobart_intel - OK

CLM tag used for the baseline comparisons:  clm4_5_16_r249


Answer changes
--------------

Changes answers relative to baseline:

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM45/CLM50 or with MOSART
    - what platforms/compilers: all
    - nature of change: similar climate, methane outputs are substantially changed

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): mosart
   mosart update to mosart1_0_26

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

  M components/clm/src/biogeophys/SnowHydrologyMod.F90 -- Remove pure attribute from OverburdenCompactionVionnet2012
  M components/clm/src/biogeophys/IrrigationMod.F90 ----- Remove purse attribute from PointNeedsCheckForIrrig

  M components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml -- Update all fsurdat files and stream_fldfilename_ch4finundated

===============================================================
===============================================================
Tag name:  clm4_5_16_r249
Originator(s):  sacks (Bill Sacks)
Date: Thu Jul  6 14:32:40 MDT 2017
One-line Summary: All new compsets, reworked test lists, and related fixes

Purpose of changes
------------------

The changes here were a joint effort between Dave Lawrence, Ben Andre, Erik
Kluzek, Mariana Vertenstein and Bill Sacks

(1) All new compset aliases, with the following changes:

    (a) Most compset aliases are now for CLM5, with fewer CLM45 compsets and
        even fewer CLM40 compsets.

    (b) Compset aliases now use capitalization of only the first letter of each
        piece, to avoid the alphabet soup problem. For example,
        IHistClm50BgcCrop

    (c) Some other tweaks have been made to compset aliases, such as always
        listing the time period and Sp (satellite phenology) explicitly

    (d) Compsets use GSWP3 forcing unless the alias specifies otherwise

    (e) Compsets use CISM2%NOEVOLVE - and so use glc_mec in CLM - unless the
        alias has Gs (for GLC - stub)

    (f) An evolving ice sheet (CISM2%EVOLVE) is now denoted by having a final
        'G' in the compset alias
        
(2) Completely reworked test lists:

    (a) Use new aliases

    (b) Changed most tests to CLM5

    (c) Merged the aux_clm45 and aux_clm40 test categories into aux_clm

    (d) Removed the 'null' test category, which was used for SBN tests

    (e) Some minor additional tweaks to the aux_clm test list to ensure
        appropriate coverage and remove some redundant tests

    (f) For a few testmods directories, removed some settings that had nothing
        to do with those testmods (use_dynroot, use_hydrstress)

(3) Fixed VIC:

    (a) Previously, VIC compsets were not actually turning VIC on; now they are

    (b) Fixed namelist defaults for VIC with CLM50

(4) Updated RTM and MOSART externals: changed their test lists and fixed a
    MOSART bug

(5) Updated CISM external; this changes answers for CISM when ice evolution is
    turned off, due to changing the lnd -> glc mapping in this case

(6) Point to a CIME branch that fixes some bugs

Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID):
- 2473: Change order of tests run with the LII test
- 2474: CLM50 CN compsets seem to be set up wrong
- 2480: vichydro option doesn't work with CLM50 as it needs bedrock off and
        lower_boundary_condition=3 (with aquifer layer)

CIME Issues fixed (include issue #): I think some issues are fixed here, but I'm
not sure which ones

Known bugs introduced in this tag (include bugzilla ID):
- 2485: CLM's 'ed' testlist still has old-style compsets
- 2486: Failure in camdenNJ test in prebeta test list
- 2488: Floating overflow in SoilBiogeochemNitrifDenitrifMod.F90
        (newly-discovered, but presumably existed in previous tags)
- 2489: Clm45BgcCrop case dies due to negative leafn
        (newly-discovered, but presumably existed in previous tags)

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions):
- All new compset aliases

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables):
- All new compset aliases

Changes made to namelist defaults (e.g., changed parameter values):
- Changed some defaults when running with VIC

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance):
- All new aliases means baseline comparisons all BFAIL

Changes to tests or testing:
- Massive overhaul - see notes elsewhere in this ChangeLog entry

Code reviewed by: This was a joint effort by Dave Lawrence, Ben Andre, Erik
Kluzek, Mariana Vertenstein and Bill Sacks. Various pieces were reviewed by
different people in this list.

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - ok

    pass except for 'compare file.*DNE', presumably due to new tests added

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu - ok
    cheyenne_intel - ok
    hobart_nag - ok
    hobart_pgi - ok
    hobart_intel - ok

    Most tests pass; baseline comparisons BFAIL. Bugs opened (and Expected Fails
    list updated) for remaining failures.

    Ran most testing on r85975; just ran relevant tests on latest revision with
    changed compset (changed IHistClm50BgcGs to IHistClm50BgcQianGs)

CLM tag used for the baseline comparisons: N/A


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: All tests BFAIL due to new compset
  aliases. Because of this, I'm not completely sure of the answer changes, but I
  think they are:
        - Tests with CISM2%NOEVOLVE change answers in fields on the glc grid due
          to new CISM external
        - CLM50 tests with Vic change answers because now they're actually using VIC
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      New climate for tests that change answers
    
   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.):
- cime
- rtm
- mosart
- cism

List all files eliminated:

========= No longer need these testmods
D       components/clm/cime_config/testdefs/testmods_dirs/clm/cropf10IC/include_user_mods
D       components/clm/cime_config/testdefs/testmods_dirs/clm/cropf10IC/user_nl_clm
D       components/clm/cime_config/testdefs/testmods_dirs/clm/cropf10IC
D       components/clm/cime_config/testdefs/testmods_dirs/clm/defaultf09IC/README
D       components/clm/cime_config/testdefs/testmods_dirs/clm/defaultf09IC/user_nl_clm
D       components/clm/cime_config/testdefs/testmods_dirs/clm/defaultf09IC/include_user_mods
D       components/clm/cime_config/testdefs/testmods_dirs/clm/defaultf09IC
D       components/clm/cime_config/testdefs/testmods_dirs/clm/af_bias_v5/user_nl_clm
D       components/clm/cime_config/testdefs/testmods_dirs/clm/af_bias_v5/shell_commands
D       components/clm/cime_config/testdefs/testmods_dirs/clm/af_bias_v5/user_nl_datm
D       components/clm/cime_config/testdefs/testmods_dirs/clm/af_bias_v5
D       components/clm/cime_config/testdefs/testmods_dirs/clm/snowlayers_12/user_nl_clm
D       components/clm/cime_config/testdefs/testmods_dirs/clm/snowlayers_12/include_user_mods
D       components/clm/cime_config/testdefs/testmods_dirs/clm/snowlayers_12

List all files added and what they do:

========= Replaces af_bias_v5
A       components/clm/cime_config/testdefs/testmods_dirs/clm/af_bias_v7/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/af_bias_v7/shell_commands
A       components/clm/cime_config/testdefs/testmods_dirs/clm/af_bias_v7/user_nl_datm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/af_bias_v7

List all existing files that have been modified, and describe the changes:

========= Reworked set of compsets and aliases
M       components/clm/cime_config/config_compsets.xml

========= Reworked test list as described above
M       components/clm/cime_config/testdefs/testlist_clm.xml

========= Stop setting glc_snow_persistence_max_days in glcMEC testmods. It made
          sense to set this for testing when most of our tests used CLM45,
          because the default snow persistence was 20 years. But for CLM50 the
          default snow persistence is 0, so it no longer makes sense to set this
          value specially for testing.
M       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC/user_nl_clm
M       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_long/user_nl_clm

========= Apply CN and VIC for CLM50
M       components/clm/cime_config/config_component.xml

========= Use compatible settings for VIC
M       components/clm/bld/namelist_files/namelist_definition_clm4_5.xml
M       components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml
M       components/clm/bld/CLMBuildNamelist.pm
M       components/clm/bld/unit_testers/build-namelist_test.pl

========= Fix for new glacier region
M       components/clm/cime_config/usermods_dirs/cmip6_glaciers/user_nl_clm

========= Make SSP work with mosart instead of rtm
M       components/clm/cime_config/SystemTests/ssp.py

========= Change order of LII test to support re-creating initial conditions
          files (rather than requiring a separate SMS_Ln1 test)
M       components/clm/cime_config/SystemTests/lii.py
M       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_spunup_1way/README

========= New, compatible initial conditions
M       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_spunup_1way/user_nl_clm
M       components/clm/cime_config/testdefs/testmods_dirs/clm/interp_f19_noncrop/user_nl_clm

========= No longer set use_dynroot = .true., use_hydrstress = .false.
M       components/clm/cime_config/testdefs/testmods_dirs/clm/cropMonthOutput/user_nl_clm

========= No longer set use_hydrstress = .false.
M       components/clm/cime_config/testdefs/testmods_dirs/clm/clm50cropIrrigMonth_interp/user_nl_clm
M       components/clm/cime_config/testdefs/testmods_dirs/clm/clm50KitchenSink/user_nl_clm

========= Update ExpectedTestFails list for new tests; new failures are:
          SMS_Ld5_D_P24x1.f10_f10_musgs.IHistClm50Bgc.hobart_nag.clm-decStart
          ERP_D_P24x1.f10_f10_musgs.IHistClm50Bgc.hobart_nag.clm-decStart
          ERP_D.f10_f10_musgs.IHistClm50Bgc.yellowstone_gnu.clm-decStart
          ERS_Ly5_P72x1.f10_f10_musgs.IHistClm45BgcCrop.cheyenne_intel.clm-cropMonthOutput
M       components/clm/cime_config/testdefs/ExpectedTestFails.xml

========= Update documentation of system testing
M       .ChangeLog_template

===============================================================
===============================================================
Tag name:  clm4_5_16_r248
Originator(s):  sacks (Bill Sacks)
Date: Wed Jun 28 15:50:13 MDT 2017
One-line Summary: Melt most ice runoff

Purpose of changes
------------------

Up until now, excess snow in CLM (accumulated beyond the snow capping limit) has
been sent to the ocean as an ice runoff flux. However, this caused problems in
some regions, in that it cooled an already-cold ocean, leading to excessive sea
ice growth. Keith Lindsay, Marika Holland and others suggested changing CLM so
that it sends this flux as liquid rather than ice runoff - having the atmosphere
melt the ice rather than having the ocean do so. These changes are implemented
here.

This has now been tested in many fully-coupled simulations, and it indeed solves
the problem of excessive sea ice growth, without having any noticeable
detrimental effects on other aspects of the simulation.

Specifically, this affects ice runoff from (a) glacier_mec columns outside of
Greenland and Antarctica, and (b) all other column types (vegetated, etc.). We
still send ice runoff from Greenland and Antarctica to simulate the ice calving
flux that occurs in those regions. In addition, we still send an ice runoff flux
generated from dynamic landunit adjustments.

This new behavior is used by default in CLM50, but not in CLM45.


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables):
- New namelist variable: melt_non_icesheet_ice_runoff
- New namelist variable: glacier_region_ice_runoff_behavior

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance):

Changes to tests or testing: none

Code reviewed by: self

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - ok

    tests pass, namelists change as expected

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    cheyenne_intel - ok
    hobart_nag --- ok
    hobart_pgi --- ok
    hobart_intel - ok

    ok means tests pass, answers change as expected

    Ran most testing on melt_ice_runoff_n05_clm4_5_16_r247; ran hobart on latest
    (which included a commit to split long lines)

CLM tag used for the baseline comparisons: clm4_5_16_r247


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: All CLM50 cases
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      new climate

      This changes runoff terms (liquid and ice) and the sensible heat flux sent
      to the atmosphere. In addition, there are limited changes in some
      methane-related terms; this is presumably due to the dependence of
      finundated on TWS, and the fact that TWS changes due to the changes in
      these runoff terms.

      There are also diffs in x2r_Flrl_irrig for this test (and the similar
      yellowstone test):
      ERS_D_Ld10.T31_g37_gl4.IGHISTCLM50.cheyenne_intel.clm-glcMEC_decrease. It
      makes sense that there would be x2r irrig diffs due to diffs in volr, but
      I was surprised that this test had any irrigation. It turns out this is
      due to bug #2479.

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: b.e20.B1850.f09_g17.pi_control.all.149

   URL for LMWG diagnostics output used to validate new climate: ???

   Note that the climate tests were done on an earlier, kludgey
   implementation. I have verified that the latest implementation is bit-for-bit
   with that earlier implementation via a 5-year run of compset
   1850_DATM%GSWP3_CLM50%BGC-CROP_SICE_SOCN_MOSART_CISM2%NOEVOLVE_SWAV at
   resolution f09_g16, producing annual-average cpl history files. (For the
   original, used
   https://svn-ccsm-models.cgd.ucar.edu/clm2/branch_tags/melt_ice_runoff_orig_tags/melt_ice_runoff_orig_n01_clm4_5_16_r246.)
   There were differences in a few CLM diagnostic fields, as expected (because I
   have tweaked some diagnostic fields in the latest version), but the cpl
   avghist files were bit-for-bit.
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Main changes as described above
M       components/clm/src/main/lnd2atmMod.F90
M       components/clm/src/main/lnd2atmType.F90

========= Changed long name in some runoff terms: removed statements that they
          do not include QSNWCPICE, because now they *do* include the *melted*
          portion of QSNWCPICE
M       components/clm/src/biogeophys/WaterfluxType.F90

========= New glacier region-specific behavior
M       components/clm/src/main/glcBehaviorMod.F90
M       components/clm/src/main/test/glcBehavior_test/test_glcBehavior.pf
M       components/clm/src/main/clm_driver.F90

========= New namelist flags controlling the behavior
M       components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml
M       components/clm/bld/namelist_files/namelist_definition_clm4_5.xml
M       components/clm/bld/CLMBuildNamelist.pm
M       components/clm/src/main/clm_instMod.F90

===============================================================
===============================================================
Tag name:  clm4_5_16_r247
Originator(s):  sacks (Bill Sacks)
Date: Mon Jun 26 19:52:20 MDT 2017
One-line Summary: New GLACIER_REGION field with CISM domain split in two

Purpose of changes
------------------

In an upcoming tag, we'll need a separate GLACIER_REGION for the purpose of
determining where ice runoff should be melted: we do not want this melt to
happen over Greenland itself, but we do want it to happen in peripheral parts of
the CISM domain (and in particular, we want it to happen over the Canadian
archipelago, which is within the CISM domain, and thus was within the
"Greenland" GLACIER_REGION). (We still need a GLACIER_REGION that encompasses
areas outside Greenland itself in case ice extent grows a bit beyond the current
boundaries. So we truly need two separate GLACIER_REGIONs for (a) Greenland
itself, and (b) peripheral areas of the CISM domain.) This tag updates the
surface datasets and related fields to have this extra GLACIER_REGION.

In addition to updating the GLACIER_REGION raw data file, this also introduces a
new regridding method that is applied to GLACIER_REGION: this takes the maximum
value from any source point (NOT the dominant value). This is important for the
new GLACIER_REGION, where we want a destination (CLM) cell to be considered in
region 2 (Greenland itself) if ANY overlapping source points are in region
2. This means that the ordering of regions in the GLACIER_REGION raw data file
is important: preference will be given to higher-numbered regions.

Note that I just changed surface datasets that had time stamp 170428 or
later. This excluded some older single point datasets, for which the new glacier
region doesn't matter anyway:
- surfdata_0.125x0.125_simyr2000_c150114.nc
- surfdata_0.125x0.125_mp24_simyr2000_c150114.nc
- surfdata_1x1_smallvilleIA_78pfts_simyr2000_c160127.nc
- surfdata_1x1_smallvilleIA_78pfts_simyr1850_c160127.nc
- surfdata_1x1_tropicAtl_16pfts_simyr1850_c160127.nc (used in tropicAtl_subset testmod)


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions):
- There are some additional subtleties now for setting up a run with different
  glacier domains (e.g., a paleoclimate run)

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files):
- New surface datasets - just differ in GLACIER_REGION

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance):
- There are some additional subtleties now for setting up a run with different
  glacier domains (e.g., a paleoclimate run)

Changes to tests or testing: none

Code reviewed by: self

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - ok

    PASSed except expected failures:
    - baseline comparisons failed for mksurfdata_map tests
    - PTCLM tests failed as expected

    Also ran mksurfdata_map unit tests:
    - new-style (cmake / pfunit-based): pass
    - old-style: same failures as on trunk

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - pass
    yellowstone_pgi - pass
    yellowstone_gnu (clm45 only) - pass
    cheyenne_intel - pass
    hobart_nag --- pass
    hobart_pgi --- pass
    hobart_intel - pass

Ran tests on glacier_region_canada_n03_clm4_5_16_r246
- After that, modified the default mksurfdata_map namelist used for testing:
  pointed to updated file



CLM tag used for the baseline comparisons: clm4_5_16_r246


Answer changes
--------------

Changes answers relative to baseline: NO - bit-for-bit
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated:

List all files added and what they do:

========= Get mkindexmapMod under some pfunit-based unit tests - required
          stubbing out a bunch of netcdf stuff
A       components/clm/tools/mksurfdata_map/src/unit_test_stubs
A       components/clm/tools/mksurfdata_map/src/unit_test_stubs/mkncdio.F90
A       components/clm/tools/mksurfdata_map/src/test/mkindexmap_test
A       components/clm/tools/mksurfdata_map/src/test/mkindexmap_test/test_mkindexmap.pf
A       components/clm/tools/mksurfdata_map/src/test/mkindexmap_test/CMakeLists.txt

========= Add get_max_indices and associated unit tests
A       components/clm/tools/mksurfdata_map/src/test/mkgridmap_test
A       components/clm/tools/mksurfdata_map/src/test/mkgridmap_test/CMakeLists.txt
A       components/clm/tools/mksurfdata_map/src/test/mkgridmap_test/test_mkgridmap.pf

List all existing files that have been modified, and describe the changes:

========= New raw dataset for glacier region
M       components/clm/bld/namelist_files/namelist_defaults_clm4_5_tools.xml
M       components/clm/tools/mksurfdata_map/mksurfdata_map.namelist

========= Get mksurfdata_map pfunit-based unit tests passing with new cime
M       components/clm/tools/mksurfdata_map/src/README.unit_testing
M       components/clm/tools/mksurfdata_map/src/CMakeLists.txt

========= Add get_max_indices and associated unit tests; use get_max_indices to
          regrid glacier region
M       components/clm/tools/mksurfdata_map/src/mkgridmapMod.F90
M       components/clm/tools/mksurfdata_map/src/mkindexmapMod.F90
M       components/clm/tools/mksurfdata_map/src/mkglacierregionMod.F90
M       components/clm/tools/mksurfdata_map/src/test/CMakeLists.txt

========= Allow building mkindexmapMod for unit tests - required stubbing out a
          bunch of netcdf stuff
M       components/clm/tools/mksurfdata_map/src/mkncdio.F90

========= Point to new surface datasets
M       components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml

========= Extended namelist array for new region
M       components/clm/cime_config/SystemTests/lvg.py

========= Removed duplicate makefile rules
M       components/clm/tools/mksurfdata_map/Makefile.data

===============================================================
===============================================================
Tag name:  clm4_5_16_r246
Originator(s):  sacks (Bill Sacks)
Date: Wed Jun 14 12:40:31 MDT 2017
One-line Summary: Update to latest cime

Purpose of changes
------------------

Main change is to update to the latest version of cime.

One of the changes in this cime version is that component-specific system tests
(e.g., LII, SSP) can now be defined in the component rather than in cime. So
this tag defines LII and SSP in CLM. In addition, this adds an LVG test (Land
Virtual Glaciers), which verifies that adding virtual glacier columns doesn't
change answers.

Another significant change in this cime version is that the lnd -> glc
downscaling (i.e., remapping) method has been changed to be bilinear with a
later conservation correction, rather than area-conservative. This leads to
smooth fields on the CISM grid.


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables):
- New drv_in namelist variable 'glc_renormalize_smb' - controls whether to apply
  global corrections to the downscaled lnd -> glc smb for conservation

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing:
- Moves LII and SSP test definitions into CLM
- Adds new test type, LVG
- Adds an LVG test

Code reviewed by: self

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - pass
    yellowstone_gnu (clm45 only) - pass
    cheyenne_intel - ok
    hobart_nag --- pass
    hobart_pgi --- ok
    hobart_intel - pass

    ok means tests pass, some answers change as noted below

CLM tag used for the baseline comparisons: clm4_5_16_r245


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: see below
    - what platforms/compilers: see below
    - nature of change (roundoff; larger than roundoff/same climate; new climate): see below

    (1) Changes answers for cases with CISM, due to new downscaling
        method. These changes show up only for long tests with CISM, and are
        potentially climate-changing:

        FAIL SMS_Lm37.T31_g37_gl4.IG1850CLM50.cheyenne_intel.clm-glcMEC_long BASELINE clm4_5_16_r245
        FAIL SMS_Lm37.T31_g37_gl4.IG1850CLM50.yellowstone_intel.clm-glcMEC_long BASELINE clm4_5_16_r245

    (2) Changes answers for hobart-pgi tests, due to new version of the pgi
        compiler on hobart. Magnitude of the change not investigated.

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.):
- cime: cime5.3.0-alpha.21 -> cime5.3.0-alpha.27

List all files eliminated: none

List all files added and what they do:

========= CLM-specific system tests are now defined here rather than in
          cime. Also, added an LVG test type: Land Virtual Glacier.
A       components/clm/cime_config/config_tests.xml
A       components/clm/cime_config/SystemTests
A       components/clm/cime_config/SystemTests/lii.py
A       components/clm/cime_config/SystemTests/ssp.py
A       components/clm/cime_config/SystemTests/lvg.py

List all existing files that have been modified, and describe the changes:

========= Ran through -cleanxml, and added an LVG test
M       components/clm/cime_config/testdefs/testlist_clm.xml

===============================================================
===============================================================
Tag name:  clm4_5_16_r245
Originator(s):  sacks (Bill Sacks)
Date: Wed Jun 14 12:13:54 MDT 2017
One-line Summary: Only adjust glc_mec topographic heights if glc_do_dynglacier is true

Purpose of changes
------------------

Two changes in this tag:

(1) Only adjust glc_mec topographic heights if glc_do_dynglacier is true (this
    namelist variable is controlled by the GLC_TWO_WAY_COUPLING xml
    variable). Previously, CLM updated its glacier topographic heights even if
    this variable was false (so we were not updating areas from CISM). Bill
    Lipscomb and Jeremy Fyke agreed a while ago that we should change this. None
    of us could remember why we initially set it up to always update topographic
    heights, but we felt that it's more intuitive to avoid updating topographic
    heights if we're not updating glacier areas.

    Note that setting GLC_TWO_WAY_COUPLING=FALSE is *not* a common thing to do,
    so this change does not affect most cases. (The typical way of doing one-way
    coupling with CISM is to use CISM2%NOEVOLVE, which turns off ice evolution
    but keeps GLC_TWO_WAY_COUPLING=TRUE in order to update CLM's glacier areas
    and topographic heights at initialization.)

(2) Adds some user mods and testmods (currently unexercised) for cmip6


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing: New test mods directories, currently not exercised (I'll add tests soon)

Code reviewed by: self

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    cheyenne_intel - ok
    hobart_nag --- ok
    hobart_pgi --- ok
    hobart_intel - ok

    ok means tests pass, a few expected baseline comparison failures

CLM tag used for the baseline comparisons: clm4_5_16_r244


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: Cases with GLC_TWO_WAY_COUPLING=FALSE
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      new climate

  This affects tests with glcMEC_changeFlags and glcMEC_spunup_1way testmods

  Also, NLCOMP failures for a few tests, I think explainable by the process Erik
  used to update some testmods to get LII tests passing:
    FAIL SMS_D_Ln1.f09_g17.ICLM45BGC.yellowstone_gnu.clm-defaultf09IC NLCOMP
    FAIL ERP.f19_g17_gl4.IG1850CLM45.cheyenne_intel.clm-glcMEC_spunup_1way NLCOMP
    FAIL SMS_D_Ln1.f19_g17_gl4.IG1850CLM45.cheyenne_intel.clm-glcMEC_spunup_1way NLCOMP

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated:

========= Renamed
D       components/clm/cime_config/usermods_dirs/clm/clm5_OutputCrop/user_nl_clm
D       components/clm/cime_config/usermods_dirs/clm/clm5_OutputCrop/shell_commands
D       components/clm/cime_config/usermods_dirs/clm/clm5_OutputCrop
D       components/clm/cime_config/usermods_dirs/clm

List all files added and what they do:

========= Top-level cmip6 usermods directory, which will include other usermods
          directories needed for the cmip6 runs
A       components/clm/cime_config/usermods_dirs/cmip6/include_user_mods
A       components/clm/cime_config/usermods_dirs/cmip6

========= Renamed from clm5_OutputCrop; also added some glacier output fields
          needed for cmip6 runs
A       components/clm/cime_config/usermods_dirs/cmip6_output/user_nl_clm
A       components/clm/cime_config/usermods_dirs/cmip6_output/shell_commands
A       components/clm/cime_config/usermods_dirs/cmip6_output/README
A       components/clm/cime_config/usermods_dirs/cmip6_output

========= Turns on virtual glacier columns over Antarctica. This is desired by
          the LIWG for cmip6 runs, so that we can have the Antarctica output
          that would be needed to later run an ice sheet model over
          Antarctica. However, it comes with a 10% performance cost.
A       components/clm/cime_config/usermods_dirs/cmip6_glaciers/user_nl_clm
A       components/clm/cime_config/usermods_dirs/cmip6_glaciers

========= Test mod that allows testing the cmip6 usermods (currently not
          exercised with any tests)
A       components/clm/cime_config/testdefs/testmods_dirs/clm/cmip6/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/cmip6

========= Test mod that allows running the new LVG (virtual glaciers) test
          (currently unexercised)
A       components/clm/cime_config/testdefs/testmods_dirs/clm/no_vector_output/README
A       components/clm/cime_config/testdefs/testmods_dirs/clm/no_vector_output/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/no_vector_output/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/no_vector_output

List all existing files that have been modified, and describe the changes:

========= Only adjust topographic heights if glc_do_dynglacier is true
M       components/clm/src/main/TopoMod.F90
M       components/clm/src/main/test/topo_test/test_topo.pf
M       components/clm/src/main/glc2lndMod.F90

========= Add _musgs to f10_f10 grid
M       components/clm/cime_config/testdefs/ExpectedTestFails.xml

===============================================================
===============================================================
Tag name:  clm4_5_16_r244
Originator(s):  erik (Erik Kluzek)
Date: Fri Jun  9 14:26:07 MDT 2017
One-line Summary: Update cime and cism externals, changes answers for IG compsets, test g17 grids, fix a few issues, update mksurfdata_map

Purpose of changes
------------------

Update the cime version which includes some important updates.  Remove lt_archive, new script query_config 
to query compsets and grids etcetera. Force user to always use case.submit rather than allow them to submit 
to batch queue on their own. Some updates to handling of namelist items in user_nl_clm. All grids now contain 
a mask variable. Also fixes a couple glitches from the previous version, see bugs fixed below.

Update cism which changes answers (for cases running with CISM) as 4km grid was changed.

Fix some small issues with CLM. Fix interpolation issue with GSSUN and GSSHA, use shr_mpi needed for unit-testing, and
fix an issue with a use of MCT routines for clm40.

Several updates to mksurfdata_map, fixing problems, starting to get it working on cheyenne, and upgrading to latest
CMIP6 PFT datasets from Peter Lawrence.

-Update cime and cism.
-Unit tests moved to cime/scripts/fortran_unit_testing/.
-Include Jim Edward's configcompsetupdate changes here.
-Convert mosart half-degree file from NetCDF-4 to NetCDF-3.
-Change grids in test lists so that mask is added to grids that need it (i.e. f45_f45 becomes f45_f45_mg37).
-Add note about supported compset IGM1850GSWCLM50BGCCROP for f09_g17, f19_g17.
-Use grids back to g16 as g17 domain files aren't there.
-Get LII tests working.
-Rerun the list of tests that failed, see if works again because of a system issue.
-use old g16 mask for CLM40 tests.
-Add CMIP5/CMIP6 names to surfdata file creation.
-Bring in mksrfunreplu branch.
-New rawdata PFT datasets from Peter.

Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID): [If none, remove this line]
   2468 GSSUN/GSSHA interp issue
   2440 change to orderedPoints for clm40 as well
   2425  mksurfdata_map changes from Sean didn't get incorporated
   2419 Irrigated areas are low in mksurfdata_map
   2399 Problem with urban points with latest mksurfdata_map
CIME Issues fixed (include issue #): [If none, remove this line]
  #1215 -- (in this version of cime) TestStatus sometimes needs to have write permission added
  #1155 -- manage_case doesn't work (renamed to query_config)
  #848 -- ./xmlquery --list-all doesn't work (refactored)

Known bugs introduced in this tag (include bugzilla ID):
  2471 PTCLM doesn't work
  2470 CLM is getting the mask from the clm namelist_defaults rather than from top level scripts
  2469 Cleanup restartvar_{DIMS}d_{TYPE} to ONLY be valid for a 1d interface
  2467 Case on non-year boundary dies with error about ignoring ic_date for a crop case, even though for a branch or hybrid case
  2465 ICLM45VIC compset doesn't actually turn VIC on
  2464 allowlakeprod are outputing standard variables instead of the "lake" specific versions...

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): None

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables):

  cime update brought in quite a few changes
- Add skip-preview-namelist to case.submit and case_run.
  - Renamed manage_case to query_config.
    - manage_case -> query_config
      --compset -> --compsets
      --machine -> --machines
      added 'all' option for --compsets
      added 'current' and to --machines
    - Remove all references to lt_archive which will not be supported in
      CESM2.0.
    - Add Support for '+=' in Namelists.
    - Add --component Option to preview_namelist.
    - Add Support of true and false in Namelist.
  - Force user to always go through case.submit.
    - Adds support for namelist entries of the form foo(3) = 'a'
    - esmf_logging (and therefore drv_in) are now optional
    - New run time XML variable: ESMF_LOGFILE_KIND
    - New --answer flag to create_newcase
  -Update so that all relevent grids contain a mask variable.
 - Add preview_run to case.run

Changes made to namelist defaults (e.g., changed parameter values): Added mapping files for 0.25x0.25_MODIS

Changes to the datasets (e.g., parameter, surface or initial files): Just to datasets to create surface datasets

Substantial timing or memory changes: None

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance):
    - Use ESMF7 on yellowstone and cheyenne.
    - Big cs.status upgrade.
    - Add --input-dir argument to create_test

Changes to tests or testing:
   Change most gx1v6 masks to gx1v7
   Keep clm40 tests at gx1v6

Code reviewed by: self, jedwards (config), mvertens, sacks (unit-tests)

Did you follow the steps in .CLMTrunkChecklist: Yes

CLM testing: regular

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - PASS

  unit-tests (components/clm/src):

    yellowstone - PASS

  tools-tests (components/clm/test/tools):

    yellowstone - OK

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - FAIL

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - OK
    yellowstone_pgi - OK
    yellowstone_gnu (clm45 only) - OK
    cheyenne_intel - OK
    hobart_nag --- OK
    hobart_pgi --- PASS
    hobart_intel - PASS

CLM tag used for the baseline comparisons:  clm4_5_16_r243


Answer changes
--------------

Changes answers relative to baseline: Yes for IG compsets with active glacier model

  Summarize any changes to answers, i.e.,
    - what code configurations: Any with CISM2
    - what platforms/compilers: All
    - nature of change:  minor
Changes answers for cases with CISM2 at 4km (the default resolution for CISM2 cases)
- Even changes answers for standard one-way coupled cases (CISM2%NOEVOLVE)
- Fields on the CISM grid will have DIMSIZEDIFF
- Fields sent to CLM have roundoff-level differences
- time variable changes for all cases with CISM

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): cime, cism, mosart
   cime   to cime5.3.0-alpha.21
   cism   to cism2_1_33
   mosart to mosart1_0_24

List all files eliminated:

   D  components/clm/tools/SVN_EXTERNAL_DIRECTORIES

List all files added and what they do:

   M  components/clm/cime_config/testdefs/testmods_dirs/clm/defaultf09IC/README --- Add description of this testmods
               and how to update the finidat file for it
   A  components/clm/test/tools/tests_pretag_cheyenne_nompi ---- Add test list for cheyenne

List all existing files that have been modified, and describe the changes:

   M  components/clm/test/tools/TCBCFGtools.sh - Source $INITMODULES
   M  components/clm/test/tools/test_driver.sh - Add cheyenne, set INITMODULES
   M  components/clm/test/tools/TSMCFGtools.sh - Handle CSMDATA
   M  components/clm/test/tools/nl_files/gen_domain.ne30.runoptions - Use CSMDATA for path to mapping file
   M  components/clm/test/tools/nl_files/gen_domain.T31.runoptions -- Use CSMDATA for path to mapping file

   M  components/clm/tools/mkmapdata/regridbatch.sh ---------------- Set PBS for cheyenne, increase regrid_num_proc to 36
   M  components/clm/tools/mkmapdata/mkmapdata.sh ------------------ Increase REGRID_PROC to 36, show defaults in --help, 
               change so -b means run with mpi, also create 0.25x0.25_MODIS maps, add cheyenne, rm hopper
   M  components/clm/tools/mksurfdata_map/Makefile.data ------------ Add global-present-T42
   M  components/clm/tools/mksurfdata_map/src/mkharvestMod.F90 ----- Change harvest_fieldnames and string_undef
   M  components/clm/tools/mksurfdata_map/src/mkgridmapMod.F90 ----- Add gridmap_areaave_scs interface which
               multiplys weight by ratio of source over destination weight (set to zero if destination weight is zero)
   M  components/clm/tools/mksurfdata_map/src/mkpftMod.F90 --------- Use gridmap_areaave_scs interface rather than default
               one, passing down source weight of pctnatveg_i and desitination weight of pctnatveg_o (both mulitipled by 0.01)
               if zeroing out also set pctnatveg_o, pctcrop_o, pct_nat_pft_o, pct_cft_o to zero, and first entry of pct_nat_pft_o
               and pct_cft_o to 100
   M  components/clm/tools/mksurfdata_map/mksurfdata_map.namelist -- Update with new files
   M  components/clm/tools/mksurfdata_map/mksurfdata.pl ------------ Add cmip_series to output filenames, use vegtyp to get harvest files,
               
   M  components/clm/tools/mksurfdata_map/landuse_timeseries_hist_78pfts_simyr1850-2015.txt - Update with new datafiles. Note, each
               year is repeated once to point to same data (to be used for harvesting). This allows harvest files to be seperate.

   M  components/clm/bld/unit_testers/build-namelist_test.pl --------------- Don't test 0.25x0.25 grid
   M  components/clm/bld/namelist_files/namelist_defaults_clm4_5_tools.xml - Add 0.25x0.25 MODIS mapping file, harvest, PFT, LAI, and soil-color
               are 0.25x0.25_MODIS, harvest files are: mksrf_fvegtyp, Update: LAI, soil-color, and PFT files, remove harvest files
   M  components/clm/bld/namelist_files/namelist_definition_clm4_5.xml ----- Add 0.25x0.25 to hgrid and res, add 2015 to sim_year, and
               1980-2015 to sim_year_range,
   M  components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml ------- Add 0.x25x0.25_MODIS mapping files

   M  components/clm/cime_config/config_compsets.xml ------- Changes from Jim Edwards to update to version 2.0 which will do xmllint checking
               on the file, add <science_support> for f09, f19 IGM1850GSWCLM50BGCCROP compsets

   M  components/clm/cime_config/testdefs/testlist_clm.xml - Add SMS _Ln1 tests to correspond to each LII test (to make updating finidat files
               for LII tests easier, update grids to include mask when needed, and update most g16 mask tests to g17 (except clm40 tests which
               need to remain at g16)
   M  components/clm/cime_config/testdefs/testmods_dirs/clm/defaultf09IC/user_nl_clm ------- Update finidat file, set use_init_interp to True
               and add notes on how to update it
   M  components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_spunup_1way/user_nl_clm - Update finidat file, set use_init_interp to True
               and add notes on how to update it
   M  components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_spunup_1way/README ------ Add notes on how to update the finidat file

   M  components/clm/SVN_EXTERNAL_DIRECTORIES - Point to PTCLM here

   M  components/clm/src_clm40/main/GetGlobalValuesMod.F90 - Change mct_gsmap_OP to mct_gsmap_orderedPoints (bug 2440)
   M  components/clm/src_clm40/main/ncdio_pio.F90.in ------- Change mct_gsmap_OP to mct_gsmap_orderedPoints (bug 2440)
   M  components/clm/src/biogeochem/CNSharedParamsMod.F90 -- Use shr_mpi_bcast rather than straight MPI (important for new unit tests)
   M  components/clm/src/README.unit_testing --------------- Updated notes on how to do it from Bill Sacks
   M  components/clm/src/biogeophys/PhotosynthesisMod.F90 -- Set switchdim=T for GSSUN/GSSHA (bug 2468)
   M  components/clm/src/CMakeLists.txt -------------------- Add include(CIME_initial_setup)

===============================================================
===============================================================
Tag name:  clm4_5_16_r243
Originator(s):  andre (Benjamin Andre,UCAR/CSEG,303-497-1391)
Date:  Tue May 23 16:27:42 MDT 2017
One-line Summary: History output cleanup from Dave Lawrence

Purpose of changes
------------------

* Reduce default history output by setting numerous variables to
  default=inactive, limiting some 3d vars to active soil layers only.

* Update default history output for CLM5.

* Added diagnostic new output for DWT_WOOD_PRODUCTC_GAIN_PATCH,
  GS_MOL, lake_icefracsurf_col, h2osoi_liq_tot_col, h2osoi_ice_tot_col

* Remove double accounting for CNSoy fixation when FUN is on.

* Bug fixes to allow landunit-level and column-level averaging and
  vector output using the hist_type1d_pertape namelist option (LAND
  for land-unit, COL for column-level).  Note that if a user asks for
  a variable at a subgrid level that is not available at that subgrid
  level, the model will crash ungracefully.  An example would be
  asking for TOT_WOODPRODC at the land-unit level when this variable
  is only available at the grid cell level, or asking for H2OSOI at
  the pft-level when H2OSOI is a column-level variable.  Code may be
  added in a future tag that will inform the user of the error.

* Add usermods dir for recommended clm5 crop default output. To use
  the usermod when creating a new case:

  ./create_newcase --compset HIST_DATM%GSWP3_CLM50%BGC-CROP_SICE_SOCN_MOSART_CISM2_SWAV \
                   --user-mods-dir clm/clm5_OutputCrop \
                   ... machine, compiler, grid, case name, etc...


Bugs fixed or introduced
------------------------

None, but see note below in testing about c14 bombspike test.

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions):

  The default history output has been reduced. You may need to
  explicitly request fields of interest from the namelist.

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: unknown

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing: none

Code reviewed by: Dave Lawrence, Ben Andre

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing: regular

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - unit tests pass

  unit-tests (components/clm/src):

    yellowstone - all tests pass

  tools-tests (components/clm/test/tools):

    yellowstone - n/a, not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - n/a, not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    cheyenne_intel - ok, see note below
    hobart_nag - ok 
    hobart_pgi - ok 
    hobart_intel - ok

CLM tag used for the baseline comparisons: clm4_5_16_r242, no
  yellowstone intel baselines were generated for clm4_5_16_r242

  Baselines comparisons for clm45/clm5 tests show:
    1. changes in fields sizes (expected, restrict vertical fields to nlevsoi)
    
    2. different fields on current and baseline files (expected, new default active/inactive)

    3. no RMS differences, except the following tests:

       These tests failed baseline comparisons with RMS differences in
       testing due to the soy nitrogen double accounting fix.

       ERP_P60x2_Lm36.f10_f10.ICRUCLM50BGCCROP.cheyenne_intel.clm-clm50cropIrrigMonth_interp
       ERS_Ly3.f10_f10.I1850CRUCLM50BGCCROP.cheyenne_intel.clm-clm50KSinkMOut
       ERS_Ly5_P60x1.f10_f10.IHISTCLM50BGCCROP.cheyenne_intel.clm-cropMonthOutput

       ERP_P60x2_Lm36.f10_f10.ICRUCLM50BGCCROP.yellowstone_intel.clm-clm50cropIrrigMonth_interp
       ERS_Ly3.f10_f10.I1850CRUCLM50BGCCROP.yellowstone_intel.clm-clm50KSinkMOut
       ERS_Ly5_P60x1.f10_f10.IHISTCLM50BGCCROP.yellowstone_intel.clm-cropMonthOutput

    The ciso-c14 bombspike1963 test failed baseline test with RMS
    differences in C14_* fields on cheyenne_intel. This did not have
    differences when tested against r273 and yellowstone_intel. This
    seems to be intermintent, there was at least one test run with
    r242 cheyenne_intel where this passed without RMS differences.
    
    SMS_D_Ly2.1x1_brazil.IHISTCLM50BGC.cheyenne_intel.clm-ciso_bombspike1963



Answer changes
--------------

Changes answers relative to baseline: some clm5 compsets

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
  
    - what code configurations: removal of double accounting for soy
      nitrogen fixation from clm5 crop runs with fun active. See tests
      above.

    - what platforms/compilers: all
    
    - nature of change (roundoff; larger than roundoff/same climate;
      new climate): unknown, presumed larger than roundoff same
      climate.

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? n/a

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: n/a

   URL for LMWG diagnostics output used to validate new climate: n/a
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: none

List all files added and what they do: 

New usermods with default output for clm5 crop runs
  A   clm/cime_config/usermods_dirs/clm/clm5_OutputCrop
  A   clm/cime_config/usermods_dirs/clm/clm5_OutputCrop/user_nl_clm
  A   clm/cime_config/usermods_dirs/clm/clm5_OutputCrop/shell_commands

List all existing files that have been modified, and describe the changes:

  M    clm/cime_config/config_component.xml - update component description from Erik Kluzek

Set history fields active/inactive:
  M    clm/src/biogeochem/CNVegCarbonStateType.F90
  M    clm/src/biogeochem/CNVegNitrogenStateType.F90
  M    clm/src/biogeochem/CNVegNitrogenFluxType.F90
  M    clm/src/biogeochem/CropType.F90
  M    clm/src/biogeophys/EnergyFluxType.F90 - don't output btran unless hydrstress active
  M    clm/src/biogeophys/TemperatureType.F90
  MM   clm/src/biogeophys/HumanIndexMod.F90
  M    clm/src/biogeophys/SoilHydrologyType.F90
  M    clm/src/biogeophys/SolarAbsorbedType.F90
  M    clm/src/biogeophys/CanopyStateType.F90
  M    clm/src/biogeophys/SurfaceRadiationMod.F90
  M    clm/src/biogeophys/WaterfluxType.F90 - variable renaming
  M    clm/src/biogeophys/SoilStateType.F90

New diag output, set default active/inactive fields:
  M    clm/src/biogeochem/CNVegCarbonFluxType.F90
  M    clm/src/biogeochem/CNProductsMod.F90
  M    clm/src/biogeophys/PhotosynthesisMod.F90
  M    clm/src/biogeophys/LakeStateType.F90
  M    clm/src/biogeophys/LakeTemperatureMod.F90
  M    clm/src/biogeophys/HydrologyNoDrainageMod.F90 - vertically summed water state calc
  M    clm/src/biogeophys/WaterStateType.F90


Default active/inactive history fields, restrict output to nlevsoi:
  M    clm/src/biogeochem/ch4Mod.F90
  M    clm/src/soilbiogeochem/SoilBiogeochemStateType.F90
  M    clm/src/soilbiogeochem/SoilBiogeochemNitrogenFluxType.F90
  M    clm/src/soilbiogeochem/SoilBiogeochemNitrogenStateType.F90
  M    clm/src/soilbiogeochem/SoilBiogeochemCarbonFluxType.F90
  M    clm/src/soilbiogeochem/SoilBiogeochemCarbonStateType.F90


FUN Soy Nitrogen Fixation double accounting:
  M    clm/src/biogeochem/CNDriverMod.F90

Subgrid mapping:
  M    clm/src/main/histFileMod.F90
  M    clm/src/main/subgridAveMod.F90


===============================================================
===============================================================
Tag name:  clm4_5_16_r242
Originator(s):  erik (Erik Kluzek)
Date: Sun May 21 21:16:34 MDT 2017
One-line Summary: Use finundated streams for CLM50, and use ndep if it comes from cpl

Purpose of changes
------------------

For methane, read in inversion for TWS to Prigent Satellite dataset from a streams file for CLM50. For
CLM45 still read in ZWT inversion parameters from the surface dataset. You can read it from the streams
file if you provide it to the namelist. Answers change for CLM50BGC compsets because of this change to
methane. The change does affect results outside of methane after enough time.

Add option to use nitrogen deposition sent from the coupler rather than from datasets (from mvertens).

Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID): 
   bug 2462 -- TWS restart
   bug 2457 -- remove FIND_HIST
   bug 2454 -- species masterlist confusion
   bug 2443 -- ndep
   bug 2456 -- rm extra settings
   bug 2463 -- T42 SP dataset

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): None

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): New namelist item
    for finundated streams stream_fldfilename_ch4finundated. It can be used for both TWS_inversion
    which is now the CLM50 default, or the ZWT_inversion (CLM45 default), but by default CLM45
    is reading ZWT inversion parameters from the surface dataset

Changes made to namelist defaults (e.g., changed parameter values): ZWT_inversion for CLM45 and TWS_inversion for CLM50
   for inundated fraction

Changes to the datasets (e.g., parameter, surface or initial files): Add 2000 T42 fsurdata file

Substantial timing or memory changes: None

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): None

Changes to tests or testing: Add two new tests
   Add test for hourly radiation with lightning resolution at half-degree
   And test with reseeding and reset of snow

Code reviewed by: self,mvertens

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing: regular

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests: 

    yellowstone - OK  (94 compare tests FAIL)

  unit-tests (components/clm/src):

    yellowstone - PASS

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - Didn't run
    yellowstone_pgi - OK
    yellowstone_gnu (clm45 only) - OK
    cheyenne_intel - OK
    hobart_nag --- PASS
    hobart_pgi --- PASS
    hobart_intel - OK

CLM tag used for the baseline comparisons:  clm4_5_16_r241


Answer changes
--------------

Changes answers relative to baseline: Yes, CLM50

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM50 (with finundated streams for TWS_inversion)
    - what platforms/compilers: All
    - nature of change: similar climate, but methane changes (which does feedback into system)

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: None

List all files added and what they do: Add new tests

   A components/clm/cime_config/testdefs/testmods_dirs/clm/rad_hrly_light_res_half/shell_commands
   A components/clm/cime_config/testdefs/testmods_dirs/clm/rad_hrly_light_res_half/user_nl_datm
   A components/clm/cime_config/testdefs/testmods_dirs/clm/reseedresetsnow/user_nl_clm
   A components/clm/cime_config/testdefs/testmods_dirs/clm/reseedresetsnow/include_user_mods

List all existing files that have been modified, and describe the changes:

   M components/clm/bld/CLMBuildNamelist.pm -------------------- Remove fin_use_fsat, set finundation_method
        and get finundated streams file if TWS_inversion, add ch4finundated namelist group
   M components/clm/bld/unit_testers/build-namelist_test.pl ---- Add test for change to finundated if not methane
   M components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml --- Remove extra settings of use_init_interp,
        add T42 present day fsurdat file, remove fin_use_fsat, set finundation_method to TWS_inversion for CLM50
        and ZWT_inversion for CLM45, set finundation_res=1.9x2.5 and set stream_fldfilename_ch4finundated file for it
   M components/clm/bld/namelist_files/namelist_definition_clm4_5.xml - Add: stream_fldfilename_ch4finundated, finundation_res
        remove fin_use_fsat, correct finundation_method documentation

   M components/clm/cime_config/config_compsets.xml ------- Add IGMCRUCLM50SP, IGMCRUCLM50BGCROP compsets
   M components/clm/cime_config/testdefs/testlist_clm.xml - Change prealpha/prebeta yellowstone_intel/gnu tests to cheyenne
        add new tests for reseedresetsnow and rad_hrly_light_res_half

   M components/clm/src/main/clm_instMod.F90 -------- Pass NLFilename down to ch4 Init
   M components/clm/src/main/clm_varctl.F90 --------- Add ndep_from_cpl variable
   M components/clm/src/main/clm_driver.F90 --------- If ndep_from_cpl is true don't do ndep_interp
   M components/clm/src/main/clm_initializeMod.F90 -- If ndep_from_cpl is true don't do ndep_init and ndep_interp
   M components/clm/src/main/histFileMod.F90 -------- Add error check if field name is too long
   M components/clm/src/biogeophys/WaterStateType.F90 - Add TWS to restart file

   M components/clm/src/cpl/clm_cpl_indices.F90 --- Set ndep_from_cpl based on existance of Faxa_nhx and Faxa_noy
   M components/clm/src/cpl/lnd_import_export.F90 - Set forc_ndep_grc if ndep_from_cpl is set, convert units

   M components/clm/src/biogeochem/SpeciesNonIsotopeType.F90 --- Add trim's to strings to make sure blanks aren't added
   M components/clm/src/biogeochem/ch4Mod.F90 ------------------ Pass NLFilename to Init, add ch4findstream data and Init to it
          Remove fws_a/b/hist, remove fin_use_fsat use finundation_mtd Call ch4findstream%CalcFinundated is finundated streams are being
          used (stream_fldfilename_ch4finundated is set), or if finundation_mtd_h2osfc, 
   M components/clm/src/biogeochem/ch4FInundatedStreamType.F90 - Add UseStreams method, get streams working properly and 
   M components/clm/src/biogeochem/SpeciesIsotopeType.F90 ------ Add trim for strings to make sure blanks don't happen
   M components/clm/src/biogeochem/ch4varcon.F90 --------------- Remove fin_use_fsat

===============================================================
===============================================================
Tag name:  clm4_5_16_r241
Originator(s):  sacks (Bill Sacks)
Date: Tue May 16 20:43:43 MDT 2017
One-line Summary: Fix ch4 subtle dependence on processor count

Purpose of changes
------------------

When we moved to using interpolated initial conditions in most cases, long tests
that change processor counts (ERP, PEM) began to fail (bug 2458). I tracked this
problem down to annsum_npp, annsum_counter, and specifically bug 1597.

I found that, in both the original finidat and finidat_interp_dest, we have:

- For coltype = 1, counter can be 0, 3600 or 5400

- For coltype = 200-something (crop), counter is always 5400

- For other coltypes, counter = 0 (but these shouldn't matter)

My best guess is that there is some interaction between (1) the history of an
initial conditions file, and (2) dynamic landunits, which causes annsum_counter
to differ by column. Specifically, with (1): I think that problems arise when an
initial conditions file has (at some point in its history) arisen from a run
that didn't run for a complete year; e.g., this can happen in the course of
making an interp'ed initial conditions file - for which we typically run for one
or a few time steps. This can lead to a misalignment of the resetting of
annsum_counter relative to when dynamic landunits kick in, and thus the counter
can differ for different columns.

This tag fixes the problem by making each column dependent on its own count,
rather than using the count from the first column on that MPI task.


Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID):
- 1597: awkward conditionals to determine end of year in CN AnnualUpdate
- 2458: ERP clm5 restart failure in clm4_5_16_r237

Known bugs introduced in this tag (include bugzilla ID): [If none, remove this line]
- https://github.com/NCAR/CLM/issues/7 : CN annsum_counter can trigger mid-year,
  and at different times for different columns

  Decision in talking with Erik and Keith was that we would not try to resolve
  this right now - it seems that it can cause a bit of confusion, but no
  scientific problems as far as we can tell.


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing: none

Code reviewed by: Erik; conceptually reviewed by Keith

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    cheyenne_intel - pending; I'll check them post-tag and open an issue if any fail
    hobart_nag --- ok
    hobart_pgi --- not run
    hobart_intel - ok

    ok means tests pass, some baselines fail as expected

CLM tag used for the baseline comparisons: clm4_5_16_r240


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: Many configurations, when run for at least a year
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      Larger than roundoff; expected to be same climate, but not investigated carefully.

      Answer changes can appear whenever we have an initial conditions file
      where different columns have different values of the annsum_counter
      restart field. This is the case for present-day restart files, as well as
      at least one year-1850 restart file
      (clmi.I1850CRUCLM45BGC.0241-01-01.1.9x2.5_g1v6_simyr1850_c170308.nc).

      The impact of this problem is expected to be small, at least if the
      differences in annsum_counter values are small (which they are for the two
      initial conditions files I have checked, and I expect this is the case for
      others, too): In this case, the impact is that some annually-accumulated
      fields reach their end-of-year mark a few time steps too early or late.

      However, I have not investigated the impact of this bug fix carefully.

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Main changes
M       components/clm/src/biogeochem/CNAnnualUpdateMod.F90

========= New function to create a sub-filter based on an existing filter and a
          column-level logical array
M       components/clm/src/main/filterColMod.F90
M       components/clm/src/main/test/filter_test/test_filter_col.pf

========= Remove no-longer-failing tests
M       components/clm/cime_config/testdefs/ExpectedTestFails.xml

===============================================================
===============================================================
Tag name:  clm4_5_16_r240
Originator(s):  sacks (Bill Sacks)
Date: Mon May 15 14:48:22 MDT 2017
One-line Summary: Make glc_dyn_runoff_routing real-valued

Purpose of changes
------------------

The glc_dyn_runoff_routing variable tracks which CLM grid cells overlap
fully-coupled glc (CISM) grid cells, and which do not: In those that do not, CLM
needs to send the snow capping flux directly to runoff. Previously, this value
was a logical. However, we (Bill Lipscomb and Bill Sacks) realized that this
really needs to be real-valued - having a value between 0 and 1 where a CLM cell
partially overlaps the CISM domain. This is needed for complete conservation
when we are running with a fully-coupled (two-way-coupled) glc component.

This changes answers for cases with two-way-coupled CISM, but does NOT change
answers for the typical one-way-coupled (%NOEVOLVE) case.

Main changes are from Bill Lipscomb.


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance):
- There is some duplicate logic between CLM and the coupler in determining the
  fraction of the CLM grid cell that overlaps with the active glc
  domain. Ideally, we'd move all of the relevant logic into the coupler and
  avoid needing it in CLM. See the TODO note in glc2lndMod.F90

Changes to tests or testing: none

Code reviewed by: self

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    cheyenne_intel - ok
    hobart_nag --- ok
    hobart_pgi --- not run
    hobart_intel - ok

    ok means tests pass, baselines fail as expected

CLM tag used for the baseline comparisons: clm4_5_16_r239


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: cases with CISM two-way coupled (i.e., without %NOEVOLVE)
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      Larger than roundoff, but only changes answers around the margin of
      Greenland, so expected to be same climate

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Main changes, as described above
M       components/clm/src/main/test/topo_test/test_topo.pf
M       components/clm/src/main/glc2lndMod.F90
M       components/clm/src/biogeophys/GlacierSurfaceMassBalanceMod.F90

========= Add a test to the xfail list which fails sporadically due to bug 2461
M       components/clm/cime_config/testdefs/ExpectedTestFails.xml

===============================================================
===============================================================
Tag name:  clm4_5_16_r239
Originator(s):  sacks (Bill Sacks)
Date: Sat May 13 20:35:52 MDT 2017
One-line Summary: Avoid division by zero in snow WindDriftCompaction

Purpose of changes
------------------

Tweak the equations in WindDriftCompaction to avoid division by 0, to fix bug
2460.


Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID):
- 2460: Floating point trap in FWAMIP compset

Known bugs introduced in this tag (include bugzilla ID):
- 2461: Multi-instance tests failing sporadically
  This has actually been an issue for the last few tags, likely related to bug
  2289 - default finidat_interp_dest file name should have instance number


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing: none

Code reviewed by: Dave Lawrence

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    cheyenne_intel - ok
       Did not do baseline comparisons for cheyenne tests
    hobart_nag --- ok
    hobart_pgi --- not run
    hobart_intel - ok

    ok means tests pass, baseline comparisons fail for clm50 tests as expected

CLM tag used for the baseline comparisons: clm4_5_16_r238


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: All CLM50
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      roundoff

   If bitwise differences were observed, how did you show they were no worse
   than roundoff?

      via analysis of the change: the new equation is algebraically identical to
      the old; essentially we now have X*Y/Z rather than X/(Z/Y)

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Main change, as described above
M       components/clm/src/biogeophys/SnowHydrologyMod.F90

========= Note sporadic multi-instance failure; remove a test from the xfail
          list that is now passing
M       components/clm/cime_config/testdefs/ExpectedTestFails.xml

===============================================================
===============================================================
Tag name:  clm4_5_16_r238
Originator(s):  andre (Benjamin Andre,UCAR/CSEG,303-497-1391)
Date: Sat May 13 11:45:15 MDT 2017
One-line Summary: ED is now an external library 'fates'

Purpose of changes
------------------

The ongoing evolution of the 'ED' library is being done by
NGEE-Tropics as 'FATES'. This change removes the 'ED' directory and
replace it with link an external release of fates.

The primary changes are to finish creation of an interface layer to
separate fates from CLM. There are also numerous science improvements
in the linked fates library.


Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID): 2459 - patch from Erik Kluzek

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions):
Changes to CLM's user interface (e.g., new/renamed XML or namelist variables):
Changes made to namelist defaults (e.g., changed parameter values):

 * ED has been completely rebranded as fates. This includes:
    * New/renamed compsets - ICLM45ED is now ICLM45FATES, ICLM50FATES.
    * Renamed name list variables:
       * use_ed --> use_fates
       * use_ed_spitfire --> use_fates_spitfire
        
    * New namelist variable: fates_paramfile, this can point to either
      the clm parameter file, or a standalone fates parameter file
      depending on user preference. All fates dimensions and variables
      are namespaced by 'fates_'.

 * Fates can not restart and interpolate from a CLM-{SP,CN,BGC}
   initial conditions file. It must be run in cold start or restart
   from a CLM-fates restart file.

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance):

Changes to tests or testing:

 * Add tests to aux_clm45 using the fates compsets and renamed the ed
   test mods to fates and fatesFire.

 * Added the cheyenne_intel test list to aux_clm45

 * all namelist tests are expected to fail because of use_ed -> use_fates rename.

Code reviewed by: 

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing:

  build-namelist tests:

    yellowstone - unit tests pass

  unit-tests (components/clm/src):

    yellowstone - all tests pass

  tools-tests (components/clm/test/tools):

    yellowstone - n/a not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - n/a not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - pass
    yellowstone_pgi - pass
    yellowstone_gnu (clm45 only) - pass
    cheyenne_intel - [ experimental, see xfails list ] pass w/ xfails
    hobart_nag - pass w/ xfails
    hobart_pgi - not run per CLM-CMT discussion, see bugz 2447, 2455
    hobart_intel - pass

CLM tag used for the baseline comparisons: clm4_5_16_r237


Answer changes
--------------

Changes answers relative to baseline: answer changing for ED/fates
    compsets, but bit for bit for all other clm45 and clm50 compsets

  Verified not answer changing for CLM50 compsets via test suite, and
  20 year simulation by Dave Lawrence and Keith Olseson.

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: ED/fates compsets only
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): unknown

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? n/a

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: n/a

   URL for LMWG diagnostics output used to validate new climate: n/a
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.):
  
A  components/clm/SVN_EXTERNAL_DIRECTORIES - new SVN_EXTERNALS file for fates
A  components/clm/src/fates

List all files eliminated:

D  components/clm/src/ED - removed and replaced by fates external

List all files reamed:

rename testmod edTest --> fates
  default now with fire off
A  testmods_dirs/clm/fates
A  testmods_dirs/clm/fates/user_nl_clm
A  testmods_dirs/clm/fates/shell_commands
D  testmods_dirs/clm/edTest
D  testmods_dirs/clm/edTest/user_nl_clm
D  testmods_dirs/clm/edTest/shell_commands

rename testmod edNoFire --> fatesFire
A  testmods_dirs/clm/fatesFire
A  testmods_dirs/clm/fatesFire/user_nl_clm
A  testmods_dirs/clm/fatesFire/include_user_mods
A  testmods_dirs/clm/fatesFire/shell_commands
D  testmods_dirs/clm/edNoFire
D  testmods_dirs/clm/edNoFire/user_nl_clm
D  testmods_dirs/clm/edNoFire/include_user_mods
D  testmods_dirs/clm/edNoFire/shell_commands

List all files added and what they do:

List all existing files that have been modified, and describe the changes:

M   .ChangeLog_template - include cheyenne_intel
M   parse_cime.cs.status - patch from Erik Kluzek bugz 2459

Point build to new src/fates directory instead of src/ED
M   clm/cime_config/buildlib
M   clm/bld/configure

Update namelist with new fates paramfile, rename use_ed to use_fates
in namelist logic, rename functions to be fates instead of ed. Update tests.
M   clm/bld/CLMBuildNamelist.pm
M   clm/bld/unit_testers/build-namelist_test.pl
M   clm/bld/test_build_namelist/t/input/namelist_defaults_clm4_5_test.xml
M   clm/bld/test_build_namelist/t/input/namelist_definition_clm4_5_test.xml
M   clm/bld/test_build_namelist/t/test_do_transient_pfts.pm
A   clm/bld/test_build_namelist/t/test_fates_mode.pm
D   clm/bld/test_build_namelist/t/test_ed_mode.pm
M   clm/bld/test_build_namelist/t/test_do_harvest.pm
M   clm/bld/test_build_namelist/t/test_do_transient_crops.pm
M   clm/bld/namelist_files/namelist_definition_clm4_5.xml
M   clm/bld/namelist_files/namelist_defaults_clm4_5.xml

Update test for fates, cheyenne_intel
M   clm/cime_config/testdefs/ExpectedTestFails.xml
M   clm/cime_config/testdefs/testlist_clm.xml

Stub fates parameter interface for unit tests:
M       components/clm/src/CMakeLists.txt
A  +    components/clm/src/unit_test_stubs/utils/clmfates_paraminterfaceMod_stub.F90
M       components/clm/src/unit_test_stubs/utils/CMakeLists.txt

Rename ED compset FATES
M   clm/cime_config/config_compsets.xml
M   clm/cime_config/config_component.xml

Fates interface
A   clm/src/utils/clmfates_paraminterfaceMod.F90
M   clm/src/utils/clmfates_interfaceMod.F90

Rename use_ed to use_fates and other rebranding
M   clm/src/biogeochem/CNCStateUpdate1Mod.F90
M   clm/src/biogeochem/CNMRespMod.F90
M   clm/src/biogeochem/CNVegetationFacade.F90
M   clm/src/biogeochem/CNDriverMod.F90
M   clm/src/main/clm_varpar.F90
M   clm/src/main/subgridRestMod.F90
M   clm/src/main/atm2lndType.F90
M   clm/src/main/restFileMod.F90
M   clm/src/main/initSubgridMod.F90
M   clm/src/main/initVerticalMod.F90
M   clm/src/main/surfrdMod.F90
M   clm/src/biogeophys/PhotosynthesisMod.F90
M   clm/src/biogeophys/HydrologyDrainageMod.F90
M   clm/src/biogeophys/SurfaceAlbedoMod.F90
M   clm/src/biogeophys/SurfaceRadiationMod.F90
M   clm/src/biogeophys/SoilMoistStressMod.F90
M   clm/src/biogeophys/CanopyStateType.F90
M   clm/src/dyn_subgrid/dynSubgridDriverMod.F90
M   clm/src/dyn_subgrid/dynEDMod.F90
M   clm/src/dyn_subgrid/dynSubgridControlMod.F90
M   clm/src/soilbiogeochem/SoilBiogeochemDecompCascadeBGCMod.F90
M   clm/src/soilbiogeochem/SoilBiogeochemDecompCascadeCNMod.F90
M   clm/src/soilbiogeochem/SoilBiogeochemPotentialMod.F90
M   clm/src/soilbiogeochem/SoilBiogeochemLittVertTranspMod.F90
M   clm/src/soilbiogeochem/SoilBiogeochemCarbonFluxType.F90
M   clm/src/soilbiogeochem/SoilBiogeochemDecompMod.F90
M   clm/src/soilbiogeochem/SoilBiogeochemCarbonStateType.F90


Update logic for fates compatibility and to use clm_fates interface
M   clm/src/biogeochem/EDBGCDynMod.F90
M   clm/src/main/subgridWeightsMod.F90
M   clm/src/main/decompInitMod.F90
M   clm/src/main/clm_initializeMod.F90
M   clm/src/main/subgridMod.F90
M   clm/src/main/histFileMod.F90
M   clm/src/main/controlMod.F90
M   clm/src/main/clm_varctl.F90
M   clm/src/main/clm_driver.F90
M   clm/src/main/pftconMod.F90
M   clm/src/main/initGridCellsMod.F90
M   clm/src/main/decompMod.F90
M   clm/src/main/clm_instMod.F90
M   clm/src/main/readParamsMod.F90
M   clm/src/biogeophys/CanopyTemperatureMod.F90
M   clm/src/biogeophys/HydrologyNoDrainageMod.F90
M   clm/src/biogeophys/BalanceCheckMod.F90
M   clm/src/biogeophys/WaterStateType.F90
M   clm/src/biogeophys/TotalWaterAndHeatMod.F90
M   clm/src/biogeophys/CanopyFluxesMod.F90
M   clm/src/biogeophys/SoilStateInitTimeConstMod.F90
M   clm/src/biogeophys/RootBiophysMod.F90
M   clm/src/biogeophys/OzoneMod.F90

M   clm/src/main/paramUtilMod.F90 - new generic routines used by fates interface
M   clm/src/main/PatchType.F90 - new patch array to distinguish between fates patch and clm pft

A   clm/src/biogeophys/SoilWaterPlantSinkMod.F90 - from SoilWaterMovement
M   clm/src/biogeophys/SoilWaterMovementMod.F90 - moved to SoilWaterPlantSink
M   clm/src/biogeophys/WaterfluxType.F90 - new variable for fates
M   clm/src/biogeophys/SoilStateType.F90 - remove tsink

===============================================================
===============================================================
Tag name:  clm4_5_16_r237
Originator(s):  erik (Erik Kluzek)
Date: Tue May  9 15:05:51 MDT 2017
One-line Summary: Latest parameter file and some changes for CLM50, CLM45-transient changes answers also

Purpose of changes
------------------

Adjustments to CLM50 climate from Keith Oleson, Peter Lawrence, Fang Li, Rosie Fisher, Danica Lombardozzi, Will Weider, 
Yaqiong Lu, Ben Sanderson, and David Lawrence.  Some tweaks to the code and to parameters and the parameter file for CLM50. 
Use Medlyn 2011 stomotal conductance rather than Ball-Berry. Modify photosynthesis and leaf maintence respiration for crop. 
Limit irrigation if river flow is on and the storage drops below a threshold. Modify a long list of parameter values including 
41 items on the parameter file.  Only harvest up to 98% to allow for regrowth and divide by several terms rather than just deadstem. 
Add slash harvesting fields (debris left from harvesting). Add in a hack to read in FWS_TWS_A/B if they are on the surface 
dataset and use them to calculate finundation based on TWS rather than exponential function based on ZWT. For fires change an 
if statement from checking if atmosphere is non-freezing to a specific soil layer.  If crops have hit peak LAI set leaf allocation 
to a small value. Make sure some retranslocation terms are positive. Let lnc in Photosynthesis max out at 10. Only vary baset 
for crops for spring wheat and sugarcane (irrigated and non) rather than all crops.

Coupled crop cases will change since we now use the radiation time-step for fertilization rather than the model time-step.
CLM45 cases remain the same with the exception for transient cases which change answers due to the change in how
harvest is handled. Fix a few minor bugs that came in with clm4_5_15_r236 with specific datasets and finidat file handling in scripts
(bugs 2448-2451).


Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID):

  2452  --- Change to divisor for harvest and also allow for regrowth
  2451  --- Bad comment marker in cropf10IC testmods
  2450  --- Make sure finidat is reset after setting to coldstart
  2449  --- Add no fail to init_interp_attributes and use_init_interp, needed for DV cases where interpolated IC files aren't there
  2448  --- Misnamed dataset in CLM xml database

Known bugs introduced in this tag (include bugzilla ID):
  2457  --- Remove FINUN_HIST from history
  2456  --- Remove extra settings of use_init_interp
  2455  --- PGI specific error at initialization
  2454  --- masterlist_addfld getting confused with names for species...
  2453  --- Memory error with restart variable vcmx25t
  2447  --- Floating overflow for CLM50CROP case on hobart_nag in Photosynthesis
  
Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): None

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): New slash harvest fields
   SLASH_HARVESTC, DWT_SLASH_CFLUX, C13_DWT_SLASH_CFLUX, C14_DWT_SLASH_CFLUX

Changes made to namelist defaults (e.g., changed parameter values): Many adjustments for CLM50
    modifyphoto_and_lmr_forcrop     TRUE       for CLM50
    stomatalcond_method             Medlyn2011 for CLM50 with PHS
    limit_irrigation_if_rof_enabled TRUE       for CLM50
    Following values modified for CLM50 cases
    modify baseflow_scalar, rh_low, bt_min, bt_max, cli_scale, boreal_peatfire_c, pot_hmn_ign_counts_alpha
           non_boreal_peatfire_c, cropfire_a1, lfuel, cmb_cmplt_fact, irrig_threshold_fraction,
           n_melt_glcmec, br_root, initial_Cstocks_depth

Changes to the datasets (e.g., parameter, surface or initial files): CLM50 parameter file clm5_params.c170413.nc
    Update CLM50 paramsfile, fsurdat-f09-2000-crop, flanduse_timeseries-f45-hist/f10-hist

Substantial timing or memory changes: None

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): finundation changes are messy

Changes to tests or testing: Fixed testmods for one tests

Code reviewed by: self,dlawren,lawrence,oleson,rosiefisher,wweider,lifang

Did you follow the steps in .CLMTrunkChecklist: Yes

CLM testing: regular

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - PASS (93 comparison tests fail to clm4_5_15_r236)

  unit-tests (components/clm/src):

    yellowstone - PASS

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - PASS
    yellowstone_pgi - PASS
    yellowstone_gnu (clm45 only) - PASS
    hobart_nag --- OK
    hobart_pgi --- OK
    hobart_intel - PASS

CLM tag used for the baseline comparisons:  clm4_5_15_r236


Answer changes
--------------

Changes answers relative to baseline: All CLM50 and CLM45-transient

  Summarize any changes to answers, i.e.,
    - what code configurations: All CLM50 compsets and any transient cases with CLM45
             Also coupled crop cases
    - what platforms/compilers: All
    - nature of change:
       Adjusted climate for CLM50 and changes to harvesting for CLM45

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): None

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

   M       components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml -
               modifyphoto_and_lmr_forcrop     TRUE       for CLM50
               stomatalcond_method             Medlyn2011 for CLM50 with PHS
               limit_irrigation_if_rof_enabled TRUE       for CLM50
               Following values modified for CLM50 cases
               modify baseflow_scalar, rh_low, bt_min, bt_max, cli_scale, boreal_peatfire_c, pot_hmn_ign_counts_alpha
                      non_boreal_peatfire_c, cropfire_a1, lfuel, cmb_cmplt_fact, irrig_threshold_fraction,
                      n_melt_glcmec, br_root, initial_Cstocks_depth
               Update CLM50 paramsfile, fsurdat-f09-2000-crop, flanduse_timeseries-f45-hist/f10-hist
   M       components/clm/bld/CLMBuildNamelist.pm ------------------------- Make sure local finidat defined for cold start
               allow nofail for use_init_interp and init_interp_attributes

   M       components/clm/cime_config/testdefs/testmods_dirs/clm/cropf10IC/user_nl_clm - Use \! for comment

   M       components/clm/src/biogeochem/CNPhenologyMod.F90 ----------- Use radiation time-step rather than dt for Fertilization
   M       components/clm/src/biogeochem/CNFireBaseMod.F90 ------------ Change ufuel default
   M       components/clm/src/biogeochem/dynHarvestMod.F90 ------------ Only harvest up to 98% and divide by sum of several
               terms rather than just deadstem (Peter Lawrence)
   M       components/clm/src/biogeochem/ch4FInundatedStreamType.F90 -- Modify endrun call
   M       components/clm/src/biogeochem/dynConsBiogeochemMod.F90 ----- Slash flux to litter and CWD
   M       components/clm/src/biogeochem/CNFireLi2016Mod.F90 ---------- Change if statement from check on forcing temp non-freezing
              to tsoi17 non-freezing (From Fang Li)
   M       components/clm/src/biogeochem/ch4Mod.F90 ------------------- Add ability to read in FWS_TWS_A/B terms from surface
              dataset and use for calculation of finundated based on TWS rather than use exponential inversion on ZWT
   M       components/clm/src/biogeochem/CNVegCarbonFluxType.F90 ------ Add slash harvest flux fields (Peter Lawrence)
   M       components/clm/src/biogeochem/CropType.F90 ----------------- Only do baset_map_latvary for spring wheat and sugarcane
              both irrigated and non.
   M       components/clm/src/biogeochem/NutrientCompetitionFlexibleCNMod.F90 - If crops have hit peaklai, then set leaf allocation to small value
              make sure leafn_to_retransn, frootn_to_retransn and livestemn_to_retransn is positive
   M       components/clm/src/biogeophys/PhotosynthesisMod.F90 -------- Let lnc max out at 10

===============================================================
===============================================================
Tag name:  clm4_5_15_r236
Originator(s):  erik (Erik Kluzek)
Date: Mon May  1 01:42:23 MDT 2017
One-line Summary: New surface datasets, and landuse.timeseries files, as well as interpolating initial conditions for almost all cases

Purpose of changes
------------------

New fsurdat and landuse.timeseries datasets for almost all resolutions.
New initial conditions datasets pointed to as much as possible for all resolutions (have ability to turn off to COLDSTART for some tests).
Normally model will now die, if it can't find initial conditions to interpolate from.
Reasonable f09 and f19 PE layout for cheyenne. Fix another issue on Cheyenne. Add new pgi/intel tests for hobart.

Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID):
   2445 -- ED not working with new datasets
   2444 -- dimensional change in URBAN_AC/URBAN_HEAT for interpolation of restart files
   2441 -- fire emissions on cheyenne
   2291 -- fire emissions with gnu compiler sometimes NaN, sometimes change answers for trivial changes
   2239 -- need new initial conditions files with extra metadata on them

Known bugs introduced in this tag (include bugzilla ID):
  2447 -- Floating overflow for CLM50CROP case on hobart_nag in Photosynthesis
  #1215 -- (in this version of cime) TestStatus sometimes needs to have write permission added
  #? -- manage_case doesn't work
  #? -- ./xmlquery --list-all doesn't work


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): 

   All initial conditions have to be interpolated now, but there are ones that can be interpolated from for standard cases
   NOTE NOW IF YOU WANT TO DO A COLD START USING ARBITRARY INITIAL CONDITIONS SET CLM_FORCE_COLDSTART=on
   Also the model will normally fail if it can't find initial conditions close enough to interpolate from

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): A close finidat file will almost always be set

Changes made to namelist defaults (e.g., changed parameter values): 

Changes to the datasets (e.g., parameter, surface or initial files): New fsurdat/finidat/landuse.timeseris

Substantial timing or memory changes: None

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance):

Changes to tests or testing: New pgi/intel tests for hobart

   Expected fails removed: bug 2239, 2291, and added SMS_Ld5_D_P24x1.f10_f10.IHISTCLM50BGC.hobart_nag.clm-monthl for bug 2447

Code reviewed by: self

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing: regular

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone -  PASS

  unit-tests (components/clm/src):

    yellowstone - PASS

  tools-tests (components/clm/test/tools):

    yellowstone - PASS

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - PASS
    yellowstone_pgi -  PASS
    yellowstone_gnu (clm45 only) - PASS
    hobart_nag --- OK
    hobart_pgi --- OK
    hobart_intel - OK

CLM tag used for the baseline comparisons:  clm4_5_15_r235


Answer changes
--------------

Changes answers relative to baseline: Yes 

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: Almost all CLM45 and CLM50 configurations because of new datasets
    - what platforms/compilers: All
    - nature of change (roundoff; larger than roundoff/same climate; new climate):  similar climate

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): None

List all files eliminated:

------ No longer need vrtlay_interp testmods, nor user_nl_clm for some
D       components/clm/cime_config/testdefs/testmods_dirs/clm/vrtlay_interp/user_nl_clm
D       components/clm/cime_config/testdefs/testmods_dirs/clm/vrtlay_interp/include_user_mods
D       components/clm/cime_config/testdefs/testmods_dirs/clm/vrtlay_interp/README
D       components/clm/cime_config/testdefs/testmods_dirs/clm/vrtlay_interp
D       components/clm/cime_config/testdefs/testmods_dirs/clm/cropColdStart/user_nl_clm
D       components/clm/cime_config/testdefs/testmods_dirs/clm/decStart1851_noinitial/user_nl_clm
D       components/clm/cime_config/testdefs/testmods_dirs/clm/monthly_noinitial/user_nl_clm
------- Reduce size of files
D       components/clm/tools/mkprocdata_map/clm4054_ne30g16_I2000.clm2.h0.2000-01_c121107.nc
D       components/clm/tools/mkprocdata_map/clm4054_f19g16_I2000.clm2.h0.2000-01_c121107.nc

List all files added and what they do:

------------ New test-mods with specific initial conditions
A       components/clm/cime_config/testdefs/testmods_dirs/clm/defaultf09IC/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/defaultf09IC/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/defaultf09IC
A       components/clm/cime_config/testdefs/testmods_dirs/clm/cropf10IC/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/cropf10IC/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/cropf10IC
A       components/clm/tools/mkprocdata_map/clm4054_ne30g16_I2000.clm2.h0.2000-01_c170430.nc
A       components/clm/tools/mkprocdata_map/clm4054_f19g16_I2000.clm2.h0.2000-01_c170430.nc

A       components/clm/cime_config/testdefs/testmods_dirs/clm/allActive/shell_commands - CLM_FORCE_COLDSTART=on
A       components/clm/cime_config/testdefs/testmods_dirs/clm/cropColdStart/shell_commands - CLM_FORCE_COLDSTART=on
A       components/clm/cime_config/testdefs/testmods_dirs/clm/monthly_noinitial/shell_commands - CLM_FORCE_COLDSTART=on

------------ New unit test for surfrdUtilsMod subroutines
A       components/clm/src/main/test/surfrdUtils_test/test_surfrdUtils.pf
A       components/clm/src/main/test/surfrdUtils_test/CMakeLists.txt

List all existing files that have been modified, and describe the changes:

M       components/clm/bld/CLMBuildNamelist.pm ---------------------------- Add better handling of finding finidat files
             either with an exact match or interpolated from
M       components/clm/bld/unit_testers/build-namelist_test.pl ------------ Add new failure tests, fix ed-test
M       components/clm/bld/namelist_files/namelist_definition_clm4_5.xml -- Add init_interp_how_close and init_interp_sim_years
M       components/clm/bld/namelist_files/namelist_defaults_overall.xml --- Start type is startup (requires finidat) for CLM45/CLM50
             unless use_cndv is on
M       components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml ---- init_interp_how_close=75 and init_interp_sim_years=1850,2000
            new 2-deg IC files IGM1850GSWCLM50BGCCROP, I1850CRUCLM45BGC, IGM2000GSWP3CLM50BGCCROPIRR, ICRUCLM45SP
            redone 2-deg ICLM45BGCCROP
            create_crop_landunit on unless ED is on
            updated: fsurdat, flanduse.timeseries for all but 1x1_smallville_IA and 0.125x0.125

M       components/clm/cime_config/testdefs/ExpectedTestFails.xml -- ICLM45VIC.yellowstone now PASS
              SMS_Lm25.f19_g16.ICLM45BGCCROP.yellowstone_gnu now PASS, new fail SMS_Ld5_D_P24x1.f10_f10.IHISTCLM50BGC.hobart_nag.clm-monthly

M       components/clm/cime_config/testdefs/testmods_dirs/clm/irrig_spunup/user_nl_clm - remove finidat and init_interp_fill_missing_with_natveg
M       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subset/user_nl_clm - set fsurdat, create_crop_landunit
M       components/clm/cime_config/testdefs/testmods_dirs/clm/USUMB/user_nl_clm ------ create_crop_landunit = .false.
M       components/clm/cime_config/testdefs/testmods_dirs/clm/40ptsROA/shell_commands - CLM_FORCE_COLDSTART=on
M       components/clm/cime_config/testdefs/testmods_dirs/clm/edTest/user_nl_clm ------ remove finidat=''
M       components/clm/cime_config/testdefs/testmods_dirs/clm/allActive/user_nl_clm
M       components/clm/cime_config/testdefs/testmods_dirs/clm/ptsROA/shell_commands - CLM_FORCE_COLDSTART=on
M       components/clm/cime_config/testdefs/testmods_dirs/clm/40ptsRLA/shell_commands - CLM_FORCE_COLDSTART=on
M       components/clm/cime_config/testdefs/testmods_dirs/clm/40ptsRLB/shell_commands - CLM_FORCE_COLDSTART=on
M       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_spunup_inc_dec_bgc/user_nl_clm - new finidat
M       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_spunup_inc_dec_bgc/README
M       components/clm/cime_config/testdefs/testmods_dirs/clm/interp_f19_crop/user_nl_clm - remove finidat
M       components/clm/cime_config/testdefs/testmods_dirs/clm/interp_f19_crop/README
M       components/clm/cime_config/testdefs/testmods_dirs/clm/ptsRLA/shell_commands - CLM_FORCE_COLDSTART=on
M       components/clm/cime_config/testdefs/testmods_dirs/clm/ptsRLB/shell_commands - CLM_FORCE_COLDSTART=on
M       components/clm/cime_config/testdefs/testmods_dirs/clm/clm50cropIrrigMonth_interp/user_nl_clm - remove finidat, 
                init_interp_fill_missing_with_natveg
M       components/clm/cime_config/testdefs/testmods_dirs/clm/decStart1851_noinitial/shell_commands- CLM_FORCE_COLDSTART=on
M       components/clm/cime_config/testdefs/testmods_dirs/clm/decStart1851_noinitial/README
M       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_spunup_1way/user_nl_clm - new finidat
M       components/clm/cime_config/testdefs/testmods_dirs/clm/clm50KitchenSink/user_nl_clm - remove finidat
M       components/clm/cime_config/testdefs/testlist_clm.xml -- new pgi/intel hobart tests, vrtlay_interp->vrtlay,
                use defaultf09IC cropf10IC for two LII tests
M       components/clm/cime_config/user_nl_clm ----------- Fix documentation of irrigate, add note to use CLM_FORCE_COLDSTART
                rather than finidat=' '
M       components/clm/cime_config/config_component.xml - HIST and 2000 compsets for BGCCROP turn irrigation on
M       components/clm/cime_config/config_pes.xml -- Add f09 and f19 PE layouts for cheyenne

M       components/clm/src/biogeochem/FireEmisFactorsMod.F90 - Copy crop factors from generic crop CFT's

M       components/clm/src/main/test/CMakeLists.txt ---------- Add new unit test
M       components/clm/src/main/surfrdUtilsMod.F90 ----------- Add renormalize and convert_cft_to_pft functions
             lighten tolerence for sums to equal 1 from 1.e-14 to 1.e-13
M       components/clm/src/main/surfrdMod.F90 ---------------- Add surfrd_pftformat, surfrd_cftformat to read in old/new formats
             for CFT or PFT, also handle conversion of new CFT format to PFT format for ED
M       components/clm/src/biogeophys/EnergyFluxType.F90 ----- For CLM50 urban add _L to URBAN_AC/HEAT to restart files, 
             so CLM45 won't be confused with CLM50

===============================================================
===============================================================
Tag name:  clm4_5_15_r235
Originator(s):  sacks (Bill Sacks)
Date: Thu Apr 27 07:47:50 MDT 2017
One-line Summary: Zero dynbal fluxes if namelist variable is set

Purpose of changes
------------------

Some fully-active system tests were dying due to too-large sensible heat fluxes
(thousands or 10s of thousands of W m-2) generated from the dynbal
adjustments. These large fluxes arose because these tests trigger daily dynamics
of CISM (via the test_coupling namelist option), rather than the typical annual
coupling. The annual dribblers see these mid-year adjustments and apply them all
in a single time step, rather than spreading them throughout the year.

The changes in this tag allow you to set a namelist variable
(for_testing_zero_dynbal_fluxes) to force the dynbal fluxes to zero. Typically,
this namelist variable should only be used for testing: setting it to
.true. breaks water and energy conservation. We will set this to true in the
fully-active tests that use daily CISM dynamics.


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables):
- new namelist variable, for_testing_zero_dynbal_fluxes; should only be used for
  testing

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing: none

Code reviewed by: self

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - pass
    yellowstone_pgi - pass
    yellowstone_gnu (clm45 only) - pass
    hobart_nag - pass

CLM tag used for the baseline comparisons: clm4_5_15_r234


Answer changes
--------------

Changes answers relative to baseline: NO - bit-for-bit

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Changes as described above
M       components/clm/src/dyn_subgrid/dynConsBiogeophysMod.F90
M       components/clm/src/dyn_subgrid/dynSubgridControlMod.F90
M       components/clm/bld/namelist_files/namelist_definition_clm4_5.xml

===============================================================
===============================================================
Tag name:  clm4_5_15_r234
Originator(s):  andre (Benjamin Andre,UCAR/CSEG,303-497-1391)
Date: Fri Apr 14 08:34:22 MDT 2017
One-line Summary: Update rtm and mosart externals

Purpose of changes
------------------

Update externals to rtm1_0_61 and mosart1_0_23.

Includes change to python build-namelist (rtm, mosart), histfile
bugfix (rtm, mosart), and science bugfix / changes (mosart).

Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID): 2434

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions):

  python build namelist for rtm will no longer automatically point rtm
  to a clm restart file. rtm should be configured to generate and read
  it's own restart files.

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing) : none


---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing:

rtm was not outputing a restart file for the ref run in SSP tests, but
was attempting to read one during the second run because of
build-namelist changes in rtm1_0_60. All SSP tests in aux_clm45 and
prebeta were changed to use a new test mod, rtmColdSSP, that forces
rtm to do a cold start when coming out of spinup.

Old RCP/clm40 tests that were not compatible with new rtm
build-namelist behavior were removed.

Code reviewed by: self, discussion with Erik Kluzek.

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - n/a, not run 

  unit-tests (components/clm/src):

    yellowstone - n/a, not run

  tools-tests (components/clm/test/tools):

    yellowstone - n/a, not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - n/a, not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

    All tests passed bit for bit except:

      * expected failures

      * Tests with mosart passed functionality, answer changing as expected.

      * SSP tests passed functionality, but don't have baselines
        because of test-mod change. Manually ran cprc to compare with
        clm4_5_15_r233, files were reported as identical.

        e.g. cprnc clm4_5_15_r233/SSP_D_Ld10.f19_g16.I1850CLM45BGC.yellowstone_intel.clm-default/clm2.h0.0001-01-06-00000.nc clm4_5_15_r234-prelim/SSP_D_Ld10.f19_g16.I1850CLM45BGC.yellowstone_intel.clm-rtmColdSSP/clm2.h0.0001-01-06-00000.nc


CLM tag used for the baseline comparisons: clm4_5_15_r233


Answer changes
--------------

Changes answers relative to baseline: yes

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: all runs with mosart
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate):  unknown, assumed same climate.

   If bitwise differences were observed, how did you show they were no worse
   than roundoff?

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename:

       mosart1_0_23 was reviewed by Sean Swenson and Dave Lawrence in
       a long coupled run and approved.

   URL for LMWG diagnostics output used to validate new climate: none
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.):

rtm1_0_61, mosart1_0_23

List all files eliminated: none

List all files added and what they do:

New test mod so rtm will do a cold start during SSP tests.

A     clm/cime_config/testdefs/testmods_dirs/clm/rtmColdSSP
A     clm/cime_config/testdefs/testmods_dirs/clm/rtmColdSSP/include_user_mods
A     clm/cime_config/testdefs/testmods_dirs/clm/rtmColdSSP/user_nl_rtm

List all existing files that have been modified, and describe the changes:

Remove old RCP/clm40 tests that were not compatible with new rtm
behavior. Update SSP tests in aux_clm45 and prebeta to use new
rtmColdSSP testmod.

M     clm/cime_config/testdefs/testlist_clm.xml


===============================================================
===============================================================
Tag name:  clm4_5_15_r233
Originator(s):  erik (Erik Kluzek)
Date: Tue Apr 11 23:30:45 MDT 2017
One-line Summary: Pull out some constants and options to namelist

Purpose of changes
------------------

Pull out a list of constants and options to namelist control. Decrease a few error tolderances.
Add in reseed_dead_plants namelist option, so can reseed dead plants for BGC on a restart.
Reenable LND_TUNING_MODE, although currently set the same for all options. Add some new 
compsets in. Fix a few bugs, including Jim Edward's fix for vector output.
Start adding in the stream option for finundated. Add option to turn Medlyn photosynthesis on.
Replace & with &amp; in namelist_definition_clm4_5.xml

Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID):
   2440 Remove use of mct_gsmap_op and replace with mct_gsMap_orderedPoints
   2430 Problem with units on new landuse.timeseries datasets
   2184 vector (1d) history output crashes for some fields

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): None

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): Added new parameters to namelist
   New namelists: cnvegcarbonstate and cn_general
   New namelist items:
         modifyphoto_and_lmr_forcrop, stomatalcond_method, lfuel, ufuel, cmb_complt_fact,
         initial_Cstocks_depth, ndep_taxmode, ndep_varlist, init_interp_attributes, reseed_dead_plants,
         initial_vegC, finundation_method
   New output history variables: Remove RSCANOPY unless use_ed add: VCMX25T, JMX25T, TPU25T
   New compsets I1850GSWCLM50BGCCROP, IM1850GSWCLM50BGCCROP, IGM1850GSWCLM50BGCCROP, IGMHISTGSWCLM50BGCCROP

Changes made to namelist defaults (e.g., changed parameter values): None

Changes to the datasets (e.g., parameter, surface or initial files): params files

Substantial timing or memory changes: None

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): None

Changes to tests or testing: None

Code reviewed by: self

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing: regular

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - OK (183 test fail comparison to previous namelists)

  unit-tests (components/clm/src):

    yellowstone - PASS

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - OK
    yellowstone_pgi - OK
    yellowstone_gnu (clm45 only) - OK
    hobart_nag - OK

CLM tag used for the baseline comparisons:  clm4_5_15_r232


Answer changes
--------------

Changes answers relative to baseline: None bit-for-bit

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): None

List all files eliminated: None

List all files added and what they do:

-------- Start adding ability to read finundated streams data (currently disabled)
   A   components/clm/src/biogeochem/ch4FInundatedStreamType.F90

List all existing files that have been modified, and describe the changes:

   M   components/clm/bld/CLMBuildNamelist.pm --- Add setup_logic_cnvegcarbonstate, 
         new namelists: cnvegcarbonstate and cn_general, refactor how finidat files
         were being found to a better more general methodology that allows a second
         go to find finidat file to interpolate from (currently disabled)
   M   components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml ---- New settings:
         modifyphoto_and_lmr_forcrop, stomatalcond_method, use_init_interp, init_interp_attributes
         initial_Cstocks_depth, initial_vegC, and new params file with medlynslope/intercept
   M   components/clm/bld/namelist_files/namelist_definition_clm4_5.xml -- New namelist items:
         modifyphoto_and_lmr_forcrop, stomatalcond_method, lfuel, ufuel, cmb_complt_fact,
         initial_Cstocks_depth, ndep_taxmode, ndep_varlist, init_interp_attributes, reseed_dead_plants,
         initial_vegC, finundation_method
   M   components/clm/bld/unit_testers/build-namelist_test.pl -- Test that use_init_interp=.true. with
         finidat blank is fails

   M   components/clm/cime_config/config_component.xml - Set LND_TUNING_MODE by compset
   M   components/clm/cime_config/config_compsets.xml -- Add: I1850GSWCLM50BGCCROP, IM1850GSWCLM50BGCCROP, 
         IGM1850GSWCLM50BGCCROP, IGMHISTGSWCLM50BGCCROP compsets

   M   components/clm/src/biogeochem/CNBalanceCheckMod.F90 --- Decrease carbon error tolerance from 1xe-8 to 1xe-7
          and nitrogen error tolerance from 1xe-4 to 1xe-3
   M   components/clm/src/biogeochem/CNFireBaseMod.F90 ---------- Add lfuel, ufuel, cmb_cmplt_fact to namelist
   M   components/clm/src/biogeochem/CNVegCarbonStateType.F90 --- Add InitReadNML and read in initial_vegC in
          new cnvegcarbonstate namelist, handle reseeding with reseed_patch filter
   M   components/clm/src/biogeochem/CNVegNitrogenStateType.F90 - Handle reseeding with reseed_patch filter for
          restart read
   M   components/clm/src/biogeochem/CNVegStateType.F90 --------- Handle reseeding with reseed_patch filter for
   M   components/clm/src/biogeochem/CNVegetationFacade.F90 ----- Add namelist read CNReadNML for cn_general
          and  reseed_dead_plants option, pass it and/or reseed filter down as appropriate
   M   components/clm/src/biogeochem/CropType.F90 ------ Check validity of baset_mapping, set latbaset_patch to nan
          if not used, switch logic of how activated
   M   components/clm/src/biogeochem/ch4varcon.F90 ----- Make default private, explicitly make items public as needed
          add finundation_mtd and valid settings, read finundation_method in namelist and check it
   M   components/clm/src/biogeochem/dynHarvestMod.F90 - Validate units of harvest fields abort if not right

   M   components/clm/src/biogeophys/CanopyStateType.F90 --- Only send RSCANOPY to history if use_ed is on
   M   components/clm/src/biogeophys/PhotosynthesisMod.F90 - Add: stomatalcond_mtd, modifyphoto_and_lmr_forcrop namelist
         items, add extra history output: VCMX25T, JMX25T, TPU25T

   M   components/clm/src/main/GetGlobalValuesMod.F90 - Replace mct_gsMap_orderedPoints for mct_gsMap_OP
   M   components/clm/src/main/histFileMod.F90 -------- Fix for bug 2184 from Jim Edwards
   M   components/clm/src/main/init_hydrology.F90 ----- Call init_root_moist_stress
   M   components/clm/src/main/ncdio_pio.F90.in ------- Replace mct_gsMap_orderedPoints for mct_gsMap_OP
   M   components/clm/src/main/ndepStreamMod.F90 ------ Add: ndep_taxmode, ndep_varlist to namelist
   M   components/clm/src/main/pftconMod.F90 ---------- Add: medlynslope/intercept to data/alloc/read/clean

   M   components/clm/src/soilbiogeochem/SoilBiogeochemCarbonStateType.F90 ------ Use decomp_cascade_con%initial_stock_soildepth
          in place of hardcoded 0.3
   M   components/clm/src/soilbiogeochem/SoilBiogeochemCompetitionMod.F90 ------- Increase error tolerence allowed
          for endrun for too much NH4 uptake predicted by FUN
   M   components/clm/src/soilbiogeochem/SoilBiogeochemDecompCascadeBGCMod.F90 -- Add initial_Cstocks_depth to namelist
   M   components/clm/src/soilbiogeochem/SoilBiogeochemDecompCascadeConType.F90 - Add initial_stock_soildepth set to 0.3

   M   components/clm/src/unit_test_stubs/csm_share/mct_mod_stub.F90 - Replace mct_gsMap_OP with mct_gsMap_orderedPoints

   M   components/clm/src/utils/quadraticMod.F90 - Allow for situations where a sqrt of a slightly negative number
          would crash the code.

===============================================================
===============================================================
Tag name:  clm4_5_15_r232
Originator(s):  erik (Erik Kluzek)
Date: Wed Apr  5 23:04:37 MDT 2017
One-line Summary: Some small changes that affect both clm4_5 and clm5_0 answers (can be considered bug fixes to clm4_5)

Purpose of changes
------------------

A set of some small changes that affect answers for both CLM45 and CLM50. A fix to a rare problem where soil albedo
could go negative from Keith Oleson and Sean Swenson, by making sure a calculated value could not go below a small value.
A change from Will Weider to lower leaf maintence respiration (LMR) for low LAI. Always calculate btran2 even for low
temperatures and/or low liquid water this lowers fires in boreal forests. For crop at peak LAI set hui to max of hui and 
huigrain. Change the handling of GDDPLANT accumulator field from Keith Oleson. Get rid of the use_voc logic that just
prevented MEGAN from activating for crop, since now MEGAN handles the crop case (since clm4_5_13_r204).

Bugs fixed or introduced
------------------------
   2437 -- lower leaf maintence respiration for low LAI
   2436 -- some adjustments to crop
   2435 -- always calculate btran to lower fires in boreal forests
   2431 -- Rare condition under which soil albedo goes negative
   2368 -- Remove use_voc as MEGAN can now work with crop

Bugs fixed (include bugzilla ID):

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): None

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): None

Changes made to namelist defaults (e.g., changed parameter values): None

Changes to the datasets (e.g., parameter, surface or initial files): None

Substantial timing or memory changes: None

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): None

Changes to tests or testing: None

Code reviewed by: self, oleson, dll, dlawren, wweider, fangli

Did you follow the steps in .CLMTrunkChecklist: Yes

CLM testing: regular

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - PASS

  unit-tests (components/clm/src):

    yellowstone - PASS

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - OK
    yellowstone_pgi - OK
    yellowstone_gnu (clm45 only) - OK
    hobart_nag - OK

CLM tag used for the baseline comparisons:  clm4_5_14_r231


Answer changes
--------------

Changes answers relative to baseline: Yes!

  Summarize any changes to answers, i.e.,
    - what code configurations:
    - what platforms/compilers:
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): None

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

   M  components/clm/src/biogeophys/SurfaceAlbedoMod.F90 --- Fix bug 2431 where soil albedo can got negative
         make sure a calculated value doesn't go too small
   M  components/clm/src/biogeophys/PhotosynthesisMod.F90 -- Add check for divide by zero fo lnc, reduce
         lmr for low LAI
   M  components/clm/src/biogeophys/SoilMoistStressMod.F90 - Always calculate btran2 even for low temperature
         and/or low liquid water this lowers fires in boreal forests
   M  components/clm/src/biogeochem/CNPhenologyMod.F90 ----- For crop at peak lai set hui to max of hui and huigrain
   M  components/clm/src/biogeochem/CropType.F90 ----------- Change handling of GDDPLANT

----------- Remove use_voc logic
   M  components/clm/src/cpl/clm_cpl_indices.F90 ----------- Remove use_voc
   M  components/clm/src/main/clm_instMod.F90 -------------- Remove use_voc
   M  components/clm/src/main/controlMod.F90 --------------- Remove use_voc
   M  components/clm/src/main/clm_varctl.F90 --------------- Remove use_voc
   M  components/clm/src/main/clm_driver.F90 --------------- Remove use_voc
   M  components/clm/src/main/lnd2atmMod.F90 --------------- Remove use_voc

===============================================================
===============================================================
Tag name:  clm4_5_14_r231
Originator(s):  sacks (Bill Sacks)
Date: Sun Apr  2 19:36:02 MDT 2017
One-line Summary: Add option to reset snow pack over non-glacier columns

Purpose of changes
------------------

When going from a CLM spinup under one set of atmospheric forcings to a
different set of atmospheric forcings, there is the possibility that columns
that reached large snow depths in the spinup should really have only seasonal
snow cover under the new atmosphere. This is a particular concern for the LIWG
in some areas of Greenland that have only seasonal snow cover: there is a
concern that the offline spinup can bake in too-high snow cover in some
regions. This can especially be a problem because of feedbacks: starting out
with a too-high snow cover can cool the overlying atmosphere, leading to
persistence of the snow pack. This is also a problem because, once the snow pack
becomes very deep, it seems that its refreezing can make it less likely that the
snow pack will ever melt.

To deal with these issues, this tag introduces a new namelist item,
reset_snow. This is typically .false. If you set it to .true., then all snow in
non-glacier columns is reset to 35 mm SWE over the first few time steps of the
run.

This resetting is accomplished via the snow capping mechanism. This
implementation was chosen because it is challenging to reset the snow pack
directly, since there are so many snow-related variables that must be kept in
sync. The snow capping mechanism already handles this properly, so it's easiest
to reuse this mechanism. However, unlike standard snow capping, the flux of snow
lost through this resetting is sent into a new flux that simply disappears into
nothingness - rather than being sent to glc and/or rof. Thus, note that - by
design! - the flux from this snow resetting breaks conservation: We do not want
this lost snow to affect ocean circulation, since this is essentially just a
mechanism for adjusting an initial conditions file.


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions):
- Specifying reset_snow = .true. will lead to a loss of conservation for the
  first few time steps of the run

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables):
- New namelist variable: reset_snow

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing: none

Code reviewed by: Leo van Kampenhout reviewed an initial prototype

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - ok
    tests pass; namelists differ from baseline, as expected

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

    ok means tests pass, NLCOMP failures as expected

CLM tag used for the baseline comparisons: clm4_5_14_r230


Answer changes
--------------

Changes answers relative to baseline: no - bit-for-bit

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated:

List all files added and what they do:

========= Unit test of new logic
A       components/clm/src/biogeophys/test/SnowHydrology_test/test_SnowHydrology_SnowCappingExcess.pf

List all existing files that have been modified, and describe the changes:

========= Changes as described above
M       components/clm/bld/CLMBuildNamelist.pm
M       components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml
M       components/clm/bld/namelist_files/namelist_definition_clm4_5.xml
M       components/clm/src/biogeophys/LakeHydrologyMod.F90
M       components/clm/src/biogeophys/BalanceCheckMod.F90
M       components/clm/src/biogeophys/WaterfluxType.F90
M       components/clm/src/biogeophys/SnowHydrologyMod.F90
M       components/clm/src/biogeophys/HydrologyDrainageMod.F90
M       components/clm/src/biogeophys/test/SnowHydrology_test/CMakeLists.txt

===============================================================
===============================================================
Tag name:  clm4_5_14_r230
Originator(s):  sacks (Bill Sacks)
Date: Fri Mar 31 16:25:49 MDT 2017
One-line Summary: Fix dynamic landunits water and energy conservation

Purpose of changes
------------------

Fixes water and energy conservation with dynamic landunits. This conservation
works by summing the water and energy contents of each grid cell before and
after the dynamic landunits transitions, then dealing with the difference
through runoff and sensible heat fluxes. However, the code for counting the
water and energy contents was wrong - slightly wrong for water, and
substantially wrong for energy. The energy counts were 6 orders of magnitude too
small, and also were missing some terms.

This tag fixes these counts, and reconciles the dynamic landunits water and
energy accounting with the accounting done for the balance checks. It also
refactors some of the code used in the balance checks to facilitate code sharing
between various places.

Also: adds wa_col (water in the unconfined aquifer) to the list of fields copied
to newly-initializing columns, to avoid spurious dynlu adjustment fluxes due to
changes in wa_col.


Bugs fixed or introduced
------------------------

Known bugs introduced in this tag (include bugzilla ID): [If none, remove this line]
- https://github.com/NCAR/CLM/issues/2 - Count energy of water in lakes in total
  gridcell heat content
- https://github.com/NCAR/CLM/issues/3 - Perform gridcell-level water balance
  checks bracketing the entire run loop

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables):
- Some renamed history variables: see below

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: not investigated, but no major changes expected

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing: none

Code reviewed by: Dave Lawrence and Keith Oleson reviewed the new code
conceptually for scientifc correctness; Ryan Knox reviewed a slightly older
version of the new code for counting water and energy contents

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

    ok means tests pass, answers change as expected

CLM tag used for the baseline comparisons: clm4_5_14_r229


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: ALL
    - what platforms/compilers: ALL
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 

    (1) Roundoff-level changes for all cases

    (2) Large changes in diagnostics of total gridcell water and total gridcell
        heat, due to various fixes

    (3) Dynamic landunit water adjustments change substantially for glacier
        transitions, and somewhat for transient crops

    (4) Dynamic landunit heat adjustments change substantially for all runs with
        dynamic landunits (transient glacier, transient crop): change by about
        6 orders of magnitude

    (5) Changes in transient crop cases due to copying wa_col to
        newly-initiating columns (though answer changes may be minor for clm5
        cases?)

    (6) Possibly other changes that I'm forgetting?

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: none

List all files added and what they do:

========= Moved code that sums water and energy contents to here, to facilitate
          code sharing; added unit tests for *some* of it
A       components/clm/src/biogeophys/TotalWaterAndHeatMod.F90
A       components/clm/src/biogeophys/test/TotalWaterAndHeat_test/test_total_water_and_heat.pf
A       components/clm/src/biogeophys/test/TotalWaterAndHeat_test/CMakeLists.txt
A       components/clm/src/biogeophys/test/TotalWaterAndHeat_test

List all existing files that have been modified, and describe the changes:

========= Major rework: Use new shared routines for calculating heat and water
          contents; adjust dynlu adjustment heat flux based on heat content of
          dynlu adjustment runoff flux
M       components/clm/src/dyn_subgrid/dynConsBiogeophysMod.F90
M       components/clm/src/biogeophys/BalanceCheckMod.F90

========= Copy wa_col (water in the unconfined aquifer), to avoid large adjustments
M       components/clm/src/dyn_subgrid/dynInitColumnsMod.F90
M       components/clm/src/dyn_subgrid/test/dynInitColumns_test/test_init_columns.pf

========= Use new routines for water content
M       components/clm/src/biogeophys/HydrologyDrainageMod.F90
M       components/clm/src/biogeophys/LakeHydrologyMod.F90

========= New constant for baseline wa_col (water in the unconfined aquifer),
          replacing hard-coded constants
M       components/clm/src/main/clm_varcon.F90
M       components/clm/src/biogeophys/SoilHydrologyMod.F90
M       components/clm/src/biogeophys/SoilHydrologyInitTimeConstMod.F90

========= For performance: introduce col%hydrologically_active, used in place of
          is_hydrologically_active function call
M       components/clm/src/main/ColumnType.F90
M       components/clm/src/main/filterMod.F90
M       components/clm/src/main/initSubgridMod.F90
M       components/clm/src/main/glcBehaviorMod.F90

========= Changes to diagnostic fields: Remove incorrect HCSOI, HC; rename
          GC_HEAT1 and GC_HEAT2 to HEAT_CONTENT1 and HEAT_CONTENT2; add
          HEAT_CONTENT1_VEG; add LIQUID_WATER_TEMP1
M       components/clm/src/biogeophys/TemperatureType.F90
M       components/clm/src/biogeophys/SoilTemperatureMod.F90
M       components/clm/src/biogeophys/LakeTemperatureMod.F90

========= Changes to diagnostic fields: Rename GC_LIQ1/2 to LIQUID_CONTENT1/2,
          and similar for ICE; also remove some now-unused fields
M       components/clm/src/biogeophys/WaterStateType.F90

========= Minor changes to some calls
M       components/clm/src/dyn_subgrid/dynSubgridDriverMod.F90
M       components/clm/src/main/clm_driver.F90

========= New stub routines
M       components/clm/src/unit_test_stubs/main/ncdio_pio_fake.F90.in

========= New unit tests
M       components/clm/src/biogeophys/CMakeLists.txt
M       components/clm/src/biogeophys/test/CMakeLists.txt

========= Add some comments
M       components/clm/src/main/subgridAveMod.F90
M       components/clm/src/main/column_varcon.F90

========= Remove unneeded use statements and associates
M       components/clm/src/biogeophys/UrbanParamsType.F90
M       components/clm/src/biogeophys/HydrologyNoDrainageMod.F90
M       components/clm/src/main/initVerticalMod.F90

===============================================================
===============================================================
Tag name:  clm4_5_14_r229
Originator(s):  erik (Erik Kluzek)
Date: Fri Mar 10 11:32:20 MST 2017
One-line Summary: Update cime and make some changes to drv_flds_in namelist, fix some minor bugs

Purpose of changes
------------------

Update cime to a version with an updated top level directory structure. It also fixes a problem
with a CLM test.

The new cime version has a new directory structure, and updates the XML schema for namelist files
from verison 1 to version 2. Currently the perl namelist code can NOT read version 2. Hence, a local
copy of the version 1 files for the drv_flds_in fields was added to CLM. Also the use of the datm
namelist files for some tools was dropped -- I think that's OK though.

Fix two minor bugs.

The new cime has a few improvements. It now adjusts the PIO namelist when the PE layout changes.
There's a new option to case.setup "--no-adjust-pio" to not do that. --mpilib option was added
to create_test. You can remove your bld directory area without having to rerun case.setup.


Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID):
  2433 -- format error in HumanIndexMod.F90
  2432 -- intent mixing in dynVarMod.F90
CIME Issues fixed (include issue #):
  1074 -- ERP_D_Ld5.hcru_hcru.ICRUCLM45BGC.yellowstone_pgi fails with PIO error

Known bugs introduced in this tag (include bugzilla ID): (recently found, but predate this tag)
  1217 -- Driver allows a contradiction in drv_flds_in between CAM and CLM
  1220 -- missing mpi-serial mpirun case on hobart

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): None

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables):

   case.setup has a new option --no-adjust-pio

   The user now can rm -rf their build area and rebuild without having
     to re-run case.setup.

Changes made to namelist defaults (e.g., changed parameter values): None

Changes to the datasets (e.g., parameter, surface or initial files): None

Substantial timing or memory changes: None

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance):

   CIME now normally adjusts PIO layout if you change the PE layout.

   Also puts a copy of namelist definition and defaults for drv_flds_in in CLM.
   This copy needs to be doubly maintained with the versions in the driver and in CAM.
   The advantage of having a copy is because each copy is using a different version of
   the xml schema, and potentially the driver might have additional fields that interact
   with other components besides CLM. Currently the only drv_flds_in fields are all shared
   between only CAM and CLM. But, the fact that there are duplicated copies does mean
   changes in any one of those components will need to go into the other two.

   Also removes the datm namelist files read in tools such as queryDefaultNamelist.pl.
   I think this is OK, as this connection may no longer be needed. It does make the
   listDefaultNamelist.pl less useful, but I think that's OK as well.

Changes to tests or testing:

   add --mpilib option to create_test

Code reviewed by: self,mvertens

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing: regular, tools

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - PASS

  unit-tests (components/clm/src):

    yellowstone - PASS

  tools-tests (components/clm/test/tools):

    yellowstone - OK

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - OK

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - OK
    yellowstone_pgi - OK
    yellowstone_gnu (clm45 only) - OK
    hobart_nag - OK

CLM tag used for the baseline comparisons: clm4_5_14_r226


Answer changes No bit-for-bit
--------------

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): cime, cime_config
   Update cime         to cime5.3.0-alpha.02
   Add new cime_config at cime_config0.0.1.alpha.03

List all files eliminated: None

List all files added and what they do: These are version 1 of the files, the ones in the driver
                                       are now version 2.

A       components/clm/bld/namelist_files/namelist_definition_drv.xml ------- Copy from driver
A       components/clm/bld/namelist_files/namelist_definition_drv_flds.xml -- Copy from driver
A       components/clm/bld/namelist_files/namelist_defaults_drv.xml --------- Copy from driver

List all existing files that have been modified, and describe the changes:

------------ Point to new local copy of drv_flds namelist files, and bunch of whitespace changes
------------ Remove pointing to datm namelist files as they are now version 2, and the perl code
------------ currently can't read them
M       components/clm/bld/queryDefaultNamelist.pl ------ Point to local location of namelist drv files
             and remove pointing to datm namelist files
M       components/clm/bld/CLMBuildNamelist.pm ---------- Point to local location of namelist drv files
M       components/clm/bld/listDefaultNamelist.pl ------- Point to local location of namelist drv files
             and remove pointing to datm namelist files

M       components/clm/cime_config/testdefs/ExpectedTestFails.xml Remove hcr_hcru test that is now passing

------------ Get unit tests working with the new cime directory structure
M       components/clm/src/CMakeLists.txt ----------------------------- New cime directory structure
M       components/clm/src/unit_test_stubs/csm_share/seq_comm_mct.F90 - Just change comment as to where
             the "real" file exists

------------ Fix a couple of bugs
M       components/clm/src/biogeophys/HumanIndexMod.F90 --- Fix bug 2433 format error
M       components/clm/src/dyn_subgrid/dynVarMod.F90.in --- Fix bug 2432 intent issue

===============================================================
===============================================================
Tag name:  clm4_5_14_r228
Originator(s):  erik (Erik Kluzek)
Date: Tue Mar  7 14:17:07 MST 2017
One-line Summary: Bring in changes that were accidentally dropped as part of the clm4_5_14_r226 tag

Purpose of changes
------------------

Bring in changes that were included for the testing of clm4_5_14_r226, but accidentally dropped
when moved to the trunk tag. Only a limited amount of testing was done, since the testing was
done in the clm4_5_14_r226 tag.


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): None

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): None

Changes made to namelist defaults (e.g., changed parameter values): None

Changes to the datasets (e.g., parameter, surface or initial files): None

Substantial timing or memory changes: None

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers: None

Changes to tests or testing: None

Code reviewed by: self

Did you follow the steps in .CLMTrunkChecklist: yes

CLM testing: short, since full testing was done in clm4_5_14_r226

CLM tag used for the baseline comparisons:  clm4_5_14_r227


Answer changes
--------------

Changes answers relative to baseline: No bit-for-bit

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): None

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

---------- Remove --phys option to PTCLM testing
M    components/clm/test/tools/nl_files/PTCLM_USUMB_clm4_5
M    components/clm/test/tools/nl_files/PTCLM_USUMB_Cycle_clm4_5
M    components/clm/test/tools/nl_files/PTCLM_USUMB_Global_clm4_5

M    components/clm/cime_config/config_component.xml ------------ Remove unnneeded "<list>"
M    components/clm/cime_config/testdefs/ExpectedTestFails.xml -- Add note about hcru_hcru failing test
M    components/clm/cime_config/testdefs/testlist_clm.xml ------- Add a test with MOSART on hobart_nag
M    components/clm/src/biogeophys/SnowSnicarMod.F90 ------------ Fix bug 2479 workaround for Intel 16/17 compiler
M    components/clm/src/main/initGridCellsMod.F90 --------------- Fix bug 2417 for create_crop_landunit

===============================================================
===============================================================
Tag name:  clm4_5_14_r227
Originator(s):  sacks (Bill Sacks)
Date: Mon Mar  6 09:42:41 MST 2017
One-line Summary: Improve performance of dynamic landunits code

Purpose of changes
------------------

Main change is to improve the performance of the column state updates portion of
the dynamic landunits code. In optimized, global runs, this piece of the code
(dyn_cnbal_col) was taking 3 - 5% of total CLM runtime. Its cost was greater in
global debug runs (~ 10 - 15%), and even greater in single-point debug runs (30
- 40%).

Here I have introduced a variable that tracks whether there are any changes in
area in this time step for each clump; if not, then it avoids doing most of the
work in dyn_cnbal_col.

This tag also fixes the fortran unit tests with the new cime version: the
necessary changes were accidentally dropped from the last tag.


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: 3-4% performance improvement for global,
optimized runs; greater performance improvement for debug and single-point runs

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing: none

Code reviewed by: self

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - pass
    yellowstone_pgi - pass
    yellowstone_gnu (clm45 only) - pass
    hobart_nag - pass

CLM tag used for the baseline comparisons: clm4_5_14_r226


Answer changes
--------------

Changes answers relative to baseline: NO - bit-for-bit

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Main changes, as noted above. Primary changes are in
          dynColumnStateUpdater, but other modules needed to be changed in order
          to pass the clump index down. Eventually, we should be able to get rid
          of this clump index tracking, instead having a separate object for
          each clump - but that is waiting on a major refactor of how we handle
          threading in CLM.
M       components/clm/src/soilbiogeochem/SoilBiogeochemCarbonStateType.F90
M       components/clm/src/soilbiogeochem/SoilBiogeochemNitrogenStateType.F90
M       components/clm/src/dyn_subgrid/test/dynColumnStateUpdater_test/test_column_state_updater.pf
M       components/clm/src/dyn_subgrid/dynSubgridDriverMod.F90
M       components/clm/src/dyn_subgrid/dynColumnStateUpdaterMod.F90
M       components/clm/src/biogeochem/dynConsBiogeochemMod.F90
M       components/clm/src/biogeochem/CNVegetationFacade.F90
M       components/clm/src/biogeochem/ch4Mod.F90

========= Fix unit tests
M       components/clm/src/CMakeLists.txt
M       components/clm/src/README.unit_testing

========= Note expected failure that started failing in r226
M       components/clm/cime_config/testdefs/ExpectedTestFails.xml

===============================================================
===============================================================
Tag name:  clm4_5_14_r226
Originator(s):  erik (Erik Kluzek)
Date: Thu Mar  2 15:12:50 MST 2017
One-line Summary: Update cime, mosart and cism to a version that is cesm2_0_beta05 or part of beta06

Purpose of changes
------------------

Update cime version and cism to version that similar to that in cesm2_0_beta05, but with many fixes in cime for
clm. Also update mosart to fix a bug on hobart. The update of cism does change answers as it makes CISM2 the
default with the new 4km greenland grid.

There are some user improvements in the latest cime version. Long term archiving issues are fixed. A file
called CASEROOT is added to your case's $RUNDIR so that you can easily see where your source code is. A few
options were added to create_newcase and create_clone (see details below). 

NOTE: You will need to use the "--run-unsupported" to create_newcase for compsets/grids that aren't tested or supported!!!

Fix a few other existing bugs. Fix createcrop_landunit to work with the new CLM surface datasets. Bring in a
workaround for a compiler bug with intel 17 and 18. Bring in a version of PTCLM that works with the latest cime.

Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID):
   2417 -- fix createcrop_landunit for new datasets with 16 PFTs
   2418 -- fix grid match for config_compsets.xml (cime issue 1079 still there)
   2424 -- Update mosart to 1_0_20 to fix the nag bug
   2479 -- workaround for intel compiler bug
   2357 -- PTCLM broken in cime5

CIME Issues fixed (include issue #): archiving, unit-tests, grid issues, gnu compiler, 
   cime issues fixed: 1075, 1053, 1051, 1073, 1072, 1089

Known bugs introduced in this tag (include bugzilla ID):
   1074 -- hcru_hcru grid no longer works gives PIO error
   1079 -- mask for grid matching

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): None

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): 
  Add support for cheyenne
  CASEROOT file added to $RUNDIR to show path to source
  Add "--run-unsupported" option to create_newcase
  Add "--cime-output-root" option to create_clone
  Fix long term achiving issues

Changes made to namelist defaults (e.g., changed parameter values): drv namelist changes
   PIO namelists have different defaults
   some grids are null and maps are idmap when they aren't needed
   clm40 removed from all active compsets

Changes to the datasets (e.g., parameter, surface or initial files): None

Substantial timing or memory changes: Seems to run faster (~20%)! (we don't understand why)

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): 
    Refactoring in cime for unit-testing, add schema files for cime xml files
    buildnml faster
    config_grids and xmlquery was refactored

Changes to tests or testing: Add test with mosart on hobart

Code reviewed by: self, sacks

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - PASS

  unit-tests (components/clm/src):

    yellowstone - PASS

  tools-tests (components/clm/test/tools):

    yellowstone - PASS

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - OK

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - OK
    yellowstone_pgi - OK
    yellowstone_gnu (clm45 only) - OK
    hobart_nag - OK

CLM tag used for the baseline comparisons:  clm4_5_14_r225


Answer changes
--------------

Changes answers relative to baseline: Yes. Compsets with CISM

  Summarize any changes to answers, i.e.,
    - what code configurations: All with CISM
    - what platforms/compilers: All
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
        compsets are updated to default to CISM2 and the new 4km greenland grid

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): cime, cism, mosart, PTCLM

    cime   to cime5.2.0-alpha25
    mosart to mosart1_0_20
    cism   to cism2_1_29
    PTCLM  to PTCLM2_170302

List all files eliminated:

 D components/clm/tools/shared

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

 M        components/clm/cime_config/config_compsets.xml - Workaround in 2418 for cime issue 1079
 M        components/clm/test/tools/TSMscript_tools.sh --- Fix arguments sent to TCB scrip

===============================================================
===============================================================
Tag name:  clm4_5_14_r225
Originator(s):  sacks (Bill Sacks)
Date:  Sun Feb 19 14:42:13 MST 2017
One-line Summary: Fix GDD accumulation in new crop columns

Purpose of changes
------------------

For newly-initiating crop columns in the middle of a run, the 20-year-average
GDD variables (gdd*20) were not being initialized correctly. They were starting
as spval, and then taking essentially forever to come down to some reasonable
value. This caused major problems for both dynamic landunits and when running
init_interp from one crop run to another, where the new run had some new crop
types - such as going from a run without irrigation to a run with irrigation.

This tag fixes these problems.


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions):
- If you do a CROP run, setting use_init_interp to .true., and pointing to a
  previous initial conditions file generated with a crop run (thus having
  restyear > 0 on the restart file), then GDD accumulation will get reset. This
  means that the first year of your run won't have any crop growth. After this
  initial "burn-in" period, it will run fine. This is only an issue when using
  initial conditions generated prior to this tag, and is only an issue when
  using init_interp.

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing: New initial conditions file for tests that use
clm50cropIrrigMonth_interp or irrig_spunup testmods - see details below.

Code reviewed by: self

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

    ok means tests pass, some expected baseline failures:

    Baseline comparisons fail because GDD accumulation is now fixed for
    transient crops:
        ERS_Ly3_Mmpi-serial.1x1_smallvilleIA.IHISTCLM50BGCCROP.yellowstone_gnu.clm-cropMonthOutput
        ERS_Ly6_Mmpi-serial.1x1_smallvilleIA.IHISTCLM50BGCCROP.yellowstone_gnu.clm-cropMonthOutput
        SMS_D_Ly6_Mmpi-serial.1x1_smallvilleIA.IHISTCLM45BGCCROP.yellowstone_pgi.clm-cropMonthOutput

    These tests point to a previously-spun-up crop file, and use init_interp. I
    have adjusted this file to add the new patch-level nyrs_crop_active
    variable, which I set to 30 for all active crop PFTs (in agreement with the
    old restyear). However, this initial conditions file does not have any
    non-irrigated crop PFTs! So crop behavior was wrong in the baseline run,
    because non-irrigated crops started with spval gdd*20 values.
        SMS_D_P24x1_Ld5.f10_f10.ICRUCLM50BGCCROP.hobart_nag.clm-irrig_spunup
        ERP_D_P15x2_Ld5.f10_f10.ICRUCLM50BGCCROP.yellowstone_intel.clm-irrig_spunup
        ERP_P60x2_Lm36.f10_f10.ICRUCLM50BGCCROP.yellowstone_intel.clm-clm50cropIrrigMonth_interp

CLM tag used for the baseline comparisons: clm4_5_14_r224


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations:
      - Transient crop cases
      - Any crop case for which initial conditions are init_interp'ed from a
        previous crop case: nyrs_crop_active is reset to 0 in this case
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      Potentially new climate for transient crop cases

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? n/a

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: n/a

   URL for LMWG diagnostics output used to validate new climate: n/a
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Main changes, as noted above
M       components/clm/src/main/clm_driver.F90
M       components/clm/src/biogeochem/CNPhenologyMod.F90
M       components/clm/src/biogeochem/CNVegetationFacade.F90
M       components/clm/src/biogeochem/CropType.F90

========= Point to new version of initial conditions file - same as old, but
          hacked to have nyrs_crop_active patch-level variable: set to 30 for
          active crop PFTs, 0 elsewhere. This hack is needed since we run
          init_interp for these tests: this allows crops to grow initially.
M       components/clm/cime_config/testdefs/testmods_dirs/clm/clm50cropIrrigMonth_interp/user_nl_clm
M       components/clm/cime_config/testdefs/testmods_dirs/clm/irrig_spunup/user_nl_clm

===============================================================
===============================================================
Tag name:  clm4_5_14_r224
Originator(s):  sacks (Bill Sacks)
Date: Fri Feb 10 06:27:53 MST 2017
One-line Summary: Tweaks for glaciers and snow

Purpose of changes
------------------

A number of answer-changing tweaks for glaciers and snow, mainly with the intent
of improving glacial melt over Greenland in CESM2.

(1) New longwave downscaling parameterization, based on Van Tricht et al. (2016,
    TC) Figure 6, doi:10.5194/tc-10-2379-2016. This uses a simple linear lapse
    rate for LW radiation, which seems better supported by observations than the
    old approach based on blackbody radiation relationships. Two new namelist
    parameters control this behavior: lapse_rate_longwave and
    longwave_downscaling_limit. This changes answers for all cases with multiple
    elevation classes - i.e., all cases with CISM (IG, etc.), just over the
    regions with downscaling (Greenland and Antarctica). This change is from Leo
    van Kampenhout.

(2) Modified the parameterization of snow cover fraction during melt to improve
    glacial melt over Greenland in CESM2:

    (a) New value for n_melt (parameter controlling snow cover fraction as snow
        melts) over glc_mec columns for CLM5. The previous value of 10 resulted
        in near-100% snow cover fraction over glaciers. The new value of 1
        allows snow cover fractions more similar to other landcover
        types. n_melt_glcmec is a new namelist parameter. This changes answers
        for all CLM5 cases with glc_mec (i.e., with CISM), just over glc_mec
        landunits.

    (b) For all landcover types, maintain snow cover fraction at 100% when
        h2osno exceeds 2m SWE in CLM5. This is important in conjunction with
        (a), in order to avoid snow cover fraction dropping significantly below
        100% when very deep (e.g., 10m) snow packs begin to melt. This is
        controlled by a new namelist parameter, int_snow_max, which can be set
        to a very large value to retrieve the old behavior. This changes answers
        for all CLM5 cases; in principle, it changes answersfor all landunits,
        but in practice, this should only matter where we have a very deep snow
        pack - typically, just in regions where the snow persists for more than
        a year.

    These two changes were proposed in a discussion with Leo van Kampenhout,
    Bill Lipscomb, Dave Lawrence and Sean Swenson.

(3) Set the ddz3 term controlling snow compaction for glaciers and wetlands in
    the same way as for soil and crop landunits. This should have been included
    in clm4_5_14_r222 (which brought in consistency in the treatment of snow
    cover fraction in glacier & wetland landunits), but was overlooked in that
    tag. This changes answers for all cases, just over glacier, glacier_mec and
    wetland columns. This change was reviewed by Sean Swenson and Leo van
    Kampenhout.


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables):
- New namelist variables:
  - lapse_rate: the temperature lapse rate for downscaling over ice sheets
    (default kept the same as before, though there may be roundoff-level
    differences due to the precision of the namelist parameter)
  - lapse_rate_longwave: the longwave radiation lapse rate for downscaling over
    ice sheets
  - longwave_downscaling_limit: the relative limit capping longwave radiation
    downscaling
  - n_melt_glcmec: the value of n_melt (parameter controlling snow cover fraction
    as snow melts) over glc_mec columns
  - int_snow_max: limit applied to integrated snowfall when determining changes in
    snow-covered fraction during melt
- INT_SNOW diagnostic now inactive by default

Changes made to namelist defaults (e.g., changed parameter values): Some of the
new namelist variables have defaults different from the previous hard-coded
values, but no changes to existing namelist defaults.

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing: Removed a bunch of no-longer-used test lists:
aux_clm_ys_intel, aux_clm_ys_pgi, aux_science, aux_scripts, aux_testsystem,
csltiming, aux_rasm

Code reviewed by: self

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - ok

    tests pass, differences as expected

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

    ok means tests pass, but differences from baselines and namelist differences
    as expected

CLM tag used for the baseline comparisons: clm4_5_14_r223


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: ALL
    - what platforms/compilers: ALL
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      Larger than roundoff. Expect at least small regional climate differences -
      specifically over Greenland and Antarctica.
    
    Answer changes are from:

    (1) New longwave downscaling parameterization. This changes answers for all
        cases with multiple elevation classes - i.e., all cases with CISM (IG,
        etc.), just over the regions with downscaling (Greenland and
        Antarctica).

    (2) New value for n_melt over glc_mec columns for CLM5. This changes answers
        for all CLM5 cases with glc_mec (i.e., with CISM), just over glc_mec
        landunits.

    (3) Modified parameterization of snow cover fraction during melt to maintain
        snow cover fraction at 100% when h2osno exceeds 2m SWE in CLM5. This
        changes answers for all CLM5 cases; in principle, it changes answersfor
        all landunits, but in practice, this should only matter where we have a
        very deep snow pack - typically, just in regions where the snow persists
        for more than a year.

    (4) Set the ddz3 term controlling snow compaction for glaciers and wetlands
        in the same way as for soil and crop landunits. This changes answers for
        all cases, just over glacier, glacier_mec and wetland columns.

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= New longwave radiation downscaling; make lapse rate a namelist
          parameter; refactor unit tests a bit
M       components/clm/src/main/atm2lndMod.F90
M       components/clm/src/main/atm2lndType.F90
M       components/clm/src/main/test/atm2lnd_test/test_downscale_forcings.pf
M       components/clm/src/main/test/atm2lnd_test/test_partition_precip.pf

========= Apply int_snow_max; treat ddz3 consistently for glaciers and wetlands
M       components/clm/src/biogeophys/SnowHydrologyMod.F90
M       components/clm/src/biogeophys/CanopyHydrologyMod.F90

========= New int_snow_max and n_melt_glcmec namelist variables
M       components/clm/src/main/controlMod.F90
M       components/clm/src/main/clm_varcon.F90
M       components/clm/src/main/initVerticalMod.F90

========= Add some inactive history fields that just apply over glaciers
M       components/clm/src/biogeophys/EnergyFluxType.F90
M       components/clm/src/biogeophys/WaterStateType.F90

========= New setup_landunit_ncols utility method
M       components/clm/src/unit_test_shr/unittestSimpleSubgridSetupsMod.F90

========= New namelist parameters, as documented above
M       components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml
M       components/clm/bld/namelist_files/namelist_definition_clm4_5.xml
M       components/clm/bld/CLMBuildNamelist.pm

========= Remove unneeded use statements
M       components/clm/src/main/clm_driver.F90
M       components/clm/src/main/clm_instMod.F90

========= Remove no-longer-used testlists: aux_clm_ys_intel, aux_clm_ys_pgi,
          aux_science, aux_scripts, aux_testsystem, csltiming, aux_rasm. Main
          motivation is that lists starting with 'aux_*' now have special
          meaning, indicating what compset/grid combinations we test regularly.
M       components/clm/cime_config/testdefs/testlist_clm.xml

===============================================================
===============================================================
Tag name:  clm4_5_14_r223
Originator(s):  sacks (Bill Sacks)
Date: Fri Feb  3 10:07:24 MST 2017
One-line Summary: Handle patch-level C&N variables correctly with dynamic landunits

Purpose of changes
------------------

The infrastructure for handling conservation of patch-level C&N variables when
subgrid weights changed was only considering changes in patch weights on the
COLUMN. For dynamic landunits - where whole columns and landunits can change in
area - this needs to consider changes in patch weights on the GRIDCELL. This tag
makes this change.

In addition, this makes the fire code work correctly with changing column /
landunit areas: Similarly to the other C&N variables, the variable that triggers
landcover-related fires was previously only considering changes in patch weights
on the column.

Also, treat patch-level crop-specific variables (grain pools and
cropseed[c/n]_deficit) in DynamicPatchAdjustments routines. C/N in the grain
pool is sent to the crop product pool via a new flux
(dwt_crop_productc_gain_patch / dwt_crop_productn_gain_patch).


Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID):
- 2106: CNFireMod code should be re-evaluated in the presence of dynamic
  landunits
- Addresses point 14 in 1679: problems with new CNFireMod


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables):
- Removed history variables: DWT_CLOSS / DWT_CLOSS_DRIBBLED (and similarly for
  N). These can be seen with DWT_CONV_CFLUX / DWT_CONV_CFLUX_DRIBBLED
  (previously dwt_closs was simply set equal to dwt_conv_cflux).

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing:
- Changes ciso_bombspike1963 to use monthly output, because this testmod is used
  in a long-running test

Code reviewed by: self

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

    ok means tests pass, changes answers for some tests as noted below

CLM tag used for the baseline comparisons: clm4_5_14_r222


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM45/CLM50 with transient landcover (HIST, RCP,
      DV, IG)
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      - For transient crop and transient glacier: larger than roundoff, may change
        climate slightly
      - Without crop: expected to be only roundoff-level changes (I confirmed
        this in various ways fo some of the changes; for other changes, I did
        not do a careful confirmation that changes were truly just
        roundoff-level)

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: none

List all files added and what they do:

========= For some tests that have daily changes in glacier area, bypass the error-checks
          that ensure that we only have changes in landcover on the year boundary.
A       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_decrease/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_increase/user_nl_clm

List all existing files that have been modified, and describe the changes:

========= Main changes, as described above
M       components/clm/src/dyn_subgrid/test/dynPatchStateUpdater_test/test_patch_state_updater.pf
M       components/clm/src/dyn_subgrid/dynPatchStateUpdaterMod.F90
M       components/clm/src/dyn_subgrid/dynSubgridControlMod.F90
M       components/clm/src/dyn_subgrid/dynPriorWeightsMod.F90
M       components/clm/src/biogeochem/dynConsBiogeochemMod.F90
M       components/clm/src/biogeochem/CNVegCarbonStateType.F90
        - also, treat initialization of cropseedc_deficit consistently with
          grain pools (only initialize if use_crop is .true.)
M       components/clm/src/biogeochem/CNVegNitrogenStateType.F90
        - also, treat initialization of cropseedc_deficit consistently with
          grain pools (only initialize if use_crop is .true.)
M       components/clm/src/biogeochem/CNVegNitrogenFluxType.F90
M       components/clm/src/biogeochem/CNVegCarbonFluxType.F90
M       components/clm/src/biogeochem/CNDriverMod.F90
M       components/clm/src/biogeochem/CNProductsMod.F90
M       components/clm/src/biogeochem/CNFireLi2016Mod.F90
M       components/clm/src/biogeochem/CNFireLi2014Mod.F90
M       components/clm/src/biogeochem/CNFireBaseMod.F90

========= Unrelated change: Since we now only initialize cropseedc_deficit when
          use_crop is true, make sure we only adjust it over prognostic crop
          patches
M       components/clm/src/biogeochem/CNC14DecayMod.F90

========= Unrelated change: use YEAR_POSITION_START_OF_TIMESTEP for consistency
          with other dyn file stuff. This doesn't make any difference for
          harvest, now that it's applied once per year at the beginning of the
          year, but it seems like we might as well be consistent.
M       components/clm/src/biogeochem/dynHarvestMod.F90

========= Add create_vegetated_landunit_n_patches to aid unit testing
M       components/clm/src/unit_test_shr/unittestSimpleSubgridSetupsMod.F90

========= For some tests that have daily changes in glacier area, bypass the error-checks
          that ensure that we only have changes in landcover on the year boundary.
M       components/clm/bld/namelist_files/namelist_definition_clm4_5.xml
M       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_spunup_inc_dec_bgc/user_nl_clm
M       components/clm/src/biogeochem/CNVegStateType.F90

========= Change output to monthly to speed up this long-running test
M       components/clm/cime_config/testdefs/testmods_dirs/clm/ciso_bombspike1963/user_nl_clm

===============================================================
===============================================================
Tag name:  clm4_5_14_r222
Originator(s):  sacks (Bill Sacks)
Date: Fri Jan 27 06:14:19 MST 2017
One-line Summary: Fix energy budget bug with fractional snow on glacier and wetland columns

Purpose of changes
------------------

Leo van Kampenhout discovered a bug in the surface energy budget when there is
fractional snow cover on glacier and wetland columns: frac_sno_eff was being
treated inconsistently for these landcover types.

Note that the old code did not conserve energy due to this bug!

The fix slightly increases melt rates over Greenland, and has other minor
effects on the simulation, but not a huge effect.

More detailed notes on the problem, from Leo, are below. However, note that we
ended up fixing the problem differently from what he suggested - based on Sean
Swenson's suggestion: We fix this by treating glaciers and wetlands the same as
soil with respect to frac_sno_eff. (Note that we still treat lakes differently
[these are handled by different code] and urban differently.)

Here are the more detailed notes from Leo:

Background:

- CLM columns are allowed to have fractional snow cover. 

- The first application of fractional snow cover is to the albedo
  calculation. This is done for every landcover type in the same fashion. This
  fractional snow cover is referred to as 'frac_sno'.

- The second type of fractional snow cover is 'frac_sno_eff', which adjusts
  surface fluxes other than shortwave radiation, such as sensible and latent
  heat. The frac_sno_eff has only been implemented for soil and crop landcover
  types.

- For all other landcovers, such as glaciers, frac_sno_eff =1.0

- As such, glaciers can have frac_sno < frac_sno_eff whereas those are otherwise
  identical

Problem:

- Frac_sno is used to compute absorbed radiation in the soil (sabg_soil) and
  snow (sabg_snow). When frac_sno < 1.0, this will lead to a positive value of
  sabg_soil at the expense of sabg_snow

- In other radiation code, notably SoilTemperatureMod.F90, the other definition
  of fractional snow cover is used (frac_sno_eff)

- For glaciers (frac_sno_eff), this means that no radiation is allowed to enter
  the soil. To my current understanding, this energy is totally lost:

                     eflx_gnet_soil = sabg_soil(p) + dlrad(p) &
                          + (1-frac_veg_nosno(p))*emg(c)*forc_lwrad(c) - lwrad_emit_soil(c) &
                          - (eflx_sh_soil(p)+qflx_ev_soil(p)*htvp(c))

    real(r8)               , intent(out)   :: hs_soil( bounds%begc: )                   ! heat flux on soil [W/m2]

                  ! separate surface fluxes for soil/snow
                  hs_soil(c) = hs_soil(c) + eflx_gnet_soil * patch%wtcol(p)

                     ! this is the snow/soil interface layer
                     rt(c,j) = t_soisno(c,j) + fact(c,j) &
                          *((1._r8-frac_sno_eff(c))*(hs_soil(c) - dhsdT(c)*t_soisno(c,j)) &
                          + cnfac*(fn(c,j) - frac_sno_eff(c) * fn(c,j-1)))

BalanceCheckMod:

- The missing energy should have been detected by BalanceCheckMod, specifically
  the check on surface energy balance:

             ! Surface energy balance
             ! Changed to using (eflx_lwrad_net) here instead of (forc_lwrad - eflx_lwrad_out) because
             ! there are longwave interactions between urban columns (and therefore patches).
             ! For surfaces other than urban, (eflx_lwrad_net) equals (forc_lwrad - eflx_lwrad_out),
             ! and a separate check is done above for these terms.

             if (.not. lun%urbpoi(l)) then
                errseb(p) = sabv(p) + sabg_chk(p) + forc_lwrad(c) - eflx_lwrad_out(p) &
                     - eflx_sh_tot(p) - eflx_lh_tot(p) - eflx_soil_grnd(p)

- Here, the total absorbed solar radiation is FSA has been been replaced by
  sabg_chk. This hides the problem, because sabg_chk itself is also flawed:

 		      ! save sabg for balancecheck, in case frac_sno is set to zero later
                     sabg_chk(p) = frac_sno_eff(c) * sabg_snow(p) + (1._r8 - frac_sno_eff(c) ) * sabg_soil(p)

- With frac_sno_eff = 1.0, this simplifies to sabg_snow. So, sabg_soil is not
  accounted for in the surface energy balance check.

Workaround:

1. Let all solar soil radiation be absorbed by snow:

SurfaceRadiationMod:

             if (frac_sno(c) < frac_sno_eff(c)) then
                ! LvK: workaround, absorb all soil radiation in snow 
                sabg_snow(p) = fsa(p)
                sabg_soil(p) = 0.0_r8
             end if

2. Recommended: let the surface energy balance use FSA :

   errseb(p) = sabv(p) + fsa(p) + forc_lwrad(c) - eflx_lwrad_out(p) &
                     - eflx_sh_tot(p) - eflx_lh_tot(p) - eflx_soil_grnd(p)

Long-term solution:

- Thought needs to be given on how SW radiation should be treated on partially
  covered glacier columns


- Allowing radiation to penetrate the soil, yet keeping frac_sno_eff = 1, is a
  possibility. This will heat the snowpack from below.


- Alternatively, we could look at implementing glacier fractional snow cover for
  surface fluxes also. Needs discussion about the physical basis & how to
  evaluate this.



Again, note that the final implementation differs from Leo's suggestion - I'm
just giving Leo's original notes for completeness.


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing: none

Code reviewed by: Sean Swenson, Leo van Kampenhout, myself

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - not run

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

    ok means tests pass, but baseline comparisons fail as expected

CLM tag used for the baseline comparisons: clm4_5_14_r221


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: All CLM45/CLM50
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      Larger than roundoff; expected to be similar climate (effects are
      relatively small) - although there are non-negligible effects on glacier
      surface mass balance (SMB).

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

M       components/clm/src/biogeophys/BalanceCheckMod.F90
M       components/clm/src/biogeophys/CanopyHydrologyMod.F90

===============================================================
===============================================================
Tag name:  clm4_5_14_r221
Originator(s):  sacks (Bill Sacks)
Date: Tue Jan 24 05:12:14 MST 2017
One-line Summary: Change rain-snow partitioning and ice albedo for glacier columns

Purpose of changes
------------------

Main change is to change the rain-snow partitioning ramp for glacier columns,
when using clm5 physics: Rather than assuming all snow below 0 C and all rain
above 2 C, for glacier columns we now assume all snow below -2 C and all rain
above 0 C. The main motivation for this change is to increase the
otherwise-too-low glacier melt we have been seeing in recent CESM2 test
runs. The physical justification is: The old partitioning makes sense when you
have a positive atmospheric lapse rate - so slightly-above-freezing temperatures
at the surface are associated with below-freezing temperatures at the cloud
level. However, for glaciers, it is relatively common to have a temperature
inversion. Thus, we would expect a different relationship between near-surface
temperatures and phase of precipitation. This new relationship was proposed and
agreed upon by LIWG leadership, particularly Bill Lipscomb, Jan Lenaerts and Leo
van Kampenhout.

To implement this change, I have reimplemented the (simple) rain-snow
partitioning code inline, rather than using the csm_share code. In addition, I
have introduced four new namelist parameters controlling its behavior:
- precip_repartition_glc_all_snow_t
- precip_repartition_glc_all_rain_t
- precip_repartition_nonglc_all_snow_t
- precip_repartition_nonglc_all_rain_t

Also changes ice albedo (albice) for glacier columns from 0.6/0.4 (vis/nir) to
0.5/0.3, when using clm5 physics. This is based on suggestions by Jan Lenaerts,
and agreed upon by the LIWG leadership.


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables):
Four new namelist parameters:
- precip_repartition_glc_all_snow_t
- precip_repartition_glc_all_rain_t
- precip_repartition_nonglc_all_snow_t
- precip_repartition_nonglc_all_rain_t

Changes made to namelist defaults (e.g., changed parameter values):
- Changed defaults for albice with CLM50

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance):
- Duplicated code for rain-snow partitioning: in CLM and csm_share (the
  csm_share version is used by datm). However, this is just a couple of lines of
  code, and it's possible that the CLM version will change in the future, so I
  felt that duplication was not a bad thing here.

Changes to tests or testing: none

Code reviewed by: self

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - ok (pass, but differences from baseline for clm45/clm50 as expected)

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

    ok means tests pass, some baseline comparisons fail as noted below

CLM tag used for the baseline comparisons: clm4_5_14_r220


Answer changes
--------------

Changes answers relative to baseline:

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: All CLM50 cases
    - what platforms/compilers: All
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      Larger than roundoff; expected to be new climate regionally, but may not
      change global climate significantly. I have confirmed via one test that
      differences are only over glacier columns.

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Main changes, as described above
M       components/clm/bld/namelist_files/namelist_definition_clm4_5.xml
M       components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml
MM      components/clm/bld/CLMBuildNamelist.pm
M       components/clm/src/main/atm2lndMod.F90
M       components/clm/src/main/atm2lndType.F90
M       components/clm/src/main/clm_instMod.F90
MM      components/clm/src/main/controlMod.F90
M       components/clm/src/main/test/atm2lnd_test/test_downscale_forcings.pf
M       components/clm/src/main/test/atm2lnd_test/test_partition_precip.pf
M       components/clm/src/main/clm_varctl.F90

========= Fix unit tests for new interface for initializing atm2lnd
M       components/clm/src/biogeophys/test/SnowHydrology_test/test_SnowHydrology_newSnowBulkDensity.pf

===============================================================
===============================================================
Tag name:  clm4_5_14_r220
Originator(s):  sacks (Bill Sacks)
Date: Sun Jan 22 14:05:50 MST 2017
One-line Summary: Fix crop seeding

Purpose of changes
------------------

The implementation of crop seeding made a few months ago didn't handle the
transfers back into the "seed deficit" (cropseedc) pool quite right. In
addition, that implementation didn't treat nitrogen. This tag fixes these
problems. In addition, it separates the seed (deficit) pools into crop seed
deficit and dwt seed deficit, and moves the latter to gridcell level (which is
needed for some upcoming work).

In the new implementation, when crops are seeded, this is tracked via
cropseedc_deficit_patch and cropseedn_deficit_patch. At the end of the growing
season, these deficits are repaid out of grain c/n, if there is enough available
grain c/n (if there is not enough available, the deficits accumulate until they
can eventually be repaid). Thus, this repayment decreases the fluxes of C & N to
the crop product pools. This new implementation was co-developed with Danica
Lombardozzi.

In addition, this tag does some other minor cleanup, as noted below.


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions):
- Seed pools won't restart properly from old initial conditions files. However,
  since these seed pools were previously just used as a diagnostic, this won't
  affect the evolution of anything except for the seed pools and related summary
  variables.

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables):
- Removed a few unused diagnostic history variables

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing: nothing substantial

Code reviewed by: Conceptual implementation co-developed with Danica
Lombardozzi (although she has not reviewed the final code)

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

    ok means tests pass; baseline failures as noted below

CLM tag used for the baseline comparisons: clm4_5_14_r219


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: Many CLM45/CLM50, but significant changes only
      for CROP
    - what platforms/compilers: ALL
    - nature of change (roundoff; larger than roundoff/same climate; new climate):
      Larger than roundoff / same climate

      Details:

      There are differences from baseline in:

      - Crop product pools and related fluxes, including summary fluxes
        (LAND_USE_FLUX, NBP)

      - FCO2

      - PFT_CTRUNC - changed due to fix in treatment of crop seed (previously,
        substantial grain was being truncated)

      - SEEDC / SEEDN

      - STORVEGC / STORVEGN in crop tests

      - Various other summary C/N state variables

      - LITFALL for CLM50 with CROP


      Other than TOTCOLC / TOTCOLN, greater-than-roundoff diffs just in CROP
      tests and tests that have non-blank finidat (latter just in SEEDC & SEEDN,
      because we don't read in the current value of SEEDC/SEEDN). Summary
      variables have diffs in some CLM45 crop tests as well as CLM50, because of
      diffs in which summary variables include seed c/n.


   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Main changes to crop seed deficit tracking, and moving dwt seed pools
          to gridcell level
M       components/clm/src/biogeochem/CNPhenologyMod.F90
M       components/clm/src/biogeochem/CNCStateUpdate1Mod.F90
M       components/clm/src/biogeochem/CNNStateUpdate1Mod.F90
M       components/clm/src/biogeochem/CNC14DecayMod.F90
M       components/clm/src/biogeochem/CNVegNitrogenFluxType.F90
M       components/clm/src/biogeochem/CNVegCarbonFluxType.F90
          - Also remove grainc_to_food from LITFALL diagnostic when sending
          grain to crop product pool
M       components/clm/src/biogeochem/CNVegNitrogenStateType.F90
M       components/clm/src/biogeochem/CNVegCarbonStateType.F90

========= Refactor some loops to support upcoming changes, and remove
          no-longer-needed code due to removed variabes
M       components/clm/src/biogeochem/dynConsBiogeochemMod.F90

========= Change arguments used in calling changed routines
M       components/clm/src/biogeochem/CNVegetationFacade.F90
M       components/clm/src/biogeochem/CNDriverMod.F90

========= Remove unused lf_conv_cflux_col variable and LF_CONV_CFLUX diagnostic field
M       components/clm/src/soilbiogeochem/SoilBiogeochemCarbonFluxType.F90
M       components/clm/src/main/clm_driver.F90

========= Just add some comments
M       components/clm/src/dyn_subgrid/dynPatchStateUpdaterMod.F90

========= Change a field that is output, because I have removed the old field
M       components/clm/cime_config/testdefs/testmods_dirs/clm/crop/user_nl_clm

===============================================================
===============================================================
Tag name:  clm4_5_14_r219
Originator(s):  erik (Erik Kluzek)
Date: Sat Jan 21 23:36:23 MST 2017
One-line Summary: Answer changes for CLM50 for several issues that lead to dead crops

Purpose of changes
------------------

Fix several problems that led to dead crops. latbaset was set in InitAllocate
and then reset to spval in InitHist. Set lnca to interp rather than skip for
interpolation on startup. Remove rootfr from restart unless use_dynroots is on.
Fix FERTNITRO and add BTRAN2 to history. Turn LUNA on by default for all CLM50
cases including SP. Change from Fang Li to remove fb from the calculation of
baf_crop. Fix LUNA in SP mode by setting PARi10 to a small value rather than
zero.

Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID): [If none, remove this line]
   bug 2407 -- latbaset is set in InitAllocate and then reset to spval in InitHist
   bug 2409 -- set lnca to interp rather than skip on restart
   bug 2408 -- remove rootfr from restart unless use_dynroots is on
   bug 2402 -- FERTNITRO
   bug 2403 -- BTRAN2
   bug 2413 -- luna in SP mode
Known bugs introduced in this tag (include bugzilla ID): [If none, remove this line]
   bug 2414 LATBASET is always output to history even if not used and even though it's a constant


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): None

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): None

Changes made to namelist defaults (e.g., changed parameter values): None

Changes to the datasets (e.g., parameter, surface or initial files): None

Substantial timing or memory changes: None

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): None

Changes to tests or testing: None

Code reviewed by: self, oleson, dlawren

CLM testing: regular

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - PASS

  unit-tests (components/clm/src):

    yellowstone - PASS

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel -  OK
    yellowstone_pgi -  OK
    yellowstone_gnu (clm45 only) -  OK
    hobart_nag -  OK

CLM tag used for the baseline comparisons:  clm4_5_14_r218

Answer changes
--------------

Changes answers relative to baseline: YES! CLM50 with crop
   CLM45 BGCCROP cases show an answer change just because fill value change of LATBASET even though it's unused

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM50 with CROP
    - what platforms/compilers: All
    - nature of change: new climate with crops growing

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): None

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

   M        components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml -- LUNA on by
               default for ALL CLM50 cases included SP mode

   M        components/clm/src/biogeochem/CNFireLi2016Mod.F90 --- Remove fb from calculation of baf_crop
   M        components/clm/src/biogeochem/CropType.F90 ---------- Move initialization of latbaset_patch
              to InitCold, fix FERTNITRO on history file
   M        components/clm/src/biogeophys/EnergyFluxType.F90 ---- Save BTRAN2 to history files
   M        components/clm/src/biogeophys/LunaMod.F90 ----------- Set PARi10 to 0.01 rather than zero if 
              LAI is zero
   M        components/clm/src/biogeophys/PhotosynthesisMod.F90 - Set lnca_patch to interp rather than skip
   M        components/clm/src/biogeophys/SoilStateType.F90 ----- Only save rootfr if use_dynroots on.

===============================================================
===============================================================
Tag name:  clm4_5_14_r218
Originator(s):  sacks (Bill Sacks)
Date: Fri Jan 13 19:46:27 MST 2017
One-line Summary: For newly initiating columns: do not copy snow state

Purpose of changes
------------------

Keith Oleson found that, in some circumstances, the model was dying with a snow
balance error in newly initiating crop columns. We tracked this down to an
incomplete copying of the snow state from the 'template' column to the newly
initiating crop column. Our two options for solving this problem were (1) copy
the snow state more completely; or (2) do not try to copy any part of the snow
state - leaving the snow in cold start conditions for the newly initiating
column. (1) is challenging because there are so many snow variables, so we have
chosen to go with (2) for now. Thus, when a column initiates (for now, this just
applies to crop columns), we (Dave Lawrence, Keith Oleson and Bill Sacks) have
decided that we should copy only the belowground temperature and water state.

Also, some minor, unrelated changes:

(1) Fix broken unit tests

(2) Abort run if try to run use_ed with transient crops

(3) Add two single-point exact restart tests for transient crop, because we did
not have good coverage of exact restart tests for transient crop before this


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing:

Added two tests:
ERS_Ly3_Mmpi-serial.1x1_smallvilleIA.IHISTCLM50BGCCROP.yellowstone_gnu.clm-cropMonthOutput  # restart is right before the transition from 100% nat veg to 100% crop
ERS_Ly6_Mmpi-serial.1x1_smallvilleIA.IHISTCLM50BGCCROP.yellowstone_gnu.clm-cropMonthOutput  # restart is right before increasing natural veg to > 0 while also shifting PCT_CFT

Code reviewed by: Main change reviewed by Keith Oleson and myself

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - not run
    On my Mac - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - pass
    yellowstone_pgi - pass
    yellowstone_gnu (clm45 only) - pass
    hobart_nag - pass

    In principle, answers could change for runs with transient crops, but I did
    not observe any answer changes in the test suite.

CLM tag used for the baseline comparisons:  clm4_5_14_r217


Answer changes
--------------

Changes answers relative to baseline: YES, in principle - but not in the test suite

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM45/CLM50 with transient crops
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      Assumed to be larger than roundoff, but only slightly, and only rare
      answer changes

      I did not observe any answer changes in the test suite. But in principle,
      this could change answers for any transient crop run, as evidenced by the
      change in behavior seen in Keith Oleson's transient crop run with and
      without this fix. It just seems like the conditions in which this matters
      only occur rarely.

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Main change: only copy belowground state to new columns
M       components/clm/src/dyn_subgrid/dynInitColumnsMod.F90
M       components/clm/src/dyn_subgrid/test/dynInitColumns_test/test_init_columns.pf

========= Abort run if try to run use_ed with transient crops
M       components/clm/src/dyn_subgrid/dynSubgridControlMod.F90

========= Fix a comment
M       components/clm/src/dyn_subgrid/dynVarMod.F90.in

========= Fix unit tests, apparently broken in r215
M       components/clm/src/unit_test_stubs/main/ncdio_pio_fake.F90.in

========= Add two tests (see above)
M       components/clm/cime_config/testdefs/testlist_clm.xml

===============================================================
===============================================================
Tag name:  clm4_5_14_r217
Originator(s):  sacks (Bill Sacks)
Date: Fri Jan 13 05:36:28 MST 2017
One-line Summary: Bug fix for snow radiation absorption

Purpose of changes
------------------

Bug fix from Leo van Kampenhout regarding snow radiation absorption: Remove
multipliers of (1.-albsnd(c,ib)) or (1.-albsni(c,ib)) in the calculation of
flx_absdv, flx_absiv, flx_absdn, flx_absin.

This stops this conditional in SurfaceRadiationMod from being triggered every
time step:

             if (abs(sabg_snl_sum-sabg_snow(p)) > 0.00001_r8) then

The triggering of this conditional led to an unintended constant partitioning of
radiation through the snowpack: 75% of radiation was absorbed in the top layer,
25% in the bottom layer.

In the old code, Leo found that sabg_snow(p) is over three times as big as
sabg_snl_sum , so these are certainly not roundoff problems.

With the fix, the conditional is no longer triggered at every time
step. Possible explanation: the factors flx_absd_snw and flx_absi_snw are
already accounted for albedo, because they are "absorbed flux per unit incident
flux at top of snowpack" according to SnowSnicarMod.F90.

Sean Swenson tested this, and says: I agree with leo; in fact the sum of the
flx_ terms should be the total absorption, or 1-albedo.  When I remove the
albedo modification leo suggested, I see most of the cases where the if-block is
triggered go away.  Those that remain are much smaller (the abs() in the if
block is ~1.e--4).  I don't know if this is a precision issue, or an indication
of a remaining bug.  Or it could be those cases for which the if-block was meant
to correct originally.

Sean later added: a couple more pieces of information: 1) the if-statement is
still needed.  If it is removed, a balance check error will abort the model.  2)
in SurfaceAlbedoMod, I tested the equality of sum_over_layers(flx_absdn) and
(1.0 - albsnd).  For direct beam, they were equal, but occassionally for ib=2
(near infrared), they were slightly different.  These were the same points that
were then triggered by the if block in SurfaceRadiation.  This may point to
something within the snicar_rt subroutine, but I don't plan on following this
issue further.

Mark Flanner added: I will note that there is an energy conservation check in
the snicarRT code which should ensure that the sum of absorption in all snow
layers never differs substantially (>0.00001) from what is expected from albedo
and transmittance.  If it does, the model aborts.  This is true, however, only
at the snow column level, so I suspect the issue you identified ultimately
relates either to (1) fractional snow cover and merging of sub-grid energy
fluxes to the gridcell level and/or (2) a change in the number of snow layers in
between the calculations of snow albedo and absorbed energy flux.  I think (2)
is what necessitated the patch in the first place.  I could be wrong.


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing: none

Code reviewed by: Sean Swenson

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - not run

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

    ok means tests pass, baseline comparisons fail as expected

CLM tag used for the baseline comparisons: clm4_5_14_r216


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: All CLM45/CLM50
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      Based on Sean Swenson's analysis: larger than roundoff; same or only
      slightly changed climate

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Change described above
M       components/clm/src/biogeophys/SurfaceAlbedoMod.F90

===============================================================
===============================================================
Tag name:  clm4_5_14_r216
Originator(s):  erik (Erik Kluzek,UCAR/TSS,303-497-1326)
Date:  Thu Jan 12 16:12:45 MST 2017
One-line Summary: Fix previous broken tag

Purpose of changes
------------------

Three files were missing from the merge to transcrop_n08_clm4_5_14_r214 on the trunk. I don't
know why they were missing, but they were. I have on very rare occasions seen subversion fail
with this problem, and it maybe due to a rare bug in subversion. Manytimes I double check to
make sure this doesn't happen, but I didn't this time.

Bugs fixed or introduced
------------------------

Known bugs introduced in this tag (include bugzilla ID): 2400
    2400 ---  Problem with mksurfdata_map for smallville landuse.timeseries (found in clm4_5_14_r215 after it's creation)


Notes of particular relevance for users
---------------------------------------

Caveats for users None

Changes to CLM's user interface: None

Changes made to namelist defaults: None

Changes to the datasets: None

Substantial timing or memory changes: None

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers: None

Changes to tests or testing: None

Code reviewed by: self

CLM testing: short

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests: None

  unit-tests (components/clm/src): None

  tools-tests (components/clm/test/tools): None

  PTCLM testing (components/clm/tools/shared/PTCLM/test): None

  regular tests: clm_short_50

    yellowstone_intel -  PASS

CLM tag used for the baseline comparisons: none


Answer changes None
--------------

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): None

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

>>>>>> Bring in files that were modified on the branch transcrop_n08_clm4_5_14_r214, but for some reason were dropped on
>>>>>> the merge to the trunk

   M           components/clm/src/dyn_subgrid/dyncropFileMod.F90
   M           components/clm/src/main/clm_initializeMod.F90
   M           parse_cime.cs.status

===============================================================
===============================================================
Tag name:  clm4_5_14_r215
Originator(s):  erik (Erik Kluzek)
Date: Thu Jan 12 10:29:52 MST 2017
One-line Summary: Update mksurfdata_map to work with new updated datasets from Peter, and use hand-edited 
                  surfdata/landuse.timeseries datasets for f09/f19

Purpose of changes
------------------

Use new rawdatasets from Peter Lawrence that have crop landunit changing in size as well as specific crop 
and natural vegetation types. Modify mksurfdata_map to use new fields for fertilizer for each crop type.
Add in harvest fields to both surface dataset as well as landuse.timeseries dataset. Also add in two
new fields: UNREPRESENTED_PFT_LULCC, UNREPRESENTED_CFT_LULCC for the impact of landuse changes for 
natural and crop vegetation types. Currently these two fields are zeroed out. But, they will be added in
with a new update to the datasets.

Implement crop fertilizer for each crop type into CLM. The fertilizer is also moved from one crop
type to another by the mapping system between the different crop types (to handle unrepresented crop
types by mapping them to one that is represented). The new datasets also have harvest fields in units by
mass rather than area. This requires new surface and landuse.timeseries datasets. We have hand-edited 
versions from Peter Lawrence for f09 and f19. The older datasets for other resolutions still work, but 
they don't have the new fertilizer field so anthropogenic fertilizer is zeroed out.

NOTE: Capability to create rcp scenarios for landuse.timeseries was removed from mksurfdata_map.


Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID):
   2386 -- buildnamelist unit tester can't compare to itself
   2389 -- make nitrogen balance threshold higher
   2382 -- soil depth dataset into subversion
   2369 -- Remove hacks to change PFT's in tropics in mksurfdata_map
   2097 -- mksurfdata_map changes

Known bugs introduced in this tag (include bugzilla ID):

   2399 -- Problem with urban points with latest mksurfdata_map


Notes of particular relevance for users
---------------------------------------

Caveats for users:

   mksurfdata.pl "-crop" option changed to "-no_crop" so the default is to create datasets with crop on it.
  Also default for -glc_nec is now 10 so default is to create datasets with glacier 

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables):

   New optional history field:

   FERTNITRO', 'gN/m2/yr', 'Nitrogen fertilizer for each crop

Changes made to namelist defaults (e.g., changed parameter values):

Changes to the datasets (e.g., parameter, surface or initial files): New f09/f19 surfdata/landuse.timeseries

Substantial timing or memory changes: None

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers:

Changes to tests or testing: Removed clm4_0 tools tests

Code reviewed by: self, lawrence

CLM testing: regular

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - PASS

  unit-tests (components/clm/src):

    yellowstone - PASS

  tools-tests (components/clm/test/tools):

    yellowstone - OK

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - OK
    yellowstone_pgi - OK
    yellowstone_gnu (clm45 only) - OK
    hobart_nag - OK

CLM tag used for the baseline comparisons:  clm4_5_14_r214


Answer changes
--------------

Changes answers relative to baseline: f09 and f19 CLM45/CLM50 cases change answers because of new datasets

  Summarize any changes to answers, i.e.,
    - what code configurations: clm45/clm50 for f09 and f19
    - what platforms/compilers: all
    - nature of change: adjusted surface datasets

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: Remove clm4_0 tools, rename clm4_5/shared directories under CLM tools

   D components/clm/tools/clm4_0/*
   D components/clm/tools/clm4_5/mksurfdata_map/*
   D components/clm/tools/clm4_5/refactorTools/*
   D components/clm/tools/shared/mkmapdata/*
   D components/clm/tools/shared/mkmapgrids/*
   D components/clm/tools/shared/mkprocdata_map/*
   D components/clm/tools/shared/ncl_scripts/*

   D components/clm/tools/clm4_5/mksurfdata_map/landuse_timeseries_hist_16pfts_simyr1850-2005.txt

List all files added and what they do: Renamed from clm4_5 or shared subdirectories, unit tests for mkharvest

   A components/clm/tools/mksurfdata_map/*
   A components/clm/tools/refactorTools/*
   A components/clm/tools/mkmapdata/*
   A components/clm/tools/mkmapgrids/*
   A components/clm/tools/mkprocdata_map/*
   A components/clm/tools/ncl_scripts/*

   A  components/clm/tools/clm4_5/mksurfdata_map/unit_testers/test_mkharvest.F90
   A  components/clm/tools/clm4_5/mksurfdata_map/unit_testers/inputs/harvestfieldsold.nc
   A  components/clm/tools/clm4_5/mksurfdata_map/unit_testers/inputs/harvestfields.nc
   A  components/clm/tools/clm4_5/mksurfdata_map/landuse_timeseries_hist_78pfts_simyr1850-2015.txt

List all existing files that have been modified, and describe the changes:

   M  components/clm/src/biogeochem/CNBalanceCheckMod.F90 - Increase threshold for Nitrogen balance check
   M  components/clm/src/biogeochem/CropType.F90 ---------- Add fertnitro to fert array
   M  components/clm/src/biogeochem/CNPhenologyMod.F90 ---- Add fertnitro_patch and InitCold for it
          Add FERTNITRO as optional output to history files (default inactive)
   M  components/clm/src/biogeochem/dynHarvestMod.F90 ----- Read in harvest units, divide by deadstem if
          new units of gC/m2/yr, otherwise take directly
   M  components/clm/src/main/surfrdMod.F90 --------------- Read in CONST_FERTNITRO_CFT if on file,
         otherwise zero it out, pass fert_cft to collapse_crop_types
   M  components/clm/src/main/clm_varsur.F90 -------------- Add fert_cft as temporary read in from dataset
   M  components/clm/src/main/clm_driver.F90 -------------- Pass crop_inst to dynSubgrid_driver
   M  components/clm/src/main/surfrdUtilsMod.F90 ---------- Handle fert_cft in collapse_crop_types
         if crops are being merged also move the fertilizer
   M  components/clm/src/main/clm_initializeMod.F90 ------- Allocate/dealloc fert_cft, pass crop_inst to dynsubgrid_init
   M  components/clm/src/dyn_subgrid/dynSubgridDriverMod.F90 ------ Pass crop_inst in and down to dyncrop_interp
   M  components/clm/src/dyn_subgrid/dynVarMod.F90.in ------------- Add allow_nodata and data_on_file flags
         and get_att method, if allow_nodata is true, read_variable will NOT abort, but zero out the
         variable
   M  components/clm/src/dyn_subgrid/dynVarTimeUninterpMod.F90.in - Pass allow_nodata as optional argument down
   M  components/clm/src/dyn_subgrid/dyncropFileMod.F90 ----------- Add fertcft dyn_var_time_uninterp_type
         initialize it, pass crop_inst to dyncrop_interp, get current data from fertcft%get_current_data
         and pass to collapse_crop_types

   M  components/clm/bld/listDefaultNamelist.pl -------------- Remove phys option maxpft is now 78
   M  components/clm/bld/unit_testers/build-namelist_test.pl - Fix bug 2386 for comparing to itself for
         user_nl_clm_real_parameters files
   M  components/clm/bld/unit_testers/NMLTest/CompFiles.pm - - Fix bug 2386 for comparing to itself, 
         change double quotes in filenames to a "+" like other special characters
   M  components/clm/bld/README ------------------------------ Remove note on clm4_0_tools file
   M  components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml - Updated (hand-edited) surface and
         historical landuse.timeseries datasets for f09 and f19
   M  components/clm/bld/namelist_files/namelist_defaults_clm4_0_tools.xml - Remove contents
         (keep file around as queryDefaultNamelist.pl assumes it's existance)
   M  components/clm/bld/namelist_files/namelist_defaults_clm4_5_tools.xml - Add "hrv" hgrid/lmask
         option for 0.9x1.25/GDRC, add "hrv" mksrf_filename called mksrf_fhrvtyp use
         lnd/clm2/rawdata/mksf_soilthk_5x5min_ORNL_SOILS_simyr1900-2015_c150701.nc file in place
         of file pointing to Sean Swenson's personal disk space, remove: mksrf_fvegtyp for test
         years, crop=off, and all rcp's as well as before 1850, but add historical through 2015
         Add harvest datasets at f09 resolution
   M  components/clm/bld/namelist_files/namelist_definition_clm4_5.xml - Add mksrf_fhrvtyp

   M  components/clm/cime_config/config_compsets.xml -- Add IGMHISTCRUCLM50BGCCROP compset

   M  components/clm/tools/mksurfdata_map/Makefile.data ------------- Change default list of files created
        so crop is output for all resolutions
   M  components/clm/tools/mksurfdata_map/src/mkharvestMod.F90 ------ Add harvestDataType and it's methods:
        init, get1DFieldPtr, get2DFieldPtr, getFieldsIdx, getFieldsDim, isField1D, isField2D, num1DFields
        num2DFields, and clean. Increase by three harvest fields, have two names for them (one for
        surfdace dataset, and one for landuse.timeseries datasets), mkharvest subroutine sends
        harvestDataType as it's output
   M  components/clm/tools/mksurfdata_map/src/mkncdio.F90 ----------- Add varexists option to check_ret,
        make nf_enotatt and nf_strerror public
   M  components/clm/tools/mksurfdata_map/src/mkfileMod.F90 --------- Send harvdata to mkfile use
        it's methods to define and output the harvest data
   M  components/clm/tools/mksurfdata_map/src/mkpftMod.F90 ---------- Always put CFT's on seperate land-unit
         new variables for: natural-veg-percent, crop-percent, fraction for each CFT and PFT
         handles oldformat and newformat (oldformat only used when PFT's are specified in namelist)
         remove missing_crops logic as crop is now required
   M  components/clm/tools/mksurfdata_map/src/mkvarctl.F90 ---------- Add mksrf_fhrvtyp
   M  components/clm/tools/mksurfdata_map/src/mkpctPftTypeMod.F90 --- Add new constructor
         constructor_pong to initialize a new pct_pft_type object with all PFT's on the gridcell
   M  components/clm/tools/mksurfdata_map/src/mksurfdat.F90 --------- Update mkharvestMod calls
         and add harvestDataType, add read of harvest dataset names, handle harvest 1D and 2D 
         data. Remove hack to set pfts 7 and 10 to 6 in the tropics because of bad LAI's (2369)

   M  components/clm/tools/mksurfdata_map/unit_testers/Srcfiles ---------------- Add new test files
   M  components/clm/tools/mksurfdata_map/unit_testers/test_mksurfdata_map.F90 - add mkharvest tests and
         test_get_nonexisting_var for test_mkncdio
   M  components/clm/tools/mksurfdata_map/unit_testers/test_mkncdio.F90 -------- Add test_get_nonexisting_var

   M  components/clm/tools/mksurfdata_map/mksurfdata_map.namelist - Updated files, crop and glc_nec=10 is
         on, does historical range of: 1850-2005
   M  components/clm/tools/mksurfdata_map/mksurfdata.pl ----------- -crop=>-no_crop glc_nec default to 10,
         default is to create datasets with crop, rawdatasets always have crop=on for them, harvest resolution different,
         remove -rcp option (no longer available), year range 1850-2000 actually does 1850-2015 now.

===============================================================
===============================================================
Tag name:  clm4_5_14_r214
Originator(s):  sacks (Bill Sacks)
Date: Tue Jan  3 12:55:28 MST 2017
One-line Summary: Update column states based on dwt terms between dyn_cnbal_patch and dyn_cnbal_col, and minor fixes

Purpose of changes
------------------

Main change is to move the update of column states based on dwt terms (which
come from shrinking patches) to earlier in the time step - specifically, between
dyn_cnbal_patch and dyn_cnbal_col. This includes updating the seed pools and
decomp_[c/n]pools_vr_col.

This change is important when there are changing column areas: In order to
conserve C & N, we need to transfer the mass from the dwt terms to the
column-level pools before executing the code to conserve the column-level state
variables. For example, if the natural vegetated column shrinks (with a
corresponding shrinkage of each patch on the column), and is replaced by crop:
Then the dwt terms from the shrinking patches (assuming this was handled
correctly - fix coming in an upcoming tag...) add some C & N to the below-ground
pools. But some of this C & N needs to end up in the growing crop column. Since
the column-level conservation operates on state variables (not fluxes), this
only works properly if the mass from the dwt fluxes is added to the states
before dyn_cnbal_col.

In addition, this tag fixes a number of minor problems:

(1) Separates the crop uses of seed(c/n)_to_leaf from the dwt uses. This is
    needed for the main change to work correctly.

(2) Allows longer history field names in hist_fincl and hist_fexcl

(3) Fixes SNOINTABS diagnostic field (bug 2321)


Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID):
- 2321: SNOINTABS diagnostic field incorrect for columns with more than one patch


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions):
- Changes meaning of DWT_SEEDC_TO_LEAF andDWT_SEEDN_TO_LEAF: No longer includes
  crop seed terms

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing: Minor tweak to crop testmod: Add a history field
that uses SUM, in order to test the SUM history field infrastructure

Code reviewed by: self

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

    ok means tests pass, baseline failures as expected, as noted below

CLM tag used for the baseline comparisons: clm4_5_14_r213


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM45/CLM50 in these configurations:
      - All transient cases (HIST, RCP, DV): changes due to the main changes in
        this tag
      - All CROP cases: changes answers in DWT_SEEDC_TO_LEAF and
        DWT_SEEDN_TO_LEAF diagnostic fields
      - Many cases: differences in SNOINTABS diagnostic field. From one test
        (LII_D_Ld3.f19_g16_gl5.IG1850CLM45.yellowstone_intel.clm-glcMEC_spunup_1way),
        there are diffs of up to 0.06. No diffs over Antarctica or most of
        Greenland (though there are some diffs on the southern tip of
        Greenland). Lots of other diffs in the northern hemisphere mid-high
        latitudes. This is as expected: expect diffs in vegetated areas, but not
        in glacier.
    - what platforms/compilers: ALL
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      Larger than roundoff; not investigated as to whether this is new climate,
      but expected not to be

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Move update of column states based on dwt terms to earlier in the time step
M       components/clm/src/biogeochem/CNVegCarbonFluxType.F90
M       components/clm/src/biogeochem/CNVegNitrogenFluxType.F90
M       components/clm/src/biogeochem/CNCStateUpdate1Mod.F90
M       components/clm/src/biogeochem/CNNStateUpdate1Mod.F90
M       components/clm/src/biogeochem/CNBalanceCheckMod.F90
M       components/clm/src/biogeochem/CNVegetationFacade.F90
M       components/clm/src/biogeochem/dynConsBiogeochemMod.F90
M       components/clm/src/dyn_subgrid/dynSubgridDriverMod.F90

========= Separate the crop uses of seed(c/n)_to_leaf from the dwt uses
M       components/clm/src/biogeochem/CNPhenologyMod.F90

========= Change sub_surf_abs_SW to a patch-level variable, rather than
          column-level (fixes bug 2321)
M       components/clm/src/biogeophys/SurfaceRadiationMod.F90
M       components/clm/src/biogeophys/SolarAbsorbedType.F90

========= Allow longer history field names in hist_fincl and hist_fexcl
M       components/clm/bld/namelist_files/namelist_definition_clm4_5.xml

========= Add a history field that uses SUM, in order to test the SUM history
          field infrastructure
M       components/clm/cime_config/testdefs/testmods_dirs/clm/crop/user_nl_clm

===============================================================
===============================================================
Tag name:  clm4_5_14_r213
Originator(s):  sacks (Bill Sacks)
Date: Fri Dec 30 08:48:44 MST 2016
One-line Summary: Convert buildnml to python

Purpose of changes
------------------

Changes from Mariana Vertenstein

Main purpose is to convert buildnml to python; also some minor tweaks to other
related files, which seem to be moving towards the removal of CLM4.


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing: none

Code reviewed by: self

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - pass

    I did NOT compare against baseline, because this is currently broken (bug 2386)

  unit-tests (components/clm/src):

    yellowstone - not run

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - pass
    yellowstone_pgi - pass
    yellowstone_gnu (clm45 only) - pass
    hobart_nag - pass

CLM tag used for the baseline comparisons: clm4_5_13_r211


Answer changes
--------------

Changes answers relative to baseline: NO

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: none

List all files added and what they do:

A       components/clm/cime_config/buildcpp

List all existing files that have been modified, and describe the changes:

M       components/clm/cime_config/buildlib
M       components/clm/cime_config/buildnml
M       components/clm/cime_config/config_component.xml

===============================================================
===============================================================
Tag name:  clm4_5_14_r212
Originator(s):  sacks (Bill Sacks)
Date: Thu Dec 22 16:06:09 MST 2016
One-line Summary: Bump science version number due to changes in clm4_5_13_r211

Purpose of changes
------------------

Bump science version number only. This is the same code base as
clm4_5_13_r211. No additional testing was done.

clm4_5_13_r211 has a significant change in behavior for transient cases, for
CLM45 as well as CLM50 cases. Thus, we are incrementing the science version
number.

===============================================================
===============================================================
Tag name:  clm4_5_13_r211
Originator(s):  sacks (Bill Sacks)
Date: Thu Dec 22 13:46:52 MST 2016
One-line Summary: Apply transient land cover and harvest all at once in first time step of year

Purpose of changes
------------------

Scientists have found it problematic to have land cover change and harvest
interpolated throughout the year: By having just a bit of deforestation done in
each time step, the forest can regrow, so that you never see the full,
appropriate impacts of land cover change.

This tag changes the behavior of both land cover change (transient PFTs) and
harvest so that they are applied all at once in the first time step of a given
year.

This new behavior is consistent with the pre-existing timing of transient crops
and transient glaciers: Now all land cover changes happen all at once on the
first time step of the year.

For the fire code, we pass a dribbled version of the land cover change - i.e., a
version that smooths the area changes over the year, similarly to what was done
before. This is important because the fire code involves interactions between
the current time step's change in area and the current time step's climate. So,
if the fire code only saw area changes on Jan 1, it could only generated
deforestation fires on Jan 1 (I think). Note there is some inconsistency now,
since the above-ground C/N biomass is all adjusted at once on Jan 1, so the fire
code operates on the already-adjusted biomass. This could be problematic in
principle if there were relatively large changes in area in a given year, but
Fang Li believes this won't cause major problems in practice, since (1) area
changes are typically small, (2) the carbon fluxes from fire are just
diagnostic, and (3) the bigger impact of deforestation fires is as a trigger for
other fires.

In addition, for fluxes passed to the atmosphere from land cover change and
harvest, we dribble these fluxes over the year, avoiding pulsed fluxes on
Jan. 1.


Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID):
- Partially addresses 2106: CNFireMod code should be re-evaluated in the presence of dynamic landunits


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing:
- Moved some transient tests (HIST/RCP) from CLM45 to CLM50

Code reviewed by: self

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

    ok means tests pass; some baseline comparisons fail as noted below

    NOTE: Most testing done on
    dynpft_and_harvest_jan1_n07_clm4_5_13_r210. dynpft_and_harvest_jan1_n08_clm4_5_13_r210
    fixed an error check for CNDV cases. I reran the CNDV tests on the n08 tag,
    along with the following additional tests:

      SMS_Ld5_D_P24x1.f10_f10.IHISTCLM50BGC.hobart_nag.clm-monthly
      ERP_D_P24x1.f10_f10.IHISTCLM50BGC.hobart_nag.clm-decStart
      ERP_D_Ld5.f19_g16.IRCP85CLM45BGC.yellowstone_pgi.clm-drydepnomegan

CLM tag used for the baseline comparisons: clm4_5_13_r210


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: All transient cases (HIST/RCP) with CLM45/CLM50; also DV cases
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      For transient cases: Larger than roundoff; unsure whether this is climate changing

      For DV cases, just roundoff-level changes in FCO2, LAND_USE_FLUX, NBP - I
      think from the dribbling of fluxes that are generated on the first time
      step of each year.

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Do land cover change (transient PFTs) and harvest all at once in the
          first time step of the year, rather than gradually throughout the
          year; dribble the fluxes to the atmosphere, and dribble the weight
          changes to the fire code.
M       components/clm/src/dyn_subgrid/dynpftFileMod.F90
M       components/clm/src/biogeochem/dynConsBiogeochemMod.F90
M       components/clm/src/biogeochem/dynHarvestMod.F90
M       components/clm/src/biogeochem/CNFireLi2014Mod.F90
M       components/clm/src/biogeochem/CNFireLi2016Mod.F90
M       components/clm/src/biogeochem/CNVegCarbonFluxType.F90
M       components/clm/src/biogeochem/CNVegetationFacade.F90
M       components/clm/src/biogeochem/CNVegStateType.F90

========= Just add some documentation for history fields
M       components/clm/src/biogeochem/CNVegNitrogenFluxType.F90
M       components/clm/src/soilbiogeochem/SoilBiogeochemCarbonFluxType.F90

========= Just remove unneeded use statements
M       components/clm/src/dyn_subgrid/dynSubgridDriverMod.F90

========= Introduce ability for dribblers to work at any subgrid level, and some
          other feature additions
M       components/clm/src/utils/test/annual_flux_dribbler_test/test_annual_flux_dribbler.pf
M       components/clm/src/utils/AnnualFluxDribbler.F90
M       components/clm/src/main/decompMod.F90
M       components/clm/src/biogeophys/EnergyFluxType.F90
M       components/clm/src/biogeophys/WaterfluxType.F90

========= Move some transient tests to CLM50
M       components/clm/cime_config/config_compsets.xml
M       components/clm/cime_config/testdefs/testlist_clm.xml

========= Unrelated change: add a bit of documentation
M       components/clm/bld/namelist_files/namelist_definition_clm4_5.xml

===============================================================
===============================================================
Tag name:  clm4_5_13_r210
Originator(s):  sacks (Bill Sacks)
Date: Sat Dec 17 05:43:34 MST 2016
One-line Summary: Update cime to cesm2_0_beta04 version

Purpose of changes
------------------

Update cime to version used in cesm2_0_beta04

Main motivation is to get the fix for the problem where manual modifications to
user_nl files in a test case get overwritten.


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing: none

Code reviewed by: self

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - pass
       ran build-namelist tests without compare or generate - all passed
       ran prove test_build_namelist.pl - pass

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - pass
    yellowstone_pgi - pass
    yellowstone_gnu (clm45 only) - pass
    hobart_nag - pass

    (NLCOMP changes for IG tests; this was expected)

CLM tag used for the baseline comparisons: clm4_5_13_r209


Answer changes
--------------

Changes answers relative to baseline: NO

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.):
- cime: cime5.2.0-alpha.7 -> cime5.2.0-alpha.9

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Update cime from cime5.2.0-alpha.7 to cime5.2.0-alpha.9 
M       SVN_EXTERNAL_DIRECTORIES

===============================================================
===============================================================
Tag name:  clm4_5_13_r209
Originator(s):  sacks (Bill Sacks)
Date: Sun Dec 11 06:09:22 MST 2016
One-line Summary: Change definition of NBP; bring back some r205 changes that were lost in r207

Purpose of changes
------------------

Changes definition of NBP to match the definition used by CMIP: Now NBP includes
all terms that contribute to the net carbon exchange between land and
atmosphere.

Also, moves both NBP and NEE diagnostics to the gridcell level, rather than the
column level - so you can no longer see column-by-column values for these
diagnostics. The move of NBP to gridcell-level is needed because it now includes
some gridcell-level quantities; the move of NEE to gridcell-level is needed to
support some upcoming changes.

Removes NET_CARBON_EXCHANGE diagnostic output because this is now redundant with
NBP.

Also, brings back some r205 changes that were lost in r207 - most notably, the
fix for the MEGAN crash due to negative intracellular co2.


Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID): 2371: Change definition of NBP


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables):
- Changes definition of NBP diagnostic output; also, NBP is now defined at the gridcell level
- Removes NET_CARBON_EXCHANGE diagnostic output
- NEE diagnostic output is now defined at the gridcell level

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing: none

Code reviewed by: self; but change in definition of NBP was reviewed conceptually by Dave Lawrence

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

    ok means tests pass; baseline comparison failures as noted below

CLM tag used for the baseline comparisons: clm4_5_13_r208


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM45/CLM50 change answers as noted below
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      Most changes are roundoff-level changes in diagnostics and in FCO2 sent to
      atmosphere; larger than roundoff-level changes in the diagnostic field
      NBP; potentially larger-than-roundoff level changes in MEG_isoprene

      Roundoff-level diffs in FCO2 (sent to atmosphere), NEE, C13_NEE, C14_NEE

      NBP diagnostic field: roundoff-level change for many cases; larger than
      roundoff for transient, crop, or year-2000 using initial conditions from a
      transient case (due to non-zero product pools)

      Small diffs in MEG_isoprene in
      SMS_Lm1.f09_g16_gl4.IG1850CRUCLM50BGC.yellowstone_intel.clm-clm50KitchenSink,
      due to bringing back the fix for Megan. (In principle, this could show up
      in other cases as well.)

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Change definition of NBP, and other changes to carbon flux diagnostics
          as noted above
M       components/clm/src/biogeochem/CNVegCarbonFluxType.F90
M       components/clm/src/biogeochem/CNVegetationFacade.F90

========= Bring back fix for Megan crash (prevent negative intracellular CO2)
          that was added in r205 and accidentally dropped in r207; also, change
          1. to 1._r8
M       components/clm/src/biogeophys/PhotosynthesisMod.F90

========= Bring back SNO_TK_ICE diagnostic field that was added in r205 and
          accidentally dropped in r207
M       components/clm/src/biogeophys/SoilStateType.F90


===============================================================
===============================================================
Tag name:  clm4_5_13_r208
Originator(s):  sacks (Bill Sacks)
Date: Sat Dec 10 15:00:21 MST 2016
One-line Summary: Rework irrigation; remove glc_smb logical

Purpose of changes
------------------

Main change is a complete rework of the irrigation algorithm. This reworks the
trigger and target for irrigation to be based on soil physical properties,
removing the dependence on btran and smpso (which were problematic in
conjunction with PHS). With the current out-of-the-box parameter values,
irrigation is substantially lower than before.

In addition, this reworks the river volume-based limitation. One change to the
volr-based limitation is that we now apply the limit to the deficit computed in
calcIrrigationNeeded - rather than applying the limit in applyIrrigation. The
point of this is to avoid problems that arise due to evolving VOLR - e.g., if we
had calculated irrigation demand such that VOLR was just barely big enough, then
we apply irrigation for some time steps, then we get an updated VOLR which is
lower due to these irrigation withdrawals - the old implementation would impose
an unnecessary limit on the irrigation to be applied for the rest of this
day. It's hard to see a clean way around this problem, given that VOLR is
updated in some but not all CLM time steps. So we're going to impose the limit
on irrigation deficit, rather than on the time step-by-time-step flux. The
downside here is that it's somewhat more likely that irrigation would try to
draw volr negative, if volr has been evolving for other reasons.

Also, this tag pulls out the parameters controlling irrigation to namelist.

Also reworks the limit_irrigation namelist parameter, changing it to
limit_irrigation_if_rof_enabled. This was a problem before, in that we needed to
remember to set it to false whenever we ran without an active ROF model (e.g.,
during spinup); now runtime logic handles that automatically. (We considered
trying to have limit_irrigation set properly by build-namelist, but that turns
out to be tricky because there are a number of ways in which you can end up with
an inactive ROF model.)

Also removes the glc_smb logical: this has been unused for quite a while (we
have always assumed it's true).


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables):
- New namelist variables for irrigation
- limit_irrigation changed to limit_irrigation_if_rof_enabled
- Remove glc_smb namelist variable, both for clm4_0 and clm4_5/clm5_0
- Renamed ICE_MASK history variable to ICE_MODEL_FRACTION

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing: minor tweaks to tests involving irrigation, as
described below

Code reviewed by: Irrigation changes reviewed by Sean Swenson

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - ok

    Many failures due to bug 2386; other than that, expected differences from
    baseline

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - pass
    yellowstone_gnu (clm45 only) - pass
    hobart_nag - ok

    ok means pass or xfail; expected baseline failures as noted below

CLM tag used for the baseline comparisons: clm4_5_13_r207


Answer changes
--------------

Changes answers relative to baseline:

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: All cases with irrigation
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      Not investigated closely, but potentially new climate

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.):

List all files eliminated:

========= Merge irrigation unit tests into a single module
D       components/clm/src/biogeophys/test/Irrigation_test/test_irrigation_singlepatch.pf
D       components/clm/src/biogeophys/test/Irrigation_test/test_irrigation_deficit.pf
D       components/clm/src/biogeophys/test/Irrigation_test/test_irrigation_multipatch.pf
D       components/clm/src/biogeophys/test/Irrigation_test/IrrigationWrapperMod.F90

========= No longer needed because we turn on irrigation river limitation in
          some other irrigation tests
D       components/clm/cime_config/testdefs/testmods_dirs/clm/limit_river_withdraw/user_nl_clm
D       components/clm/cime_config/testdefs/testmods_dirs/clm/limit_river_withdraw/include_user_mods
D       components/clm/cime_config/testdefs/testmods_dirs/clm/limit_river_withdraw

List all files added and what they do:

========= Merge irrigation unit tests into a single module, and add some tests
A       components/clm/src/biogeophys/test/Irrigation_test/test_irrigation.pf

List all existing files that have been modified, and describe the changes:

========= Rework irrigation: both the core algorithm and the volr limitation
M       components/clm/src/biogeophys/IrrigationMod.F90
M       components/clm/src/main/clm_driver.F90

========= Determine if rof_enabled is true, needed now that we have changed
          limit_irrigation to limit_irrigation_if_rof_enabled
M       components/clm/src/cpl/lnd_comp_mct.F90

========= Add new irrigation namelist variables, in their own group; also remove
          glc_smb namelist item
M       components/clm/bld/namelist_files/namelist_definition_clm4_5.xml
M       components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml
M       components/clm/bld/CLMBuildNamelist.pm
M       components/clm/src/main/clm_instMod.F90

========= Remove glc_smb logical: we have been assuming it's true for quite a
          while
M       components/clm/bld/namelist_files/use_cases/2000_glacierMEC_control.xml
M       components/clm/bld/namelist_files/use_cases/1850_glacierMEC_control.xml
M       components/clm/bld/namelist_files/use_cases/1850-2100_rcp2.6_glacierMEC_transient.xml
M       components/clm/bld/namelist_files/use_cases/1850-2100_rcp6_glacierMEC_transient.xml
M       components/clm/bld/namelist_files/use_cases/1850-2100_rcp4.5_glacierMEC_transient.xml
M       components/clm/bld/namelist_files/use_cases/glacierMEC_pd.xml
M       components/clm/bld/namelist_files/use_cases/1850-2100_rcp8.5_glacierMEC_transient.xml
M       components/clm/bld/namelist_files/use_cases/20thC_glacierMEC_transient.xml
M       components/clm/bld/namelist_files/namelist_definition_clm4_0.xml
M       components/clm/bld/namelist_files/namelist_defaults_overall.xml
M       components/clm/cime_config/user_nl_clm
M       components/clm/cime_config/testdefs/testmods_dirs/clm/fire_emis/user_nl_clm
M       components/clm/bld/unit_testers/build-namelist_test.pl
M       components/clm/cime_config/buildnml
M       components/clm/doc/UsersGuide/preface.xml
M       components/clm/bld/test_build_namelist/t/input/namelist_definition_clm4_5_test.xml
M       components/clm/src_clm40/main/clm_glclnd.F90
M       components/clm/src_clm40/main/controlMod.F90
M       components/clm/src_clm40/main/clm_varctl.F90

========= Remove glc_smb and move limit_irrigation logic into IrrigationMod
M       components/clm/src/main/clm_varctl.F90
M       components/clm/src/main/controlMod.F90

========= Rework some of the column filter creators to have a clearer interface
M       components/clm/src/main/filterColMod.F90
M       components/clm/src/main/test/filter_test/test_filter_col.pf
M       components/clm/src/main/TopoMod.F90
M       components/clm/src/main/test/atm2lnd_test/test_downscale_forcings.pf

========= Put some extra metadata on the restart file: whether we have
          create_crop_landunit and irrigate, since these are helpful for
          understanding when init_interp is needed
M       components/clm/src/main/restFileMod.F90

========= Rename ICE_MASK to ICE_MODEL_FRACTION, based on suggestion from Marcus
          Lofverstrom
M       components/clm/src/main/glc2lndMod.F90

========= Merge irrigation unit tests into a single module
M       components/clm/src/biogeophys/test/Irrigation_test/CMakeLists.txt

========= Fix for cime update
M       components/clm/bld/test_build_namelist/test_build_namelist.pl

========= Stop turning off limit_irrigation, since it's working now; also
          include QIRRIG_DEMAND in output
M       components/clm/cime_config/testdefs/testmods_dirs/clm/clm50cropIrrigMonth_interp/user_nl_clm
M       components/clm/cime_config/testdefs/testmods_dirs/clm/irrig_spunup/user_nl_clm

========= Rename limit_irrigation to limit_irrigation_if_rof_enabled
M       components/clm/cime_config/testdefs/testmods_dirs/clm/clm50KitchenSink/user_nl_clm

========= Include QIRRIG_DEMAND in output
M       components/clm/cime_config/testdefs/testmods_dirs/clm/irrigOn_reduceOutput/user_nl_clm

========= Remove limit_river_withdraw test - now we test that option via other
          irrigation tests
M       components/clm/cime_config/testdefs/testlist_clm.xml

========= Add a stub routine
M       components/clm/src/unit_test_stubs/utils/restUtilMod_stub.F90.in

========= Add a couple of tests to the xfail list - bug 2388
M       components/clm/cime_config/testdefs/ExpectedTestFails.xml

===============================================================
===============================================================
Tag name:  clm4_5_13_r207
Originator(s):  andre (Benjamin Andre,UCAR/CSEG,303-497-1391)
Date:  Thu Dec  8 10:34:56 MST 2016
One-line Summary: PHS - Calculate separate root water uptake resistances for soil and root pathways

Purpose of changes
------------------

PHS changes from Sean Swenson. Root water uptake resistances
calculated separately for soil and root pathways.  These resistances
are added in series to give a soil to root resistance that replaces
the ad hoc expression used in the original code.  History variables
added for soil and root resistances, as well as a variable 'QPHSNEG'
obtained by summing negative transpiration terms in each soil layer.


Bugs fixed or introduced
-----------------------

none

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: unknown

Notes of particular relevance for developers: (including Code reviews and testing) none

---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing: none

Code reviewed by: Sean Swenson, David Lawrence, Keith Oleson

CLM testing: 

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

  ok means - all functionality tests passed. All baseline comparisons passed except:
      - all clm5 compsets : expected, tag is answer changing for clm5

      - SMS_D_Ld5.f10_f10.ICLM45ED.hobart_nag.clm-edTest :
        baseline failed with RMS difference in a single field:
           RMS NBP  3.3589E-12  NORMALIZED  4.4201E-05
        SMS_D_Ld5.f10_f10.ICLM45ED.yellowstone_{gnu|intel|pgi} tests
        are all bit for bit with the baseline. Just documenting the
        discrepancy and ignoring.
      
CLM tag used for the baseline comparisons: clm4_5_13_r206


Answer changes
--------------

Changes answers relative to baseline: yes

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: all clm5 compsets with PHS on
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): unknown, assumed larger than roundoff same climate.

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? n/a

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: none

   URL for LMWG diagnostics output used to validate new climate: none
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

clm/src/biogeochem/CNVegetationFacade.F90 - new routines to calculate froot and croot carbon.
clm/src/main/histFileMod.F90 - add nlevsoi as 2d output option
clm/src/main/clm_driver.F90 - add calls froot and croot carbon calculations
clm/src/main/pftconMod.F90 - new root desnity and root radius variables
clm/src/biogeophys/WaterfluxType.F90 - new qflx_phs_neg_col variable
clm/src/biogeophys/WaterStateType.F90 - remove smp_l_col variable
clm/src/biogeophys/PhotosynthesisMod.F90 - calculate root-soil interface conductance
clm/src/biogeophys/SoilStateType.F90 - new variables k_soil_root_patch, soil_conductance_patch, root_conductance_patch
clm/src/biogeophys/CanopyFluxesMod.F90 - pass froot and croot carbon through to photosynthesis.
clm/src/biogeophys/SoilWaterMovementMod.F90 - calculate qflx_phs_neg_col


===============================================================
===============================================================
Tag name:  clm4_5_13_r206
Originator(s):  andre (Benjamin Andre,UCAR/CSEG,303-497-1391)
Date:  Tue Nov 29 10:46:24 MST 2016
One-line Summary: Bugfix for Luna causing arctic to die

Purpose of changes
------------------

Bugfix from Keith Oleson to prevent Luna from causing the arctic to
die.

Bug 2366 prevented a divide by zero in Luna, but it sets Jmax/Vcmax to
zero. This causes plants in the arctic to never start growing and
hence never get any leaf nitrogen. The fix tested by Keith Oleson is
to set them to the default values that Luna uses when it can't
converge.


Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID): 2379

Bugs introduced: re-opening 2291. An old problem with fire emissions
fields and gnu has resurfaced. This is a two line science change
in clm5-bgc-luna that is unlikely to caused this regression.

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none expected

Notes of particular relevance for developers: (including Code reviews and testing): none

---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing: none

Code reviewed by: K. Oleson, Erik Kluzek

CLM testing: regular

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - unit tests - fail, can't import perl module:
    'Streams/TemplateGeneric.pm'. Not related to current changes, must
    have come in a previous tag.

  unit-tests (components/clm/src):

    yellowstone - all tests pass

  tools-tests (components/clm/test/tools):

    yellowstone - no related changes, not run.

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - no related changes, not run.

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - 40 : ok, 45 : ok
    yellowstone_pgi - 40 : ok, 45 : ok 
    yellowstone_gnu (clm45 only) - ok, see note below.
    hobart_nag - ok

    ok means - all test functionality passes
             - baselines pass except for clm5 bgc (answer changing)
             - expected failures ignored
             - tput, memleak, memcomp, nlcomp ignored.

             - bug 2291 has resurfaced? Also appears to have been an
               issue in clm4_5_13_r205.

               FAIL SMS_Lm25.f19_g16.ICLM45BGCCROP.yellowstone_gnu.clm-cropMonthOutput BASELINE

               $ grep -e RMS TestStatus.log
                RMS l2x_Fall_fire001   1.9723E-17    NORMALIZED  8.4685E-06
                RMS l2x_Fall_fire002   2.7612E-17    NORMALIZED  1.2077E-06
                RMS l2x_Fall_fire003   1.9723E-17    NORMALIZED  5.5636E-06

CLM tag used for the baseline comparisons: clm4_5_13_r205


Answer changes
--------------

Changes answers relative to baseline: yes

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: clm5-bgc with luna on.
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate;
      new climate): Unknown, larger than roundoff to prevent die-off
      of the arctic.

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
    - casename: unknown, Keith Oleson ran a longer simulation and
      verbally confirmend he was happy with the results.

   URL for LMWG diagnostics output used to validate new climate: none


Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

clm/src/biogeophys/LunaMod.F90 - bugfix for 2379 set vcmx25 and jmx25 to non-zero values.

clm/cime_config/testdefs/ExpectedTestFails.xml - add xfail issue 2291

===============================================================
===============================================================
Tag name:  clm4_5_13_r205
Originator(s):  sacks (Bill Sacks)
Date: Wed Nov 16 10:38:15 MST 2016
One-line Summary: Add diagnostics for snow and glacier; fix crash in Megan

Purpose of changes
------------------

Most changes are to add new diagnostics fields related to the snow pack, and
diagnostic fields that are averaged just over istice/istice_mec landunits
(fields ending with _ICE). These changes are from from Leo van Kampenhout
(l.vankampenhout@uu.nl).

In addition:

(1) Fix to prevent negative (or very small positive) values of intracellular
    leaf CO2. This just affects Megan emissions, and only has a small
    effect. This change is needed to prevent a crash in Megan due to negative
    values of these variables. This fix is from Keith Oleson.

(2) Ensure that we don't try to do any downscaling over urban points; this is
    not currently allowed (see bug 2377). This change is needed in case there is
    an overlap between active urban points and the CISM domain: without this
    change, urban points in the CISM domain would be inside the downscaling
    filter, which would then cause an abort in check_downscale_consistency.


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing: none

Code reviewed by: self

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - pass
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - pass

    ok means tests pass; some answer changes as noted below

CLM tag used for the baseline comparisons: clm4_5_13_r204


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: some clm45/clm50; answer changes show up rarely
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      seem to be roundoff or only slightly greater

      Changes are due to the fix for Megan, in PhotosynthesisMod. Answer changes
      only appeared for three tests in the test suite:

      SMS_Lm1.f09_g16_gl4.IG1850CRUCLM50BGC.yellowstone_intel.clm-clm50KitchenSink
      ERP_P15x2_Lm13.f10_f10.IHISTCLM50BGC.yellowstone_intel.clm-monthly

         Small diffs in MEG_isoprene

      SMS_Lm25.f19_g16.ICLM45BGCCROP.yellowstone_gnu.clm-cropMonthOutput

      NaN values in a few fields in old; non-NaN in new:

       RMS l2x_Fall_fire001                        NaN            NORMALIZED  0.0000E+00
       RMS l2x_Fall_fire002                        NaN            NORMALIZED  0.0000E+00
       RMS l2x_Fall_fire003                        NaN            NORMALIZED  0.0000E+00


   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Do not downscale over urban points
M       components/clm/src/main/glc2lndMod.F90
M       components/clm/src/main/atm2lndMod.F90

========= Fix Megan crash: prevent negative intracellular CO2
M       components/clm/src/biogeophys/PhotosynthesisMod.F90

========= New snow / glacier diagnostic fields
M       components/clm/src/main/clm_initializeMod.F90
M       components/clm/src/biogeophys/SoilStateType.F90
M       components/clm/src/biogeophys/LakeHydrologyMod.F90
M       components/clm/src/biogeophys/SoilTemperatureMod.F90
M       components/clm/src/biogeophys/SolarAbsorbedType.F90
M       components/clm/src/biogeophys/WaterStateType.F90
M       components/clm/src/biogeophys/LakeTemperatureMod.F90
M       components/clm/src/biogeophys/WaterfluxType.F90
M       components/clm/src/biogeophys/EnergyFluxType.F90
M       components/clm/src/biogeophys/FrictionVelocityMod.F90
M       components/clm/src/biogeophys/TemperatureType.F90

===============================================================
===============================================================
Tag name:  clm4_5_13_r204
Originator(s):  erik (Erik Kluzek)
Date: Tue Nov 15 13:55:16 MST 2016
One-line Summary: A few answer changing bug fixes

Purpose of changes
------------------

This brings in some simple answer changing bug fixes. And some non-answer changing bug fixes for mksurfdata.pl and 
the build-namelist unit tester.

In order to calculate infiltration the fraction of ground covered in surface water is used, before it is updated
to account for snow. Also mulitply k_wet by a factor of 1x10^-4 both of these will makes a difference in surface runoff.
This change is essentially a bug in the original formulation and so we've applied to both CLM45 and CLM50 answers.
Since this is hydrology it will affect answers in all CLM45/CLM%0 cases whether SP, CN or BGC modes.

For MEGAN we were using a new updated dataset that had the addition of all 78 PFT's including the new crop ones.
Unfortunately it also had bare-soil, and this moved the indexing off by one. So we have a new dataset that removes
the bare-soil and hence works correctly now.

A simple addition of setting lake energy flux (eflx_grnd_lake) for the case when there isn't one layer os snow.

For CLM45 we found that the use of the Zheng rooting profile for Carbon resulted in 1850 spinup simulations that couldn't
spinup the tropics. Using the Jackson-1996 profile alleviates this problem.

There were also some simple problems in using the queryNamelistDefaults.pl tool with the new cime tag brought in
with clm4_5_12_r202. Fixing this allows mksurfdata.pl and build-namelist-unit_tester to work.


Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID):
    2378 Zheng profile for carbon results in tropics that doesn't spin up
    2376 mksurfdata tests fail in clm4_5_12_r202 with new cime version
    2375 84 tests are removed from build-namelist unit_tester 
    2374 Use fraction of ground covered in surface water used in infiltration before it's updated to account for snow
    2370 Megan was giving incorrect answers
    1717 Lake hydrology issue
    
Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): None

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): None

Changes made to namelist defaults (e.g., changed parameter values):  carbon rooting is now Jackson-1996
   rooting_profile_method_carbon for CLM$5 was Zheng method, now changed to Jackson-1996

Changes to the datasets (e.g., parameter, surface or initial files): New megan dataset without bare-soil

Substantial timing or memory changes: None

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): None

Changes to tests or testing: None

Code reviewed by: self, swensosc, fvitt

CLM testing: regular

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone -  PASS (176 compare tests fail because of bug 

  unit-tests (components/clm/src):

    yellowstone - PASS

  tools-tests (components/clm/test/tools):

    yellowstone - PASS

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - OK
    yellowstone_pgi - OK
    yellowstone_gnu (clm45 only) - OK
    hobart_nag - OK

CLM tag used for the baseline comparisons:  clm4_5_12_r203


Answer changes
--------------

Changes answers relative to baseline: YES! Both CLM45 and CLM50

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM45BGC/CLM50
    - what platforms/compilers: all
    - nature of change:
        surface runoff for CLM45/CLM50 changes when snow exists, small change for short simulations
        MEGAN answers are corrected, important for isoprene
        Change in fill mask for lake energy flux
        CLM45BGC changes in an important way
       
Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): None

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

   M components/clm/src/biogeophys/CanopyHydrologyMod.F90 --- Save frac_h2osfc_nosnow
   M components/clm/src/biogeophys/SoilHydrologyMod.F90 ----- Use frac_h2osfc_nosnow to determine frac_infclust (bug 2374)
          Also change k_wet by a factor of e-4
   M components/clm/src/biogeophys/LakeHydrologyMod.F90 ----- Save off eflx_grnd_lake as an "else" in one more conditional
          when snl is not 1 layer (bug 1717)
   M components/clm/src/biogeophys/WaterStateType.F90 ------- Write out FH2OSFC_NOSNOW to history
   M components/clm/src/biogeochem/CNVegCarbonFluxType.F90 -- Add commented out change in NBP definition
   M components/clm/src/biogeochem/MEGANFactorsMod.F90 ------ Check of n_pft's on MEGAN file changes by 1

   M components/clm/bld/listDefaultNamelist.pl -------------- Can't use version 2 format datm namelist_definition for datm or drv
         but use the version 1 drv file.
   M components/clm/bld/queryDefaultNamelist.pl ------------- Can't use version 2 format datm namelist_definition for datm or drv
         but use the version 1 drv file.
   M components/clm/bld/unit_testers/build-namelist_test.pl - Make sure glc_present is added to tests for glc command line options

   M components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml - rooting_profile_method_carbon==1 for clm45
   M components/clm/bld/namelist_files/namelist_defaults_drydep.xml - New 78 pft file for megan that doesn't have bare soil
          (bug 2370)

===============================================================
===============================================================
Tag name:  clm4_5_12_r203
Originator(s):  sacks (Bill Sacks)
Date: Thu Nov 10 12:14:13 MST 2016
One-line Summary: Bug fixes for snow-on-lake

Purpose of changes
------------------

Fix a few bugs with the calculation of melt fluxes arising from
snow-on-lake. These appear to mainly just affect diagnostic terms, although in
theory it looks like this fixes a possible balance check error in rare
conditions.

Changes are from Leo van Kampenhout (l.vankampenhout@uu.nl)

Specific changes are:

(1) qflx_sl_top_soil is no longer updated in LakeHydrology. Terms that used to
    go into that variable now go into qflx_snow_drain.

(2) For the case where we have snow above an unfrozen lake: Changed calculation
    of qflx_snomelt and eflx_snomelt:

Old:
               qflx_snomelt(c) = qflx_snomelt(c) + h2osno(c)/dtime
               eflx_snomelt(c) = eflx_snomelt(c) + h2osno(c)*hfus/dtime 

New:
               qflx_snomelt(c) = qflx_snomelt(c) + sumsnowice(c)/dtime
               eflx_snomelt(c) = eflx_snomelt(c) + sumsnowice(c)*hfus/dtime 

So note that this now just considers sumsnowice rather than the full h2osno -
i.e., it doesn't remelt the liquid in the snow pack.

(3) For the case where we have snow above an unfrozen lake: The update of
    qflx_snow_drain is changed; and again, note that qflx_sl_top_soil is gone.

Old:
               ! update drainage from snow pack for this case
               qflx_snow_drain(c)     = qflx_snow_drain(c)  + qflx_snomelt(c)
               qflx_sl_top_soil(c) = qflx_sl_top_soil(c) + h2osno(c)

New:
               ! update incidental drainage from snow pack for this case
               qflx_snow_drain(c) = qflx_snow_drain(c) + h2osno(c)/dtime

The old version had three apparent problems:

(a) This drainage term contributed to both qflx_snow_drain and qflx_sl_top_soil,
    which later get added together (in BalanceCheck); as noted in (1), the uses
    of qflx_sl_top_soil and qflx_snow_drain have been merged into just
    qflx_snow_drain in this routine.

(b) The qflx_sl_top_soil addition adds h2osno, without dividing by dtime

(c) The qflx_snow_drain addition adds the full qflx_snomelt, which may include
    other terms that were set prior to this code.

Note that, in the new version, we want to drain the *whole* snow pack in this
case - liquid as well as solid.

(4) qflx_top_soil is changed:

Old:
         qflx_top_soil(c)  = qflx_prec_grnd_rain(p) + qflx_snomelt(c)

New:
         qflx_top_soil(c)  = qflx_prec_grnd_rain(p) + qflx_snow_drain(c)

What the soil receives should equal what leaves the snow, i.e. the drainage term. 


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing: none

Code reviewed by: Bill Sacks, Sean Swenson

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - not run

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - pass
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - pass

    ok means tests pass; baseline comparison failures as noted below

CLM tag used for the baseline comparisons: clm4_5_12_r202


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: Potentially any clm45/clm50 case
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      Appears to only change diagnostic fields

      Answer changes only show up in a few cases, presumably because this case
      in the code is relatively uncommon. Specifically, these tests have answer
      changes:

  FAIL LII_D_Ld3.f09_g16.ICLM45BGC.yellowstone_gnu.clm-default BASELINE
  FAIL ERI_D_Ld9.ne30_g16.ICLM45BGC.yellowstone_intel.clm-vrtlay BASELINE
  FAIL ERP_Ld5.f19_g16.I1850CLM45BGC.yellowstone_intel.clm-default BASELINE
  FAIL ERP_P180x2_D_Ld5.f19_g16.I1850CLM45.yellowstone_intel.clm-default BASELINE
  FAIL ERS_D_Ld3.f09_g16_gl4.IG1850CRUCLM50BGCCROP.yellowstone_intel.clm-clm50KitchenSink BASELINE

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

M       components/clm/src/biogeophys/LakeHydrologyMod.F90

===============================================================
===============================================================
Tag name:  clm4_5_12_r202
Originator(s):  sacks (Bill Sacks)
Date: Wed Nov  9 12:02:41 MST 2016
One-line Summary: Update to cime version used in cesm2_0_beta03

Purpose of changes
------------------

Update to cime version used in cesm2_0_beta03, which fixes some bugs and has
some new features.

Bugs fixed or introduced
------------------------

Known bugs introduced in this tag (include bugzilla ID):
- Unexpected answer change with Build namelist2 PR (#640) (https://github.com/ESMCI/cime/issues/766)


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions):
- preview_namelists is now first run by case.build - no longer by case.setup 

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing:
- ERI and ERP tests now pass on hobart (previously these were failing silently)

Code reviewed by: self

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - pass
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - pass
    hobart_nag - ok

    ok means tests pass; answer changes in these two tests:

    FAIL ERP_Ld5.f19_g16.ICNCROP.yellowstone_pgi.clm-40default BASELINE
    - testing-specific change, due to the fact that we now build this ERP test
      non-threaded

    FAIL SMS_D_Ld1_Mmpi-serial.1x1_mexicocityMEX.I.hobart_nag BASELINE
    - unknown reason for diff: see https://github.com/ESMCI/cime/issues/766


CLM tag used for the baseline comparisons: clm4_5_12_r201


Answer changes
--------------

Changes answers relative to baseline: YES - but only in the two tests noted above

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: just the two tests noted above
    - what platforms/compilers: just the two tests noted above
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      not investigated closely

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.):
- cime: clm4_5_12_r198_cime5.2.0-alpha.1-9-gd321e4b -> cime5.2.0-alpha.7

List all files eliminated:

========= Just rename xmlchange_cmnds to shell_commands, because xmlchange_cmnds
          is being deprecated
D       components/clm/cime_config/testdefs/testmods_dirs/clm/pts/xmlchange_cmnds
D       components/clm/cime_config/testdefs/testmods_dirs/clm/40ptsRLA/xmlchange_cmnds
D       components/clm/cime_config/testdefs/testmods_dirs/clm/40ptsRLB/xmlchange_cmnds
D       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subsetLate/xmlchange_cmnds
D       components/clm/cime_config/testdefs/testmods_dirs/clm/decStart/xmlchange_cmnds
D       components/clm/cime_config/testdefs/testmods_dirs/clm/40pts/xmlchange_cmnds
D       components/clm/cime_config/testdefs/testmods_dirs/clm/irrigOn_reduceOutput/xmlchange_cmnds
D       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subsetEarly/xmlchange_cmnds
D       components/clm/cime_config/testdefs/testmods_dirs/clm/ptsROA/xmlchange_cmnds
D       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_changeFlags/xmlchange_cmnds
D       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subsetMid/xmlchange_cmnds
D       components/clm/cime_config/testdefs/testmods_dirs/clm/af_bias_v5/xmlchange_cmnds
D       components/clm/cime_config/testdefs/testmods_dirs/clm/ptsRLA/xmlchange_cmnds
D       components/clm/cime_config/testdefs/testmods_dirs/clm/ptsRLB/xmlchange_cmnds
D       components/clm/cime_config/testdefs/testmods_dirs/clm/40ptsROA/xmlchange_cmnds
D       components/clm/cime_config/testdefs/testmods_dirs/clm/drydepnomegan/xmlchange_cmnds

List all files added and what they do:

========= Just rename xmlchange_cmnds to shell_commands, because xmlchange_cmnds
          is being deprecated
A       components/clm/cime_config/testdefs/testmods_dirs/clm/irrigOn_reduceOutput/shell_commands
A       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subsetEarly/shell_commands
A       components/clm/cime_config/testdefs/testmods_dirs/clm/ptsROA/shell_commands
A       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_changeFlags/shell_commands
A       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subsetMid/shell_commands
A       components/clm/cime_config/testdefs/testmods_dirs/clm/af_bias_v5/shell_commands
A       components/clm/cime_config/testdefs/testmods_dirs/clm/ptsRLA/shell_commands
A       components/clm/cime_config/testdefs/testmods_dirs/clm/ptsRLB/shell_commands
A       components/clm/cime_config/testdefs/testmods_dirs/clm/40ptsROA/shell_commands
A       components/clm/cime_config/testdefs/testmods_dirs/clm/drydepnomegan/shell_commands
A       components/clm/cime_config/testdefs/testmods_dirs/clm/pts/shell_commands
A       components/clm/cime_config/testdefs/testmods_dirs/clm/40ptsRLA/shell_commands
A       components/clm/cime_config/testdefs/testmods_dirs/clm/40ptsRLB/shell_commands
A       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subsetLate/shell_commands
A       components/clm/cime_config/testdefs/testmods_dirs/clm/decStart/shell_commands
A       components/clm/cime_config/testdefs/testmods_dirs/clm/40pts/shell_commands

List all existing files that have been modified, and describe the changes: none

===============================================================
===============================================================
Tag name:  clm4_5_12_r201
Originator(s):  sacks (Bill Sacks)
Date: Wed Nov  9 09:18:54 MST 2016
One-line Summary: Rework initialization of transient weights - important with use_init_interp

Purpose of changes
------------------

Two main purposes:

(1) When using use_init_interp in a case with CISM, avoid doing dyn landcover
    adjustments in the first time step after initialization. This is important
    in order to avoid fictitious adjustments simply due to the fact that we
    don't have updated glacier areas until the run loop (as in the cold start
    case).

(2) Update prescribed transient weights (for PFTs and crops) in initialization,
    rather than weighting for the run loop. This undoes part of
    clm4_5_1_r101. This can be important if you're running use_init_interp, so
    that the appropriate points are active on the output dataset.

More details on (1): This was achieved by initializing glacier areas at the
start of the run loop for cold start or interpolated start.

Rationale:

In the first time step of a run that used cold start or init_interp, glacier
areas will start at whatever is specified on the surface dataset, because
coupling fields from GLC aren't received until the run loop. Thus, CLM will see
a potentially large, fictitious glacier area change in the first time step after
cold start or init_interp. We don't want this fictitious area change to result
in any state or flux adjustments. Thus, we apply this area change at the start
of the driver loop, so that in dynSubgrid_driver, it will look like there is no
glacier area change in the first time step.

This needs to happen very early in the run loop, before any balance checks are
initialized, because - by design - this doesn't conserve mass at the grid cell
level. (The whole point of this new code block in the driver is that we adjust
areas without doing the typical state or flux adjustments that need to accompany
those area changes for conservation.)

This accomplishes approximately the same effect that we would get if we were
able to update glacier areas in initialization. The one difference - and minor,
theoretical problem - that could arise from this start-of-run-loop update is: If
the first time step of the CESM run loop looked like: (1) GLC runs and updates
glacier area (i.e., glacier area changes in the first time step compared with
what was set in initialization); (2) coupler passes new glacier area to CLM; (3)
CLM runs. Then the code here would mean that the true change in glacier area
between initialization and the first time step would be ignored as far as state
and flux adjustments are concerned. But this is unlikely to be an issue in
practice: Currently GLC doesn't update this frequently, and even if it did, the
change in glacier area in a single time step would typically be very small.

If we are ever able to change the CESM initialization sequence so that GLC
fields are passed to CLM in initialization, then this new code block in the
driver can be removed.


Also: Remove handling of first step since cold start in dynSubgrid_driver. This
is no longer needed now that (a) we update prescribed transient weights in
initialization, and (b) we have special-purpose code for glacier in the main
driver run loop.


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing: none

Code reviewed by: self

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

    ok means tests pass; a few answer changes as noted below

CLM tag used for the baseline comparisons: clm4_5_12_r200


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM45/CLM50 with CISM, with use_init_interp = .true.
      ALSO: Possible answer changes in other transient configurations - see note below
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      not investigated carefully; could have climate changing impacts in a coupled run

   Baseline comparisons failed for the following three tests, as expected:
   FAIL ERS_D_Ld3.f09_g16_gl4.IG1850CRUCLM50BGCCROP.yellowstone_intel.clm-clm50KitchenSink COMPARE_baseline
   FAIL ERS_D_Ld12.T31_g37_gl4.IG1850CRUCLM50BGC.yellowstone_intel.clm-glcMEC_spunup_inc_dec_bgc COMPARE_baseline
   FAIL SMS_Lm1.f09_g16_gl4.IG1850CRUCLM50BGC.yellowstone_intel.clm-clm50KitchenSink COMPARE_baseline

   In addition, it's possible that answer changes would appear in a coupled,
   transient run with cold start or init_interp, due to changes in the fields
   sent in initialization (or the first time step???)

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Set prescribed transient weights in initialization. Get rid of special
          handling of the first step since cold start; this is no longer needed
          now that we (1) handle the glacier case specially in the driver, and
          (2) initialize prescribed transient weights in initialization
M       components/clm/src/dyn_subgrid/dynSubgridDriverMod.F90

========= Handle glacier area specially in the first time step since cold start
          or interpolated start
M       components/clm/src/main/clm_driver.F90

========= Get rid of special handling of the first step since cold start; this
          is no longer needed now that we (1) handle the glacier case specially
          in the driver, and (2) initialize prescribed transient weights in
          initialization
M       components/clm/src/dyn_subgrid/dynConsBiogeophysMod.F90

========= Add a flag to determine if we're doing an interpolated start
M       components/clm/src/main/clm_varctl.F90
M       components/clm/src/main/clm_initializeMod.F90

========= Just add some comments
M       components/clm/src/main/subgridWeightsMod.F90
M       components/clm/src/main/glcBehaviorMod.F90
M       components/clm/src/init_interp/initInterpMindist.F90

===============================================================
===============================================================
Tag name:  clm4_5_12_r200
Originator(s):  erik (Erik Kluzek)
Date: Tue Nov  8 00:56:00 MST 2016
One-line Summary: Latest parameter updates from simulations, ignore surface soil layer for plant hydraulic stress for greater variability in surface soil moisture

Purpose of changes
------------------

Ignore surface soil layer for plant hydraulic stress which allows for greater variability in surface soil
moisture. Output some additional diagnostic fields to the history files. Rename fertnitro to manunitro,
both in code and in params files. Add options to vary baset by latitude for tropical crops and subtract
crop seed carbon. Don't call precision control for frootc for CLM50.

For CLM50 we bring in the latest set of parameter updates to the parameter file as well as namelist items.
Many of these were manually tuned, and many were tuned with the automatic calibration process of Rosie Fisher
and Ben Sanderson.

Fix several bugs, a couple possible divide by zero errors, only run freelivingfixation when FUN on. Limit
array operation by number of layers. Add option to put list of namelist parameters to an output file.


Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID):
  bug 2349 Run freelivingfixation only if FUN is on
  bug 2362 Possible divide by zero for fert when fertilizer off
  bug 2364 maxval check goes over whole range of array when should just go to nlayers
  bug 2366 fix divide by zero in Luna
  bug 2367 Add a list of real parameters as part of what CLM build-namelist does (partial)

Known bugs introduced in this tag (include bugzilla ID): [If none, remove this line]
  bug 2368 Remove old "use_voc" logic that was put in as a hack to turn off megan when prognostic crop was on
           (This existed before, but we just spotted it as a problem)

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): None

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables):
    New namelist items: baset_mapping, baset_latvary_slope, baset_latvary_intercept, 
                  initial_seed_at_planting
    new clm namelists: cnphenology, crop
    New history fields: LNC, BTRANMN, CPHASE, LATBASET, CROPSEEDC all default active

Changes made to namelist defaults (e.g., changed parameter values):
   New parameter calibrations
   For CLM50:
              baseflow_scalar=0.0090932, zetamaxstable=0.5, pot_hmn_ign_counts_alpha=0.0079611
              Jmaxb1=0.093563, initial_seed_at_planting=3.0, decomp_depth_efolding=10.0
              baset_mapping=varytropicsbylat, baset_latvary_intercept=12, baset_latvary_slope=0.4
              br_root=1.1678d-06, initial_Cstocks=3*200.0
   For CLM45 old defaults used:

Changes to the datasets (e.g., parameter, surface or initial files):
   New parameter dataset with latest calibration changing following fields:
      mergetoclmpft modified to remove generic crops and merge to more existing crops
      mxmat,arooti,lfemerg,min_planting_temp,bfact,fleafi,manunitro manually calibrated by Yaqiong Lu for crop
      soilpsi_off,soilpsi_on manually calibrated
      FUN_fracfixers,fun_cn_flex_a,fun_cn_flex_b,fsr_pft,grperc,dsladlai,ekn_active,froot_leaf,kmax,leaf_long,leafcn,mbbopt,psi50,slatop,stem_leaf
           modified by automatic calibration scripts
      maxpsi_hr hand calibrated by Charlie Koven
      i_vcad,s_vcad hand calibrated for crop
      FUN_fracfixers,dsladlai,ekn_active,froot_leaf,kmax,krmax,leaf_long,leafcn,mbbopt,psi50,slatop hand calibrated
      akn_active,croot_stem,ekc_active,kc_nonmyc,kn_nonmyc modified slightly
      leafcn,slato from TRY database

Substantial timing or memory changes: None

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance):
   crop phase should be changed into integer with parameter indices for the different types
   as well as outputting flag_meanings and flag_values attributes. Remove LATBASET from history
   as constant.

   There is some complication for clm4_5 to preserve answers for latbarybaset
   and subtract_cropseed for fert that should be removed. Will change answers
   but shouldn't matter.

Changes to tests or testing: None

Code reviewed by: self, oleson, dll, yaqiong

CLM testing: regular

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - PASS (254 comparison tests are different because of namelist changes)

  unit-tests (components/clm/src):

    yellowstone - PASS

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - OK
    yellowstone_pgi - OK
    yellowstone_gnu (clm45 only) - OK
    hobart_nag -  OK

CLM tag used for the baseline comparisons:  clm4_5_12_r199


Answer changes
--------------

Changes answers relative to baseline: YES! for CLM50 (identical for CLM45)

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM50
    - what platforms/compilers: ALL
    - nature of change: calibrated climate

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
      clm5n04r193phs_2deg_calibrateparams_v3_crop_fert10perc_medshrb_1850ADspin
      b.e20.B1850.f09_g16.pi_control.all.123
      (neither of these are identical to this tag for different reasons)

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): None

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

   M    parse_cime.cs.status -- Update to work with newer cime being used now

   M    components/clm/bld/unit_testers/build-namelist_test.pl ----------- Add tests for 
            user_nl_clm_real_parameters and baset_mapping and Jmaxb1
   M    components/clm/bld/namelist_files/namelist_definition_clm4_5.xml - New namelist
           items: baset_mapping, baset_latvary_slope, baset_latvary_intercept, 
                  initial_seed_at_planting
   M    components/clm/bld/namelist_files/namelist_defaults_clm4_0.xml --- Ran xmllint
          on it.
   M    components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml --- Use latest
          calibrated parameters for clm5_0:
              baseflow_scalar=0.0090932, zetamaxstable=0.5, pot_hmn_ign_counts_alpha=0.0079611
              Jmaxb1=0.093563, initial_seed_at_planting=3.0, decomp_depth_efolding=10.0
              baset_mapping=varytropicsbylat, baset_latvary_intercept=12, baset_latvary_slope=0.4
              br_root=1.1678d-06, initial_Cstocks=3*200.0
              
          New paramfiles with fertnitro renamed to manunitro, clm50 version with updated
          parameters
   M    components/clm/bld/CLMBuildNamelist.pm --- Add output_reals command line option,
         new namelist subroutines: setup_logic_crop, setup_logic_friction_vel, setup_logic_century_soilbgcdecompcascade,
                                   new general subroutine: error_if_set to abort on error if a list of
                                                           namelist items is set
         new namelists: cnphenology, crop
   M    components/clm/src/biogeochem/CNPhenologyMod.F90 ------- Add CNPhenologyReadNML, and namelist
          items: initial_seed_at_planting, and subtract_cropseed, rename fertnitro to manunitro, and add
                 cropseedc, and cphase, if fertilizer off don't add in manunitro, subtract cropseed
                 if subtract_cropseed is set.
   M    components/clm/src/biogeochem/CNVegCarbonStateType.F90 - Add cropseed and CROPSEEDC to history
          and restart files
   M    components/clm/src/biogeochem/CNDriverMod.F90 -- Only call CNFreeLivingFixation if use_fun
   M    components/clm/src/biogeochem/CropType.F90 ----- Add ReadNML, baset_mapping/latvary_intercept/latvary_slope
          cphase_patch, add CPHASE and LATBASET to history files, cphase to restart
   M    components/clm/src/biogeochem/CNPrecisionControlMod.F90 -- Set prec_control_for_froot to opposite of use_nguardrail
          so turned on for clm5_0 and off for clm4_5 (currently needed to get c4 crops to grow)
   M    components/clm/src/main/clm_initializeMod.F90 --- call energyflux_inst%initAccVars
   M    components/clm/src/main/controlMod.F90 ---------- call CNPhenologyReadNML
   M    components/clm/src/main/clm_driver.F90 ---------- call energyflux_inst%UpdateAccVars
   M    components/clm/src/main/pftconMod.F90 ----------- change fertnitro to manunitro
   M    components/clm/src/main/clm_instMod.F90 --------- call call crop_inst%ReadNML and energyflux_inst%InitAccBuffer
   M    components/clm/src/biogeophys/BalanceCheckMod.F90 ------ Set indexg when found
   M    components/clm/src/biogeophys/SoilWaterMovementMod.F90 - Remove local krmax, and use param_inst version, set
          rai to zero, limit array operation to :nlayers as nlayers change
   M    components/clm/src/biogeophys/EnergyFluxType.F90 ------- Add btran_min, and btran_min_inst, and interfaces: InitAccBuffer,
          InitAccVars, UpdateAccVars, add BTRANMN to history, BTRAN_MIN, BTRAN_MIN_INST to restart
   M    components/clm/src/biogeophys/FrictionVelocityMod.F90 -- Initialize zetamaxstable
   M    components/clm/src/biogeophys/LunaMod.F90 -------------- Initialize Jmaxb1 = 0.1_r8, check lnc>0 as well as tlai, 
           otherwise set: jmax25_z/vcmx25_z==0
   M    components/clm/src/biogeophys/PhotosynthesisMod.F90 ---- Add LNC to history and lnca to restart, rai(j=1)==0 for PHS
   M    components/clm/src/soilbiogeochem/SoilBiogeochemDecompCascadeBGCMod.F90 - initial_Cstocks(:)==200

===============================================================
===============================================================
Tag name:  clm4_5_12_r199
Originator(s):  sacks (Bill Sacks)
Date: Sat Oct 29 14:20:11 MDT 2016
One-line Summary: Use CISM2 by default

Purpose of changes
------------------

For compsets that use CISM (IG compsets), use CISM2 by default.

Also update CISM external to a version with an updated input file for CISM2 at 4
km resolution.


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions):
- Meaning of IG compset aliases changes - now means CISM2 rather than CISM1
- This results in slightly changed glacier cover over Greenland
- If you have a restart file from an old IG case (CLM45/CLM50) and plug it into
  an IG case with the same compset alias in this tag, there will be an initial
  shock to the system as CLM responds to the new glacier area. Thus, this change
  should be made in an offline run, and run for a year or more before plugging
  the new restart file into a coupled run.

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance):
- All IG tests will BFAIL because they use a new resolution

Changes to tests or testing:
- Removed the ICLM45GLCMEC compset that had been used for testing; replaced its
  test with IGCLM45BGC
- Added an ERP IG test, replacing the old PEM IG test

Code reviewed by: self

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - not run

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

    ok means tests pass; IG tests BFAIL because of new CISM resolution

CLM tag used for the baseline comparisons: clm4_5_12_r198


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: Out-of-the-box IG compsets change answers due to
      the new definition of these compsets (CISM2 rather than CISM1)
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      Not investigated closely; expected to be larger than roundoff/same climate
      for most applications

      Also note that, for the sake of testing, IG tests will BFAIL

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.):

cism: cism2_1_21 -> cism2_1_24

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

M       components/clm/cime_config/config_compsets.xml
M       components/clm/cime_config/testdefs/testlist_clm.xml

===============================================================
===============================================================
Tag name:  clm4_5_12_r198
Originator(s):  Sean Swenson, Bill Sacks
Date: Thu Oct 20 20:39:56 MDT 2016
One-line Summary: Rework mapping of irrigation from CLM to ROF

Purpose of changes
------------------

The combination of the CLM changes and the changes to externals (RTM, MOSART,
CIME) change the way irrigation is mapped from CLM to ROF: Rather than being
mapped like other fluxes, it is mapped with normalization by VOLR. This means
that, if there are multiple ROF cells underlying a single CLM cell, then
irrigation with be withdrawn from each in an amount proportional to the VOLR in
each. So, for example, if a CLM cell overlaps two ROF cells, one with VOLR = 100
and one with VOLR = 200, then twice as much water will be withdrawn from the
second as from the first.

The main motivation for this change is to decrease the frequency at which
irrigation exceeds available river volume in a given ROF cell. This will
especially be improved once the volr-limited irrigation is working (this will be
fixed in an upcoming tag).


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions):
- If this CLM tag is plugged in to a CESM tag, note that it depends on
  rtm1_0_59, mosart1_0_19, and the cime changes from
  https://github.com/ESMCI/cime/pull/681

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing:
- Added some irrigation tests
- Removed some tests from the xfail list which are now passing

Code reviewed by: Bill Sacks
  Note that most changes are originally from Sean Swenson; Bill Sacks reviewed
  and tested the changes

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

    ok means tests pass; some baseline comparison failures as noted below;
    also, many IG tests (i.e., with CISM) showed baseline comparison failures,
    but this is simply because, with the new CISM external, CISM now does not
    produce a history file in short tests, whereas it did before.

CLM tag used for the baseline comparisons: clm4_5_12_r197
Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: clm45/clm50 with irrigation, and all tests with MOSART
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
        not investigated carefully, but expected to be larger than roundoff/same
        climate

    Irrigation changes are due to the new mapping

    MOSART changes are just in x2l_Flrr_volr, r2x_Flrr_vol,r TWS & VOLR - due to
    a fixed calculation of VOLR in the MOSART external

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.):
- cime: 5.1.1 -> clm4_5_12_r198_cime5.2.0-alpha.1-9-gd321e4b
    This is a cime branch tag, based off of baseline version d321e4b (this
    baseline version is 9 commits past cime5.2.0-alpha.1). The changes on this
    branch are expected to be available by cime5.2.0-alpha.5
- cism: 2_1_18 -> 2_1_21 (unrelated to the other changes in this tag)
- rtm: 1_0_58 -> 1_0_59
- mosart: 1_0_18 -> 1_0_19

List all files eliminated:

========= Renamed to include irrigation
D       components/clm/cime_config/testdefs/testmods_dirs/clm/clm50cropMonth_interp/README
D       components/clm/cime_config/testdefs/testmods_dirs/clm/clm50cropMonth_interp/user_nl_clm
D       components/clm/cime_config/testdefs/testmods_dirs/clm/clm50cropMonth_interp/include_user_mods
D       components/clm/cime_config/testdefs/testmods_dirs/clm/clm50cropMonth_interp

List all files added and what they do:

========= Added more tests with irrigation turned on
A       components/clm/cime_config/testdefs/testmods_dirs/clm/irrig_spunup/README
A       components/clm/cime_config/testdefs/testmods_dirs/clm/irrig_spunup/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/irrig_spunup/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/irrig_spunup/shell_commands
A       components/clm/cime_config/testdefs/testmods_dirs/clm/irrig_spunup
A       components/clm/cime_config/testdefs/testmods_dirs/clm/clm50cropIrrigMonth_interp/shell_commands
A       components/clm/cime_config/testdefs/testmods_dirs/clm/clm50cropIrrigMonth_interp/README
A       components/clm/cime_config/testdefs/testmods_dirs/clm/clm50cropIrrigMonth_interp/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/clm50cropIrrigMonth_interp/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/clm50cropIrrigMonth_interp

List all existing files that have been modified, and describe the changes:

========= Main changes for routing irrigation as a separate field
M       components/clm/src/main/lnd2atmType.F90
M       components/clm/src/main/lnd2atmMod.F90
M       components/clm/src/cpl/clm_cpl_indices.F90
M       components/clm/src/cpl/lnd_import_export.F90

========= Use volrmch rather than volr for limiting irrigation
M       components/clm/src/main/clm_driver.F90

========= Add 'target' attributes to some variables that need them
M       components/clm/src/init_interp/initInterpMultilevelContainer.F90

========= Add a deallocation statement
M       components/clm/src/main/atm2lndType.F90

========= Rename a variable
M       components/clm/src/biogeophys/IrrigationMod.F90

========= Add a new diagnostic field
M       components/clm/src/biogeophys/WaterfluxType.F90

========= Added two debug tests with irrigation; changed the long clm50 crop
          test to include irrigation
M       components/clm/cime_config/testdefs/testlist_clm.xml

========= Two ERI tests now pass due to fixes in CIME and CISM
M       components/clm/cime_config/testdefs/ExpectedTestFails.xml

===============================================================
===============================================================
Tag name:  clm4_5_12_r197
Originator(s):  erik (Erik Kluzek)
Date: Fri Oct 14 03:17:41 MDT 2016
One-line Summary: Some cleanup for plant hydraulic stress and adding more namelist parameters

Purpose of changes
------------------

Some cleanup and documentation of Plant Hydraulic Stress (PHS) from Keith Oleson and Daniel Kennedy.
Setup some common indices as paraameters for PHS rather than hard-coded magic numbers.
Add several new namelist parameters and -light_res option to use high resolution lightnng dataset.

Work with bombspike option and add a test for it. Remove ESMF interfaces.

Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID):
   2361 Setting of glc_nec in a clm aux test
   2359 build-namelist_test.pl has 20 fails in clm4_5_12_r195
   2351 1x1_tropicAtl case issues
   2350 problems with bombspike case
   2339 don't write crootfr and rootfr
   2333 build-namelist_test.pl should label the mode in a more useful way
   2332 fire_emis test is unable to add fire emission-specific history fields
   2325 limit scope of mct vars in decompInitMod and lnd_comp_mod
   2293 better handling of bombspike case


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): None

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables):
      new namelist items: initial_Cstocks, freelivfix_slope_wET, freelivfix_intercept, zetamaxstable, Jmaxb1
      new build-namelist option (CLM_NAMELIST_OPTS): light_res

      Change DJK history field to TSINK

Changes made to namelist defaults (e.g., changed parameter values): 

Changes to the datasets (e.g., parameter, surface or initial files):
      Option for a half-degree lightning dataset rather than just the default T62 dataset

Substantial timing or memory changes: None

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance):
     SoilWaterMovementMod.F90 duplicates the soil and root indices that are in PhotosynthesisMod

Changes to tests or testing: Add bombspike test

Code reviewed by: self, oleson, djk

CLM testing: regular

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone -  PASS (310 comparisons fail, because of namelist changes)

  unit-tests (components/clm/src):

    yellowstone -  PASS

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel -  OK
    yellowstone_pgi -  OK
    yellowstone_gnu (clm45 only) -  OK
    hobart_nag - PASS

CLM tag used for the baseline comparisons:  clm4_5_12_r196


Answer changes
--------------

Changes answers relative to baseline: no bit-for-bit

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): None

List all files eliminated: Remove ESMF interfaces no longer supported

  D   components/clm/src/cpl/lnd_comp_esmf.F90
  D   components/clm/src_clm40/main/lnd_comp_esmf.F90

List all files added and what they do:

-------------- Add new test for c14 bombspike
  A   components/clm/cime_config/testdefs/testmods_dirs/clm/ciso_bombspike1963/user_nl_clm
  A   components/clm/cime_config/testdefs/testmods_dirs/clm/ciso_bombspike1963/include_user_mods
  A   components/clm/cime_config/testdefs/testmods_dirs/clm/ciso_bombspike1963/shell_commands

List all existing files that have been modified, and describe the changes:

  M   components/clm/bld/CLMBuildNamelist.pm --------------------------- Add -light_res option, clarify help, set cnfireson
               when lightning/pop defns needed
  M   components/clm/bld/unit_testers/build-namelist_test.pl ----------- set mode to options to configure, add new tests for 
               the new namelist options
  M   components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml --- set spinup_state, use_dynroot, paramfile for use_ed/clm50
               correct year range for flanduse_timeseries 1x1_tropicAtl, set light_res defaults, add half-degree lightning file,
               
  M   components/clm/bld/namelist_files/namelist_definition_clm4_5.xml - Add new namelist items: initial_Cstocks, freelivfix_slope_wET,
               freelivfix_intercept, zetamaxstable, Jmaxb1, and light_res option

--------------- Remove unneeded ndepsrc="stream", add cnfireson for pop-dens and lightning
  M   components/clm/bld/namelist_files/use_cases/1850_glacierMEC_control.xml
  M   components/clm/bld/namelist_files/use_cases/1850-2100_rcp2.6_glacierMEC_transient.xml
  M   components/clm/bld/namelist_files/use_cases/1850-2100_rcp6_glacierMEC_transient.xml
  M   components/clm/bld/namelist_files/use_cases/1850-2100_rcp4.5_glacierMEC_transient.xml
  M   components/clm/bld/namelist_files/use_cases/1850-2100_rcp8.5_glacierMEC_transient.xml
  M   components/clm/bld/namelist_files/use_cases/2000_control.xml
  M   components/clm/bld/namelist_files/use_cases/20thC_glacierMEC_transient.xml
  M   components/clm/bld/namelist_files/use_cases/2000-2100_rcp8.5_transient.xml
  M   components/clm/bld/namelist_files/use_cases/2000_glacierMEC_control.xml
  M   components/clm/bld/namelist_files/use_cases/1850_control.xml
  M   components/clm/bld/namelist_files/use_cases/1850-2100_rcp2.6_transient.xml
  M   components/clm/bld/namelist_files/use_cases/1850-2100_rcp6_transient.xml
  M   components/clm/bld/namelist_files/use_cases/1850-2100_rcp4.5_transient.xml
  M   components/clm/cime_config/testdefs/testmods_dirs/clm/clm50cropMonth_interp/user_nl_clm - turn hydrstess off

  M   components/clm/src/utils/spmdGathScatMod.F90 ------- Add only clause to use statements (bug 2325)
  M   components/clm/src/biogeochem/CNFireLi2016Mod.F90 -- Add need_lightning_and_popdens, remove note on compiler bug
  M   components/clm/src/biogeochem/CNNDynamicsMod.F90 --- Add CNNDynamicsReadNML for freelivfix_intercept, freelivfix_slope_wET
  M   components/clm/src/biogeochem/CNFireMethodMod.F90 -- Add need_lightning_and_popdens
  M   components/clm/src/biogeochem/CNFireLi2014Mod.F90 -- Set need_lightning_and_popdens=.true.
  M   components/clm/src/biogeochem/CNFireNoFireMod.F90 -- Set need_lightning_and_popdens=.false.
  M   components/clm/src/biogeochem/CNFireBaseMod.F90 ---- Add need_lightning_and_popdens, only do them if true
  M   components/clm/src/main/clm_varpar.F90 ------------- Make i_met_lit, i_cel_lit, i_lig_lit parameters, set i_cwd appropriately
  M   components/clm/src/main/decompInitMod.F90 ---------- Add only clause to use statements (bug 2325)
  M   components/clm/src/main/ndepStreamMod.F90 ---------- Add only clause to use statements (bug 2325)
  M   components/clm/src/main/GetGlobalValuesMod.F90 ----- Add only clause to use statements (bug 2325)
  M   components/clm/src/main/controlMod.F90 ------------- Add calls to: LunaReadNML, FrictionVelReadNML, and
              CNNDynamicsReadNML, DecompCascadeBGCreadNML
  M   components/clm/src/main/clm_instMod.F90 ------------ Shorten statement
  M   components/clm/src/main/ncdio_pio.F90.in ----------- Have pio bcast error, so terminate here rather than deep in pio
  M   components/clm/src/biogeophys/SoilWaterMovementMod.F90 - Change djk to tsink, work on documentation
              set soil=1,root=4 as parameters
  M   components/clm/src/biogeophys/EnergyFluxType.F90 ------- Always allocate bsun_patch/bsha regardless of phs on/off
  M   components/clm/src/biogeophys/FrictionVelocityMod.F90 -- Add FrictionVelReadNML for zetamaxstable
  M   components/clm/src/biogeophys/UrbanFluxesMod.F90 ------- Use zetamaxstable from frictionvel_parms_inst
  M   components/clm/src/biogeophys/LunaMod.F90 -------------- Add LunaReadNML for Jmaxb1
  M   components/clm/src/biogeophys/PhotosynthesisMod.F90 ---- Set sun,sha,xyl,root,veg,soil parameters and use them, always allocate
              regardless of phs, ensure nvegwcs==4, remove commented out lines, add back call to bombspike, 
              remove some unused arrays, work on comments, 
  M   components/clm/src/biogeophys/LakeFluxesMod.F90 -------- Use zetamaxstable from frictionvel_parms_inst
  M   components/clm/src/biogeophys/SoilStateType.F90 -------- Change DJK to TSINK, always alloc tsink, don't output CROOTFR/ROOTFR
  M   components/clm/src/biogeophys/BareGroundFluxesMod.F90 -- Use zetamaxstable from frictionvel_parms_inst
  M   components/clm/src/biogeophys/CanopyFluxesMod.F90 ------ Use zetamaxstable from frictionvel_parms_inst, work on comments for PHS
  M   components/clm/src/biogeophys/CanopyStateType.F90 ------ Always allocate vegwp_patch don't worry about PHS
  M   components/clm/src/biogeophys/test/HumanStress_test/test_humanstress.pf - Speed up test
  M   components/clm/src/soilbiogeochem/SoilBiogeochemDecompCascadeBGCMod.F90 - Add DecompCascadeBGCreadNML for initial_Cstocks,
              make som pools indices parameters

===============================================================
===============================================================
Tag name:  clm4_5_12_r196
Originator(s):  erik (Erik Kluzek)
Date: Tue Sep 27 02:46:29 MDT 2016
One-line Summary: Bring new cime5 to clm trunk

Purpose of changes
------------------

   Update from cime4 version to cime5.1.1. This has some changes to the user interface
   on setting up cases. create_newcase largely works the same, but other scripts have
   subtle to more extensive changes to them. cime5 has scripts all done in object oriented Python. 

  create_newcase changes some options to use double "--" signs. Standard options
  can be done with either one or two.
  --user-compset        If set, then the --compset argument is treated as a
                        user specified compset.This assumes that all of the
                        compset settings in thecompset along name have been
                        defined for all of its componentsIf the compset name
                        is found as a supported compset, then it will be
                        treated as such.
  --pesfile PESFILE     Only used and required for --user-compset
                        argument.Full pathname of the pes specification
                        fileThis argument is required if --user-compset is
                        True
  --user-grid           If set, then the -grid argument is treated as a user
                        specified grid.As such, the additional argument
                        --gridfile must also be specifiedand all of the grid
                        settings in the --res argument name (which must be a
                        grid longnamehave been defined in the grid file
                        pointed to by --gridfile
  --gridfile GRIDFILE   Full pathname of config grid file to useThis should be
                        a copy of cime_config/config_grids.xmlwith the new
                        user grid changes added to itThis argument is required
                        if --user-grid is True

  create_newcase adds the following new options (
  --ninst NINST         Specify number of component instancesSet the number of
                        component instances in the case.
  --srcroot SRCROOT     Alternative path for source root directory. By default
                        this is set to cimeroot/../
  --walltime WALLTIME   Set the wallclock limit for this case. Can use env var
                        CIME_GLOBAL_WALLTIME to set this.
  -q QUEUE, --queue QUEUE
                        Force batch system to use a certain queue

  New files created in your case:

   Several files are softlinked into the case directory (such as case.setup, case.run, etc.)
   software_environment.txt -- your environment variables
   PESetupHist --- Directory for processor history changes

   case.clean_build is removed, and you use the --clean option to case.build

   xmlchange adds several options such as -subgroup
   xmlquery operation is a bit different. list capability is done via --list-all option.

   Format of *.xml files in your case is a bit different than before

  PIO versions were updated and PIO now catches some errors that it let go before.

  userdefinedmachine is upgraded so that you create a ~/.cime directory and put config_machines.xml
  for your machine (as well as config_compilers.xml, config_batch.xml, and config_build.xml
  if needed)

Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID):
   2354 New streams file for urban is in NetCDF4 classic format and new cime5 
        gnu/pnetcdf/pio1 combination can't read it

Known bugs introduced in this tag (include bugzilla ID): 
   2359 build-namelist_test.pl has 20 fails in clm4_5_12_r195
   2358 test_driver.sh has problems with running gen_domain with clm4_5_12_r19620 fails in 
   2357 PTCLMmkdata broken in clm4_5_12_r196 due to changes in cime5
   2356 Test hangs on hobart
   2353 areas wrong on mosart input file

 cime5 issues:
   589 Add back ability of ascii test lists to have comments...
   580 ERI test with REFCASE prestages file into wrong run directory
   506 make 1 processor cases by default mpi-serial (won't fix)
   294 Need an "all" option to --xml-* options
   293 cs.status looses some of the functionality that was in cimeteststatus

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions):

   No longer need to provide machine name in create_newcase
   New options to create_newcase: --queue, --walltime, --ninst
   Some less used options were removed.

   Single processor cases, no longer by default use mpi-serial. You have
   to manually change MPILIB!

   manage_* scripts command line options changed use --help option to query usage.

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): None

Changes made to namelist defaults (e.g., changed parameter values): None

Changes to the datasets (e.g., parameter, surface or initial files):
   Urban streams file changed from NetCDF4 format to NetCDF3 so new pio1 and pnetcdf could read it

Substantial timing or memory changes: None

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance):

Changes to tests or testing:

    interface to create_test is changed. Standard operation is like this...

  ./create_test --xml-category aux_clm45 --compare clm4_5_12_r195 --generate clm4_5_12_r196 \
                --xml-machine yellowstone--xml-compiler intel

  Currently in this version cime5.1.1 you can't leave off --xml-compiler as it will run
  everything with the default compiler

Code reviewed by: self, sacks, mvertens

CLM testing: regular

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - OK 20 tests fail, and 104 namelists are different

  unit-tests (components/clm/src): 

    yellowstone - PASS

  tools-tests (components/clm/test/tools):

    yellowstone - OK (bug 2358)

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - FAIL (bug 2357)

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - OK
    yellowstone_pgi - OK
    yellowstone_gnu (clm45 only) - OK
    hobart_nag - OK

CLM tag used for the baseline comparisons:  clm4_5_12_r195


Answer changes
--------------

Changes answers relative to baseline: No bit-for-bit

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): cime, rtm, mosart, cism
    cime   to cime5.1.1
    rtm    to rtm1_0_58
    mosart to mosart1_0_18
    cism   to cism2_1_18 --- Removes ESMF tests

    add output history frequency "time_period_freq" to history files

List all files eliminated: Move to name with clm50 in it

D       components/clm/cime_config/testdefs/testmods_dirs/clm/cropMonth_interp
D       components/clm/cime_config/testdefs/testmods_dirs/clm/cropMonth_interp/user_nl_clm
D       components/clm/cime_config/testdefs/testmods_dirs/clm/cropMonth_interp/include_user_mods
D       components/clm/cime_config/testdefs/testmods_dirs/clm/cropMonth_interp/README

List all files added and what they do:

A       parse_cime.cs.status ---- Script to parse cs.status output like cime4 cimeteststatus
           usage: ../../parse_cime.cs.status cs.status.*

               Scripts to take a baseline directory in cime4 format to cime5 format
A       components/clm/tools/clm4_5/refactorTools/esmciport/convertbaselines4esmci
A       components/clm/tools/clm4_5/refactorTools/esmciport/linkhistorytofileswdate.ncl
A       components/clm/tools/clm4_5/refactorTools/esmciport

               Have clm50 in the name, and add new CLM50 crop finidat file
A       components/clm/cime_config/testdefs/testmods_dirs/clm/clm50cropMonth_interp/README
A       components/clm/cime_config/testdefs/testmods_dirs/clm/clm50cropMonth_interp/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/clm50cropMonth_interp/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/clm50cropMonth_interp

List all existing files that have been modified, and describe the changes:

           Initial changes to get gen_domain build/run working with cime5
M       components/clm/test/tools/test_driver.sh -- update module settings, 
M       components/clm/test/tools/TCBCFGtools.sh -- update how configure works, and run
          .env_mach_specific.sh, don't need to softlink Macros.make

M       components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml -- Update urban streams
              files so in NetCDF3 format rather than NetCDF4 so cime5/pio can read it

M       components/clm/cime_config/config_compsets.xml - whitespace changes, add CAM55

M       components/clm/cime_config/testdefs/testmods_dirs/clm/default/shell_commands ---- no
                mult-instance extra copies, don't set PIO rearranger type
M       components/clm/cime_config/testdefs/testmods_dirs/clm/40pts/xmlchange_cmnds ----- don't
                set TOTALPES, but set ESP
M       components/clm/cime_config/testdefs/testmods_dirs/clm/pts/xmlchange_cmnds ------- don't
                set TOTALPES, but set ESP
M       components/clm/cime_config/testdefs/testmods_dirs/clm/40default/shell_commands -- no
                mult-instance extra copies
M       components/clm/cime_config/testdefs/testlist_clm.xml - Make all single processor
              tests with _Mmpi-serial, change cropMonth_interp to clm50cropMonth_interp
              change some PEM tests to ERP
M       components/clm/cime_config/buildlib ------------------ Changed to python
M       components/clm/cime_config/config_component.xml ------ Additive option changed to cime5
              Remove BARRIER_N/OPTION/ATM_PIO_TYPENAME/LND_PIO_REARRANGER moved to cime5
              format changed slightly

M       components/clm/src/biogeochem/MEGANFactorsMod.F90 -- MEGAN comp_names is 40 rather
              than 32, to match size on megan emissions file

M       components/clm/src/main/histFileMod.F90 --- Add time_period_freq
MM      components/clm/src/main/clm_varcon.F90 ---- Add isecsphr, and isecspmin

===============================================================
===============================================================
Tag name:  clm4_5_12_r195
Originator(s):  sacks (Bill Sacks)
Date: Sun Sep 18 07:23:25 MDT 2016
One-line Summary: Remove dependence on column weights in fire code

Purpose of changes
------------------

When calculating the fractions of BET and BDT, calculate these as fractions of
the column rather than as fractions of the grid cell. This is needed for
consistency with all other code in CLM, where the behavior of a column shouldn't
depend on that column's weight on the grid cell. The earlier code was
problematic in this way: If you did two runs - one with default areas, and one
where the natural veg landunit area was larger or smaller - then the evolution
of the natural veg landunit could change; this is not supposed to happen in CLM.

This can change answers for the fire code, but should generally only change
answers by a small amount, unless there are tropical grid cells where the
natural vegetation fraction is substantially less than 1.

Fang Li is okay with this change. She points out that the original formulation
was based on the fact that literataure typically cites 60% of (BET+BDT) on the
grid cell as a cutoff for being classified as tropical closed forest for the
sake of fire determinations, so the earlier code was consistent with that
definition. She also points out that this change could lead to a slightly
greater prevalence of deforestation fires and (after tuning) a consequently
smaller prevalence of non-deforestation fires - which can be undesirable. But
overall she is okay with this change given its likely small impact.


Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID): partial fix of item #14 in bugz 1679
   Still need to address dtrotr_col, but the fix there is different, and is tied
   in with other changes for dynamic landunits.


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing: none

Code reviewed by: self

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

   ok means tests pass; some baseline comparisons fail

CLM tag used for the baseline comparisons: clm4_5_12_r194


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: CN/BGC with CLM45/CLM50
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 

      Greater than roundoff for at least some tests; from some spot-checks,
      seems to be same climate.

      I have spot-checked a few tests that have greater than roundoff-level
      diffs (ERP_D_Ld5.f19_g16.IRCP85CLM45BGC.yellowstone_pgi.clm-drydepnomegan
      and ERI_D_Ld9.f09_g16.ICLM45BGC.yellowstone_intel.clm-default). These
      tests have diffs in just a few grid cells in the tropics.

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

M       components/clm/src/biogeochem/CNFireBaseMod.F90
M       components/clm/src/biogeochem/CNFireLi2016Mod.F90
M       components/clm/src/biogeochem/CNVegStateType.F90
M       components/clm/src/biogeochem/CNFireLi2014Mod.F90

===============================================================
===============================================================
Tag name:  clm4_5_12_r194
Originator(s):  sacks (Bill Sacks)
Date: Thu Sep  1 10:17:56 MDT 2016
One-line Summary: Dribble annual dyn landunit adjustment fluxes; initialize water state for new crop columns

Purpose of changes
------------------

Two main changes in this tag:

(1) Add infrastructure for dribbling fluxes that are generated once per year (on
    the first time step of the year), so that an equal flux is produced
    throughout the year. Apply this infrastructure to the correction fluxes that
    are generated to conserve water and energy with dynamic columns / landunits.

(2) When a new column comes into existence (currently, this means a new crop
    column), copy h2osoi_liq, h2osoi_ice and h2osoi_vol from the "template"
    column (typically a natural veg column on that gridcell), in addition to the
    pre-existing copy of t_soisno.

Also, a minor change that touched many files: Replace inline uses of __FILE__
with a constant ('sourcefile') defined in each source file where this is
used. This is needed because lines with __FILE__ were sometimes exceeding pgi's
line limit (since pgi enforces the line limit after expanding macros). (See bugz
2049.)


Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID): 2049 - __FILE__ expands to be too long sometimes

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance):
- New uses of __FILE__ on outstanding branches should be replaced with
  sourcefile. Note that I have only added 'sourcefile' in files that currently
  needed it; other files may need to have this added.

Changes to tests or testing:
- Added this test in order to test mid-year restarts with dynamic landunits
  (needed to test restartability of annual flux dribbling):
  ERS_D_Ld7.1x1_smallvilleIA.IHISTCLM45BGCCROP.yellowstone_intel.clm-decStart1851_noinitial

  Note that the "noinitial" aspect of this can be removed once ignore_ic_date is
  made compatible with crop.

Code reviewed by: self

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

  ok means tests pass or xfail; expected baseline failures as noted below

CLM tag used for the baseline comparisons: clm4_5_12_r193


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: clm45/clm50 transient (HIST, RCP, DV or IG)
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 

      Not investigated carefully, but expected to be new climate for
      configurations that have transient column areas (IG or transient crop,
      which involve large transitions at the starat of the year), but only
      marginally different (approx. roundoff-level) for transient natural PFTs
      (which involve gradual transitions throughout the year).

      I have verified that the answer changes due to the new annual flux
      dribbler infrastructure are reduced to 0 (i.e., bit-for-bit) if the flux
      on the first time step of the year is treated as before - i.e., other than
      the dribbling that is applied to this start-of-year flux, this
      infrastructure is bit-for-bit with the earlier code in dynConsBiogeophys.

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: none

List all files added and what they do:

========= New infrastructure for dribbling fluxes that are generated on the
          first time step of the year - spreading these fluxes throughout the
          year
A       components/clm/src/utils/AnnualFluxDribbler.F90
A       components/clm/src/utils/test/annual_flux_dribbler_test/test_annual_flux_dribbler.pf
A       components/clm/src/utils/test/annual_flux_dribbler_test/CMakeLists.txt
A       components/clm/src/utils/test/annual_flux_dribbler_test

========= Test mods for new test: tests mid-year restarts with dynamic landunits
A       components/clm/cime_config/testdefs/testmods_dirs/clm/decStart1851_noinitial/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/decStart1851_noinitial/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/decStart1851_noinitial/shell_commands
A       components/clm/cime_config/testdefs/testmods_dirs/clm/decStart1851_noinitial/README
A       components/clm/cime_config/testdefs/testmods_dirs/clm/decStart1851_noinitial

List all existing files that have been modified, and describe the changes:

========= Use new infrastructure for dribbling fluxes in order to dribble fluxes
          generated to conserve water and energy with changing column areas
M       components/clm/src/biogeophys/EnergyFluxType.F90
M       components/clm/src/biogeophys/WaterfluxType.F90
M       components/clm/src/dyn_subgrid/dynConsBiogeophysMod.F90

========= New time manager routines needed for dribbling infrastructure
M       components/clm/src/utils/test/clm_time_manager_test/test_clm_time_manager.pf
M       components/clm/src/utils/clm_time_manager.F90
M       components/clm/src/unit_test_shr/unittestTimeManagerMod.F90

========= When a new column comes into existence, also copy some soil water
          variables from the template column
M       components/clm/src/dyn_subgrid/dynInitColumnsMod.F90
M       components/clm/src/dyn_subgrid/dynSubgridDriverMod.F90
M       components/clm/src/dyn_subgrid/test/dynInitColumns_test/test_init_columns.pf

========= Add tests of new dribbling infrastructure
M       components/clm/src/utils/CMakeLists.txt
M       components/clm/src/utils/test/CMakeLists.txt

========= New test: tests mid-year restarts with dynamic landunits
M       components/clm/cime_config/testdefs/testlist_clm.xml

========= Replace inline uses of __FILE__ with a constant ('sourcefile')
M       components/clm/src/utils/quadraticMod.F90
M       components/clm/src/utils/clmfates_interfaceMod.F90
M       components/clm/src/utils/restUtilMod.F90.in
M       components/clm/src/utils/SimpleMathMod.F90
M       components/clm/src/biogeochem/NutrientCompetitionMethodMod.F90
M       components/clm/src/biogeochem/CNPhenologyMod.F90
M       components/clm/src/biogeochem/CNVegCarbonFluxType.F90
M       components/clm/src/biogeochem/CNDVType.F90
M       components/clm/src/biogeochem/VOCEmissionMod.F90
M       components/clm/src/biogeochem/CNFireFactoryMod.F90
M       components/clm/src/biogeochem/CNVegComputeSeedMod.F90
M       components/clm/src/biogeochem/C14BompbSpikeMod.F90
M       components/clm/src/biogeochem/CNBalanceCheckMod.F90
M       components/clm/src/biogeochem/DryDepVelocity.F90
M       components/clm/src/biogeochem/CNDVDriverMod.F90
M       components/clm/src/biogeochem/MEGANFactorsMod.F90
M       components/clm/src/biogeochem/SpeciesNonIsotopeType.F90
M       components/clm/src/biogeochem/SatellitePhenologyMod.F90
M       components/clm/src/biogeochem/NutrientCompetitionFactoryMod.F90
M       components/clm/src/biogeochem/CNDVEstablishmentMod.F90
M       components/clm/src/biogeochem/DUSTMod.F90
M       components/clm/src/biogeochem/CNProductsMod.F90
M       components/clm/src/biogeochem/CNVegCarbonStateType.F90
M       components/clm/src/biogeochem/dynConsBiogeochemMod.F90
M       components/clm/src/biogeochem/CNFireLi2014Mod.F90
M       components/clm/src/biogeochem/CNVegStateType.F90
M       components/clm/src/biogeochem/CNMRespMod.F90
M       components/clm/src/biogeochem/CNFUNMod.F90
M       components/clm/src/biogeochem/CNVegetationFacade.F90
M       components/clm/src/biogeochem/CNVegNitrogenStateType.F90
M       components/clm/src/biogeochem/ch4Mod.F90
M       components/clm/src/biogeochem/NutrientCompetitionCLM45defaultMod.F90
M       components/clm/src/biogeochem/CNGapMortalityMod.F90
M       components/clm/src/biogeochem/SpeciesIsotopeType.F90
M       components/clm/src/biogeochem/CNFireBaseMod.F90
M       components/clm/src/biogeochem/CropType.F90
M       components/clm/src/biogeochem/CNCIsoFluxMod.F90
M       components/clm/src/biogeochem/CNPrecisionControlMod.F90
M       components/clm/src/biogeochem/NutrientCompetitionFlexibleCNMod.F90
M       components/clm/src/biogeochem/dynHarvestMod.F90
M       components/clm/src/biogeochem/ch4varcon.F90
M       components/clm/src/biogeochem/CNSharedParamsMod.F90
M       components/clm/src/biogeochem/CNFireLi2016Mod.F90
M       components/clm/src/init_interp/initInterpBounds.F90
M       components/clm/src/init_interp/initInterpMultilevelCopy.F90
M       components/clm/src/init_interp/initInterp1dData.F90
M       components/clm/src/init_interp/initInterpMultilevelSplit.F90
M       components/clm/src/init_interp/initInterp.F90
M       components/clm/src/init_interp/initInterp2dvar.F90.in
M       components/clm/src/init_interp/initInterpMultilevelInterp.F90
M       components/clm/src/init_interp/initInterpMultilevelContainer.F90
M       components/clm/src/init_interp/initInterpMindist.F90
M       components/clm/src/init_interp/initInterpMultilevelSnow.F90
M       components/clm/src/main/subgridAveMod.F90
M       components/clm/src/main/initGridCellsMod.F90
M       components/clm/src/main/initVerticalMod.F90
M       components/clm/src/main/atm2lndMod.F90
M       components/clm/src/main/lnd2atmMod.F90
M       components/clm/src/main/surfrdMod.F90
M       components/clm/src/main/ncdio_pio.F90.in
M       components/clm/src/main/reweightMod.F90
M       components/clm/src/main/glcBehaviorMod.F90
M       components/clm/src/main/subgridWeightsMod.F90
M       components/clm/src/main/decompInitMod.F90
M       components/clm/src/main/subgridRestMod.F90
M       components/clm/src/main/subgridMod.F90
M       components/clm/src/main/ndepStreamMod.F90
M       components/clm/src/main/atm2lndType.F90
M       components/clm/src/main/column_varcon.F90
M       components/clm/src/main/histFileMod.F90
M       components/clm/src/main/restFileMod.F90
M       components/clm/src/main/controlMod.F90
M       components/clm/src/main/GetGlobalValuesMod.F90
M       components/clm/src/main/initSubgridMod.F90
M       components/clm/src/main/filterColMod.F90
M       components/clm/src/main/glc2lndMod.F90
M       components/clm/src/main/filterMod.F90
M       components/clm/src/main/lnd2glcMod.F90
M       components/clm/src/main/clm_driver.F90
M       components/clm/src/main/surfrdUtilsMod.F90
M       components/clm/src/main/pftconMod.F90
M       components/clm/src/ED/biogeochem/EDCanopyStructureMod.F90
M       components/clm/src/ED/biogeochem/EDSharedParamsMod.F90
M       components/clm/src/ED/main/EDCLMLinkMod.F90
M       components/clm/src/ED/main/EDRestVectorMod.F90
M       components/clm/src/ED/biogeophys/EDPhotosynthesisMod.F90
M       components/clm/src/biogeophys/OzoneOffMod.F90
M       components/clm/src/biogeophys/SnowSnicarMod.F90
M       components/clm/src/biogeophys/SoilMoistStressMod.F90
M       components/clm/src/biogeophys/OzoneMod.F90
M       components/clm/src/biogeophys/CanopyHydrologyMod.F90
M       components/clm/src/biogeophys/FrictionVelocityMod.F90
M       components/clm/src/biogeophys/UrbanFluxesMod.F90
M       components/clm/src/biogeophys/LunaMod.F90
M       components/clm/src/biogeophys/SurfaceAlbedoMod.F90
M       components/clm/src/biogeophys/TemperatureType.F90
M       components/clm/src/biogeophys/HumanIndexMod.F90
M       components/clm/src/biogeophys/SurfaceAlbedoType.F90
M       components/clm/src/biogeophys/PhotosynthesisMod.F90
M       components/clm/src/biogeophys/SoilHydrologyMod.F90
M       components/clm/src/biogeophys/GlacierSurfaceMassBalanceMod.F90
M       components/clm/src/biogeophys/SoilHydrologyType.F90
M       components/clm/src/biogeophys/CanopyFluxesMod.F90
M       components/clm/src/biogeophys/SoilHydrologyInitTimeConstMod.F90
M       components/clm/src/biogeophys/SoilStateInitTimeConstMod.F90
M       components/clm/src/biogeophys/SurfaceRadiationMod.F90
M       components/clm/src/biogeophys/SoilTemperatureMod.F90
M       components/clm/src/biogeophys/WaterStateType.F90
M       components/clm/src/biogeophys/UrbBuildTempOleson2015Mod.F90
M       components/clm/src/biogeophys/SnowHydrologyMod.F90
M       components/clm/src/biogeophys/LakeTemperatureMod.F90
M       components/clm/src/biogeophys/CanopyStateType.F90
M       components/clm/src/biogeophys/TridiagonalMod.F90
M       components/clm/src/biogeophys/SoilWaterRetentionCurveFactoryMod.F90
M       components/clm/src/biogeophys/UrbanTimeVarType.F90
M       components/clm/src/biogeophys/UrbanRadiationMod.F90
M       components/clm/src/biogeophys/BandDiagonalMod.F90
M       components/clm/src/biogeophys/AerosolMod.F90
M       components/clm/src/biogeophys/IrrigationMod.F90
M       components/clm/src/biogeophys/SurfaceResistanceMod.F90
M       components/clm/src/biogeophys/UrbanParamsType.F90
M       components/clm/src/biogeophys/UrbanAlbedoMod.F90
M       components/clm/src/biogeophys/RootBiophysMod.F90
M       components/clm/src/biogeophys/BalanceCheckMod.F90
M       components/clm/src/biogeophys/SoilWaterMovementMod.F90
M       components/clm/src/soilbiogeochem/SoilBiogeochemDecompMod.F90
M       components/clm/src/soilbiogeochem/SoilBiogeochemCarbonStateType.F90
M       components/clm/src/soilbiogeochem/SoilBiogeochemNitrifDenitrifMod.F90
M       components/clm/src/soilbiogeochem/SoilBiogeochemNitrogenFluxType.F90
M       components/clm/src/soilbiogeochem/SoilBiogeochemDecompCascadeBGCMod.F90
M       components/clm/src/soilbiogeochem/SoilBiogeochemNitrogenStateType.F90
M       components/clm/src/soilbiogeochem/SoilBiogeochemNLeachingMod.F90
M       components/clm/src/soilbiogeochem/SoilBiogeochemCompetitionMod.F90
M       components/clm/src/soilbiogeochem/SoilBiogeochemVerticalProfileMod.F90
M       components/clm/src/soilbiogeochem/SoilBiogeochemDecompCascadeCNMod.F90
M       components/clm/src/soilbiogeochem/SoilBiogeochemPotentialMod.F90
M       components/clm/src/soilbiogeochem/SoilBiogeochemNitrogenUptakeMod.F90
M       components/clm/src/soilbiogeochem/SoilBiogeochemLittVertTranspMod.F90
M       components/clm/src/dyn_subgrid/dynTimeInfoMod.F90
M       components/clm/src/dyn_subgrid/dynFileMod.F90
M       components/clm/src/dyn_subgrid/dynColumnStateUpdaterMod.F90
M       components/clm/src/dyn_subgrid/dynPatchStateUpdaterMod.F90
M       components/clm/src/dyn_subgrid/dynColumnTemplateMod.F90
M       components/clm/src/dyn_subgrid/dynpftFileMod.F90
M       components/clm/src/dyn_subgrid/dynVarMod.F90.in
M       components/clm/src/dyn_subgrid/dynSubgridControlMod.F90
M       components/clm/src/dyn_subgrid/dyncropFileMod.F90
M       components/clm/src/dyn_subgrid/dynLandunitAreaMod.F90
M       components/clm/src/unit_test_shr/unittestSimpleSubgridSetupsMod.F90

===============================================================
===============================================================
Tag name:  clm4_5_12_r193
Originator(s):  andre (Benjamin Andre,UCAR/CSEG,303-497-1391)
Date:  Tue Aug 30 21:08:39 MDT 2016
One-line Summary: Bugfix in BalanceCheckMod: revert tolerance change and removal of endrun call introduced in r192

Purpose of changes
------------------

Revert the tolerance change and removal of an endrun call in BalanceCheckMod
that were introduced in r192.

Bugs fixed or introduced
------------------------

see above.

Notes of particular relevance for users
---------------------------------------

none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Changes to tests or testing: none

Code reviewed by: self

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - n/a, not run

  unit-tests (components/clm/src):

    yellowstone - n/a, not run

  tools-tests (components/clm/test/tools):

    yellowstone - n/a, not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - n/a, not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

CLM tag used for the baseline comparisons: clm4_5_12_r192


Answer changes
--------------

Changes answers relative to baseline:

    Test suite bit for bit with r191 and r192. Long runs may change from
    r192 if the tolerance or endrun condition are encountered, but
    should agree with r191.

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

    components/clm/src/biogeophys/BalanceCheckMod.F90 - revert tolerance
    change and reinstate endrun call.

===============================================================
===============================================================
Tag name:  clm4_5_12_r192
Originator(s):  andre (Benjamin Andre,UCAR/CSEG,303-497-1391)
Date:  Sat Aug 27 21:32:54 MDT 2016
One-line Summary: ED bugfixes and initial refactoring for a standalone library

Purpose of changes
------------------

NGEE-T development work on ED. Numerous science and software
improvements including:

* carbon linkages between ed and subsurface soil biogeochemistry
* improvements to patch fusion
* litter flux outputs
* phenology is self contained
* sites now align to clm columns
* ed is now a bgc mode
* check for incompatible physics
* better error checking of compatible name list options
* fixed memory corruption during restarts
* bit for bit restart for single point and global simulations works
* numerous threading related issues fixed
* numerous improvements to history and diagnostics

Start renaming some routines and modules to use the new name "FATES".

Initial development work to isolate ED from CLM and create a
standalone library, including:

* start defining an API for external drivers to interact with fates.
* start moving interaction between clm and fates into interface routines
* start work on thread safe fates objects
* data structures to clearly identify and isolate input and output
boundary conditions for some fates routines.


Bugs fixed or introduced
------------------------

Known bugs introduced in this tag (include bugzilla ID):

BalanceCheckMod.F90 was changed to loosen tolerances, not call endrun
if error in energy balance. This change isn't changing answers in
tests and wasn't caught until late in merging. It should probably be
reverted.

ED is not thread safe, and is not expected to work or restart with
multiple threads.

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions):

Changes to CLM's user interface (e.g., new/renamed XML or namelist
variables): ed is now a bgc mode.

Changes made to namelist defaults (e.g., changed parameter values):

Changes to the datasets (e.g., parameter, surface or initial files):
updated ed parameters file.

Substantial timing or memory changes: unknown

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing:

Code reviewed by: Ryan Knox, Charlie Koven, Rosie Fisher

CLM testing:


  [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - unit tests pass

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - n/a, not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

    yellowstone - n/a, not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

    ED tests have been added to the clm test suite on yellowstone and
    hobart. These will BFAIL because they do not have baselines in
    r191.

  CLM tag used for the baseline comparisons: clm4_5_12_r191

  ed test suite - baseline 9c008bf - yellowstone gnu, intel, pgi - pass

Answer changes
--------------

Changes answers relative to baseline: bit for bit for clm40, clm45 and
clm50. Changes answers for ED compsets, but these were not supported
or expected to work in the trunk.

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated:

  components/clm/src/ED/biogeochem/EDPhenologyType.F90

  List all files added and what they do:

    new mods test for ed
      components/clm/cime_config/testdefs/testmods_dirs/clm/edNoFire
      components/clm/cime_config/testdefs/testmods_dirs/clm/edNoFire/user_nl_clm
      components/clm/cime_config/testdefs/testmods_dirs/clm/edNoFire/include_user_mods
      components/clm/cime_config/testdefs/testmods_dirs/clm/edNoFire/shell_commands

    new unit tests for ED build namelist options
      components/clm/bld/test_build_namelist/t/test_ed_mode.pm

    new clm-ed interface:
      components/clm/src/utils/clmfates_interfaceMod.F90 -
      components/clm/src/ED/main/FatesInterfaceMod.F90
      components/clm/src/ED/main/FatesGlobals.F90

      call subsurface biogeochemistry driven by ED
      components/clm/src/biogeochem/EDBGCDynMod.F90

    List all existing files that have been modified, and describe the changes:

    ===============================================================

    ED as a bgc mode, better testing of namelist options related to ed
    and checks for compatibility.

      components/clm/cime_config/config_component.xml
      components/clm/bld/CLMBuildNamelist.pm
      components/clm/bld/namelist_files/namelist_definition_clm4_5.xml
      components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml
      components/clm/bld/unit_testers/build-namelist_test.pl
      components/clm/bld/test_build_namelist/t/input/namelist_defaults_clm4_5_test.xml
      components/clm/bld/test_build_namelist/t/input/namelist_definition_clm4_5_test.xml
      components/clm/bld/test_build_namelist/t/test_vichydro.pm
      components/clm/bld/test_build_namelist/t/template_test_XXX.pm

      Update ED test mods and add ED tests to clm test suite
      components/clm/cime_config/testdefs/testmods_dirs/clm/edTest/user_nl_clm
      components/clm/cime_config/testdefs/testlist_clm.xml

    clm-ed interaction
      components/clm/src/main/clm_varpar.F90 - ed compatibility with century decomp
      components/clm/src/main/subgridWeightsMod.F90 - ed bugfix with pft diags
      components/clm/src/main/decompInitMod.F90 - cohorts aligned with columns
      components/clm/src/main/clm_initializeMod.F90 - use ed interfaces, ed as bgc mode
      components/clm/src/main/subgridMod.F90 - ed subgrid info updated
      components/clm/src/main/ColumnType.F90 - whitespace
      components/clm/src/main/histFileMod.F90 - ed specific output
      components/clm/src/main/clm_driver.F90 - call ed interfaces
      components/clm/src/main/initGridCellsMod.F90 - ed cohorts align with columns
      components/clm/src/main/initVerticalMod.F90 - ed levels
      components/clm/src/main/surfrdMod.F90 - bug work around, ed related?
      components/clm/src/main/clm_instMod.F90 - use ed interfaces, ed as bgc mode
      components/clm/src/main/readParamsMod.F90 - ed as bgc mode
      components/clm/src/biogeochem/CNCStateUpdate1Mod.F90 - add ed to literfall
      components/clm/src/biogeochem/CNVegetationFacade.F90 - ed requires veg data structures for subsurface bgc
      components/clm/src/biogeochem/CNDriverMod.F90 - remove canopy state
      components/clm/src/biogeophys/BalanceCheckMod.F90 - loosen tolerances, don't endrun if error.
      components/clm/src/biogeophys/TemperatureType.F90 - remove ed_gdd0
      components/clm/src/biogeophys/LunaMod.F90 - remove ed variables
      components/clm/src/biogeophys/PhotosynthesisMod.F90 - remove ed variables
      components/clm/src/biogeophys/CanopyFluxesMod.F90 - interface to get ed canopy fluxes
      components/clm/src/biogeophys/SurfaceRadiationMod.F90 - remove ed code
      components/clm/src/biogeophys/CanopyStateType.F90 - remove gccanopy_patch
      components/clm/src/biogeophys/SurfaceAlbedoMod.F90 - call ED routine through interface
      components/clm/src/biogeophys/HydrologyNoDrainageMod.F90 - ed needs hydrology parameters
      components/clm/src/soilbiogeochem/SoilBiogeochemCarbonFluxType.F90 - fates c litr fluxes
      components/clm/src/soilbiogeochem/SoilBiogeochemCarbonStateType.F90 - don't do some liter pools if ed on.

    ed as bgc mode, work with subsurface bgc
      components/clm/src/soilbiogeochem/SoilBiogeochemDecompCascadeBGCMod.F90
      components/clm/src/soilbiogeochem/SoilBiogeochemPrecisionControlMod.F90
      components/clm/src/soilbiogeochem/SoilBiogeochemDecompCascadeCNMod.F90
      components/clm/src/soilbiogeochem/SoilBiogeochemPotentialMod.F90
      components/clm/src/soilbiogeochem/SoilBiogeochemLittVertTranspMod.F90
      components/clm/src/soilbiogeochem/SoilBiogeochemDecompMod.F90

    ed refactoring for interfaces, science and software big fixes
      components/clm/src/ED/biogeochem/EDCanopyStructureMod.F90
      components/clm/src/ED/biogeochem/EDGrowthFunctionsMod.F90
      components/clm/src/ED/biogeochem/EDCohortDynamicsMod.F90
      components/clm/src/ED/biogeochem/EDPhysiologyMod.F90
      components/clm/src/ED/biogeochem/EDPatchDynamicsMod.F90
      components/clm/src/ED/main/EDCLMLinkMod.F90
      components/clm/src/ED/main/EDVecCohortType.F90
      components/clm/src/ED/main/EDRestVectorMod.F90
      components/clm/src/ED/main/EDPftvarcon.F90
      components/clm/src/ED/main/EDInitMod.F90
      components/clm/src/ED/main/EDParamsMod.F90
      components/clm/src/ED/main/EDMainMod.F90
      components/clm/src/ED/main/EDTypesMod.F90
      components/clm/src/ED/main/CMakeLists.txt
      components/clm/src/ED/fire/SFMainMod.F90
      components/clm/src/ED/biogeophys/EDAccumulateFluxesMod.F90
      components/clm/src/ED/biogeophys/EDSurfaceAlbedoMod.F90
      components/clm/src/ED/biogeophys/EDPhotosynthesisMod.F90
      components/clm/src/ED/biogeophys/EDBtranMod.F90

===============================================================
===============================================================
Tag name:  clm4_5_12_r191
Originator(s):  sacks (Bill Sacks)
Date: Sun Aug 21 06:18:04 MDT 2016
One-line Summary: New parameterizations for snow overburden compaction and wind drift compaction

Purpose of changes
------------------

   Introduces new parameterizations for snow overburden compaction and wind
   drift compaction. By default, CLM45 uses the old snow overburden compaction
   formula and no wind drift compaction, whereas CLM5 uses the new
   parameterizations.

   Also changes the CLM50 default for the snow compaction parameter
   upplim_destruct_metamorph

   Scientific changes are from Leo van Kampenhout (l.vankampenhout@uu.nl)


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables):
   New namelist option: snow_overburden_compaction_method

Changes made to namelist defaults (e.g., changed parameter values):
   - Changed clm5_0 default for upplim_destruct_metamorph
   - upplim_destruct_metamorph appears in namelist for clm4_5 as well as clm5_0
   - upplim_destruct_metamorph default changed for clm5_0 (175 rather than 150)
   - overburden_compress_tfactor appears in namelist for clm4_5; does not appear
     when using the new Vionnet2012 snow overburden compaction method (so does
     not appear by default with clm5_0); no longer has a different default value
     for clm5_0 (since it doesn't appear by default in clm5_0)

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

   The new parameterizations are more complex, so have a moderate (~ 20%) impact
   on SnowCompaction timing, but this is a very small part of the overall CLM
   run time. The timing impacts of extracting routines to compute some of
   the snow compaction terms were minimal (only increased the SnowCompaction
   time by a few percent).

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing: none

Code reviewed by: self; Dave Lawrence also reviewed Leo's initial implementation

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - ok

      tests pass; differences from baseline for CLM45 and CLM50 as expected

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

    ok means tests pass (or xfail); differences from baseline for CLM50 as expected

CLM tag used for the baseline comparisons: clm4_5_12_r190


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM50
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 

      Larger than roundoff; I haven't investigated this closely, but suspect
      these changes result in new climate, at least regionally

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated:

========= Remove unit tests for a function that has been removed
D       components/clm/src/biogeophys/test/SnowHydrology_test/test_SnowHydrology_windCompactionFactor.pf

List all files added and what they do:

List all existing files that have been modified, and describe the changes:

========= Main changes, as described above
M       components/clm/src/biogeophys/SnowHydrologyMod.F90

========= (a) Add namelist option controlling which snow overburden compaction
          method to use; (b) make upplim_destruct_metamorph appear in the
          namelist for clm4_5 as well as clm5_0; (c) change default value for
          upplim_destruct_metamorph; (d) remove clm5_0 default for
          overburden_compress_tfactor (because it is not used by default in
          clm5_0), and make sure this namelist item appears with clm4_5 but
          doesn't appear when using the new Vionnet2012 snow overburden
          compaction method
M       components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml
M       components/clm/bld/namelist_files/namelist_definition_clm4_5.xml
M       components/clm/bld/CLMBuildNamelist.pm

========= Unrelated change: Remove spaces from timer names for easier automated
          processing of timing output (requested by Sean Santos)
M       components/clm/src/main/clm_driver.F90

========= Unrelated changes: Add more informative error messages
M       components/clm/src/main/atm2lndMod.F90
M       components/clm/src/main/restFileMod.F90

========= Remove unit tests for a function that has been removed
M       components/clm/src/biogeophys/test/SnowHydrology_test/CMakeLists.txt

===============================================================
===============================================================
Tag name:  clm4_5_12_r190
Originator(s):  sacks (Bill Sacks)
Date: Sat Aug 20 05:53:49 MDT 2016
One-line Summary: Fix snow capping bug

Purpose of changes
------------------

   When snow capping was triggered, the bottom snow layer was decreased in mass,
   but dz remained unchanged, leading to problematic changes in density. This
   tag fixes that problem, so that dz is decreased appropriately.

   These changes are from Leo van Kampenhout (l.vankampenhout@uu.nl)


Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID): 2343 (new snow capping scheme does not conserve density)

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing:
   Changed
   ERP_P15x2_Lm36.f10_f10.ICRUCLM50BGCCROP.yellowstone_intel.clm-cropMonth_interp
   to
   ERP_P30x2_Lm36.f10_f10.ICRUCLM50BGCCROP.yellowstone_intel.clm-cropMonth_interp
   so that it could reliably finish within 2 hours.

Code reviewed by: self

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - pass

    ok means tests pass, some baseline comparisons fail as expected

CLM tag used for the baseline comparisons: clm4_5_11_r189


Answer changes
--------------

Changes answers relative to baseline:

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: potentially all clm45 / clm50
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 

      Larger than roundoff. I have not investigated the size of the change,
      suspect it is the same climate with respect to land-atmosphere fluxes, but
      potentially different climate with respect to snow pack properties and SMB
      sent to CISM. (This changes the density of the bottom layer of deep snow
      packs.)

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? n/a

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: n/a

   URL for LMWG diagnostics output used to validate new climate: n/a
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Main changes
M       components/clm/src/biogeophys/SnowHydrologyMod.F90

========= Change a test, as noted above
M       components/clm/cime_config/testdefs/testlist_clm.xml

===============================================================
===============================================================
Tag name:  clm4_5_11_r189
Originator(s):  erik (Erik Kluzek)
Date: Thu Aug 18 14:52:36 MDT 2016
One-line Summary: Bring in time varying streams for urban data (currently triggers AC use)

Purpose of changes
------------------

Instead of reading in maximum building temperature from surface dataset, read it in from
a time-varying urban streams file. This allows the urban Air Conditioning use to change
in time as well as spatially. Other spatially and temporally changing parameters can be added
(or moved from the surface dataset) to this stream file as well in the future. The new streams
file has the same kind of controls as other streams file for years to run over, filename, and
mapping algorithm. The time interpolation is assumed to be linear, and it uses taxmode=extend
so it will use the first value before the first year and the last value after the last year.
The current dataset is at one degree resolution (f09_g16). Because of this CLM45 compsets
will change answers to some extent (because interpolation methods for streams are slightly
different) -- but answers will be very similar. CLM50 compsets will change because there is
variation in the max building temperature both spatially and temporally.

Also fix a problem with the humanstress module for GSWP3 forcing because of temperatures that
are too high for the WetBulb method to converge. WetBulb previously only allowed two iterations
and now it allows more (10,000). If the method fails to converge it will exit with a warning.
This was worked on by Jonathan Buzan with Keith Oleson.

Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID):
   2348 PTCLMmkdata not able to run for clm5_0
   2305 Nan for wet bulb temperature

Known bugs introduced in this tag (include bugzilla ID): 
   2346 Unnecessary arguments to WetBulb subroutine (WONTFIX)


Notes of particular relevance for users
---------------------------------------

Caveats for users: No longer reads t_building_max from surface dataset
   reads it in from the urban time-varying streams

Changes to CLM's user interface: New namelist variables
    Add: stream_year_first_urbantv, stream_year_last_urbantv
         model_year_align_urbantv, stream_fldfilename_urbantv, urbantvmapalgo

Changes made to namelist defaults: None

Changes to the datasets: new urban time-varying streams datasets

Substantial timing or memory changes: None

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers: None

Changes to tests or testing: None

Code reviewed by: self, oleson

CLM testing: regular

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - OK (all tests PASS and 64 compare tests are different because of namelist changes)

  unit-tests (components/clm/src):

    yellowstone - PASS

  tools-tests (components/clm/test/tools):

    yellowstone - PASS

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - OK

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - OK
    yellowstone_pgi - OK
    yellowstone_gnu (clm45 only) - OK
    hobart_nag - PASS

CLM tag used for the baseline comparisons:  clm4_5_11_r188


Answer changes
--------------

Changes answers relative to baseline: Yes!

  Summarize any changes to answers, i.e.,
    - what code configurations: clm4_5 (to a minor degree) and clm5_0 with urban
    - what platforms/compilers: All
    - nature of change: same climate

  CLM45 answers with urban areas may change to a minor degree because of the use of
  the urban time varying stream file to get the max indoor building temperature rather
  than reading from the surface dataset. Shorter tests are fairly close and some may be
  identical (all CLM45 single point cases are identical). Tests of a month or longer likely
  diverge.

  Five of the 22 CLM45 and CLM45BGC tests with f10_f10 on hobart are different, others are the same.
  Half of the 46 CLM45 CLM45 tests with f10_f10 on yellowstone are the same.

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): PTCLM
    update PTCLM to PTCLM2_160818

List all files eliminated: None

List all files added and what they do: Object to handle time-varying urban data

   A components/clm/src/biogeophys/UrbanTimeVarType.F90 -- Read max building temperature from urban time-varying stream
        for three urban classes (Tall Building Disctrict-TBD, High Density-HD, and Medium Density-MD) add TBUILD_MAX as 
        possible output to history

List all existing files that have been modified, and describe the changes:

   M components/clm/src/main/clm_instMod.F90 -- Setup urbantv_type and initialize it
   M components/clm/src/main/clm_driver.F90 --- Interpolate urban-time-varying data and pass it down

   M components/clm/src/biogeophys/HumanIndexMod.F90 ------------- Remove duplicated wbt_ref2m_u_patch,
         output urban stull wet bulb temp, new convergence routine for Wet-Bulb (increase max iterations
         from 2 to 10000)
   M components/clm/src/biogeophys/SoilTemperatureMod.F90 -------- Pass urbantv down, get t_building_max from it
   M components/clm/src/biogeophys/UrbBuildTempOleson2015Mod.F90 - Pass urbantv down, get t_building_max from it
   M components/clm/src/biogeophys/UrbanParamsType.F90 ----------- Remove t_building_max and no longer read
         T_BUILDING_MAX from surface dataset
   M components/clm/src/biogeophys/test/HumanStress_test/test_humanstress.pf -- Test new WetBulb subroutine

         Add in stream_year_ first/last/align for urbantv for clm5_0
   M components/clm/bld/namelist_files/use_cases/1850-2100_rcp8.5_glacierMEC_transient.xml
   M components/clm/bld/namelist_files/use_cases/2000_control.xml
   M components/clm/bld/namelist_files/use_cases/20thC_glacierMEC_transient.xml
   M components/clm/bld/namelist_files/use_cases/2000-2100_rcp8.5_transient.xml
   M components/clm/bld/namelist_files/use_cases/2000_glacierMEC_control.xml
   M components/clm/bld/namelist_files/use_cases/1850_control.xml
   M components/clm/bld/namelist_files/use_cases/1850-2100_rcp2.6_transient.xml
   M components/clm/bld/namelist_files/use_cases/1850-2100_rcp6_transient.xml
   M components/clm/bld/namelist_files/use_cases/1850-2100_rcp4.5_transient.xml
   M components/clm/bld/namelist_files/use_cases/1850-2100_rcp8.5_transient.xml
   M components/clm/bld/namelist_files/use_cases/20thC_transient.xml
   M components/clm/bld/namelist_files/use_cases/1850_glacierMEC_control.xml
   M components/clm/bld/namelist_files/use_cases/1850-2100_rcp2.6_glacierMEC_transient.xml
   M components/clm/bld/namelist_files/use_cases/1850-2100_rcp6_glacierMEC_transient.xml
   M components/clm/bld/namelist_files/use_cases/1850-2100_rcp4.5_glacierMEC_transient.xml

   M components/clm/bld/namelist_files/namelist_definition_clm4_5.xml -  Add: stream_year_first_urbantv, stream_year_last_urbantv
         model_year_align_urbantv, stream_fldfilename_urbantv, urbantvmapalgo
   M components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml ---  Defaults for above list.
         clm4_5 has first, last and align set to 2000 whereas clm5_0 sets it appropriatly by sim_year and sim_year_range
         there is also a CLM45 urbantv streams file that approximates the previous method of reading from the surface dataset
         the urbantv streams files are at 0.9x1.25 resolution

   M components/clm/bld/CLMBuildNamelist.pm - Add setup_logic_urbantv_streams, call it and add urbantv_streams namelist

       Remove T_BUILDING_MAX from clm45/clm50 surface datasets
   M components/clm/test/tools/test_driver.sh --- Make CLM_SOFF default FALSE
   M components/clm/test/tools/README ----------- Show example usage on yellowstone and update note about CLM_SOFF
   M components/clm/tools/clm4_5/mksurfdata_map/src/mkfileMod.F90 ----- Don't write T_BUILDING_MAX
   M components/clm/tools/clm4_5/mksurfdata_map/src/mkurbanparMod.F90 - Remove T_BUILDING_MAX as urban parameter
   M components/clm/tools/clm4_5/mksurfdata_map/mksurfdata.pl --------- Remove T_BUILDING_MAX from copy for urban single point datasets

===============================================================
===============================================================
Tag name:  clm4_5_11_r188
Originator(s):  erik (Erik Kluzek)
Date: Fri Aug  5 13:53:01 MDT 2016
One-line Summary: A set of small answer changing issues for both clm45 and clm50

Purpose of changes
------------------

Changes to CLM45 and CLM50:

Some adjustments to methane output (for both CLM45BGC) and CLM50BGC from Xiyan Xu. This calculates 
finundated from before snow, and rather than multiplying m_tiller by LAI it multiples by a constant four.

Update Li2014 FireFluxes subroutine for spinupstate=2 capability (so can be shared). Changes to
roundoff, while also allowing spinupstate==2 and fixing bug 2243 to deal with deadstem for CLM45 
from Charlie Koven.

Carbon and Nitrogen state missing accounting of of live to dead from fire in StateUpdate3.

Nitrogen uptake code error from Xiaojuan Yang and Charlie Koven. This is dependent on use_nitrif_denitrif=T
so will only affect CLM45BGC/CLM50BGC, but not SP or CN alone simualtions. This is for the 2nd pass at 
Nitrogen uptake.

Issue with carbon Isotopes. Brett Raczka and Henrique Duarte at Univ. Utah have identified a bug in the 
CLM4.5 C isotope code, in which isotope ratios are not stabilizing when fire turns on.  Turning off the 
fire code produces reasonable isotope ratios.  We've identified that the problem is that the variables 
for the fire fluxes associated with the new fire code were never copied over into CNCIsoFluxMod.F90. Fix
from Charlie Koven, and Brett verified it worked in his version. Also update the C14 half-life value. Used
to be the Libbey value, now use the updated one.

Changes to CLM50 only:

Remove discontiniues in new CLM50 snow density. Also if wind is zero (< 0.1m/s), wind_dependent_snowdensity
is increase is also zero. Some changes to fire injection height for fire-emissions from Simone Tilmes, and a unit-conversion
error fix from Fang Li.

Summary:

ciso errors bug 2116 (isotopes both clm45/clm5)
Bug 2224 N uptake code clm45/clm50BGC
Transfer of live to dead bug 2264 clm45/clm5)
2326 for shade part clm5
snow density discontinuities (2328) clm5
Methane change on mechanges branch clm45/clm5 2338
2340 Fire emission change from Simone clm5
Units conversion error in CNfire-emissions bug 2342 clm5

Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID):

2116  C isotope (13C and 14C) errors in fire code
2141  Precision of constants in SoilTemperature.F90 is not double
2224  plant N uptake second pass error 
2243  Deadstem not taken into account in fire-fluxes for clm4_5 (koven) (FOR CLM45 SIDE)
2264  Fire is missing accounting of C/N for transfer of live to dead
2326  Bad multiplication of btran for soybean or nbrdlf_dcd_tmp_shrub with CNDV in CanopyFluxes
2328  Discontinuities in new CLM50 snow density formulation
2338  Use the pre-snow values to calculate finundated, and use constant for m_tiller rather than elai
2340  Adjustments to fire-emission from Simone Tilmes
2342  Units conversion error in CNfire-emissions

Known bugs introduced in this tag (include bugzilla ID): 

2332  fire_emiss tests don't work (cime issue)

Notes of particular relevance for users
---------------------------------------

Caveats for users: None

Changes to CLM's user interface: None

Changes made to namelist defaults: None

Changes to the datasets: None

Substantial timing or memory changes: None

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers:  None

Changes to tests or testing: None

Code reviewed by: self,fangli,slater,stilmes,koven

CLM testing: regular

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - PASS

  unit-tests (components/clm/src):

    yellowstone - PASS

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - OK
    yellowstone_pgi - OK
    yellowstone_gnu (clm45 only) - OK
    hobart_nag - PASS

CLM tag used for the baseline comparisons:  clm4_5_10_r187


Answer changes
--------------

Changes answers relative to baseline:   Yes! for clm4_5 and clm5_0

  Summarize any changes to answers, i.e.,
    - what code configurations: clm4_5 BGC and CN compsets and Carbon isotopes 
                                clm5_0 all (BGC, CN, SP)
                                any fire-emission
    - what platforms/compilers: All
    - nature of change: similar climate

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): cime
   Add changes to cime branch tag to be able to run on hobart

   cime to clm4_5_11_r188_cime4.5.14

List all files eliminated: None

List all files added and what they do: Add unit tests for new snow bulk density

   M components/clm/src/biogeophys/test/SnowHydrology_test/test_SnowHydrology_newSnowBulkDensity.pf

List all existing files that have been modified, and describe the changes:

   M components/clm/src/biogeochem/CNNStateUpdate3Mod.F90 - Subtract live to dead from fire Nitrogen for 
        live/dead and stem/root (both CLM45CN/BGC and CLM50CN/BGC)
   M components/clm/src/biogeochem/CNC14DecayMod.F90 ------ Adjust C14 half-life from Libby 5568 to 5730 a
       more recent value used (this affects both clm45 and clm50 when use_c14 is on)
   M components/clm/src/biogeochem/ch4Mod.F90 ------------- Calculate finundated from before snowfall, and don't multiply
        m_tiller by LAI, but by 4.0.
   M components/clm/src/biogeochem/CNCStateUpdate3Mod.F90 - Subtract live to dead from fire Nitrogen for 
        live/dead and stem/root (both CLM45CN/BGC and CLM50CN/BGC)
   M components/clm/src/biogeochem/CNCIsoFluxMod.F90 ------ Missing isotope flux calculations (changes for CLM45/50 with c13/c14)
   M components/clm/src/biogeochem/CNFireEmissionsMod.F90 - Changes from Simone Tilmes adjusting the fire
        injection heights for different PFTS and also use indices rather than hard-coded magic integers
   M components/clm/src/biogeochem/CNFireLi2014Mod.F90 ---- Use same version of FireFluxes as in Li2016, 
        so can use spinup_state==2 and apply a previous bug-fix (). Outside of that answers are roundoff
        different. And this allows the base version of the subroutine to be used for both Li2014 and Li2016
        to reduce code duplication.

   M components/clm/src/biogeophys/CanopyFluxesMod.F90 ---- Remove 2nd adjustment to btran for soybean 
        and nbrdlf_dcd_tmp_shrub for CNDV (both clm45crop/cndv and clm50crop/cndv)
   M components/clm/src/biogeophys/SnowHydrologyMod.F90 --- Make new snow bulk density continuous (only CLM50)
        add unit-test function: SnowHydrologySetControlForTesting. Apply new wind dependent density increase
        only for wind > 0.1m/sec (so no density increase at zero wind)

   M components/clm/src/soilbiogeochem/SoilBiogeochemCompetitionMod.F90 --- Bug 2224

   M components/clm/src/biogeophys/test/SnowHydrology_test/CMakeLists.txt - add tests for snow density

===============================================================
===============================================================
Tag name:  clm4_5_10_r187
Originator(s):  erik (Erik Kluzek)
Date: Tue Jul 26 21:45:51 MDT 2016
One-line Summary: Some CLM45/50 changes: seperate carbon and water root profile, turn off undercanopystability, 
                  really turn PHS on, LUNA predict sunlit fraction N fractionation

Purpose of changes
------------------

   Seperate the carbon and water fine root profiles and have namelist control over them. This removes the duplicated
   code in soilbiogeochem that replicated the Jackson-1996 profile. Also remove several soilbiogeochem specific namelist
   control items over the root profile.

   CLM50 changes: 
        Change water fine root profile to Jackson-1996 with rootprof_beta adjusted for water (dlawren)
        Turn off under canopy stability term that decreases csoilc by Sakaguchi&Zeng, 2008 (swensosc)
        When fun on -- add cpool_to_leafc to leafc_to_litter and cpool_to_frootc to frootc_to_litter (rfisher)
        Really turn Plant Hydrallic Stress on (erik)
        Have LUNA predict the scaling of Vcmax/Jmax/tpu-25 for canopy sunlight/shaded average in Photosynthesis (rfisher)

   CLM45 changes:  Water fine root profile was used rather than carbon profile (used in soilbiogeochem) in CNMResp and in ch4Mod
     The profile used was zeng_2001, it's now Jackson_1996. You can duplicate the old answers if you use zeng-2001 for CNMResp
     and ch4Mod, but Jackson-1996 for soilbiogeochem.


Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID): 2337, 2334, 2331, 2311
   2337 Methane and maintenance respiration using water root profile rather than carbon root profile
   2334	Plant hydraulic stress not turned on by default in clm4_5_9_r184
   2331 many build-namelist tests fail when comparing a tag against itself
   2311 Move mbbopt to params file

Known bugs introduced in this tag (include bugzilla ID): 2339
   2339 croofr and rootfr profiles are time constant but default output to history


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): None

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): Namelist items added and removed
        Add: rooting_profile_method_water, rooting_profile_method_carbon, rooting_profile_varindex_water,
             rooting_profile_varindex_carbon, and use_undercanopy_stability
        Remove: pftspecific_rootingprofile, exponential_rooting_profile, and rootprof_exp

Changes made to namelist defaults (e.g., changed parameter values):
        set: rooting_profile_method_carbon = Jackson1996 (both clm50 and clm45)
             rooting_profile_method_water  = Zeng_2001 (clm45), Jackson1996 (clm50)
             use_undercanopy_stability     = .true. (clm45),   .false. (clm50)

Changes to the datasets (e.g., parameter, surface or initial files):
   New params files (with 2D rootprof_beta)

Substantial timing or memory changes: None

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): None

Changes to tests or testing: tests with dynroots need to explicitly turn PHS off

Code reviewed by: self, dlawren, rfisher

CLM testing: regular

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - OK (83 compare tests FAIL, because of namelist changes)

  unit-tests (components/clm/src):

    yellowstone - PASS

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel -  OK
    yellowstone_pgi -  OK
    yellowstone_gnu (clm45 only) -  OK
    hobart_nag - PASS

CLM tag used for the baseline comparisons:  clm4_5_9_r186


Answer changes
--------------

Changes answers relative to baseline: CLM45BGC and all CLM50

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM45BGC and all CLM50 compsets
    - what platforms/compilers: All
    - nature of change: CLM45 
         CLM50 

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: rfisher    respmods_n31_clm4_5_9_r185_00

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): None

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

   M components/clm/bld/unit_testers/NMLTest/CompFiles.pm --- Fix bug comparison to same version (2331)

   M components/clm/bld/namelist_files/namelist_definition_clm4_5.xml -- Remove: rooting_profile_method
        Add: rooting_profile_method_water, rooting_profile_method_carbon, rooting_profile_varindex_water,
             rooting_profile_varindex_carbon, and use_undercanopy_stability
        Remove: pftspecific_rootingprofile, exponential_rooting_profile, and rootprof_exp     
   M components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml -- new param files, 
        set: rooting_profile_method_carbon, rooting_profile_method_water, and use_undercanopy_stability
   M components/clm/bld/namelist_files/namelist_defaults_drydep.xml -- Update to use 79 PFT megan factors file

   M components/clm/cime_config/testdefs/testmods_dirs/clm/clm50dynroots/user_nl_clm --- add use_hydrstress = .false.
   M components/clm/cime_config/testdefs/testmods_dirs/clm/cropMonthOutput/user_nl_clm - add use_hydrstress = .false.

   M components/clm/bld/CLMBuildNamelist.pm --- Pass use_ed to use_hydrstress default (2334), add setup_logic_canopyfluxes
       namelist, change rooting_profile_method to rooting_profile_method_water/carbon, canopyfluxes_inparm namelist group.

   M components/clm/src/biogeochem/CNMRespMod.F90 ------ Use carbon fine root profile (crootfr_patch) rather than water profile (2337)
   M components/clm/src/biogeochem/CNFUNMod.F90 -------- Use carbon fine root profile (crootfr_patch) rather than water profile
   M components/clm/src/biogeochem/CNDriverMod.F90 ----- Use carbon fine root profile (crootfr_patch) rather than water profile
   M components/clm/src/biogeochem/ch4Mod.F90 ---------- Use carbon fine root profile (crootfr_patch) rather than water profile (2337)
   M components/clm/src/biogeochem/CNPhenologyMod.F90 -- When fun on -- add cpool_to_leafc to leafc_to_litter and
        cpool_to_frootc to frootc_to_litter from Rosie Fisher
   M components/clm/src/biogeochem/VOCEmissionMod.F90 -- Have factors handle new PFT size
   M components/clm/src/biogeochem/MEGANFactorsMod.F90 - Read mxpft PFT's from emissions file, check that number PFT's is as expected
   M components/clm/src/main/controlMod.F90 ------------ Remove exponential_rooting_profile, rootprof_exp, surfprof_exp, pftspecific_rootingprofile
        Add CanopyFluxesReadNML call
   M components/clm/src/main/pftconMod.F90 ------------- rootprof_beta is 2D with nvariants as 2nd dimension
   M components/clm/src/main/clm_varpar.F90 ------------ Add nvariants=2 for variants of PFT constants
   M components/clm/src/biogeophys/LunaMod.F90 --------- Make LUNA predict sunlit fraction N fractionation, scale in PhotosynthesisMod
   M components/clm/src/biogeophys/PhotosynthesisMod.F90 --------- Implement scaling of Vcmax/Jmax/tpu/25 from sunlit average to shaded canopy 
         average value (both PHS and non-PHS versions), read mbbopt from params file in PHS section (2311)
   M components/clm/src/biogeophys/SoilStateType.F90 ------------- Add crootfr_patch for carbon and initialize. rootfr_patch is for water
         write out crootfr and rootfr to history (this should be cleaned up to be only for first history file as it's an unchanging
         constant profile)
   M components/clm/src/biogeophys/CanopyFluxesMod.F90 ----------- Add CanopyFluxesReadNML with canopyfluxes_inparm namelist
         and set use_undercanopy_stability in it, decrease csoilc as in in Sakaguchi&Zeng, 2008 if on
   M components/clm/src/biogeophys/SoilStateInitTimeConstMod.F90 - Initialize crootfr
   M components/clm/src/biogeophys/RootBiophysMod.F90 ------------ Add water and carbon versions of rooting_profile_method
        and add water and carbon rooting_profile_varindx for variant index of rootprof_beta to use from params file, make
        m_to_cm and beta double precision, pass 'water' or 'carbon' to init_vegrootfr, varindx for carbon is 2 and 1 for water.
       default rooting method is zen_2001 for water and jackson_1996 for carbon.
   M components/clm/src/biogeophys/SurfaceRadiationMod.F90 ------- Remove unused single precision reals
   M components/clm/src/soilbiogeochem/SoilBiogeochemVerticalProfileMod.F90 - Use crootfr_patch to set cinput_rootfr, remove
      version of jackson_1996 carbon root profile that was in here. Also remove: exponential_rooting_profile, pftspecific_rootingprofile,
      and rootprof_exp

===============================================================
===============================================================
Tag name:  clm4_5_9_r186
Originator(s):  sacks (Bill Sacks)
Date: Wed Jul 13 07:17:04 MDT 2016
One-line Summary: Initialize biogeochem balance checks AFTER column area updates

Purpose of changes
------------------

Reworking the conservation of patch-level CN variables with dynamic landunits
will make the column-level CN balance checks very tricky to determine, as they
were written before - where the starting point for the comparison was determined
before all of the area adjustments (i.e., the dyn subgrid stuff). This becomes
much more straightforward if the initialization of the balance checks is done
after the dyn subgrid stuff is complete. This tag makes that change.

In order to accomplish that, we need to re-compute the CN state summaries after
the dyn subgrid stuff is complete - near the beginning of the time step. We
still need the summary routine at the end of the time step for the sake of
diagnostics (e.g., history output). So now we call the summary routines twice
for states. We do NOT need to call the flux summary routines at the beginning of
the time step - and doing so doesn't really make sense (how do you summarize
fluxes that haven't yet been computed) - so I have split the top-level summary
routine into a SummarizeStates and SummarizeFluxes.

I also reworked the ch4 balance check similarly, in order to be consistent with
the CN balance checks.

Longer-term, we'll add another set of balance checks that operate on
gridcell-level quantities, which WILL cover the dyn subgrid stuff. So the
overall sequence will look like:

   Initialize gridcell-level balance checks
   Dyn subgrid stuff (adjust patch, column, landunit areas, and do associated
      state updates)
   Initialize column-level balance checks
   Science routines
   Check column-level balance
   Check gridcell-level balance



Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance): none

Changes to tests or testing: none

Code reviewed by: self

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

ok means tests pass, some answers change as noted below

CLM tag used for the baseline comparisons: clm4_5_9_r185


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM45/CLM50 runs with BGC that involve changes
      in subgrid areas (including HIST, RCP, DV and IG cases)
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      Not investigated closely; expected to be larger than roundoff / same climate

      Answer changes come from the fact that some code (e.g., the fire code)
      uses the summarized state variables. Previously, this code was using the
      state summaries from the previous time step. With this change, the code is
      now using the updated state summaries. These updated state summaries can
      differ from the ones computed at the end of the last time step if subgrid
      areas have changed.

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Move initialization of CN and ch4 balance checks to AFTER dyn subgrid
M       components/clm/src/main/clm_driver.F90
M       components/clm/src/biogeochem/CNVegetationFacade.F90

========= Split the CNDriverSummary into separate SummarizeStates and
          SummarizeFluxes: Only SummarizeStates needs to be done near the start
          of the time step. Also move calls to PrecisionControl to a higher
          level, since these aren't needed in the initial call to
          SummarizeStates.
M       components/clm/src/biogeochem/CNDriverMod.F90

========= Change which terms (from transient landcover) are included in the
          balance checks, due to new placement in the driver sequence
M       components/clm/src/biogeochem/CNBalanceCheckMod.F90
M       components/clm/src/biogeochem/CNVegCarbonFluxType.F90
M       components/clm/src/biogeochem/CNVegNitrogenFluxType.F90
M       components/clm/src/biogeochem/dynConsBiogeochemMod.F90

========= Rework timing of ch4 balance check initialization, too, for
          consistency
M       components/clm/src/biogeochem/ch4Mod.F90

========= Remove some variables from Restart, now that we call the Summary
          routines early in the time step. Also no longer update summary
          diagnostic variables in DynamicPatchAdjustments
M       components/clm/src/soilbiogeochem/SoilBiogeochemCarbonStateType.F90
M       components/clm/src/soilbiogeochem/SoilBiogeochemNitrogenStateType.F90
M       components/clm/src/biogeochem/CNVegNitrogenStateType.F90
M       components/clm/src/biogeochem/CNVegCarbonStateType.F90

========= No longer need to do p2c of totvegc in fire code: this is done in the
          initial call to the summary routines
M       components/clm/src/biogeochem/CNFireLi2014Mod.F90
M       components/clm/src/biogeochem/CNFireLi2016Mod.F90
M       components/clm/src/biogeochem/CNFireNoFireMod.F90

========= Replace __FILE__ with filename parameter to avoid too-long lines with pgi
M       components/clm/src/soilbiogeochem/SoilBiogeochemNitrifDenitrifMod.F90

========= Remove
          SMS_Lm25.f19_g16.ICLM45BGCCROP.yellowstone_gnu.clm-cropMonthOutput:
          baseline comparisons have been passing for me recently
M       components/clm/cime_config/testdefs/ExpectedTestFails.xml

===============================================================
===============================================================
Tag name:  clm4_5_9_r185
Originator(s):  sacks (Bill Sacks)
Date:  Thu Jul  7 13:54:09 MDT 2016
One-line Summary: Revert glacial melt behavior to the old treatment for mountain glaciers

Purpose of changes
------------------

The primary change in this tag is reverting glacial melt behavior to the old
scheme (i.e., the scheme used in standard glacier landunits) for mountain
glaciers: The old scheme involves glacial melt remaining in place until it
refreezes (thus, not generating any runoff), whereas the new scheme involves
glacial melt running off and being replaced by ice from below (generating
positive liquid runoff and negative ice runoff).

The main motivation for this change is that mountain glaciers were generating
substantial negative ice runoff in coupled cases when using the new scheme. This
is presumably because CAM's topographic height is significantly lower than the
real-world topographic height in mountainous regions, so mountain glaciers were
seeing too-warm temperatures. The LIWG, in consultation with members of the
LMWG, decided to revert mountain glaciers to their old behavior to avoid
detrimentally impacting a coupled simulation. Because the LIWG is not currently
concerned with the SMB of mountain glaciers - and because mountain glacier SMB
cannot be realistically simulated yet anyway - this reversion was not considered
a problem from their perspective.

To accomplish this, this tag introduces a new namelist variable,
glacier_region_melt_behavior. Like glacier_region_behavior, this keys off of the
GLACIER_REGION field on the surface dataset. Thus, different melt behavior can
be used for each glacier region. By default, Greenland and Antarctica use the
new (glc_mec) behavior ('replaced_by_ice'), whereas other regions use the old
behavior ('remains_in_place').

For glacier columns that use the 'remains_in_place' melt behavior, we do NOT
compute surface mass balance (SMB). This is because the negative component of
SMB is non-sensical in those columns. To make this clear, the QICE, QICE_FRZ and
QICE_MELT diagnostic fields are filled with missing values in the
'remains_in_place' region. (However, the qice fields sent to the coupler, along
with QICE_FORC, are 0 in that region - giving the values that are actually sent
to the coupler.)

Note that this means that different glacier regions now have different
physics. And, in order to compute SMB, you would need to change the melt
behavior, thus significantly changing the behavior of mountain glaciers.

This tag also refactors the code that computes glacier surface mass balance so
that this is centralized in one module: GlacierSurfaceMassBalanceMod.F90.

Other behavior changes in this tag are:

(1) The subgrid snow parameterization (subgrid topographic variability) now
    differentiates between 'single_at_atm_topo' istice_mec columns and other
    istice_mec columns. Previously, istice_mec columns were treated differently
    from others because they already have some representation of subgrid
    variability. However, 'single_at_atm_topo' columns should be treated more
    like other columns, because they do not allow for this elevation class
    variability; this has been fixed here.

(2) Vegetated SMB is computed for all grid cells where we compute glacier
    SMB. Previously vegetated SMB was only generated in the 'virtual' glacier
    region, but that added complexity to the code logic without having a good
    reason (as far as I can tell). This change just affects the lnd -> glc
    fields for elevation class 0 (changing where these are valid, rather than
    being set to 0): it does not affect the evolution of CLM.

(3) Adds some error checking for the glacier_region_behavior namelist item as
    well as for the new glacier_region_melt_behavior namelist item.

Between the primary change in this tag and the change in (1), it is now possible
to make the evolution of glacier_mec landunits exactly match the evolution of
standard glacier landunits - by using a glacier_region_behavior of
'single_at_atm_topo' and a glacier_region_melt_behavior of 'remains_in_place'.


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions):
- Surface mass balance (SMB) is no longer computed for mountain glaciers. In
  order to compute SMB, you would need to change the
  glacier_region_melt_behavior, which will change behavior significantly for
  mountain glaciers.

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables):
- New namelist variable, glacier_region_melt_behavior - as described above. This
  variable and glacier_region_behavior both appear in the default namelist for
  all clm45/clm50 cases, but only affect the operation of CLM if running with
  glc_mec (i.e., a case with CISM).

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers: none

Changes to tests or testing: none

Code reviewed by: self

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - ok (tests pass, expected differences from baseline; but see
    bug 2331)

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

  ok means tests pass, some answer changes as noted below

In addition, ran 100-year runs to confirm that glc_mec (istice_mec) landunits
can now be made to operate exactly the same as standard glacier (istice) with
the appropriate namelist settings:

  IG run: 1850_DATM%QIA_CLM50%BGC_SICE_SOCN_RTM_CISM1_SWAV
  I run: 1850_DATM%QIA_CLM50%BGC_SICE_SOCN_RTM_SGLC_SWAV

  For the IG run, put the following in user_nl_clm:

      glacier_region_behavior = 'single_at_atm_topo','single_at_atm_topo','single_at_atm_topo'
      glacier_region_melt_behavior = 'remains_in_place','remains_in_place','remains_in_place'

  and with the following sourceMods to allow running an IG compset with
  single_at_atm_topo & remains_in_place behavior over Greenland (because we
  currently cannot run with SGLC with glc_mec):

     --- ../../../components/clm/src/cpl/lnd_import_export.F90    2016-07-01 06:11:13.117799391 -0600
     +++ SourceMods/src.clm/lnd_import_export.F90    2016-07-04 09:58:37.130458468 -0600
     @@ -228,8 +228,8 @@
                   glc2lnd_inst%topo_grc(g,num)  = x2l(index_x2l_Sg_topo(num),i)
                   glc2lnd_inst%hflx_grc(g,num)  = x2l(index_x2l_Flgg_hflx(num),i)
                end do
     -          glc2lnd_inst%icemask_grc(g)  = x2l(index_x2l_Sg_icemask,i)
     -          glc2lnd_inst%icemask_coupled_fluxes_grc(g)  = x2l(index_x2l_Sg_icemask_coupled_fluxes,i)
     +          glc2lnd_inst%icemask_grc(g)  = 0._r8
     +          glc2lnd_inst%icemask_coupled_fluxes_grc(g)  = 0._r8
             end if

          end do

  Both run at T31_g37 for 100 years; compared last CLM and RTM history files;
  these were bit-for-bit except for expected differences in PCT_LANDUNIT

  Also ran similar sets of runs, but with all temperatures increased by 10 deg
  (along with setting initial glacier h2osno to 0) or decreased by 10 deg (along
  with setting initial glacier h2osno to 10000) to try to make sure we're
  exercising both glacier increases and decreases (though I didn't confirm that
  we're definitely exercising increases and decreases in those). Ran those hot &
  cold runs with both CLM50 and CLM45.

CLM tag used for the baseline comparisons: clm4_5_9_r184


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM45/CLM50 with glc_mec (i.e., compsets with CISM)
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      expected to be new climate, at least regionally - but not investigated closely

      Answers change over glaciers outside of Greenland and Antarctica (i.e.,
      mountain glaciers). In addition, fields sent to coupler are now present
      for elevation class 0 (bare ground) over Antarctica.

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): none

List all files eliminated: none

List all files added and what they do:

========= Consolidate code that computes glacier surface mass balance. This code
          was primarily taken from SoilTemperatureMod and HydrologyDrainageMod,
          with some other code also removed from BalanceCheckMod and
          clm_driver. Relevant fluxes have also been moved here (from
          WaterfluxType)
A       components/clm/src/biogeophys/GlacierSurfaceMassBalanceMod.F90

List all existing files that have been modified, and describe the changes:

========= Add new glacier_region_melt_behavior namelist item; always add
          glacier_region_behavior and glacier_region_melt_behavior to namelist,
          so error checks pass (these currently aren't needed in cases without
          CISM, but will always be needed soon, once glc_mec becomes the only
          glacier option - so it seemed reasonable to go ahead and always add
          them to the namelist)
M       components/clm/bld/CLMBuildNamelist.pm
M       components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml
M       components/clm/bld/namelist_files/namelist_definition_clm4_5.xml

========= Add differentiation on glacier_region_melt_behavior, add an
          'allow_multiple_columns_grc' flag that can be used elsewhere, improve
          error checking, and some other tweaks
M       components/clm/src/main/glcBehaviorMod.F90
M       components/clm/src/main/test/glcBehavior_test/test_glcBehavior.pf

========= Move code out, into new GlacierSurfaceMassBalanceMod
M       components/clm/src/biogeophys/BalanceCheckMod.F90
M       components/clm/src/biogeophys/HydrologyDrainageMod.F90
M       components/clm/src/biogeophys/SoilTemperatureMod.F90
M       components/clm/src/biogeophys/WaterfluxType.F90

========= Call new routines, move initialization to 0 out of clm_drv_init into
          new GlacierSurfaceMassBalanceMod
M       components/clm/src/main/clm_driver.F90

========= Change do_smb filter: (1) only includes points where
          melt_replaced_by_ice is true; (2) includes vegetated points for the
          same grid cells as glacier points, rather than using the
          has_virtual_columns mask
M       components/clm/src/main/filterMod.F90

========= For glc_mec columns: Subgrid topographic variability depends on
          whether a gridcell allows multiple elevation classes
M       components/clm/src/main/initVerticalMod.F90

========= Add new glacier_smb_inst, and pass it where needed
M       components/clm/src/main/clm_instMod.F90
M       components/clm/src/main/clm_initializeMod.F90
M       components/clm/src/main/lnd2glcMod.F90

========= Do some additional error checking
M       components/clm/src/main/glc2lndMod.F90

========= Build new code for unit tests
M       components/clm/src/biogeophys/CMakeLists.txt

========= Unrelated change: do necessary teardown
M       components/clm/src/dyn_subgrid/test/dynPatchStateUpdater_test/test_patch_state_updater.pf

========= Just remove unneeded use statements
M       components/clm/src/biogeochem/DUSTMod.F90
M       components/clm/src/biogeophys/EnergyFluxType.F90
M       components/clm/src/biogeophys/HydrologyNoDrainageMod.F90
M       components/clm/src/biogeophys/SnowHydrologyMod.F90
M       components/clm/src/main/atm2lndMod.F90
M       components/clm/src/main/histFileMod.F90

========= Remove a bunch of tests that no longer fail (due to changes in r184 or
          earlier) or have been removed from the test list; also change bug
          associated with one test
M       components/clm/cime_config/testdefs/ExpectedTestFails.xml

===============================================================
===============================================================
Tag name:  clm4_5_9_r184
Originator(s):  erik (Erik Kluzek)
Date: Wed Jul  6 14:55:45 MDT 2016
One-line Summary: CLM50 changes: Atkin form of lmr changed, new parameters and files, turn PHS on by default, new 
                  cold snow density, reseed at exit AD spinup, fix fire bug, fix npool and cpool errors

Purpose of changes
------------------

The CLM50 Atkin method of leaf maintenence respiration was changed by Dr. Rosie Fisher according to communication with Atkin.
New parameter file for CLM50 with new parameters. Plant Hydraulic Stress is now on by default for CLM50. New formulation
for snow density below -15C from Dr. Andrew Slater and Dr. David Lawrence. If plants are dead at the exit AD spinup stage, reseed.
Fix a fire bug which allowed negative nitrogen pools. Fix some npool and cpool errors.

Work on CNFUNMod, correct indentation, and headers and comments. Remove unused arrays. Initialize arrays in filter loops. Do
some changes to increase performance. Make logic for CNPrecisionControl into three subroutines, when especially negative abort.

 -- Changes from Rosie Fisher to remove leaf_acc term, and implement changes to the Atkin form of lmr25top based on personal communication
with Atkin.
 -- new params file
 -- Read in PHS parameters from PFT params file.
 -- CNPrecisionControl modularization
 -- new method for snow density and a change to how wind_dependent_snow_density is done for clm5.0. upplim_destruct_metamorph and
 -- overburden_compress_tfactor for clm5
 -- Put mbbopt on params file and use it
 -- removed deciduous retranslocation adjustment to plant_ndemand to fix cpool error
 -- Checkin Keith's changes to reseed Carbon for forests if in spinup mode and returning to regular mode, this should help in making it so
 -- that you can always use spunup initial conditions rather than always having to do a cold start
 -- Some FUN optimization.
 -- Set barriers, ATM_PIO_TYPENAME
 -- removed deciduous retranslocation adjustment to plant_ndemand to fix cpool error
 -- If leafn small set leaf-CN and storage_leaf-CN to missing value in NutrientCompetitionFlexibleCNMod
 -- add in free N flux direct to npool
 -- Move update of grainn_to_food side by side to grainc_to_food with the same equation, from Rosie and Keith (bug 2327)
 -- fire (bug 2314)
 -- soybean CNDV shrub (bug 2326)


Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID): 2255, 2314, 2326, 2327

   2327 Change location of where grainn_to_food is updated for CROP
   2326 Bad multiplication of btran for soybean or nbrdlf_dcd_tmp_shrub with CNDV in CanopyFluxes (partial see below)
   2314 Negative carbon pools due to issue in fire model
   2255 bug in soil resistance, likely causes crop soil resistance to remain unset

Known bugs introduced in this tag (include bugzilla ID): 2326, 2328, 2330
  2330 Issue with frootc/frootn for C4 crops
  2328 Discontinuities in new CLM50 snow density formulation
  The issue that created the need for bug 2326 was removed for both CLM45 and CLM50 in this tag
 (The same code was left in the CLM40 version)


Notes of particular relevance for users
---------------------------------------

Caveats for users: None

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables):
   New namelist items: ncrit, ccrit, nnegcrit, cnegcrit,
           baseflow_scalar, denitrif_respiration_coefficient/exponent (and nitrconc), lotmp_snowdensity_method,
           upplim_destruct_metamorph, overburden_compress_Tfactor, min_wind_snowcompact,  remove leaf_acc

Changes made to namelist defaults: Set new namelist items, update CLM50 params file

Changes to the datasets: CLM50 params file with updated parameters

Substantial timing or memory changes: CLM50BGC is a good bit faster

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers:  Now reading some mxpft dimensioned arrays in local readParams
   SnowHydrologyMod parameters should go into a params_type

Changes to tests or testing: None

Code reviewed by: self,oleson,rfisher,dlawren,aslater@cu.edu,lifang

CLM testing: regular

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - OK (78 compare tests FAIL because of namelist changes)

  unit-tests (components/clm/src):

    yellowstone - PASS

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - OK
    yellowstone_pgi -   OK
    yellowstone_gnu (clm45 only) - OK
    hobart_nag -  PASS

CLM tag used for the baseline comparisons:  clm4_5_9_r183


Answer changes
--------------

Changes answers relative to baseline: Yes for CLM50 and CLM45CROP

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM50 or CLM45CROP
    - what platforms/compilers: All
    - nature of change: 
        CLM50 ------ Modified climate
        CLM45CROP -- soybean results and grainn_to_food (all CFTS) will be different

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename:  rfisher: respmods_n30_clm4_5_8_r182_4x5_bareground_AD_1 (has some other SourceMods too)

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): None

List all files eliminated:

   D components/clm/bld/namelist_files/namelist_definition_drv_flds.xml

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

   M components/clm/src/main/clm_initializeMod.F90 ------------ Always call readParameters
   M components/clm/src/main/controlMod.F90 ------------------- Add calls to: soilHydReadNML, nitrifReadNML, CNPrecisionControlReadNML
   M components/clm/src/main/clm_driver.F90 ------------------- Work with timing calls
   M components/clm/src/main/pftconMod.F90 -------------------- Read in mbbopt
   M components/clm/src/main/readParamsMod.F90 ---------------- Add some comments, pass in photosyns_inst and call it's readParams
   M components/clm/src/biogeophys/SoilWaterMovementMod.F90 --- Use Photosyns_inst->params_inst%psi_soil_ref in place of -50000
   M components/clm/src/biogeophys/SoilHydrologyMod.F90 ------- Add soilHydReadNML, read in baseflow_scalar
   M components/clm/src/biogeophys/SnowHydrologyMod.F90 ------- New namelist items: lotmp_snowdensity_method, 
          upplim_destruct_metamorph, overburden_compress_Tfactor, min_wind_snowcompact, new_snowdensity method has
          lower density for < -15C, change to wind_dependent_snow_density
   M components/clm/src/biogeophys/PhotosynthesisMod.F90 ------ New parameters for Plant Hydralic Stress: krmax, kmax, 
           psi50, psi_soil_ref, lmr_intercept_atkin, remove leaf_acc. Add: allocParams, readParams methods
           remove mbbopt and move into pftcon. Atkin method of leaf respiration modified per communication with Atkin.
   M components/clm/src/biogeophys/SurfaceResistanceMod.F90 --- Properly use land-unit rather than column (bug 2255)
   M components/clm/src/biogeophys/CanopyFluxesMod.F90 -------- Remove multiplication of btran for soybean or nbrdlf_dcd_tmp_shrub
           for CNDV, inside the ITERATION loop (bug 2326). This means the reason that brought this code is no longer addressed.
   M components/clm/src/soilbiogeochem/SoilBiogeochemNitrifDenitrifMod.F90 --- Add nitrifReadNML, read in:
           denitrif_respiration_coefficient, denitrif_respiration_exponent, denitrif_nitrateconc_coefficient,
           denitrif_nitrateconc_exponent. Remove k_nitr_max
   M components/clm/src/soilbiogeochem/SoilBiogeochemDecompCascadeBGCMod.F90 - Remove hardwired minpsi
   M components/clm/src/biogeochem/CNFireBaseMod.F90 --------- Multiply several terms by (1-cc_other) (bug 2314)
   M components/clm/src/biogeochem/CNPrecisionControlMod.F90 - Add CNPrecisionControlReadNML, cnegcrit, nnegcrit
           do actual truncation inside new subroutines: TruncateCandNStates, TruncateCState, TruncateNState
           Die if C or N is very negative < cnegcrit or < nnegcrit (currently set to very large negative numbers -60 and -6)
   M components/clm/src/biogeochem/NutrientCompetitionFlexibleCNMod.F90 Set actual_storage_leafcn to missing value if
           leafn_storage is zero. actual_leafcn to missing if leafn is < n_min, remove modification of plant_ndemand if FUN off
   M components/clm/src/biogeochem/CNVegCarbonStateType.F90 - Reseed if plants are dead and going from Accel. Decomp. to regular mode
   M components/clm/src/biogeochem/CNNStateUpdate1Mod.F90 --- Add handling of npool and retransn
   M components/clm/src/biogeochem/CNFUNMod.F90 ------------- Add more comments, correct indentation, speed up, and remove
           extra garbage, use filters to zero out arrays
           add free_Nretrans and fraction of N retranslocation which is automatic/free
   M components/clm/src/biogeochem/CNVegNitrogenFluxType.F90  Add free_retransn_to_npool_patch, write out to history, write
           LEAFN_TO_LITTER to history by default
   M components/clm/src/biogeochem/CNDriverMod.F90 ----------- Pass bounds to CNPrecisionControl
   M components/clm/src/biogeochem/CNPhenologyMod.F90 -------- grainn_to_food modified to be similar to Carbon version (bug 2327)
           for FUN leafn_to_retransn is paid_retransn_to_npool plus free_retransn_to_npool

   M components/clm/bld/unit_testers/build-namelist_test.pl ----------- Add in new tests for new parameters
   M components/clm/bld/namelist_files/namelist_definition_clm4_5.xml - New namelist items: ncrit, ccrit, nnegcrit, cnegcrit,
           baseflow_scalar, denitrif_respiration_coefficient/exponent (and nitrconc), lotmp_snowdensity_method,
           upplim_destruct_metamorph, overburden_compress_Tfactor, min_wind_snowcompact,  remove leaf_acc
   M components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml --- Add CPOOL to history for clm_accelerated_spinup
           remove leaf_acc, set: lotmp_snowdensity_method, upplim_destruct_metamorph, overburden_compress_tfactor, new
           params file for CLM50, set ncrit, turn use_hydrstress=T for CLM50
   M components/clm/bld/CLMBuildNamelist.pm --------------------------- Add setup_logic_cnprec, call setup_logic_nitrif_params,
           setup_logic_hydrology_params, add in cnprecision_inparm namelist

   M components/clm/cime_config/buildnml ------------ Don't need to copy user_nl_clm to Buildconf use CASEROOT version
           be sure to set $tuning options for build-namelist
   M components/clm/cime_config/config_component.xml  Add BARRIER_N/OPTION, ATM_PIO_TYPENAME settings

===============================================================
===============================================================
Tag name:  clm4_5_9_r183
Originator(s):  erik (Erik Kluzek)
Date: Sat Jul  2 18:23:09 MDT 2016
One-line Summary: Decomposition is not water limited after reaching a field capacity parameter (maxpsi_hr) rather 
                  than only at soil saturation

Purpose of changes
------------------

Replaces the hard-coded assumption present in prior versions of the model that soil respiration was 
water-limited whenever it fell below saturation. Now it's no longer water-limited from maxpsi_hr up
to saturation.

This was due to a wrong interpretation/implementation of the following paper.

Andren, O., and K. Paustian, 1987. Barley straw decomposition in the field: a comparison of models. Ecology, 68(5):1190-1200

Also see notes in..

http://bb.cgd.ucar.edu/cesm12z-clm45-important-bad-interpretation-maximum-rate-constant-soil-water-content

Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID): 2324 Bad interpretation of maximum rate constant for soil water content in SoilbiogeochemDecompCascade

Notes of particular relevance for users
---------------------------------------

Caveats for users: None

Changes to CLM's user interface: None

Changes made to namelist defaults: new params files

Changes to the datasets: parameter files

Substantial timing or memory changes: None

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers (e.g., code that is duplicated that requires double maintenance):
   maxpsi_hr is a scalar constant but read in on the parameter file (should change to namelist)

Changes to tests or testing: Removed RTM ESMF test

Code reviewed by: self, ckoven, dlawren

CLM testing: regular

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - OK (70 comparision tests fail, because of the new params files)

  unit-tests (components/clm/src):

    yellowstone - PASS

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - OK
    yellowstone_pgi - OK
    yellowstone_gnu (clm45 only) - OK
    hobart_nag - PASS

CLM tag used for the baseline comparisons:  clm4_5_8_r182


Answer changes
--------------

Changes answers relative to baseline: Yes, for CLM4_5/CLM5_0 for BGC and CN cases

  Summarize any changes to answers:
    - what code configurations: clm4_5 and clm5_0 with BGC or CN
    - what platforms/compilers: all
    - nature of change: should be similar climate 

    Charlie Koven did some work with sensitivity analysis to find a good value for maxpsi_hr

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): rtm

    rtm to rtm1_0_57 -- remove ESMF test

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

   M components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml -- new params file with maxpsi_hr on them

   M components/clm/src/soilbiogeochem/SoilBiogeochemDecompCascadeBGCMod.F90 - Use maxpsi_hr from params file
       rather than max soil saturation
   M components/clm/src/soilbiogeochem/SoilBiogeochemDecompCascadeCNMod.F90 -- Use maxpsi_hr from params file
       rather than max soil saturation

===============================================================
===============================================================
Tag name:  clm4_5_8_r182
Originator(s):  erik (Erik Kluzek)
Date: Fri Jun 24 23:33:36 MDT 2016
One-line Summary: Bring in option for plant hydraulic stress for clm50

Purpose of changes
------------------

Add in option for plant hydraulic stress (PHS). Does Leaf stomatal resistance and leaf photosynthesis
simultaneous solution of sunlit/shaded per Pierre Gentine/Daniel Kennedy PHS method. Vegetation
water potential is calculated for four conductance segments: sun, shade, xylem, and root. 

The main impact in the code is in CanopyFluxes where either the PHS or non-PHS version of Photosynthesis is
called and the sun and shade segments are solved simultaneously. Then it impacts soil water movement
for transpiration.

PHS is turned on by adding use_hydrstress=.true. in your user_nl_clm file for your case.


Bugs fixed or introduced
------------------------

Known bugs introduced in this tag (include bugzilla ID): 2323 (duplication in Photosynthesis)


Notes of particular relevance for users
---------------------------------------

Caveats for users: use_dynroots and use_hydrstress can NOT both be on at the same time!

Changes to CLM's user interface: None

Changes made to namelist defaults: Add use_hydrstress=.false.

Changes to the datasets: None

Substantial timing or memory changes: Maybe 4% slower with PHS, memory only increases by 0.1MB

Notes of particular relevance for developers: (including Code reviews and testing)
---------------------------------------------

Caveats for developers: PhotosynthesisMod is duplicated for PHS and non-PHS
    PhotosynthesisMod more than doubles in size from 2k to 4.5k. Most of it
    is duplicated. Thus changes to one part of the code, have to be duplicated
    in the other part, causing double maintence. Also the effects of 6 namelist
    control items are duplicated meaning those items have to be tested in both
    branches to ensure they are working correctly. (bug 2323)

Changes to tests or testing: Add use_hydrstress=T to KitchenSink tests
     add clm50dynroots test directory

Code reviewed by: self,oleson,Daniel Kennedy

CLM testing: regular

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - OK (78 compare tests fail compared to r181 
                      because of addition of use_hydrstress=.false.)

  unit-tests (components/clm/src):

    yellowstone - PASS

  tools-tests (components/clm/test/tools):

    yellowstone - No

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - No

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - OK
    yellowstone_pgi - OK
    yellowstone_gnu (clm45 only) - OK
    hobart_nag - PASS

CLM tag used for the baseline comparisons:  clm4_5_8_r181


Answer changes
--------------

Changes answers relative to baseline: No (only changes answers if use_hydrstress=.true.)

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, mosart, cism, etc.): None

List all files eliminated: None

List all files added and what they do:

::::::::::: Add specific tests for dynamic roots
   A   components/clm/cime_config/testdefs/testmods_dirs/clm/clm50dynroots/user_nl_clm
   A   components/clm/cime_config/testdefs/testmods_dirs/clm/clm50dynroots/include_user_mods

List all existing files that have been modified, and describe the changes:

::::::::::: Add in use_hydrstress namelist item, add in vegetation water columns mainly handled in Photosynthesis and
::::::::::: then impacts soil water transpiration in soil water movement.
   M   components/clm/src/main/controlMod.F90 ------------ Read in use_hydrstress, check it
   M   components/clm/src/main/clm_varctl.F90 ------------ Add use_hydrstress
   M   components/clm/src/main/clm_driver.F90 ------------ Pass canopystate to HydrologyDrainage
   M   components/clm/src/main/histFileMod.F90 ----------- Add ability to handle nvegwcs dimension
   M   components/clm/src/main/restFileMod.F90 ----------- Write out nvegwcs dimension if use_hydrstress
   M   components/clm/src/main/clm_varpar.F90 ------------ Set nvegwcs number of vegetation water conductance segments to 4
   M   components/clm/src/biogeophys/PhotosynthesisMod.F90 ------ Add PHS versions of subroutines
   M   components/clm/src/biogeophys/SoilStateType.F90 ---------- Add djk column soil transpiration sink by layer, add
           SMP and HK to restart file. Set SMP to -1000 for cold start.
   M   components/clm/src/biogeophys/CanopyFluxesMod.F90 -------- Call PHS or regular version of Photosynthesis
           don't limit or adjust qflx_trans_veg by btran0 for PHS
   M   components/clm/src/biogeophys/SoilWaterMovementMod.F90 --- Add Compute_VertTranSink_PHS, pass canopystate, energyfluxstate
          down to soilwater zengdecker and moisture_form, for PHS rootr_col is zeroed only for pervious road.
          Compute_VertTranSink_PHS apply transpiration as a sink condition that is vertically distributed over the soil column.
   M   components/clm/src/biogeophys/SoilMoistStressMod.F90 ----- btran only set if NOT PHS
   M   components/clm/src/biogeophys/EnergyFluxType.F90 --------- Add bsun/bsha canopy transpiration wetness factor for PHS
   M   components/clm/src/biogeophys/CanopyStateType.F90 -------- Add vegwp_patch for PHS, add to restart and history
          (vegetation water matric potential for sun/sha canopy,xyl,root segments)
   M   components/clm/src/biogeophys/HydrologyNoDrainageMod.F90 - Pass in canopystate and pass canopystate, energystate
          to SoilWater

::::::::::: Handle use_hydrstress in namelist
   M   components/clm/bld/namelist_files/namelist_definition_clm4_5.xml - Define use_hydrstress
   M   components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml --- Set default use_hydrstress to .false.
   M   components/clm/bld/CLMBuildNamelist.pm --------------------------- Add setup_logic_hydrstress, use_hydrstress
          and use_dynroots cannot both be on at the same time.
   M   components/clm/bld/unit_testers/build-namelist_test.pl ----------- Add checks that can't use PHS with ED or dynroot

::::::::::: Add dynroot tests and turn on use_hydrstress for KitchenSink tests
   M   components/clm/cime_config/testdefs/testmods_dirs/clm/clm50KitchenSink/user_nl_clm - Add use_hydrstress=T, remove use_dynroots=T
   M   components/clm/cime_config/testdefs/testmods_dirs/clm/clm50KSinkMOut/user_nl_clm --- Add init_interp_fill_missing_with_natveg=T
          so test will pass as SMP is now required.
   M   components/clm/cime_config/testdefs/testlist_clm.xml - Add 3 clm50dynroots testing, remove ESMF tests


===============================================================
===============================================================
Tag name:  clm4_5_8_r181
Originator(s):  erik (Erik Kluzek)
Date: Fri Jun 17 16:39:22 MDT 2016
One-line Summary: Update cime version which fixes several issues and changes answers

Purpose of changes
------------------

   Update for CIME: This includes several key important changes and bug-fixes
      - Now there is a CLMGSWP3 option for DATM_MODE
      - When running with datm driver has a barrier each day (so MP_EAGER_LIMIT is no longer needed)
      - PIO1 is now the default (PIO2 still exists as an option, but now both exist and you can choose which one)
      - Driver now merges CLM's drv_flds_in file with CAM's and aborts on a conflict
      - The drv_flds_in namelists are defined in the driver where the source exists
      - The drv_flds_in file is recreated just like other namelist files (no longer have to delete earlier one)
      - Changes answers because of shr_orb (see below)

   Changes to tools to include Caspian Sea as a CLM Lake on surface datasets

   Add LND_TUNING_MODE as an env_run.xml variable. The default setting is determined by which major physics
   version is being used (clm4_0, clm4_5, or clm5_0). We intend to use this in order to tune parameters
   for clm5_0 offline with GSWP3 forcing versus clm5_0 with CAM5.5.

   CLM_ACCELERATED_SPINUP="on" now cuts back I/O and is much faster (only outputs a few fields yearly). It
   also applies for both with and without CN. If CN is on, it will by default turn Accellerated Decomposition
   on.


Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID):
     2308 prebeta clm40 compsets are using the wrong testmods directories
     2307 MOSART assumes no-leap calendar
     2303 user_compset gives different settings than expected for options defined in config_compsets.xml
     2280 Need to set barriers for I compsets with PE layouts where datm runs concurrently to CLM
     2256 Problems with early versions of PIO2 in CLM
     2252 Changing megan_specifier for I cases doesn't actually change the megan_specifier in the resolved namelist
     1674 RTM assumes no-leap calendar

CIME Issues fixed (include issue #):
     #315 Add CLMGSWP3
     #324 Merge drv_flds_in in driver from different components
     #56 SSP test treats ref1 case as the main case

Known bugs introduced in this tag (include bugzilla ID): cime issue #453 (ESMF tests fail)
   cime issue #455 (have to delete Macros file if switch to mpi-serial)


Notes of particular relevance for users
---------------------------------------

Caveats for users: CLM_ACCELERATED_SPINUP mean is different (see below)

Changes to CLM's user interface: Add LND_TUNING_MODE, CLM_ACCELERATED_SPINUP changed.

    LND_TUNING_MODE added in with defaults for each CLM physics option (clm4_0, clm4_5, and clm5_0)
    clm4_0 wasn't tuned for a specific forcing, clm4_5 was tuned for CRUNCEP forcing, clm5_0 is
    currently tuned for running with CAM5.5. We eventually expect to have tunings for clm5_0
    for running offline and also with CAM5.5.

    Also CLM_ACCELERATED_SPINUP is now changed and available whether CN is on or not. For a SP
    (Satelite Phenology) case this mode reduces output in order to speed up the simulation.
    For a CN case it does that as well as turning on spinup_state to an accelerated decomposition
    mode. If you don't want CN to be in accelerated decomposition set spinup_state=0 in your user_nl_clm
    (for final spinup after AD mode).

Changes made to namelist defaults: nsegspc is now 35 instead of 20

Changes to the datasets:  None

Changes for tools:
   Files for surface dataset creation now set Caspian sea as a Lake
   new maps for mksurfdata with Caspian Sea

Substantial timing or memory changes: The change in nsegspc should improve performance slightly
    Running with CLM_ACCELERATED_SPINUP="on" will make a good 20% improvement in performance
    from less history output and turning megan off


Code reviews and testing
------------------------

Code reviewed by: self

CLM testing: regular

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - OK (All PASS, but 121 tests are different that r180, because nsegspc changes, new namelists, and spinup_state)

  unit-tests (components/clm/src):

    yellowstone - PASS

  tools-tests (components/clm/test/tools):

    yellowstone - OK (Some mksurfdata compare tests fail because of Caspian as lake)
                      PTCLM compare tests for clm4_5 fail because of new mapping files being used)

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone -  OK (all but one PASS and 44 compare tests are different as expected)
     U-UMB ------- Testing this resolution works

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel -  OK
    yellowstone_pgi -  OK
    yellowstone_gnu (clm45 only) -  OK
    hobart_nag - PASS

CLM tag used for the baseline comparisons:  clm4_5_8_r180


Answer changes
--------------

Changes answers relative to baseline:   Yes!

  Summarize any changes to answers, i.e.,
    - what code configurations:  all including clm4_0 and clm4_5/clm5_0
    - what platforms/compilers:  all
    - nature of change: same climate

   The cime update includes a change to shr_orb that changes answers
   for all simulations. There is also a change in vertical_gradient
   calculations for glacier model that changes answers when CISM
   is active (IG compsets).
       
Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, cism, etc.): cime, rtm, mosart

   cime   to clm4_5_8_r180_cime4.5.14 (This includes option for DATM=CLMGSWP3)
   rtm    to rtm1_0_56
   mosart to mosart1_0_16

List all files eliminated: Remove NCL script to compare files (can now use -m option to FORTRAN cprnc program)

   D    components/clm/tools/shared/ncl_scripts/cprnc.pl --- use FORTRAN cprnc
   D    components/clm/tools/shared/ncl_scripts/cprnc.ncl -- use FORTRAN cprnc
   D    components/clm/bld/namelist_files/namelist_definition_drv_flds.xml --- Now in driver

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

::::::::::::::::::: Replace setting of CPRNC_EXE with CPRNC_OPT="-m"
   M    components/clm/test/tools/CLM_compare.sh ----- Add use of CPRNC_OPT
   M    components/clm/test/tools/test_driver.sh ----- Export CPRNC_EXE and set default CPRNC_OPT to blank
   M    components/clm/test/tools/TBLCFGtools.sh ----- Replace CRPNC_EXE with CPRNC_OPT="-m"
   M    components/clm/test/tools/TOPtools.sh -------- Replace CRPNC_EXE with CPRNC_OPT="-m"
   M    components/clm/test/tools/TBLscript_tools.sh - Replace CRPNC_EXE with CPRNC_OPT="-m"
   M    components/clm/test/tools/TBLtools.sh -------- Replace CRPNC_EXE with CPRNC_OPT="-m"
   M    components/clm/test/tools/TSMscript_tools.sh - Use $CSMDATA/lnd/clm2/PTCLMmydatafiles.c160208 directory
            rather than older directory
   M    components/clm/test/tools/nl_files/PTCLM_USUMB_clm4_5 -------- Update map date to 160208
   M    components/clm/test/tools/nl_files/PTCLM_USUMB_Cycle_clm4_5 -- Update map date to 160208
   M    components/clm/test/tools/nl_files/PTCLM_USUMB_Global_clm4_5 - Update map date to 160208

   M    components/clm/tools/shared/ncl_scripts/README - Remove mention of cprnc.pl/cprnc.ncl

   M    components/clm/tools/shared/mkmapdata/mkmapdata.sh -------- Create map for 3x3min_MODIS-wCsp instead of 3x3min_MODIS
   M    components/clm/tools/clm4_5/mksurfdata_map/Makefile.data -- By default also create f45 1850 and transient datasets

   M    components/clm/bld/unit_testers/build-namelist_test.pl --------------- Add a ton more testing
   M    components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml ------- Add lnd_tuning_mod, clm_accelerated_spinup,
            megan, atm_c14_filename use_c14. Set spinup_state by clm_accelerated_spinup, set hist settings by
           clm_accelerated_spinup cutting back history output drastically. Set pot_hmn_ign_counts_alpha by
           lnd_tuning_mode. Set nsegspc=35. Change maps from 3x3min_MODIS to 3x3min_MODIS_wCsp to add Caspian Sea to
           lake mask
   M    components/clm/bld/namelist_files/namelist_definition_clm4_0.xml ----- Add lnd_tuning_mod, clm_accelerated_spinup, megan.
   M    components/clm/bld/namelist_files/namelist_defaults_clm4_5_tools.xml - Add SCRIP grid file for 0.125x0.125 resolution.
          add SCRIP grid for 3x3min_MODIS-wCsp, lake mask is now MODIS-wCsp, update mksrf_flakwat to include Caspian Sea
   M    components/clm/bld/namelist_files/namelist_definition_clm4_5.xml ----- Add some commented out namelist variables that
           will be added later. Correct or clarify some definitions. Add lnd_tuning_mode, clm_accelerated_spinup and megan.
           Remove MEGAN, drydep, and fire-emission namelist items as in drv namelist_definition now.
   M    components/clm/bld/namelist_files/namelist_defaults_clm4_0.xml ------- Set lnd_tuning_mod, clm_accelerated_spinup, and megan.
           Also use history options to cut back history output drastically for clm_accelerated_spinup="on".
   M    components/clm/bld/CLMBuildNamelist.pm ----- Add clm_accelerated_spinup, lnd_tuning_mode, remove bgc_spinup. Read
           in driver namelist-definition for drv_flds_in. Add nitrif_inparm, and soilhydrology_inparm although empty. Always
           write out (and overwrite) the drv_flds_in namelist even if empty. Driver now reads clm's version and merges it with
           CAM's version and terminates on a contradiction.

   M    components/clm/cime_config/testdefs/testlist_clm.xml - Work on test lists.
   M    components/clm/cime_config/user_nl_clm --------------- Remove note about drv_flds_in file only be written out if certain
           build-namelist options are on as no longer true.
   M    components/clm/cime_config/buildnml ------------------ Turn megan off if NOT datm. Send LND_TUNING_MODE to build-namelist.
           Remove setting of bgc_spinup based on CLM_ACCELERATED_SPINUP (build-namelist itself figures this out). Leave drv_flds_in
           in clmconf directory and let the driver merge it's contents with CAM and create a version in RUNDIR. Copy 
           CASEROOT/Buildconf/clmconf/user_nl_clm${inst_string} to clmconf (doesn't really need to be done).
   M    components/clm/cime_config/config_component.xml ------ Add LND_TUNING_MODE (clm4_0_default,clm5_0_cam5.5,clm5_0_GSW3P,clm4_5_CRUNCEP)
           Right now default for CLM5.0 is clm5_0_cam5.5 for all cases. For clm4_0 or clm4_5 the one given default is used.

===============================================================
===============================================================
Tag name:  clm4_5_8_r180
Originator(s):  sacks (Bill Sacks)
Date: Mon Jun  6 06:13:57 MDT 2016
One-line Summary: Refactor dyn_cnbal_patch

Purpose of changes
------------------

There was a lot of duplicated code, as well as almost-but-not-quite-duplicated
code in dyn_cnbal_patch (the code used for updating patch-level BGC variables
when patch weights change). This tag consolidates this duplicated code into some
new shared infrastructure, similar to what is done for column-level variables.

In addition, do not zero states when patch weights go to zero. (I expected this
to change answers for 1-d history files, but it didn't.)

Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID):
- 2317: incorrect handling of isotopes with transient PFTs starting in clm4_5_1_r097


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: small timing increase: about 10% increase
in dyn_cnbal_patch, amounting to a 0.3% increase in total CLM runtime (for both
transient and non-transient runs).


Code reviews and testing
------------------------

Code reviewed by: self

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

NOTE: testing done on
refactor_seed_calculation_n01_maintain_state_zero_weight_n01_dynlu_conserve_cn3_n03_clm4_5_8_r179;
very minor changes since then tested with
SMS_Ld5_D_P24x1.f10_f10.IRCP45CLM45BGC.hobart_nag.clm-decStart

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

    ok means tests pass, expected baseline failures as noted below

CLM tag used for the baseline comparisons: clm4_5_8_r179
   CLM40 compared with clm4_5_8_r178 (baselines missing for r179)


Answer changes
--------------

Changes answers relative to baseline:

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM45 / CLM50 transient and CNDV runs
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 

    Roundoff-level changes

    Greater than roundoff-level for transient runs with isotopes, due to fixing
    bug 2317

   If bitwise differences were observed, how did you show they were no worse
   than roundoff?

   Created a branch (dynlu_conserve_cn3_oneoff) that was as similar as possible
   to the trunk, with just those changes needed to get bit-for-bit behavior with
   my new code (e.g., reordering some calculations). Confirmed that my new code
   is bit-for-bit with that.

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do:

========= New, shared infrastructure for updating patch-level variables
A       components/clm/src/dyn_subgrid/dynPatchStateUpdaterMod.F90
A       components/clm/src/dyn_subgrid/test/dynPatchStateUpdater_test/CMakeLists.txt
A       components/clm/src/dyn_subgrid/test/dynPatchStateUpdater_test/test_patch_state_updater.pf
A       components/clm/src/dyn_subgrid/test/dynPatchStateUpdater_test

========= Extract code common to carbon and nitrogen, for computing seed amounts
A       components/clm/src/biogeochem/CNVegComputeSeedMod.F90
A       components/clm/src/biogeochem/test/CNVegComputeSeed_test/CMakeLists.txt
A       components/clm/src/biogeochem/test/CNVegComputeSeed_test/test_ComputeSeedAmounts.pf
A       components/clm/src/biogeochem/test/CNVegComputeSeed_test

========= Define constants for identifying whether we're operating on c12, c13,
          c14 or n (used in CNVegComputeSeedMod)
A       components/clm/src/biogeochem/CNSpeciesMod.F90

List all existing files that have been modified, and describe the changes:

========= Remove a bunch of code - moved to new infrastructure
M       components/clm/src/biogeochem/dynConsBiogeochemMod.F90

========= Make calls to new patch state updater for each necessary variable
M       components/clm/src/biogeochem/CNVegCarbonStateType.F90
M       components/clm/src/biogeochem/CNVegNitrogenStateType.F90

========= Set up patch state updater
M       components/clm/src/dyn_subgrid/dynSubgridDriverMod.F90

========= Other minor changes needed to use the new infrastructure
M       components/clm/src/biogeochem/CNVegetationFacade.F90

========= Add some unit tests, and some related unit testing infrastructure
M       components/clm/src/biogeochem/test/CMakeLists.txt
M       components/clm/src/main/pftconMod.F90
M       components/clm/src/biogeochem/CMakeLists.txt
M       components/clm/src/dyn_subgrid/CMakeLists.txt
M       components/clm/src/dyn_subgrid/test/CMakeLists.txt
M       components/clm/src/unit_test_shr/unittestSimpleSubgridSetupsMod.F90

========= Remove a bit of unused code
M       components/clm/src/dyn_subgrid/dynColumnStateUpdaterMod.F90

========= Remove a test that has been passing for a while, and one that no longer exists
M       components/clm/cime_config/testdefs/ExpectedTestFails.xml

===============================================================
===============================================================
Tag name:  clm4_5_8_r179
Originator(s):  sacks (Bill Sacks)
Date: Fri May 27 10:39:15 MDT 2016
One-line Summary: Update column-level BGC state variables with dynamic landunits

Purpose of changes
------------------

Update column-level BGC state variables as column areas change due to dynamic
landunits. This does NOT yet update column-level biogeophysical variables, NOR
does it handle patch-level variables appropriately.

Note that some variables that used to only exist on vegetated landunits (soil &
crop landunits) now exist on all landunits. When columns in special landunits
expand, they take on the carbon, nitrogen and methane state variables from the
columns they expanded into. These C / N / CH4 quantities essentially get trapped
underneath the glacier (or lake / urban / whatever), staying fixed until that
column eventually shrinks. If that special column shrinks and is replaced by a
vegetated column, then the vegetated column takes on the state that had been
trapped under the glacier (or whatever). In this way, we avoid destroying or
creating mass when special landunits grow and shrink. This change explains why
summary variables that used to be computed for just soil & crop columns are now
computed for all columns.

Note: In some testing (particularly in the 6-year Smallville test case), I found
that there was a huge decrease (order of magnitude or more) in methane
concentrations in the unsaturated portion of the growing column after column
area adjustments. As far as I can tell, the state variable is being updated
correctly due to the changing column areas, but then within the timestep evolves
rapidly to a different value. From talking with Dave Lawrence, we assume this is
due to the adjustment of carbon content in the column, since the carbon state
can have a big effect on methane fluxes.


Bugs fixed or introduced
------------------------

Known bugs introduced in this tag (include bugzilla ID):
- 2283: dynamic landunits: handle methane with changing lake area [enhancement]

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions):

   When using use_init_interp in cases with CISM (IG/JG/FG/BG) compsets, there
   is a large adjustment in Greenland glacier area in the first timestep of the
   run, even if glacier evolution is off. (This is because, in initialization,
   glacier area comes from CLM's surface dataset; then glacier area is updated
   to match CISM in the first timestep, even if glacier evolution is off.) This
   results in big adjustments in column-level carbon, nitrogen and methane
   content in the first timestep, because it looks to CLM like some glacier
   columns have grown significantly (trapping C / N / CH4), while others have
   shrunk significantly, causing a significant decrease in area-average C / N /
   CH4 in the growing vegetated columns.

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none


Code reviews and testing
------------------------

Code reviewed by: self

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

    ok means tests all pass or xfail; expected baseline comparison failures as
    noted below

CLM tag used for the baseline comparisons: clm4_5_8_r178


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM45/CLM50 with CN/BGC, either with CISM (IG)
      or transient crops (historical / RCP compsets with CROP)
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      larger than roundoff; potentially new climate

   The evolution of C / N / CH4 state variables is now completely different with
   transient glacier or crop areas, causing significant answer changes.

   These transient crop tests change answers:
     ERS_Ly5_P60x1.f10_f10.IHISTCLM45BGCCROP.yellowstone_intel.clm-cropMonthOutput
     SMS_D_Ly6.1x1_smallvilleIA.IHISTCLM45BGCCROP.yellowstone_pgi.clm-cropMonthOutput
   
   For glacier, typically changes will only be seen if ice evolution is turned
   on, but changes will be seen even with ice evolution off - or ice evolution on
   in a test too short to actually see any ice evolution - if use_init_interp
   is used, as noted in the "caveats" section above. This affects these tests:
     ERS_D_Ld3.f09_g16_gl5.IG1850CRUCLM50BGCCROP.yellowstone_intel.clm-clm50KitchenSink
     SMS_Lm1.f09_g16_gl5.IG1850CRUCLM50BGC.yellowstone_intel.clm-clm50KitchenSink

   In addition, there are FILLDIFFs in a few methane variables. The new code
   seems correct, in that the fill pattern (over special landunits) is the same
   for all vertical levels: the old code had different fill patterns in lower
   soil layers. This affects these variables: CONC_O2_SAT, CONC_O2_UNSAT,
   CONC_CH4_SAT, CONC_CH4_UNSAT, LAYER_SAT_LAG.


   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, cism, etc.):
   cism2_1_10 -> cism2_1_17: Update to latest CISM trunk tag (main purpose is to
      bring in new capabilities for overriding glacier areas for testing purposes)

List all files eliminated: none

List all files added and what they do:

========= Add a test that has both increases and decreases in glacier together
          with BGC
A       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_spunup_inc_dec_bgc/user_nl_cism
A       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_spunup_inc_dec_bgc/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_spunup_inc_dec_bgc/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_spunup_inc_dec_bgc/README
A       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_spunup_inc_dec_bgc

List all existing files that have been modified, and describe the changes:

========= Add capabilities to the column state updater: fractional areas (needed
          for methane) and keeping track of the adjustments made to each variable
M       components/clm/src/dyn_subgrid/dynColumnStateUpdaterMod.F90
M       components/clm/src/dyn_subgrid/test/dynColumnStateUpdater_test/test_column_state_updater.pf

========= Update BGC column-level state variables when column areas change
M       components/clm/src/dyn_subgrid/dynSubgridDriverMod.F90
M       components/clm/src/biogeochem/dynConsBiogeochemMod.F90
M       components/clm/src/soilbiogeochem/SoilBiogeochemCarbonStateType.F90
M       components/clm/src/soilbiogeochem/SoilBiogeochemNitrogenStateType.F90
M       components/clm/src/biogeochem/CNVegetationFacade.F90
M       components/clm/src/biogeochem/CNDriverMod.F90
M       components/clm/src/biogeochem/CNBalanceCheckMod.F90
M       components/clm/src/biogeochem/CNVegCarbonStateType.F90
M       components/clm/src/biogeochem/CNVegNitrogenStateType.F90
M       components/clm/src/main/clm_driver.F90

========= Update ch4 column-level state variables when column areas change. Also
          did a bunch of refactoring that was either needed or nice to have to
          support these changes, especially related to (1) determining whether
          it's the first timestep where ch4 is included; (2) how variables that
          keep track of states in the previous timestep are set (this needed to
          be reworked to simplify what we need to adjust in the column
          conservation); (3) initializing conserved state variables to 0 (rather
          than spval) over special landunits (this required putting in place
          backwards compatibility with old restart files in subroutine Restart);
          (4) where start-of-timestep balance check initialization is done
M       components/clm/src/biogeochem/ch4Mod.F90

========= Add new routine to support restart file backwards compatibility:
          set_missing_vals_to_constant
M       components/clm/src/utils/restUtilMod.F90.in

========= Add a new history averaging option: SUM. Also refactored some handling
          of avgflag to remove duplication, and allowed l2g_scale_type in more
          contexts
M       components/clm/src/main/histFileMod.F90


========= Add a new l2g_scale_type: veg_plus_lake (needed for some methane
          variables)
M       components/clm/src/main/subgridAveMod.F90

========= Add a new fiter: allc - all (active) columns
M       components/clm/src/main/filterMod.F90

========= Add col_filter_from_lunflags, change col_filter_from_ltype to
          col_filter_from_ltypes (allowing multiple landunit types)
M       components/clm/src/main/filterColMod.F90
M       components/clm/src/main/test/filter_test/test_filter_col.pf
M       components/clm/src/main/test/topo_test/test_topo.pf

========= Updates for modified interface in new CISM
M       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_decrease/user_nl_cism
M       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_increase/user_nl_cism

========= Add a test that has both increases and decreases in glacier together
          with BGC; remove a long test for which we have sufficient coverage
          with a similar, shorter test
M       components/clm/cime_config/testdefs/testlist_clm.xml

===============================================================
===============================================================
Tag name:  clm4_5_8_r178
Originator(s):  sacks (Bill Sacks)
Date: Sun Apr 17 19:28:55 MDT 2016
One-line Summary: Remove some consistency checks, and merge crop_prog with use_crop in code

Purpose of changes
------------------

(1) Remove some consistency checks that were doing more harm than good:

    (a) Make init_interp_fill_missing_with_natveg unnecessary for natural veg
        and crop output points. This is mainly to support the common use case of
        interpolating from non-crop to crop, without requiring the user to set
        this flag.

    (b) Remove check_finidat_fsurdat_consistency - now never do this check. This
        consistency check was causing more problems than it solved, both for
        users and developers (e.g., requiring us to change initial conditions
        files whenever we made new versions of the surface dataset).

(2) Remove crop_prog logical variable from the code. This was identical to
    use_crop, and so it was confusing to have these two separate variables. Uses
    of crop_prog have been replaced by uses of use_crop.


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables):
- No longer need to set init_interp_fill_missing_with_natveg when interpolating
from non-crop to crop

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none


Code reviews and testing
------------------------

Code reviewed by: self

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - pass (ran bld/unit_testers tests)

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - pass
    yellowstone_pgi - pass
    yellowstone_gnu (clm45 only) - pass
    hobart_nag - pass

CLM tag used for the baseline comparisons: clm4_5_8_r177


Answer changes
--------------

Changes answers relative to baseline: NO


Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated:

========= Make init_interp_fill_missing_with_natveg unnecessary for natural veg
          and crop output points
D       components/clm/cime_config/testdefs/testmods_dirs/clm/interp_f19_noncrop2crop/user_nl_clm
D       components/clm/cime_config/testdefs/testmods_dirs/clm/interp_f19_noncrop2crop/include_user_mods
D       components/clm/cime_config/testdefs/testmods_dirs/clm/interp_f19_noncrop2crop/README
D       components/clm/cime_config/testdefs/testmods_dirs/clm/interp_f19_noncrop2crop

List all files added and what they do:

List all existing files that have been modified, and describe the changes:

========= Make init_interp_fill_missing_with_natveg unnecessary for natural veg
          and crop output points
M       components/clm/src/init_interp/initInterpMindist.F90
M       components/clm/src/init_interp/test/initInterpMindist_test/test_init_interp_mindist.pf
M       components/clm/cime_config/testdefs/testmods_dirs/clm/clm50KitchenSink/user_nl_clm
M       components/clm/cime_config/testdefs/testlist_clm.xml

========= Remove check_finidat_fsurdat_consistency - now never do this check
M       components/clm/src/main/restFileMod.F90
M       components/clm/bld/namelist_files/namelist_definition_clm4_5.xml

========= Remove crop_prog - use use_crop in its place
M       components/clm/src/ED/main/EDCLMLinkMod.F90
M       components/clm/src/biogeophys/EnergyFluxType.F90
M       components/clm/src/biogeophys/TemperatureType.F90
M       components/clm/src/biogeophys/WaterStateType.F90
M       components/clm/src/soilbiogeochem/SoilBiogeochemNStateUpdate1Mod.F90
M       components/clm/src/soilbiogeochem/SoilBiogeochemStateType.F90
M       components/clm/src/soilbiogeochem/SoilBiogeochemNitrogenFluxType.F90
M       components/clm/src/soilbiogeochem/SoilBiogeochemNitrogenStateType.F90
M       components/clm/src/soilbiogeochem/SoilBiogeochemCarbonStateType.F90
M       components/clm/src/dyn_subgrid/dynSubgridControlMod.F90
M       components/clm/src/unit_test_stubs/main/histFileMod_stub.F90
M       components/clm/src/biogeochem/CNFUNMod.F90
M       components/clm/src/biogeochem/CNVegNitrogenStateType.F90
M       components/clm/src/biogeochem/CNPrecisionControlMod.F90
M       components/clm/src/biogeochem/CNPhenologyMod.F90
M       components/clm/src/biogeochem/CropType.F90
M       components/clm/src/biogeochem/CNVegNitrogenFluxType.F90
M       components/clm/src/biogeochem/CNDriverMod.F90
M       components/clm/src/biogeochem/CNVegCarbonFluxType.F90
M       components/clm/src/biogeochem/CNVegCarbonStateType.F90
M       components/clm/src/biogeochem/CNNStateUpdate1Mod.F90
M       components/clm/src/biogeochem/CNBalanceCheckMod.F90
M       components/clm/src/biogeochem/CNVegStateType.F90
M       components/clm/src/main/clm_varctl.F90
M       components/clm/src/main/clm_driver.F90
M       components/clm/src/main/clm_initializeMod.F90
M       components/clm/src/main/initGridCellsMod.F90
M       components/clm/src/main/histFileMod.F90
M       components/clm/src/main/clm_varpar.F90
M       components/clm/src/main/pftconMod.F90
M       components/clm/src/main/surfrdMod.F90
M       components/clm/src/main/clm_instMod.F90

===============================================================
===============================================================
Tag name:  clm4_5_8_r177
Originator(s):  sacks (Bill Sacks)
Date: Thu Apr 14 14:00:25 MDT 2016
One-line Summary: Move CN product pools to gridcell level

Purpose of changes
------------------

Move CN product pools from column-level to gridcell-level. This is needed for C
& N conservation with dynamic landunits, because there was no obvious way to
handle column-level product pools.

This also required moving some of the related fluxes to the gridcell-level.

Also added capability for init_interp to handle gridcell-level fields.


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions):
- If you run an old restart file through init_interp, product pools will be
  zeroed out. This is an issue for restart files that come from a transient run
  or from a clm5 crop run. Solution: run your old file through the new code for
  at least one time step without init_interp, then you can init_interp that
  file.

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files):
- clmi.I2000CLM45CRUBGC.2000-01-01.0.9x1.25_gx1v6_simyr2000_c160127.nc replaced
  by clmi.I2000CLM45CRUBGC.2000-01-01.0.9x1.25_gx1v6_simyr2000_c160413.nc. This
  is basically the same, but run for one extra time step using compset ICLM45BGC
  with this branch.

Substantial timing or memory changes: none


Code reviews and testing
------------------------

Code reviewed by: self

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

    ok means tests pass or xfail, some baseline comparisons fail, as noted below

CLM tag used for the baseline comparisons: clm4_5_8_r176


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: all CLM45/CLM5 with CN/BGC
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 

    All CLM45/CLM5 CN/BGC cases have roundoff-level changes in product pools and
    related fluxes. In addition:

    (1) Bigger answer changes for CN/BGC cases using the f09 year-2000 initial
    conditions file: this file has been run through the new code for one
    additional time step. Differences were larger than I expected for this
    seemingly-minor change; I did not spend time tracking down the cause for
    those differences.

    (2) Cases doing interpolation (init_interp) from some other out-of-the-box
    initial conditions files have normalized RMS differences greater than
    roundoff. This is because some other initial conditions files (including
    some 1850 files) have non-zero product pools, which are zeroed out by
    init_interp: see the caveat for users above. However, in an absolute sense,
    RMS differences are small, because the product pools on these files are very
    small.

    (3) Greater than roundoff-level changes in product pools and related fluxes
    in transient crop cases. This shows up in the test
    ERS_Ly5_P60x1.f10_f10.IHISTCLM45BGCCROP.yellowstone_intel.clm-cropMonthOutput. This
    is expected: in the old code, the product pools grew or shrank as the
    columns they were on grew or shrank. This was essentially the motivation for
    this tag.

   If bitwise differences were observed, how did you show they were no worse
   than roundoff?

      Based on RMS errors in baseline comparisons

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Move product pools from column to gridcell-level, as described above
M       components/clm/src/biogeochem/CNProductsMod.F90
M       components/clm/src/biogeochem/CNVegCarbonFluxType.F90
M       components/clm/src/biogeochem/CNDriverMod.F90
M       components/clm/src/biogeochem/CNVegetationFacade.F90
M       components/clm/src/main/clm_driver.F90
M       components/clm/src/main/lnd2atmMod.F90

========= Allow suffix on restart field name
M       components/clm/src/biogeochem/SpeciesBaseType.F90
M       components/clm/src/biogeochem/SpeciesIsotopeType.F90
M       components/clm/src/biogeochem/SpeciesNonIsotopeType.F90
M       components/clm/src/biogeochem/test/Species_test/test_SpeciesNonIsotope.pf
M       components/clm/src/biogeochem/test/Species_test/test_SpeciesIsotope.pf

========= Add a routine to assist with backwards compatibility:
          set_grc_field_from_col_field: Set a gridcell-level field from a
          column-level field on the restart file
M       components/clm/src/utils/restUtilMod.F90.in

========= Add capability for init_interp to handle gridcell-level fields. This
          is needed for the new gridcell-level product pools.
M       components/clm/src/init_interp/test/initInterpMindist_test/test_init_interp_mindist.pf
M       components/clm/src/init_interp/initInterp.F90
M       components/clm/src/init_interp/initInterpMindist.F90
M       components/clm/src/init_interp/initInterpBounds.F90

========= Point to new year-2000 initial conditions file. This is basically the
          same as the old one, but has been run for one timestep using the new
          code, in order to have gridcell-level product pools. This is needed
          for LII testing.
M       components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml

========= Replace a year-1850 LII test with a year-2000 LII test to exercise the
          gridcell-level init_interp code (need non-zero product pools to test
          that code fully)
M       components/clm/cime_config/testdefs/testlist_clm.xml


===============================================================
===============================================================
Tag name:  clm4_5_8_r176
Originator(s):  sacks (Bill Sacks)
Date: Wed Apr 13 09:32:56 MDT 2016
One-line Summary: Calculate active flags and filters earlier in initialization

Purpose of changes
------------------

Main purpose is to compute the active flags and filters (via reweight_wrapup)
earlier in initialization. These are now computed initially before the restart
file is read, and tehn updated as soon as possible in the midst of the restart
file read. This is useful in case any of the clm_instMod restart routines want
to use the active flags or filters, directly or indirectly (e.g., via a call to
subgridAveMod) - e.g., for the sake of backwards compatibility. This is
something that's needed in an upcoming tag.

Also: change some CN product history fields, so that they are more consistent -
so totals just give totals for wood:

- Renamed TOTPROD to TOT_WOODPROD

- Removed PRODUCT_CLOSS and similar fields, added TOT_WOODPRODC_LOSS and similar
  fields: now just include losses from wood product pools


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables):
- renamed CN product history fields: see above

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none


Code reviews and testing
------------------------

Code reviewed by: self

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

    ok means tests pass or xfail, plus expected failures in CLM5 ERP tests with
    threading, just in the NPP_BURNEDOFF field, due to bug 2292 (leading to
    differences both in the baseline comparison and in the comparison of the
    restart to the baseline)

CLM tag used for the baseline comparisons: clm4_5_8_r175


Answer changes
--------------

Changes answers relative to baseline: NO

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Compute active flags and filters earlier in initialization
M       components/clm/src/main/clm_initializeMod.F90
M       components/clm/src/main/restFileMod.F90

========= Change CN product history fields (see above for details)
M       components/clm/src/biogeochem/CNProductsMod.F90

========= Unrelated change: fix argument intent
M       components/clm/src/biogeochem/CNPhenologyMod.F90

===============================================================
===============================================================
Tag name:  clm4_5_8_r175
Originator(s):  sacks (Bill Sacks)
Date: Sat Apr  9 15:48:47 MDT 2016
One-line Summary: For glc_mec, change downscaling and where SMB is computed

Purpose of changes
------------------

Two main purposes:

(1) Change some aspects of the downscaling of atmospheric fields that is done
    when running with glc_mec. These change answers for glc_mec cases (i.e.,
    cases with CISM):

    (a) Change the downscaling equations for forc_th (potential temperature) and
    forc_rho (atmospheric density): Previously, these gave different answers
    from the gridcell value even if the column's topographic height exactly
    matched the atmosphere's topographic height. The new equations are based on
    deltas, ensuring that the downscaled values match the atmospheric forcings
    if topographic heights match.

    Now all downscaled fields should match the atmosphere forcings if the
    topographic heights match, *except* rain and snow (potentially large
    differences, by design), and longwave radiation (roundoff-level differences
    can be introduced by the normalization).

    (b) Perform downscaling over all column types inside the
    icemask. Previously, downscaling was done only for istice_mec and istsoil
    columns (because those were the only ones that computed SMB). I realized
    that this could result in some undesirable inconsistencies between the
    different columns in a gridcell, which could be especially problematic if a
    glacier advanced over (e.g.) a lake column. In practice, this seems to
    affect a few lake points inside Greenland.

    (c) Do *not* perform downscaling over glacier columns with the
    single_at_atm_topo behavior. This is for consistency with other column types
    whose topographic height (implicitly) matches the atmosphere's. In practice,
    this shouldn't effect the simulation much, if at all (due to the change in
    (a)).

    (d) Extracted a function to compute forc_rho, and pulled out some magic
    numbers from this calculation

(2) When running with glc_mec, compute SMB for all vegetated columns in the
    'virtual' glacier region, rather than just in the icemask. This affects the
    CLM fields sent to the coupler for elevation class 0, but otherwise has no
    direct effect on CLM evolution.

    This is important if you want coupler forcings that can drive a later TG
    run: Typically you will want these forcings in the same place where you
    wanted virtual columns (for the same reason: so that forcings are available
    in every elevation class, including elevation class 0).

In order to accomplish these changes, I have separated the logic for where to
compute SMB from the logic for where to do downscaling.


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none


Code reviews and testing
------------------------

Code reviewed by: Bill Lipscomb reviewed the new equations for forc_th and
forc_rho. Other changes have not been reviewed.

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

    ok means tests pass or xfail, except for expected baseline comparison
    failures, as noted below.

    Also: There were failures in CLM5 ERP tests with threading, just in the
    NPP_BURNEDOFF field, due to bug 2292, which was introduced in the previous
    tag. I confirmed that the same tests failed in a fresh checkout of r174.

CLM tag used for the baseline comparisons: clm4_5_8_r174


Answer changes
--------------

Changes answers relative to baseline: YES, for CLM45/CLM5 with CISM (IG compsets)

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM45/CLM5 with CISM (IG compsets)
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 

      Not investigated closely, but expected to be larger than roundoff/same
      climate

      Differences are due to:

      (1) New downscaling equations for forc_th and forc_rho. I have confirmed
      that these differences are relatively small in one test run (one-day
      average differences < 0.31 deg for forc_th and < 1e-10 for forc_rho).

      (2) Downscaling now done over all column types within the icemask
      (including lakes)

      (3) Small change in constants used in calculation of forc_rho downscaling,
      to be consistent with shr_const_mod

      (4) Now compute SMB for all vegetated columns in the 'virtual' glacier
      region, rather than just columns in the icemask. This affects fields sent
      from CLM to the coupler in elevation class 0.
    

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated:

========= Changed to a .in file processed by genf90
D       components/clm/src/unit_test_shr/unittestArrayMod.F90

List all files added and what they do:

========= New module to handle coordination of updating topographic heights, as
          well as determining which columns need downscaling
A       components/clm/src/main/TopoMod.F90

========= New unit tests
A       components/clm/src/main/test/atm2lnd_test/test_downscale_forcings.pf
A       components/clm/src/main/test/topo_test/test_topo.pf
A       components/clm/src/main/test/topo_test/CMakeLists.txt
A       components/clm/src/main/test/topo_test

========= Changed to a .in file processed by genf90
A       components/clm/src/unit_test_shr/unittestArrayMod.F90.in

========= Routines that assist unit tests working with glc_mec landunits
A       components/clm/src/unit_test_shr/unittestGlcMec.F90

List all existing files that have been modified, and describe the changes:

========= Main changes, as described above. Some of these changes have to do
          with the creation of TopoMod: topo_type, and the move of glc_topo into
          there - now called topo_col
M       components/clm/src/main/restFileMod.F90
M       components/clm/src/main/clm_varcon.F90
M       components/clm/src/main/filterMod.F90
M       components/clm/src/main/glcBehaviorMod.F90
M       components/clm/src/main/subgridRestMod.F90
M       components/clm/src/main/ColumnType.F90
M       components/clm/src/main/clm_instMod.F90
M       components/clm/src/main/reweightMod.F90
M       components/clm/src/main/glc2lndMod.F90
M       components/clm/src/main/lnd2glcMod.F90
M       components/clm/src/main/clm_driver.F90
M       components/clm/src/main/clm_initializeMod.F90
M       components/clm/src/main/atm2lndMod.F90
M       components/clm/src/dyn_subgrid/dynSubgridDriverMod.F90

========= New routines for creating filters - some for production code, some for
          unit tests
M       components/clm/src/main/filterColMod.F90

========= Add some unit tests and some unit test helper functionality
M       components/clm/src/main/CMakeLists.txt
M       components/clm/src/main/test/filter_test/test_filter_col.pf
M       components/clm/src/main/test/glcBehavior_test/test_glcBehavior.pf
M       components/clm/src/main/test/CMakeLists.txt
M       components/clm/src/main/test/atm2lnd_test/CMakeLists.txt
M       components/clm/src/unit_test_shr/unittestFilterBuilderMod.F90
M       components/clm/src/unit_test_shr/unittestSimpleSubgridSetupsMod.F90
M       components/clm/src/unit_test_shr/unittestSubgridMod.F90
M       components/clm/src/unit_test_shr/CMakeLists.txt
M       components/clm/src/unit_test_shr/test/unittestArray_test/test_unittestArray.pf

========= Add a bit of documentation
M       components/clm/bld/namelist_files/namelist_definition_clm4_5.xml


===============================================================
===============================================================
Tag name:  clm4_5_8_r174
Originator(s):  erik (Erik Kluzek)
Date: Fri Mar 25 01:57:24 MDT 2016
One-line Summary: Bring Rosie's respiration and FUN changes to the trunk

Purpose of changes
------------------

Changes to respiration from Rosie Fisher. Leaf respiration option (CLM50 default is Atkin 2015) 
as well as option for light inhibition. Also reworking of FUN so it calculates both fixers 
and non fixers and then figures out the impact of both based on a fixed percentage of plants
that fix by PFT. Add burned-off carbon to FUN (Carbon that can not be used for N uptake). 
Add new term to directly account for Ben Houlton's temperature response function.

New defaults for CLM5.0. Add some new history fields including
LEAFCN and LEAFCN_STORAGE CN ratios.

Default for snow depth is now lowered to 10m from 20m. If you startup from an initial condition
file with 20m of snow, a big flow of ice-runoff will flow out of the system (takes a few days
to clear it all out). In general you should NOT allow this for fully coupled simulations with
an active ocean model. For other simulations, you should be aware of this sudden ice runoff that
will happen.

Remove some unused unworking or unrefined options for flexible-CN.

Check for small C or N values in CNPrecisionControl after
each StateUpdate section rather than just after summary.
This is turned on for CLM50 with use_nguardrail (will turn this
on for CLM45 as well, and remove later).

Improve some of the documentation of namelist items. Also work on some of the dependencies:
use_flexiblcCN requires CN, carbon_resp_opt=1 only if CN on and FUN off.
use_luna on only if CN and nitrif_denitrif on.
lnc_opt depends on if CN on or off.
FUN on depends on both CN and nitrig_dentrif

FUN is very expensive in this version and causes model to be significantly slower.

Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID): 

    2302 Some missing nh4 arrays set to zero.
    2298 Init method NOT called for NutrientCompetetionFlexibleCN
    2296 Missing meta-data for new data added to params file
    2273 Log output without a "if masterproc " around it...
    2268 Irrigation unit tests broken because of irrigation limiter
    2253 Nitrogen Deposition accidentally turned off when FUN on
    2249 Low LAI over Amazon

Known bugs introduced in this tag (include bugzilla ID):

    2295 ch4 conservation error in ne30 1850 case
    2269 log(0) possibility


Notes of particular relevance for users
---------------------------------------

Caveats for users:
     This changes the default for snow capping from 20m to 10m. If you use an initial condition
     file with 20m of snow it will cut the snow depth to 10m, and send 10m of snow as ice runoff.
     This sudden influx of ice runoff could be problematic for fully coupled simulations to an
     ocean model.

Changes to CLM's user interface:
     New namelist items: leafresp_method, light_inhibit, leaf_acc, rootstem_acc, use_nguardrail
     Remove namelist   : carbon_excess_opt, carbon_storage_excess_opt, dynamic_plant_alloc_opt
     Remove vcmax_opt options 1 and 2

     new namelist group: photosyns_inparm

     carbon_resp_opt should be 0 when use_fun=.true.

     New history fields: Vcmx25Z, Jcmx25Z, LEAFCN, LEAFCN_STORAGE
                         COST_NFIX, COST_NACTIVE, COST_NRETRANS, NUPTAKE_NPP_FRACTION

     add IGM1850CRUCLM50BGCCROP and IGM1850CRUCLM50BGC compsets

Changes made to namelist defaults:

     New defaults: CLM50: leaf_acc, light_inhibit, use_bedrock, use_nguardrail all on
                          leaf_resp=2
                          h2osno_max=10m
                          use_flexibleCN (if CN on)
                          carbon_resp_opt=1 (only if use_cn ON and FUN off)
                          use_luna (only if use_cn and use_nitrif_denitrif on)
                          lnc_opt depends on CN
                          FUN on depends on CN and nitrif_denitrif
                          Change leaf_mr_vcm phys default value

Changes to the datasets:
     New params file for clm5_0 with metadata on new fields. Remove some uneeded
     parameters.

Substantial timing or memory changes: Approximately 20% slower with FUN on


Code reviews and testing
------------------------

Code reviewed by: self,rfisher

CLM testing: regular

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - PASS

  unit-tests (components/clm/src):

    yellowstone - PASS

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - OK
    yellowstone_pgi - OK
    yellowstone_gnu (clm45 only) - OK
    hobart_nag - PASS

CLM tag used for the baseline comparisons:  clm4_5_8_r173


Answer changes  Yes! for CLM50, clm45 and clm40 bit-for-bit
--------------

Changes answers relative to baseline: 

  Summarize any changes to answers, i.e.,
    - what code configurations:  CLM50
    - what platforms/compilers:  All
    - nature of change: new climate

       - casename: /home/oleson/respn14r172_1850spin

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, cism, etc.): None

List all files eliminated:  None

List all files added and what they do:
  A     components/clm/doc/clm3_0_ChangeLog -- split out CLM3.0 section
  A     components/clm/doc/clm4_0_ChangeLog -- split out CLM4.0 section

List all existing files that have been modified, and describe the changes:
M       components/clm/cime_config/config_component.xml
     formatting change, removing extra spaces
M       components/clm/cime_config/config_compsets.xml
     add IGM1850CRUCLM50BGCCROP and IGM1850CRUCLM50BGC compsets
M       components/clm/src/biogeophys/test/Irrigation_test/IrrigationWrapperMod.F90
     Changes from Ben Andre to fix irrigation unit test issue bug 2268
M       components/clm/src/biogeophys/test/Irrigation_test/test_irrigation_singlepatch.pf
     Add new test irrigation_for_limiting_volr
M       components/clm/src/biogeophys/SoilWaterMovementMod.F90
     Remove warning for h2osoi_liq negative. Limit dLow, diag, dUpp, and rhs
     arrays by nlayers.
M       components/clm/src/biogeophys/IrrigationMod.F90
     Make sure a constant is double (_r8)
M       components/clm/src/biogeophys/UrbanParamsType.F90
     Add if_masterproc
MM      components/clm/src/biogeophys/SnowHydrologyMod.F90
     Add min_snow_to_keep, fix bug 2270
M       components/clm/src/biogeophys/LunaMod.F90
     Work on warnings and error conditions.
M       components/clm/src/biogeophys/PhotosynthesisMod.F90
     Make Vcmx25Z, Jcmx25Z default inactive on history. Add ReadNML method
     add leafresp_method, light_inhibit, leaf_acc, rootstem_acc to namelist.
     Remove vcmax_opt=1/2 change to if,else if, else.
M       components/clm/src/soilbiogeochem/SoilBiogeochemDecompCascadeBGCMod.F90
     Add if_masterproc
M       components/clm/src/soilbiogeochem/SoilBiogeochemCompetitionMod.F90
     Add timer around FUN. Add some new terms when FUN on. Use local version
     of use_fun (so optimizer can know it won't change). Write to iulog rather
     than *.
M       components/clm/src/soilbiogeochem/SoilBiogeochemPrecisionControlMod.F90
     Comment out warning
M       components/clm/src/soilbiogeochem/SoilBiogeochemCarbonFluxType.F90
     Remove unneeded use_fun dependence
M       components/clm/src/biogeochem/CNGapMortalityMod.F90
     Remove: carbon_excess_opt, carbon_storage_excess_opt
M       components/clm/src/biogeochem/CNGRespMod.F90
     Remove: carbon_excess_opt and carbon_storage_excess_opt calcs
M       components/clm/src/biogeochem/CNBalanceCheckMod.F90
     Lower carbon balance warning from e-10 to e-9, use iulog rather than *
M       components/clm/src/biogeochem/CNMRespMod.F90
     Add rootstem_acc option which Rosie says "will increase R and decrease
     productivity in boreal forests, A LOT. :)"
M       components/clm/src/biogeochem/CNFUNMod.F90
     Extensive changes from Rosie. Some formatting changes. Add burnedoff_carbon.
     and timer around main FUN calculations. Fix bug 2302 (missing setting of some nh4
     arrays to zero). Base if fixer on c3psn. Add bit about unmet_demand. Loop
     over both fixers and non-fixers, params file has percentage of each for each PFT type.
     Set some things to spval for night. Add new term to directly account for Ben
     Houlton's temperature response function
M       components/clm/src/biogeochem/CNVegNitrogenStateType.F90
     Add if masterproc around writes
M       components/clm/src/biogeochem/NutrientCompetitionFactoryMod.F90
     Pass in bounds and add call to init method
M       components/clm/src/biogeochem/CNPrecisionControlMod.F90
     Make ccrit and ncrit parameters and add n_min (for calculation of CN ratio)
M       components/clm/src/biogeochem/NutrientCompetitionMethodMod.F90
     Add init method to abstract class and add readParams as completed method
M       components/clm/src/biogeochem/CNPhenologyMod.F90
     Add some use_fun changes, add logical for additional_onset_condition
M       components/clm/src/biogeochem/CNCStateUpdate1Mod.F90
     Remove cpool imbalance warning
M       components/clm/src/biogeochem/NutrientCompetitionCLM45defaultMod.F90
     Add init method, move readParams to base class. Check if aleaf is nan
     in calc_plant_nutrient_competition. Set frootn/livestemn "to_retransn" to zero for fun
M       components/clm/src/biogeochem/CNNDynamicsMod.F90
     Remove setting of ndep_to_sminn(c) to zero for FUN, do set nfix_to_sminn to zero
M       components/clm/src/biogeochem/CNVegNitrogenFluxType.F90
     Add new history fields: COST_NFIX, COST_NACTIVE, COST_NRETRANS, NUPTAKE_NPP_FRACTION
     all default on.
M       components/clm/src/biogeochem/CNDriverMod.F90
     Add some more timers. Call CNPrecisionControl after each set of updates
     (if use_nguardrail is on). Move CNPhenology/CNFUNInit call to before 
     nutrient_demand, so that croplive didn't change half way through crop N cycle
M       components/clm/src/biogeochem/NutrientCompetitionFlexibleCNMod.F90
     Add actual_storage_leafcn and actual_leafcn CN ratios and output to history
     and always calculate them. Remove readParams, and add init method. Remove 
     unused dynamic_plant_alloc. Remove "if(use_fun)" and just rely on carbon_resp_opt 
     to be 0 when FUN on. Use n_min as parameter for minimun N used for CN ratio.
M       components/clm/src/biogeochem/CNVegCarbonFluxType.F90
     Add NPP_BURNEDOFF to history file, change ordering
M       components/clm/src/biogeochem/CNVegCarbonStateType.F90
     Add if(masterproc) around write statements
M       components/clm/src/main/clm_varpar.F90
     Add if_masterproc
MM      components/clm/src/main/clm_initializeMod.F90
     Pass bounds_proc to create_nutrient_competition_method
M       components/clm/src/main/findHistFields.pl
     Get working again with all F90 files.
MM      components/clm/src/main/controlMod.F90
     Remove carbon_excess_opt, carbon_storage_excess_opt, dynamic_plant_alloc_opt
     namelist variables. Add use_nguardrail (to preserve answers for clm45 will
     remove later).
M       components/clm/src/main/clm_driver.F90
     Add some timers.
M       components/clm/src/main/clm_varctl.F90
     Remove carbon_excess_opt, carbon_storage_excess_opt, dynamic_plant_alloc_opt
     Add use_nguardrail.
M       components/clm/src/main/pftconMod.F90
     Add some more FUN parameters and remove some uneeded ones.
M       components/clm/src/main/clm_instMod.F90
     Add call to photsyns ReadNML
M       components/clm/src/main/ncdio_pio.F90.in
     Add some if_masterproc
M       components/clm/bld/unit_testers/build-namelist_test.pl
     Add some new tests for new variables
M       components/clm/bld/namelist_files/namelist_definition_clm4_5.xml
     Add rootstem_acc, leaf_acc, light_inhibit, leafresp_method
     use_nguardrail. Improve documentation for some flex-CN options
M       components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml
     New defaults: CLM50: leaf_acc=T, light_inhibit=T,leaf_resp=2, use_bedrock=T
                          h2osno_max=10m, use_flexibleCN (if use_cn=T)
                          carbon_resp_opt=1 (only if use_cn ON and FUN off)
                          use_luna (only is use_cn and use_nitrif_denitrif on)
                          lnc_opt depends on use_cn, use_fun depends on
                          use_cn=T AND use_nitrif_dentrif=T
                          Change leaf_mr_vcm phys default value
                          use_nguardrail=T 
M       components/clm/bld/CLMBuildNamelist.pm
     New photsyns_inparm namelist. carbon_resp_opt should NOT be 1 when FUN on.
     lnc_opt only matters when luna on or vcmax_opt=3/4. leafresp_method MUST be 0 
     if CN off.


===============================================================
===============================================================
Tag name:  clm4_5_8_r173
Originator(s):  sacks (Bill Sacks)
Date: Thu Mar 17 20:24:45 MDT 2016
One-line Summary: Major refactor of CN Products

Purpose of changes
------------------

Variables and code related to CN product pools and fluxes were scattered among
12 modules. In addition, CNWoodProducts was difficult to understand and modify,
because the same basic logic was repeated four times: once for carbon, once for
c13, once for c14 and once for nitrogen.

This tag does a major overhaul of CNWoodProducts - now renamed to CNProducts,
since it includes grain as well as wood products. This is now an object-oriented
class. The major benefits of this overhaul are:

- Only 2 modules now contain any information about the number of product pools
  and their lifetimes: CNProducts and pftconMod. Previously, 12 modules had some
  information about the fact that there were 10 & 100-year product pools. This
  makes it easier to change the number or lifetimes of product pools in the
  future. Code outside CNProducts (and pftconMod) knows that there is some flux
  to wood and crop product pools in general, but doesn't need to know anything
  about how this is partitioned into the 10 and 100-year product pools - or even
  the fact that there are 10 and 100-year product pools.

- Because this product pool information is now self-contained, with a clear
  interface, CNProductsMod could be used by ED, if this were desired.

- Changes to CNProductsMod no longer need to be replicated four times for the
  four different species. Instead, there are four instances of cn_products_type
  declared at a higher level.

This tag also introduces a "species" class (with subclasses for isotope and
non-isotope species), which can be used to remove duplication in the setting of
history and restart variables in classes for which we have one instance for each
species. This is currently used in the new CNProductsMod; eventually it can also
be used in CNVegCarbonStateType, CNVegCarbonFluxType, and the similar
SoilBiogeochem Types (at which point this should probably be moved out of the
biogeochem directory into somewhere like 'utils').

This tag also introduces a utility method for setting one restart field (not
found on the restart file) from another (which was present). This is used in a
few places in CNProductsMod, and should be used in other places as well (e.g.,
see bug 2282).


Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID):
- 2297 (code looks wrong for initializing carbon isotopes from a restart file
  without isotope information)

Known bugs introduced in this tag (include bugzilla ID):
- 2256 (Problems with early versions of PIO2 in CLM) -- shows up in more
  (hobart) tests now, for unclear reasons


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none


Code reviews and testing
------------------------

Code reviewed by: self

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - ok (pass except irrigation expected failure)

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

    ok means tests pass or xfail, some baseline comparisons failed as noted
    below

    Two new expected failures appear to be PIO2 issues:
   <entry bugz="2256" >RUN ERP_Ly5.1x1_numaIA.ICRUCLM50BGCCROP.hobart_nag.clm-monthly</entry>
   <entry bugz="2256" >RUN ERP_Ld5_P24x1.f10_f10.I1850CLM45BGC.hobart_nag.clm-default</entry>


CLM tag used for the baseline comparisons: clm4_5_8_r172


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM45 / CLM50 - anything other than 1850
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      roundoff

   If bitwise differences were observed, how did you show they were no worse
   than roundoff?

     This is complicated; ready? Let's work backwards:

     Branch tag product_pools_gridcell2_n03_clm4_5_8_r172 (which is becoming
     this trunk tag) was bit-for-bit with branch tag
     product_pool_total_fluxes_n01_clm4_5_8_r172 (from branch
     product_pool_total_fluxes), except for roundoff-level changes in c13 / c14
     product pools / fluxes for transient cases with ciso. (Those changes
     remained roundoff-level throughout the simulation, so their roundoff-level
     nature was obvious from the cprnc output.)

     Determining that the changes in product_pool_total_fluxes_n01_clm4_5_8_r172
     were no greater than roundoff-level was tricky, because these differences
     propagated over time. To do this, I created another branch:
     product_total_roundoff, with branch tag
     product_total_roundoff_n01_product_pool_total_fluxes_n01_clm4_5_8_r172. This
     was essentially the same as product_pool_total_fluxes_n01_clm4_5_8_r172,
     except that hrv_deadstemc_to_prod10c and hrv_deadstemc_to_prod100c (and
     same for nitrogen) were computed twice: once the old way and once the new
     way. The updates of deadstemc/n in CStateUpdate2h and NStateUpdate2h (which
     were the uses that caused differenes to propagate to greater than
     roundoff-level) were also done twice: once using the "old" hrv_deadstem
     values, and once with the "new" values. The "old" version was used in the
     rest of the code, but the two versions were compared for every point in
     every time step to ensure that they were never more than roundoff-level
     different. I ran the full test suite on
     product_total_roundoff_n01_product_pool_total_fluxes_n01_clm4_5_8_r172 and
     ensured that it differed by no more than roundoff-level from trunk tag
     clm4_5_8_r172.

     To summarize: I ensured that the only differences greater than
     roundoff-level in the test suite were attributable to differences in the
     order of operations when computing the hrv_deadstem*_to_prod* variables,
     and I also ensured that the new and old calculations of the
     hrv_deadstem*_to_prod* variables never differed by more than roundoff.

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated:

========= Renamed to CNProductsMod.F90
D       components/clm/src/biogeochem/CNWoodProductsMod.F90

List all files added and what they do:

========= Main change - this used to be CNWoodProductsMod.F90, but has been
          completely rewritten, as described above
A       components/clm/src/biogeochem/CNProductsMod.F90

========= Utility classes to hold metadata for classes that can have one
          instance for each species (carbon, nitrogen, c13, c14) - removing
          duplication in the calls to hist_addfld and restartvar
A       components/clm/src/biogeochem/SpeciesNonIsotopeType.F90
A       components/clm/src/biogeochem/SpeciesBaseType.F90
A       components/clm/src/biogeochem/SpeciesIsotopeType.F90
A       components/clm/src/biogeochem/test/Species_test/test_SpeciesNonIsotope.pf
A       components/clm/src/biogeochem/test/Species_test/CMakeLists.txt
A       components/clm/src/biogeochem/test/Species_test/test_SpeciesIsotope.pf
A       components/clm/src/biogeochem/test/Species_test
A       components/clm/src/biogeochem/test/CMakeLists.txt
A       components/clm/src/biogeochem/test

========= Add a short ciso transient test (eventually can remove the long ciso
          transient test and just keep this one)
A       components/clm/cime_config/testdefs/testmods_dirs/clm/ciso_decStart/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/ciso_decStart

List all existing files that have been modified, and describe the changes:

========= Main changes in this tag: remove information about the different
          product pools that are scattered throughout the code, and add some
          objects of cn_products_type
M       components/clm/src/biogeochem/CNCIsoFluxMod.F90
M       components/clm/src/biogeochem/dynHarvestMod.F90
M       components/clm/src/biogeochem/CNCStateUpdate2Mod.F90
M       components/clm/src/biogeochem/CNVegCarbonStateType.F90
M       components/clm/src/biogeochem/dynConsBiogeochemMod.F90
M       components/clm/src/biogeochem/CNVegNitrogenFluxType.F90
M       components/clm/src/biogeochem/CNVegetationFacade.F90
M       components/clm/src/biogeochem/CNVegNitrogenStateType.F90
M       components/clm/src/biogeochem/CNDriverMod.F90
M       components/clm/src/biogeochem/CNPhenologyMod.F90
M       components/clm/src/biogeochem/CNVegCarbonFluxType.F90
M       components/clm/src/biogeochem/CNNStateUpdate2Mod.F90
M       components/clm/src/biogeochem/CNBalanceCheckMod.F90

========= Add utility method for setting an absent restart field from one that
          was present on the initial conditions file
M       components/clm/src/utils/restUtilMod.F90.in

========= Move duplicate code into clm_varcon, and fix bug 2297
M       components/clm/src/main/clm_varcon.F90
M       components/clm/src/soilbiogeochem/SoilBiogeochemCarbonStateType.F90

========= Add a short ciso transient test (eventually can remove the long ciso
          transient test and just keep this one)
M       components/clm/cime_config/testdefs/testlist_clm.xml

========= Add unit tests of new Species classes
M       components/clm/src/CMakeLists.txt
M       components/clm/src/biogeochem/CMakeLists.txt

========= Two new expected failures on hobart; appear to be PIO2-related
M       components/clm/cime_config/testdefs/ExpectedTestFails.xml


===============================================================
===============================================================
Tag name:  clm4_5_8_r172
Originator(s):  sacks (Bill Sacks)
Date: Tue Mar  8 13:10:19 MST 2016
One-line Summary: Exclude land use and product pools / fluxes from CN summary diagnostics

Purpose of changes
------------------

Changed TOTCOLC, TOTECOSYSC, TOTCOLN and TOTECOSYSN (and same for C isotopes) to
no longer include product pools. Also changed NBP and NEE to no longer include
land use or product fluxes (dwt_closs and product_closs).

Removed LAND_UPTAKE diagnostic, because NEE now gives this quantity. Added
NET_CARBON_EXCHANGE, which gives the sum of NEE and the land use flux - i.e.,
what NEE used to be.

Also, changed TOTPRODN to be consistent with TOTPRODC: no longer includes crop
product pool.

The main motivation for this change is the upcoming move of product pools to the
grid cell level. However, this also addresses inconsistencies between CLM's
definition of NEE, etc., and what would be more typically considered in the
literature.

These changes to the meaning of these diagnostics were all proposed and/or
approved by Peter Lawrence.


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions):
- Changes meaning of a number of diagnostics, as noted above

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none


Code reviews and testing
------------------------

Code reviewed by: self

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - ok

    All pass except expected failure in irrigation

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

    All pass or xfail; baseline failures as noted below

CLM tag used for the baseline comparisons: clm4_5_8_r171, but with mods to
produce FCO2 history field (in order to ensure that this tag hasn't changed the
co2 flux sent to the atmosphere).


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: many CLM45 / CLM50 - see below for details
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      roundoff for prognostic fields, larger than roundoff for some diagnostic fields

      Significant changes in the diagnostic fields noted under "purpose of
      changes", above, for transient, CNDV and crop runs, and for year-2000 runs
      that used initial conditions from a transient run (so presumably had
      non-zero product pools). Changes in these diagnostic fields (if any) are
      roundoff-level for non-crop, non-CNDV, non-crop 1850 runs.

      Roundoff-level changes in CO2 flux sent to atmosphere and new FCO2
      diagnostic field for some runs.

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Main changes as described above. Some files just changed because some
          uses of nee have been changed to net_carbon_exchange.
M       components/clm/src/cpl/lnd_import_export.F90
M       components/clm/src/biogeochem/CNVegetationFacade.F90
M       components/clm/src/biogeochem/CNVegNitrogenStateType.F90
M       components/clm/src/biogeochem/CNVegCarbonFluxType.F90
M       components/clm/src/biogeochem/CNVegCarbonStateType.F90
M       components/clm/src/main/clm_driver.F90
M       components/clm/src/main/lnd2atmMod.F90

========= Since total column C / N no longer includes the product pools, the CN
          balance checks needed to be changed so that outputs from the system
          include fluxes into the product pools, but NOT fluxes out of the
          product pools (the product pools are outside of the system as far as
          the balance checks are concerned)
M       components/clm/src/biogeochem/CNBalanceCheckMod.F90

========= Fluxes into the product pools now need to be saved for the sake of the
          balance checks
M       components/clm/src/biogeochem/CNPhenologyMod.F90
M       components/clm/src/biogeochem/CNWoodProductsMod.F90
M       components/clm/src/biogeochem/CNVegNitrogenFluxType.F90

========= Output FCO2 (co2 flux to atmosphere), since otherwise this isn't
          covered by any of our tests - since our tests don't turn on this
          coupling field
M       components/clm/src/main/lnd2atmType.F90
M       components/clm/cime_config/testdefs/testmods_dirs/clm/default/user_nl_clm

========= Add expected baseline failure (bug 2291)
M       components/clm/cime_config/testdefs/ExpectedTestFails.xml

===============================================================
===============================================================
Tag name:  clm4_5_8_r171
Originator(s):  erik (Erik Kluzek)
Date:  Wed Mar  2 23:53:40 MST 2016
One-line Summary: Backout COMP_RUN_BARRIERS setting, and remove all ED tests from testlist (as they all fail)

Purpose of changes
------------------

Backout the setting of COMP_RUN_BARRIERS. It has a nasty side effect of disabling the
automatic setting of CONTINUE_RUN=TRUE when RESUBMIT>1. See bug 2280. Now production
simulations with I compsets will fail because datm is allowed to get ahead of CLM.

Also remove all of the ED tests from the testlists as they currently all fail.

Known bugs introduced in this tag (include bugzilla ID): bug 2280

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): None

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): None

Changes made to namelist defaults (e.g., changed parameter values): None

Changes to the datasets (e.g., parameter, surface or initial files): None

Substantial timing or memory changes:


Code reviews and testing
------------------------

Code reviewed by: self

CLM testing: short

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  regular tests:

    yellowstone_intel - clm_short_45 -- PASS

CLM tag used for the baseline comparisons:  clm4_5_8_r170


Answer changes
--------------

Changes answers relative to baseline: No, bit-for-bit

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, cism, etc.): None

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

   M components/clm/cime_config/config_component.xml ------- Remove setting of COMP_RUN_BARRIERS
   M components/clm/cime_config/testdefs/testlist_clm.xml -- remove all ED tests

===============================================================
===============================================================
Tag name:  clm4_5_8_r170
Originator(s):  sacks (Bill Sacks)
Date: Sun Feb 28 20:33:37 MST 2016
One-line Summary: Add a wrapper for CN Vegetation

Purpose of changes
------------------

This tag introduces a wrapper (or "facade" in software design terms) for the CN
vegetation types and modules.

My main motivations were:

(1) Insulating the rest of the code from changes in the CNVeg
implementation. For example, I'm about to introduce a class to hold variables
related to the product pools. With the old implementation, I would have to touch
a number of modules outside of the biogeochem directory in order to do this; now
I won't.

(2) Simplifying interfaces to subroutines  reducing the number of arguments.

(3) Starting to put in place a structure that could be leveraged to support CN
and ED (and SP) side-by-side, polymorphically, so that we don't need 'if use_cn'
/ 'if use_ed' conditionals scattered throughout the code or direct "use"
statements of types in CN / ED / etc.

The changes here are a big first step towards these goals, although this isn't
yet complete. There are some notes in comments in CNVegetationFacade.F90 listing
some things that should still be done.


Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID):
- 2276: Need ne30_g16 surface dataset with crop for CLM45/CLM50
- 2291: fire emissions NaN with gnu compiler


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none


Code reviews and testing
------------------------

Code reviewed by: a bit of review by Erik Kluzek and Ben Andre

CLM testing:

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - ok

    ok means: all tests pass except expected irrigation failure

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

    There was one unexpected baseline failure:
    SMS_Lm25.f19_g16.ICLM45BGCCROP.yellowstone_gnu.clm-cropMonthOutput

    Upon investigation, it appeared that this was a problem in the previous tag
    (and possibly earlier): fire emissions differed between the trunk and this
    branch, and were often NaN in the trunk version (but no longer NaN on this
    branch). This seems most likely to be a compiler-related problem, since it
    seems to just appear with gnu. See bug 2291.

CLM tag used for the baseline comparisons: clm4_5_8_r169


Answer changes
--------------

Changes answers relative to baseline: NO

  (However, see above notes about the baseline failure due to bug 2291.)

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated:

========= Moved some modules from dyn_subgrid into biogeochem (no changes to contents)
D       components/clm/src/dyn_subgrid/dynCNDVMod.F90
D       components/clm/src/dyn_subgrid/dynHarvestMod.F90
D       components/clm/src/dyn_subgrid/dynConsBiogeochemMod.F90

List all files added and what they do:

========= New module, providing a wrapper / facade for the CNVeg stuff;
          this is the crux of the change
A       components/clm/src/biogeochem/CNVegetationFacade.F90

========= Moved some modules from dyn_subgrid into biogeochem (no changes to contents)
A       components/clm/src/biogeochem/dynCNDVMod.F90
A       components/clm/src/biogeochem/dynHarvestMod.F90
A       components/clm/src/biogeochem/dynConsBiogeochemMod.F90

List all existing files that have been modified, and describe the changes:

========= Moved stuff out of these places into the new CNVeg, and simplified
          some interfaces
M       components/clm/src/main/clm_driver.F90
M       components/clm/src/main/clm_initializeMod.F90
M       components/clm/src/main/clm_instMod.F90
M       components/clm/src/dyn_subgrid/dynSubgridDriverMod.F90

========= Rather than passing CNVeg derived types, instead directly pass the
          small number of arrays that are needed from CNVeg (removes dependence
          on the CNVeg types, which is needed if we ever want to make CNVeg
          polymorphic; also makes the connection between CNVeg and other parts
          of the model more explicit)
M       components/clm/src/biogeophys/CanopyFluxesMod.F90
M       components/clm/src/biogeophys/PhotosynthesisMod.F90
M       components/clm/src/main/lnd2atmMod.F90
M       components/clm/src/biogeochem/ch4Mod.F90

========= Added a bit of time manager functionality, and some unit tests
M       components/clm/src/utils/clm_time_manager.F90
M       components/clm/src/unit_test_shr/unittestTimeManagerMod.F90
M       components/clm/src/utils/test/clm_time_manager_test/test_clm_time_manager.pf

========= Moved some crop-specific variables out of CNVegStateType into CropType
          (but there are still more that need to be moved)
M       components/clm/src/biogeochem/CNVegStateType.F90
M       components/clm/src/biogeochem/CropType.F90
M       components/clm/src/biogeochem/CNPhenologyMod.F90
M       components/clm/src/biogeochem/CNCStateUpdate1Mod.F90
M       components/clm/src/biogeochem/NutrientCompetitionCLM45defaultMod.F90
M       components/clm/src/biogeochem/NutrientCompetitionFlexibleCNMod.F90
M       components/clm/src/biogeochem/NutrientCompetitionMethodMod.F90
M       components/clm/src/biogeochem/CNNDynamicsMod.F90
M       components/clm/src/biogeochem/CNVegStructUpdateMod.F90
M       components/clm/src/biogeochem/CNRootDynMod.F90
M       components/clm/src/biogeochem/CNDriverMod.F90

========= Unrelated change: fix xml entries for ne30 and ne120 surface datasets
          (bug 2276)
M       components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml

========= Restore expected failure that seems to have been deleted accidentally
M       components/clm/cime_config/testdefs/ExpectedTestFails.xml

===============================================================
===============================================================
Tag name:  clm4_5_8_r169
Originator(s):  erik (Erik Kluzek)
Date: Tue Feb 23 14:35:02 MST 2016
One-line Summary: Add fire several fire constants to namelist, add some new clm45/50 surface datasets

Purpose of changes
------------------

   Add a bunch of constants to the namelist for the CN Li fire parameterization.
   They are added in the new lifire_inparm namelist.

   Work on user interface a bit. 
     * New lifire_inparm namelist (see above)
     * Add CLM_ACCELERATED_SPINNUP env_run variable
     * Turn COMP_RUN_BARRIERS for f09 and f19 resolutions
     * New compsets: ICLM50BGCDVCROP, IHISTCLM50BGC
     * Model dies if CLM namelist isn't found
     * Models dies if use_bedrock=.true. and zbedrock NOT on surface dataset
     * Remove use_nofire move to fire_method as "nofire" option

   Add some new clm45/50 surface datasets for crop at 1850 for f45, ne30, and ne120
   Add back in the USUMB PTCLMmkdata dataset directory for testing.

   Work on testing a bit. Remove CLM50 testmods directories just there because of
   missing CLM50 compsets. Add set of complete clm40 testmod directories. Add nofire
   test, update USUMB test.  Remove use_dynroot from all but Kitchen sink tests.

Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID): [If none, remove this line]
   2285 Problem creating ne120 surface dataset
   2280 (partial) need to set barriers for concurrent PE layouts with I compsets
   2279 Need new USUMB PTCLMmkdata directory
   2276 New ne30, ne120, f45 surface datasets for CLM45/50 1850 CROP

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions):

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables):

    Introduce new env_run variable: CLM_ACCELERATED_SPINUP (It can be "on" or "off")
    When "on" it sets the simulation up in such a way for it to run in an accelerated
    fashion

   (currently all it does is turn "-bgc_spinup on" if 

   NOTE: Turns on COMP_RUN_BARRIERS by default for f09 and f19 resolutions as they
         are usually run concurrent (f09 is by default).

   Add new CLM namelist: lifire_inparm

   Add new compsets: ICLM50BGCDVCROP, IHISTCLM50BGC

   NOTE: Model will now die if you set use_bedrock=.true., and your surface dataset
         doesn't have zbedrock on it.

   WARNING: Now if a CLM namelist is NOT found -- the model will abort with an error.

Changes made to namelist defaults (e.g., changed parameter values): Many new namelist items

   New CN fire namelist items: rh_low, rh_hgh, bt_min, bt_max, cli_scale,
       boreal_peatfire_c, pot_hmn_ign_counts_alpha, non_boreal_peatfire_c,
       cropfire_a1, and occur_hi_gdp_tree
   They are set by default according to either fire_method=li2014qianfrc or li2016crufrc

   use_nofire removed and "nofire" added as an option to fire_method

Changes to the datasets (e.g., parameter, surface or initial files): A few new surface datasets
   New 1850 clm45/50 surface datasets for: f45, ne30, ne120
   Alos new PTCLMmkdata USUMB directory

Substantial timing or memory changes: None known


Code reviews and testing
------------------------

Code reviewed by: self

CLM testing: regular

  build-namelist tests:

    yellowstone -   OK (36 comparison tests fail because of new namelist)

  unit-tests (components/clm/src):

    yellowstone -  OK

  tools-tests (components/clm/test/tools):

    yellowstone - PASS

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - OK
    yellowstone_pgi - OK
    yellowstone_gnu (clm45 only) - OK
    hobart_nag - OK

 [PASS means all tests PASS and OK means tests PASS other than expected fails.]

 Two comparision tests (ro clm4_5_8_r168) fail, because use_dynroot no longer on.

CLM tag used for the baseline comparisons: clm4_5_8_r168


Answer changes
--------------

Changes answers relative to baseline: No bit-for-bit

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, cism, etc.): None

List all files eliminated:

   Eliminate testmods directories just needed for CLM50 compsets
   Now that compsets are added they are unneeded.

 D components/clm/cime_config/testdefs/testmods_dirs/clm/clm50BGCCROPmonthly/include_user_mods
 D components/clm/cime_config/testdefs/testmods_dirs/clm/clm50BGCCROPmonthly/shell_commands
 D components/clm/cime_config/testdefs/testmods_dirs/clm/clm50BGCDVCROPmonthly/include_user_mods
 D components/clm/cime_config/testdefs/testmods_dirs/clm/clm50BGCDVCROPmonthly/shell_commands
 D components/clm/cime_config/testdefs/testmods_dirs/clm/clm50BGCmonthly/include_user_mods
 D   components/clm/cime_config/testdefs/testmods_dirs/clm/clm50BGCmonthly/shell_commands

List all files added and what they do:

A  +    components/clm/src/biogeochem/CNFireNoFireMod.F90 -- No fire option

        New testmods for nofire, clm40 tests, and USUMB PTCLMmkdata directory
A  +    components/clm/cime_config/testdefs/testmods_dirs/clm/nofire
A  +    components/clm/cime_config/testdefs/testmods_dirs/clm/40crop
A  +    components/clm/cime_config/testdefs/testmods_dirs/clm/40pts
A  +    components/clm/cime_config/testdefs/testmods_dirs/clm/40ptsRLA
A  +    components/clm/cime_config/testdefs/testmods_dirs/clm/40ptsRLB
A  +    components/clm/cime_config/testdefs/testmods_dirs/clm/40ptsROA
A  +    components/clm/cime_config/testdefs/testmods_dirs/clm/40reduceOutput
A  +    components/clm/cime_config/testdefs/testmods_dirs/clm/USUMB/shell_commands

List all existing files that have been modified, and describe the changes:

 M   components/clm/bld/CLMBuildNamelist.pm --- Add new fire constants and lifire_inparm
        namelist. Allow spinup state to be 1 or 2, and document better
 M   components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml -- When
       -bgc_spinup on, spinup_state=1 for clm45 and 2 for clm50. Add new
       fire constants set to values for either lifire2014qianfrc or lifire2016crufrc
       new f45, ne30, ne120 datasets (bug 2276)
 M   components/clm/bld/namelist_files/namelist_definition_clm4_5.xml -- Add
       nofire option to fire_method, remove use_nofire, and add new fire
       constants
 M   components/clm/cime_config/buildnml --- Add CLM_ACCELERATED_SPINUP
       set "-bgc_spinup on" if CLM_ACCELERATED_SPINUP="on"

 M   components/clm/cime_config/config_component.xml -- Set COMP_RUN_BARRIERS (bug 2280)
         to TRUE for f09 and f19 resolutions. Define CLM_ACCELERATED_SPINUP.
 M   components/clm/cime_config/config_compsets.xml -- Add ICLM50BGCDVCROP
         and IHISTCLM50BGC compsets

 M   components/clm/cime_config/testdefs/testlist_clm.xml --- move all clm40
       tests to have 40 testmods directories, add f45 nofire test, remove clm50
       testmods just use new CLM50 compsets
 M   components/clm/cime_config/testdefs/testmods_dirs/clm/USUMB/user_nl_clm -- update (bug 2279)
 M   components/clm/cime_config/testdefs/testmods_dirs/clm/USUMB/xmlchange_cmnds -- update
 M   components/clm/cime_config/testdefs/testmods_dirs/clm/ciso_flexCN_FUN/user_nl_clm -- remove use_dynroot
 M   components/clm/cime_config/testdefs/testmods_dirs/clm/crop/include_user_mods -- point to default NOT 40default
 M   components/clm/cime_config/testdefs/testmods_dirs/clm/flexCN_FUN/user_nl_clm -- remove use_dynroot
 M   components/clm/cime_config/testdefs/testmods_dirs/clm/pts/include_user_mods -- point to default not 40default
 M   components/clm/cime_config/testdefs/testmods_dirs/clm/reduceOutput/shell_commands -- remove -no-fire_emis

 M   components/clm/src/biogeochem/CNFireBaseMod.F90 ----- add cnfire_const object
        and CNFireReadNML method, put li2016 version of FireFluxes in place (can be
        shared by li2014 and li2016).
 M   components/clm/src/biogeochem/CNFireFactoryMod.F90 -- Abort if namelist not
        found, and add nofire case for fire_method.
 M   components/clm/src/biogeochem/CNFireLi2014Mod.F90 --- Use constants from cnfire_const 
        object in CNFireBaseMod, remove use_nofire option
 M   components/clm/src/biogeochem/CNFireLi2016Mod.F90 --- Use constants from cnfire_const
        object in CNFireBaseMod, remove use_nofire option, remove CNFireFluxes
 M   components/clm/src/biogeochem/CNFireMethodMod.F90 --- Add CNFireReadNML_interface
 M   components/clm/src/biogeochem/CNMRespMod.F90 -------- abort if can't find namelist
 M   components/clm/src/biogeochem/CNSharedParamsMod.F90 ----- abort if can't find namelist
 M   components/clm/src/biogeochem/SatellitePhenologyMod.F90 - abort if can't find
namelist
 M   components/clm/src/biogeochem/VOCEmissionMod.F90
 M   components/clm/src/biogeochem/ch4varcon.F90 ---------- abort if can't find namelist
 M   components/clm/src/biogeophys/CanopyHydrologyMod.F90 - abort if can't find namelist
 M   components/clm/src/biogeophys/CanopyStateType.F90 ---- abort if can't find namelist
 M   components/clm/src/biogeophys/HumanIndexMod.F90 ------ abort if can't find namelist
 M   components/clm/src/biogeophys/RootBiophysMod.F90 ----- abort if can't find namelist
 M   components/clm/src/biogeophys/SnowHydrologyMod.F90 --- abort if can't find namelist
 M   components/clm/src/biogeophys/SoilHydrologyType.F90 -- abort if can't find namelist
 M   components/clm/src/biogeophys/SoilStateInitTimeConstMod.F90 - abort if can't find namelist
 M   components/clm/src/biogeophys/SoilWaterMovementMod.F90 - abort if can't find namelist
 M   components/clm/src/biogeophys/SurfaceResistanceMod.F90 - abort if can't find namelist
 M   components/clm/src/biogeophys/UrbanParamsType.F90 ------ abort if can't find namelist
 M   components/clm/src/dyn_subgrid/dynSubgridControlMod.F90  abort if can't find namelist
 M   components/clm/src/dyn_subgrid/dynpftFileMod.F90 ------- abort if can't find namelist
 M   components/clm/src/init_interp/initInterp.F90 ---------- abort if can't find namelist
 M   components/clm/src/main/clm_initializeMod.F90 ---------- Pass NL_Filename to create_cnfire_method
 M   components/clm/src/main/clm_varcon.F90 ----------------- Add secsphr
 M   components/clm/src/main/clm_varctl.F90 ----------------- Remove use_nofire
 M   components/clm/src/main/controlMod.F90 ----------------- Remove use_nofire, abort
        if can't find namelists
 M   components/clm/src/main/glcBehaviorMod.F90 ------------- abort if can't find namelist
 M   components/clm/src/main/initVerticalMod.F90 ------------ abort if can't find namelist        and abort if use_bedrock and zbedrock NOT on surface dataset
 M   components/clm/src/main/ndepStreamMod.F90 -------------- abort if can't find namelist

 M   components/clm/src/main/restFileMod.F90 ---------------- abort if can't find namelist 

 M   components/clm/tools/clm4_5/mksurfdata_map/Makefile.data -- by default create crop
          1850 f45, ne30, ne120 datasets
 M   components/clm/tools/clm4_5/mksurfdata_map/src/mkpftMod.F90 - Lower tolerance to
          relerr = 0.0001 (bug 2285)

===============================================================
===============================================================
Tag name:  clm4_5_8_r168
Originator(s):  Keith Oleson; brought to trunk by Bill Sacks
Date: Sat Feb 20 20:55:19 MST 2016
One-line Summary: Fix zero methane production

Purpose of changes
------------------

Methane production has been zero ever since the hydrology reordering in
clm4_5_13 (in June, 2013). The order of subroutine calls appears to be a
problem:
1. CNDriverNoLeaching is called in clm_driver, which calls SetValues, which
   zeros out the carbon fluxes (e.g., somhr and lithr)
2. ch4 is called which uses the zero-ed out fluxes
3. Summary is called which sums up the soil layer som and litter heterotrophic
   respiration terms which should be used by ch4, but are not.

This tag puts the call to ch4 back where it was in clm4_5_12 and earlier.

Keith Oleson found and fixed this bug; Bill Sacks brought it to the trunk.


Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID):
- 2225: CH4PROD=0
- 2287: Methane production is zero

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions):
- Changes answers far more than you might immediately suspect; this was deemed
  to be reasonable at the 02/18/2016 TSS meeting

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none


Code reviews and testing
------------------------

Code reviewed by: Keith Oleson, Bill Sacks

CLM testing:

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - not run

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

    'ok' means: tests pass or xfail, some baseline comparisons fail as noted below

CLM tag used for the baseline comparisons: clm4_5_7_r167


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM45 & CLM50 with BGC turned on
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      New climate

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: clm5_respn05r162_2degGSWP3_1850spin_allN_v01_ch4A_785_799

   URL for LMWG diagnostics output used to validate new climate:
	http://www.cgd.ucar.edu/tss/clm/diagnostics/clm5_dev/clm5_respn05r162_2degGSWP3_1850spin_allN_v01_ch4A_785_799-clm5_respn05r162_2degGSWP3_1850spin_allN_v01_785_799/setsIndex.html

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Move ch4 call to where it was in clm4_5_12 and earlier
M       components/clm/src/main/clm_driver.F90

===============================================================
===============================================================
Tag name:  clm4_5_7_r167
Originator(s):  sacks (Bill Sacks)
Date: Sat Feb 20 06:24:52 MST 2016
One-line Summary: Fix carbon isotopes in transient runs

Purpose of changes
------------------

In CNWoodProducts, code that was supposed to operate on c13 / c14 variables was
actually operating on the standard c12 variable. This led to incorrect results
and carbon balance errors if running with carbon isotopes in transient runs.

Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID):
- 2207: bug in carbon isotopes in CNWoodProducts


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none


Code reviews and testing
------------------------

Code reviewed by: self

CLM testing:

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - not run

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - pass
    yellowstone_pgi - pass
    yellowstone_gnu (clm45 only) - pass
    hobart_nag - pass

CLM tag used for the baseline comparisons: clm4_5_7_r166


Answer changes
--------------

Changes answers relative to baseline: NO

   In principle, changes answers for transient runs with carbon isotopes
   enabled, but since those runs were previously crashing (due to carbon balance
   errors), I am listing this as no answer changes.        


Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do:

========= Add a long, transient test with carbon isotopes
A       components/clm/cime_config/testdefs/testmods_dirs/clm/ciso_monthly/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/ciso_monthly/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/ciso_monthly

List all existing files that have been modified, and describe the changes:

========= Main change
M       components/clm/src/biogeochem/CNWoodProductsMod.F90

========= Add a long, transient test with carbon isotopes
M       components/clm/cime_config/testdefs/testlist_clm.xml

===============================================================
===============================================================
Tag name:  clm4_5_7_r166
Originator(s):  sacks (Bill Sacks)
Date: Tue Feb  2 04:58:45 MST 2016
One-line Summary: Infrastructure for carbon and nitrogen conservation with dynamic landunits

Purpose of changes
------------------

Puts in place the infrastructure that will be used for carbon and nitrogen
conservation, and possibly other column-level conservation, with dynamic
landunits.

This does NOT yet implement any of teh actual carbon and nitrogen conservation -
that will be done in an upcoming tag via uses of this new infrastructure.

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none


Code reviews and testing
------------------------

Code reviewed by: High-level (design) review by Erik Kluzek and Ben Andre

CLM testing:

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - pass
    yellowstone_pgi - pass
    yellowstone_gnu (clm45 only) - pass
    hobart_nag - pass

CLM tag used for the baseline comparisons: clm4_5_7_r165


Answer changes
--------------

Changes answers relative to baseline: NO

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, cism, etc.):

List all files eliminated:

List all files added and what they do:

========= Main new code: class for adjusting column-level state variables due to
          transient column areas
A       components/clm/src/dyn_subgrid/dynColumnStateUpdaterMod.F90
A       components/clm/src/dyn_subgrid/test/dynColumnStateUpdater_test/CMakeLists.txt
A       components/clm/src/dyn_subgrid/test/dynColumnStateUpdater_test/test_column_state_updater.pf
A       components/clm/src/dyn_subgrid/test/dynColumnStateUpdater_test

========= Find a template column to use for the state variables on some other
          column of interest. Used by both dynColumnStateUpdater and
          dynInitColumns.
A       components/clm/src/dyn_subgrid/dynColumnTemplateMod.F90
A       components/clm/src/dyn_subgrid/test/dynColumnTemplate_test/test_column_template.pf
A       components/clm/src/dyn_subgrid/test/dynColumnTemplate_test/CMakeLists.txt
A       components/clm/src/dyn_subgrid/test/dynColumnTemplate_test

========= Add test of get_ltype_special
A       components/clm/src/unit_test_shr/test/unittestSubgrid_test/test_unittestSubgrid.pf
A       components/clm/src/unit_test_shr/test/unittestSubgrid_test/CMakeLists.txt
A       components/clm/src/unit_test_shr/test/unittestSubgrid_test

List all existing files that have been modified, and describe the changes:

========= Initialize a column state updater object, and set the old and new
          weights in each time step
M       components/clm/src/dyn_subgrid/dynSubgridDriverMod.F90

========= Extract initial_template_col and some related code into a new class
          (dynColumnTemplateMod)
M       components/clm/src/dyn_subgrid/dynInitColumnsMod.F90

========= New function: landunit_is_special
M       components/clm/src/main/landunit_varcon.F90
M       components/clm/src/main/initSubgridMod.F90

========= Just add a comment
M       components/clm/src/dyn_subgrid/dynPriorWeightsMod.F90

========= Add get_ltype_special function
M       components/clm/src/unit_test_shr/unittestSubgridMod.F90

========= Move test of extracted code to new directory
M       components/clm/src/dyn_subgrid/test/dynInitColumns_test/test_init_columns.pf

========= Add files for unit test build
M       components/clm/src/dyn_subgrid/CMakeLists.txt
M       components/clm/src/unit_test_shr/test/CMakeLists.txt
M       components/clm/src/dyn_subgrid/test/CMakeLists.txt

===============================================================
===============================================================
Tag name:  clm4_5_7_r165
Originator(s):  sacks (Bill Sacks)
Date: Fri Jan 29 05:28:46 MST 2016
One-line Summary: Remove fglcmask, recreate all surface datasets

Purpose of changes
------------------

Remove fglcmask input file. This specified the area where we need virtual
glacier elevation classes for coupling to CISM. There were two main problems
with this:

- There was a separate file for each CLM resolution at which we can couple to
  CISM - currently this is just f09, f19, T31. There was no easy way to generate
  these files for all CLM resolutions - which is something that is needed in
  order to turn GLC on by default in all CESM runs.

- This did not provide the flexibility needed to treat three regions
  differently: Greenland (virtual columns), Antarctica (multiple elevation
  classes, but no virtual columns), and mountain glaciers (single elevation
  class).

This tag removes the fglcmask file, replacing it with an integer-valued
GLACIER_REGION field on the surface dataset, together with a
glacier_region_behavior namelist option.

I have generated all new surface datasets. In addition to adding the
GLACIER_REGION field, these:
- add zbedrock (most out-of-the-box surface datasets did not yet have this
  field)
- remove unused TOPO field

There are also new initial conditions files, simply for the sake of updating the
surface_dataset metadata.

Also changed mksurfdata_map's Makefile.data and perl script (including adding a
-no_surfdata flag) so that the necessary out-of-the-box surface datasets are all
created correctly (with correct names). Also did some other cleanup of
mksurfdata.pl.

Also removed kludgey Greenland and Antarctica areas from history file, which
weren't being used.


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions):

   - New surface datasets have zbedrock, in contrast to many old datasets. This
     means that runs with use_bedrock = .true. will actually use bedrock now,
     changing answers

   - For any run with glc_mec (compsets with CISM): will need to run initial
     conditions through init_interp

   - For any initial conditions file of your own that was generated from an
     earlier CLM tag (i.e., not an out-of-the-box initial conditions file): will
     need to set check_finidat_fsurdat_consistency to .false., because surface
     datasets have changed

   - 1/8 deg surface dataset hasn't been updated, so won't work with this tag

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables):

   - New namelist variable: glacier_region_behavior

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files):

   - all new surface datasets; these are the same as before, but have:
     - GLACIER_REGION added
     - TOPO removed
     - zbedrock added (wasn't yet on most default surface datasets)

   - new initial conditions files: just updated surface_dataset metadata to
     point to new surface datasets

Substantial timing or memory changes: NONE


Code reviews and testing
------------------------

Code reviewed by: self

CLM testing:

  build-namelist tests:

    yellowstone - pass

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - pass
       010 blg54 failed due to problems / differences in the baseline; when I
       fixed those, it passed

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

    ok means: all tests pass or xfail. Baseline comparisons fail for IG tests
    and ERS_D_Ld3.f10_f10.ICRUCLM50BGC.yellowstone_intel.clm-deepsoil_bedrock,
    as noted below.

CLM tag used for the baseline comparisons: clm4_5_7_r164


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations:
      - configurations with glc_mec (compsets with CISM)
      - configurations with use_bedrock = .true. for which zbedrock wasn't
        previously on the surface dataset
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      larger than roundoff; not investigated closely


      The answer changes in glc_mec runs are due to small changes in the set of
      grid cells in the single_at_atm_topo zone. I confirmed that, if I use a
      kludged-in GLACIER_REGION field that exactly matches the old fglcmask, then
      answers are bit-for-bit.

      The answer changes in use_bedrock configurations are presumably due to
      zbedrock being on the surface datasets now.

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, cism, etc.): No updates
to top-level externals; updated PTCLM to allow build on pronghorn (same as
yellowstone / caldera)

List all files eliminated:

========= Mostly-unrelated change: remove unused fields from history file (these
          specified Greenland and Antarctica areas in a kludgey way)
D       components/clm/src/main/glcDiagnosticsMod.F90

========= Renamed to be consistent with new naming convention
D       components/clm/tools/clm4_5/mksurfdata_map/landuse_timeseries_hist_simyr1850-2005.txt

List all files added and what they do:

========= Add GLACIER_REGION field to surface dataset
A       components/clm/tools/clm4_5/mksurfdata_map/src/mkglacierregionMod.F90

========= Renamed to be consistent with new naming convention
A       components/clm/tools/clm4_5/mksurfdata_map/landuse_timeseries_hist_16pfts_simyr1850-2005.txt


List all existing files that have been modified, and describe the changes:

========= Remove glcmask. Instead make glcBehavior based on GLACIER_REGION on
          the surface dataset
M       components/clm/src/utils/domainMod.F90
M       components/clm/src/main/controlMod.F90
M       components/clm/src/main/test/glcBehavior_test/test_glcBehavior.pf
M       components/clm/src/main/glc2lndMod.F90
M       components/clm/src/main/clm_varctl.F90
M       components/clm/src/main/surfrdMod.F90
M       components/clm/src/main/clm_instMod.F90
M       components/clm/src/main/glcBehaviorMod.F90
M       components/clm/src/main/clm_initializeMod.F90

========= Add GLACIER_REGION to surface datasets. Point to all new surface
          datasets. Also new initial conditions files - identical to old ones
          except for surface_dataset metadata. Also, remove fglcmask namelist
          option and add glacier_region_behavior namelist option.
M       components/clm/tools/clm4_5/mksurfdata_map/mksurfdata_map.namelist
M       components/clm/tools/clm4_5/mksurfdata_map/README
M       components/clm/tools/clm4_5/mksurfdata_map/README.developers
M       components/clm/tools/clm4_5/mksurfdata_map/src/mksurfdat.F90
M       components/clm/tools/clm4_5/mksurfdata_map/src/README.unit_testing
M       components/clm/tools/clm4_5/mksurfdata_map/src/Srcfiles
M       components/clm/tools/clm4_5/mksurfdata_map/src/mkvarctl.F90
M       components/clm/tools/clm4_5/mksurfdata_map/src/mkfileMod.F90
M       components/clm/tools/clm4_5/mksurfdata_map/unit_testers/Srcfiles
M       components/clm/bld/CLMBuildNamelist.pm
M       components/clm/bld/namelist_files/checkmapfiles.ncl
M       components/clm/bld/namelist_files/namelist_definition_clm4_5.xml
M       components/clm/bld/namelist_files/namelist_defaults_clm4_5_tools.xml
M       components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml
M       components/clm/cime_config/testdefs/testmods_dirs/clm/interp_f19_crop/user_nl_clm
M       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_spunup_1way/user_nl_clm
M       components/clm/cime_config/testdefs/testmods_dirs/clm/clm50KitchenSink/user_nl_clm
M       components/clm/cime_config/testdefs/testmods_dirs/clm/interp_f19_noncrop/user_nl_clm
M       components/clm/doc/UsersGuide/tools.xml
M       components/clm/doc/UsersGuide/adding_files.xml

========= Make new routine for printing diagnostics of index fields
M       components/clm/tools/clm4_5/mksurfdata_map/src/mkdiagnosticsMod.F90
M       components/clm/tools/clm4_5/mksurfdata_map/src/mkagfirepkmonthMod.F90
M       components/clm/tools/clm4_5/mksurfdata_map/src/mkurbanparMod.F90

========= Fix makefile-based creation of surface datasets so that 'make all'
          gives correctly-named datasets for all needed out-of-the-box surface
          datasets
M       components/clm/tools/clm4_5/mksurfdata_map/Makefile.data
M       components/clm/tools/clm4_5/mksurfdata_map/mksurfdata.pl

========= Point to new PTCLM: allow testing on pronghorn (same as yellowstone)
M       components/clm/tools/SVN_EXTERNAL_DIRECTORIES

========= Add tests to xfail list. These all failed in clm4_5_7_r164 except for these new failures:
          +   <entry bugz="2277" >RUN ERS_Ly3.f10_f10.I1850CRUCLM50BGCCROP.yellowstone_intel.clm-clm50KSinkMOut</entry>
          +   <entry bugz="2279" >RUN SMS_D_Lm1_Mmpi-serial.CLM_USRDAT.I1PTCLM45.yellowstone_pgi.clm-USUMB</entry>
M       components/clm/cime_config/testdefs/ExpectedTestFails.xml

===============================================================
===============================================================
Tag name:  clm4_5_7_r164
Originator(s):  erik (Erik Kluzek)
Date: Tue Jan 12 00:51:25 MST 2016
One-line Summary: Update CIME and MOSART

Purpose of changes
------------------

Update CLM to a robust version of CIME and PIO2 (used in the cesm1_5_beta04 tag). 
Also fix an issue in MOSART that changes answers (qgwl_volume must be multiplied 
by area). 

Note, that this version of CIME removes the archive.locked directory.

Change the rearranger that PIO uses from being hardcoded to using the one
picked  with the env_run.xml variable LND_PIO_REARRANGER (both clm40 and clm45).
By default, as before the rearranger for clm40 is the new SUBSET option, and 
for clm45/clm50 it's the old BOX method, eventually we expect both to use
the SUBSET method by default.


Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID): 
   2265 Workaround for pio_syncfile issue
   2257 Unit tests fail
   2256 Issues with early versions of PIO2

Bugs found recently:
   2264 Fire is missing accounting of C/N for transfer of live to dead

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions):
   This version of CIME now creates cimeteststatus instead of cs.status when create_test used
      (use the summary option to cimeteststatus "-s"!)
   Remove the archive.locked functionality and the creation of the associated hardlinks
   Removed the option DOUT_S_SAVE_DATES_RESTART_FILE_SET 

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): pio rearranger
   set the rearranger for PIO to use by the env_run variable LND_PIO_REARRANGER

Changes made to namelist defaults (e.g., changed parameter values): None

Changes to the datasets (e.g., parameter, surface or initial files): None

Substantial timing or memory changes: PIO2 should have better performance
  and it allows two options for the rearranger to use (BOX and SUBSET).


Code reviews and testing
------------------------

Code reviewed by: self

CLM testing: regular

  build-namelist tests:

    yellowstone -  PASS

  unit-tests (components/clm/src):

    yellowstone -  OK (all PASS except irrigation test with known issue)

  tools-tests (components/clm/test/tools):

    yellowstone - PASS

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - OK (only one expected FAIL)

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel -  OK
    yellowstone_pgi -    OK
    yellowstone_gnu (clm45 only) -  OK
    hobart_nag - OK

OK means tests pass except those in the ExpectedFail list file

CLM tag used for the baseline comparisons: clm4_5_7_r163

Answer changes
--------------

Changes answers relative to baseline: only if MOSART used

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: with mosart
    - what platforms/compilers: all
    - nature of change: fixes bug where area wasn't multiplied in

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, cism, etc.): cime, mosart
    cime   to cime4.3.9
    mosart to mosart1_0_15

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

   M    components/clm/src/README.unit_testing -- Add note about how to delete previous build

   M    components/clm/src/init_interp/initInterp.F90 -- workaround for bug in PIO where you can't
         do two writes in a row.
   M    components/clm/src/main/ncdio_pio.F90.in -- Take out specifier for rearranger
         so will use the setting from LND_PIO_REARRANGER (was hardcoded to BOX)

   M    components/clm/src_clm40/main/ncdio_pio.F90.in
         so will use the setting from LND_PIO_REARRANGER (was hardcoded to SUBSET)

   M    components/clm/cime_config/config_component.xml -------- Set LND_PIO_REARRANGER 
          to BOX for clm45/clm50 and to SUBSET for clm40
   M    components/clm/cime_config/testdefs/testlist_clm.xml --- change goldbach tests for
          prealpha/prebeta to hobart
   M    components/clm/cime_config/testdefs/testmods_dirs/clm/40default/shell_commands
   M    components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subset/shell_commands
   M    components/clm/cime_config/testdefs/testmods_dirs/clm/default/shell_commands
   M    components/clm/cime_config/testdefs/testmods_dirs/clm/reduceOutput/shell_commands


===============================================================
===============================================================
Tag name:  clm4_5_7_r163
Originator(s):  sacks (Bill Sacks)
Date: Wed Dec 23 20:31:22 MST 2015
One-line Summary: Improve crop performance by allocating less memory

Purpose of changes
------------------

Performance of crop runs was being significantly impacted by the fact that we
allocate memory for any crop column that might ever need to come into existence
with dynamic landunits. Most CLM code should not run over 0-weight points, so
this likely reflects problems in memory/cache efficiency.

This tag changes that behavior, so that for non-transient runs, we only allocate
memory for the crops that actually exist in that run (i.e., have non-zero
area). For transient crop runs, the behavior is currently the same as before.

Note that this means you need to run init_interp when transitioning from a
non-transient crop run to a transient crop run, or vice versa.

For an f09 run without i/o (20-day run with compset
1850_DATM%QIA_CLM50%BGC-CROP_SICE_SOCN_RTM_SGLC_SWAV), this resulted in:

- number of columns reduced from 674,634 to 277,728

- number of patches reduced from 968,284 to 571,378

- throughput increased from 3.821 seconds/mday to 2.404 seconds/mday

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to interpolate initial conditions):

- need to run old crop initial conditions through init_interp (already done for
  out-of-the-box finidat files)

- from now on, need to run init_interp when transitioning from a non-transient
  crop run to a transient crop run, or vice versa

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): new finidat
files for crop: same as old, but run through init_interp

Substantial timing or memory changes: substantial improvement in both timing and
memory for crop cases


Code reviews and testing
------------------------

Code reviewed by: self

CLM testing:

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - irrigation test fails, as in r162

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    NOTE: On yellowstone, I tested with a cime version that had a one-off from
    cime4.3.1: changes to cprnc. This was done so that cprnc would indicate
    which tests had differences in dimension sizes in the h1 history files.


    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

    'ok' means tests pass, baseline comparisons fail for some diagnostic fields
    for crop cases, as described below

    Also, this test failed the baseline comparison due to a problem in the
    baseline:
    ERS_D_Ld5.f10_f10.IMCRUCLM50BGC.yellowstone_intel.clm-default

    Some r162 baselines were missing on hobart; I reran these tests and verified
    that baseline comparisons passed.

CLM tag used for the baseline comparisons: clm4_5_7_r162


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: clm45/clm50 with crop
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      Changes in diagnostic fields only

      Changes are in:

      (1) PCT_CFT in grid cells that have 0% crop

      (2) dimension sizes differ for history files with dov2xy = .false.

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Main changes
M       components/clm/src/main/initGridCellsMod.F90
M       components/clm/src/main/subgridMod.F90

========= Initialize dynSubgridControl earlier in initialization. This is needed
          because it now needs to be initialized before we set up the subgrid
          stuff / bounds.
M       components/clm/src/dyn_subgrid/dynSubgridDriverMod.F90
M       components/clm/src/dyn_subgrid/dynSubgridControlMod.F90
M       components/clm/src/main/clm_initializeMod.F90

========= Add more informative message if it looks like use_init_interp is needed
M       components/clm/src/main/restFileMod.F90
M       components/clm/src/main/ncdio_pio.F90.in

========= Point to new finidat files for crop, which have been run through init_interp
M       components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml
M       components/clm/cime_config/testdefs/testmods_dirs/clm/interp_f19_crop/user_nl_clm

========= Minor tweak: remove explicit reference to init_interp, to make it
          easier to search the ChangeLog for true references to init_interp
M       .ChangeLog_template

===============================================================
===============================================================
Tag name:  clm4_5_7_r162
Originator(s):  andre (Benjamin Andre,UCAR/CSEG,303-497-1391)
Date:  Fri Dec 18 15:59:23 MST 2015
One-line Summary: negative runoff updates.

Purpose of changes
------------------

Remove direct to ocean runoff from coupler fields. Negative runoff is
now handled by mosart. Only limit irrigation if volume is below the
threshold instead of lake evaporation and irrigation.


Bugs fixed or introduced
------------------------

unknown

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to run initial conditions through init_interp): Not well tested after some last minute changes. Not recommended for use.

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables):
    limit_lake_evap_and_irrig phys changed to limit_irrigation

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: unknown


Code reviews and testing
------------------------

Code reviewed by: swenson

CLM testing: minimal

  build-namelist tests

    yellowstone - unit tests pass

  unit-tests (components/clm/src):

    yellowstone - irrigation test fails

  tools-tests (components/clm/test/tools):

    yellowstone - n/a not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - n/a not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - clm50 kitchen sink looks ok
    yellowstone_pgi - not run prior to tag
    yellowstone_gnu (clm45 only) - not run prior to tag
    hobart_nag - not run prior to tag

  prior testing of branch indicated that it was bit for bit with the
  exception of coupler and histroy fields related to runoff:

   TWS              
   VOLR             
   VOLRMCH          
   l2x_Flrl_rofgwl  
   l2x_Flrl_rofdto  
   x2l_Flrr_volr    
   x2l_Flrr_volrmch 
   r2x_Forr_rofl    
   r2x_Flrr_volr    
   r2x_Flrr_volrmch 
   x2r_Flrl_rofgwl  
   x2r_Flrl_rofdto  

  several last minute changes were made and testing was not rerun
  before making the tag. No significant problems are expected, but...

CLM tag used for the baseline comparisons: clm4_5_6_r161


Answer changes
--------------

Changes answers relative to baseline: yes, only in clm and coupler runoff fields listed above.

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: all
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): larger than roundoff.

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? none

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: none

   URL for LMWG diagnostics output used to validate new climate: none
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, cism, etc.): rtm1_0_55, mosart1_0_12

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

  change name of limit_irrigation namelist item
    clm/bld/CLMBuildNamelist.pm
    clm/bld/namelist_files/namelist_definition_clm4_5.xml
    clm/bld/namelist_files/namelist_defaults_clm4_5.xml
    clm/cime_config/testdefs/testmods_dirs/clm/limit_river_withdraw/user_nl_clm
    clm/cime_config/testdefs/testmods_dirs/clm/clm50KitchenSink/user_nl_clm
    clm/src/biogeophys/test/Irrigation_test/IrrigationWrapperMod.F90

  change negative runoff
    clm/src/main/lnd2atmType.F90
    clm/src/main/controlMod.F90
    clm/src/main/clm_varctl.F90
    clm/src/main/lnd2atmMod.F90
    clm/src/biogeophys/WaterfluxType.F90
    clm/src/biogeophys/LakeFluxesMod.F90
    clm/src/biogeophys/HydrologyDrainageMod.F90
    clm/src/biogeophys/BandDiagonalMod.F90
    clm/src/biogeophys/IrrigationMod.F90
    clm/src/cpl/clm_cpl_indices.F90
    clm/src/cpl/lnd_import_export.F90


===============================================================
===============================================================
Tag name:  clm4_5_6_r161
Originator(s):  sacks (Bill Sacks)
Date: Thu Dec 17 14:04:29 MST 2015
One-line Summary: Collapse mountain glaciers to a single elevation class

Purpose of changes
------------------

Mountain glaciers (i.e., glaciers outside of Greenland and Antarctica) have been
problematic when running with glc_mec, because of the adjustments made to the
atmospheric forcings (downscaling to columns). Mountain glaciers generally sit
above the atmospheric forcing height, so this downscaling leads to discrepancies
between the atmospheric forcings and what CLM sees, on the gridcell mean. This
same problem can exist over ice sheets, but it can be more pronounced in
mountain regions because of the steep topography. Furthermore, because no
downscaling is done over the vegetated portion of the grid cell: Even if CLM's
mean grid cell elevation agreed exactly with the atmosphere's topographic
height, there would still be a discrepancy after downscaling, because the
glaciers would see a cooler climate, whereas the rest of the grid cell would see
exactly the climate sent by the atmosphere.

Mountain glaciers are not currently a focus of the Land Ice Working Group
(LIWG), and surface mass balance is known to have significant problems in
mountain glacier regions. Therefore, because of the above atm-lnd discrepancy,
the LIWG (especially Bill Lipscomb and Jeremy Fyke) decided it would be best to
have only a single glacier elevation class in mountain glacier regions (outside
of Greenland and Antarctica), whose elevation exactly matches the atmosphere's
topographic height. Note that this match of the atmopshere's topographic height
is the same as what is done (implicitly) in all other landunits - resulting in
no adjustment to the atmospheric forcings.

This tag implements the collapse of mountain glaciers to a single elevation
class, whose topographic height matches the atmosphere's topographic height. It
allows for the possibility that the atmosphere's topographic height could change
in time - in which case the glacier's topographic height (and potentially its
elevation class index) will change in time to follow the atmosphere.

In addition, this tag puts in place infrastructure to make it easier to define
different glacier regions that receive different treatments (whether virtual
columns are enabled, and whether glacier should be collapsed to a single
elevation class). The "frontend" user interface for this will be added in an
upcoming tag.

Currently, the definition of the "mountain glacier" region is done so that it
includes everything except the region defined by fglcmask and the region south
of 60 deg S (assumed to be Antarctica). Soon the setting of this region will be
made more robust and more easily user-definable.

Finally, this tag adds infrastructure to aid in creating and using local
column-level filters. Eventually, this could be extended to cover all of CLM's
filters.


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to run initial conditions through init_interp):
- For runs with glc_mec (IG, FG, BG), need to run initial conditions through
  init_interp, because there are now slightly fewer glc_mec columns.

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files):
- just changed finidat for glcMEC_spunup_1way testmod

Substantial timing or memory changes:
- small decrease in memory for glc_mec runs, due to a decrease in the number of
  columns


Code reviews and testing
------------------------

Code reviewed by: self; review by others will come later

CLM testing:

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - pass

    'ok' means: tests pass except for baseline comparison failures for IG tests,
    as noted below

CLM tag used for the baseline comparisons: clm4_5_6_r160


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM45/CLM50 with glc_mec (IG, FG, BG)
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      not investigated closely, but expected to give new climate, at least regionally

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	
   Verified that changes came just from collapsing mountain glaciers to a single
   elevation class, by running the affected tests with this change in
   glcBehaviorMod:

-    logical, parameter :: collapse_mountain_glaciers = .true.
+    logical, parameter :: collapse_mountain_glaciers = .false.

   -- these tests were bit-for-bit with the trunk, as expected.

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do:

========= Main addition in this tag. This module determines a number of aspects
          of the behavior of glacier_mec classes in each grid cell.
A       components/clm/src/main/glcBehaviorMod.F90

========= Unit tests of glcBehaviorMod
A       components/clm/src/main/test/glcBehavior_test/CMakeLists.txt
A       components/clm/src/main/test/glcBehavior_test/test_glcBehavior.pf
A       components/clm/src/main/test/glcBehavior_test

========= Supports creation and use of local column-level filters. Eventually we
          may want to consider moving all filters to using infrastructure like
          this.
A       components/clm/src/main/filterColMod.F90

========= Unit tests of filterColMod
A       components/clm/src/main/test/filter_test/CMakeLists.txt
A       components/clm/src/main/test/filter_test/test_filter_col.pf
A       components/clm/src/main/test/filter_test

========= Stub of module in driver_cpl/shr (needed by glc_elevclass_mod.F90)
A       components/clm/src/unit_test_stubs/csm_share/seq_comm_mct.F90

========= Minor changes needed to support unit tests

List all existing files that have been modified, and describe the changes:

========= Delegate glc_mec-related logic to glcBehaviorMod: this logic is now
          complex, and tied in with various aspects of glcBehaviorMod; also,
          delegating the logic to glcBehaviorMod allows us to reduce duplication
          between initGridCellsMod and subgridMod. Also split the monster
          routine in subgridMod (which had a bunch of optional arguments) into
          small routines with well-defined interfaces.
M       components/clm/src/main/subgridMod.F90
M       components/clm/src/main/initGridCellsMod.F90
          - also, put setting of ice_mec landunits in a separate routine, thus
            cleaning up set_landunit_wet_ice_lake; and remove no-longer-used
            setdata argument


========= Use glc_behavior instead of glcmask
M       components/clm/src/main/glc2lndMod.F90
          - also call glc_behavior%update_collapsed_columns
M       components/clm/src/main/subgridWeightsMod.F90

========= Track whether a column's type is dynamic
M       components/clm/src/main/ColumnType.F90
M       components/clm/src/main/initSubgridMod.F90

========= Update glc classes upon restart; also separate read and write routines
          (which now have different required arguments)
M       components/clm/src/main/subgridRestMod.F90

========= Declare and initialize glc_behavior, and pass it where needed
M       components/clm/src/main/clm_instMod.F90
M       components/clm/src/main/clm_initializeMod.F90

========= Pass newly-needed arguments
M       components/clm/src/main/clm_driver.F90
M       components/clm/src/dyn_subgrid/dynSubgridDriverMod.F90
M       components/clm/src/main/decompInitMod.F90
M       components/clm/src/main/restFileMod.F90
M       components/clm/src/main/reweightMod.F90

========= Make sure glcmask is always initialized to 0
M       components/clm/src/main/surfrdMod.F90

========= Add new history field
M       components/clm/src/main/atm2lndType.F90

========= For unit tests: add glc_elevclass_mod.F90 from driver_cpl/shr
M       components/clm/src/CMakeLists.txt

========= Minor changes needed to support unit tests
M       components/clm/src/unit_test_stubs/csm_share/CMakeLists.txt
M       components/clm/src/unit_test_shr/unittestArrayMod.F90
M       components/clm/src/unit_test_shr/unittestSimpleSubgridSetupsMod.F90
M       components/clm/src/main/CMakeLists.txt
M       components/clm/src/main/test/CMakeLists.txt

========= Remove some costly CLM4 tests
M       components/clm/cime_config/testdefs/testlist_clm.xml
M       components/clm/cime_config/testdefs/ExpectedTestFails.xml

========= Point to new initial conditions file, init_interp'ed from the old one
M       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_spunup_1way/user_nl_clm

===============================================================
===============================================================
Tag name:  clm4_5_6_r160
Originator(s):  sacks (Bill Sacks)
Date: Fri Dec 11 10:51:21 MST 2015
One-line Summary: For glc_mec, get gridcell topographic height from atm

Purpose of changes
------------------

Runs with glc_mec require knowledge of the atmosphere's topographic height. Up
until now, this was specified via the flndtopo file for the three resolutions
that glc_mec can run at: f09, f19, T31. However, this has three problems:

(1) It made it hard to extend glc_mec to run at other CLM resolutions

(2) If CAM's topographic height changes (as it did recently), CLM would need to
    have its flndtopo files updated to agree.

(3) It assumes that datm's forcing heights match CAM's.

In this tag, flndtopo has been removed, and CLM now gets the atmosphere's
topographic height from the atmosphere, via the coupler. References to flndtopo
/ ldomain%topo have been replaced with atm2lnd_inst%forc_topo_grc.

For now, datm is set up to provide a topographic height that matches the old f09
file - so offline (I compset) runs at f09 will be the same as before. But this
will soon change.

Also removed fatmtopo, which was in the code in a few places but was no longer
being used.


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to run initial conditions through init_interp): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables):
- removed flndtopo file for CLM45/CLM5

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files):
- removed flndtopo file for CLM45/CLM5

Substantial timing or memory changes: none


Code reviews and testing
------------------------

Code reviewed by: self

CLM testing:

  build-namelist tests:

    yellowstone - pass (both sets of tests)

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - pass

    'ok' means pass except baseline comparison failures for IG tests, as noted
    below

    Note that most hobart_nag tests are now in the expected fail list. The only
    passing tests on hobart_nag are:

       SMS_D_Ld1_P24x1.f10_f10.ICRUCLM45.hobart_nag.clm-af_bias_v5
       SMS_Ld1_Mmpi-serial.f45_f45.ICLM45.hobart_nag.clm-ptsRLA
       SMS_D_Ld1_Mmpi-serial.1x1_vancouverCAN.I1PTCLM50.hobart_nag.clm-default
       SMS_Ld1.f45_f45.ICLM45.hobart_nag.clm-ptsRLA
       SMS_D_Ld1_Mmpi-serial.1x1_vancouverCAN.I1PTCLM45.hobart_nag.clm-default
       SMS_D_Ld1_P24x1.f10_f10.ICLM45BGC.hobart_nag.clm-oldhyd
       ERS_D_Ld5_Mmpi-serial.1x1_mexicocityMEX.I1PTCLM45.hobart_nag.clm-default
       SMS_D_Ld1_Mmpi-serial.f45_f45.ICLM45.hobart_nag.clm-ptsRLA
       ERP_Ly5.1x1_numaIA.ICLM45BGCCROP.hobart_nag.clm-monthly
       SMS_Ld1.1x1_mexicocityMEX.I1PT.hobart_nag.clm-40default
       SMS_Ld5_P24x1.f10_f10.IRCP26CN.hobart_nag.clm-reduceOutput
       SMS_D_Ld1.1x1_mexicocityMEX.I.hobart_nag

CLM tag used for the baseline comparisons: clm4_5_6_r159
   compared
   ERS_Ly3.f10_f10.I1850CRUCLM50BGCCROP.yellowstone_intel.clm-clm50KSinkMOut
   against baselines in directory clm4_5_r159


Answer changes
--------------

Changes answers relative to baseline:

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM45/CLM5 with glc_mec (IG, FG, BG)
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 

      Potentially new climate. Magnitude of change depends on how different
      atm's topography is from the flndtopo file that had been used before.

      For now, offline (IG) runs at f09 are the same as before, but all other
      offline runs change. Runs coupled to CAM may be the same (or close to the
      same), if CAM is using its old topography files, but will change for the
      new CAM topography.

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Main changes, as described above
M       components/clm/bld/CLMBuildNamelist.pm
M       components/clm/bld/test_build_namelist/t/input/namelist_defaults_clm4_5_test.xml
M       components/clm/bld/test_build_namelist/t/input/namelist_definition_clm4_5_test.xml
M       components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml
M       components/clm/bld/namelist_files/namelist_definition_clm4_5.xml
M       components/clm/doc/UsersGuide/preface.xml
M       components/clm/doc/UsersGuide/adding_files.xml
M       components/clm/doc/UsersGuide/single_point.xml
M       components/clm/src/cpl/clm_cpl_indices.F90
M       components/clm/src/cpl/lnd_import_export.F90
M       components/clm/src/utils/domainMod.F90
M       components/clm/src/main/clm_initializeMod.F90
M       components/clm/src/main/atm2lndType.F90
M       components/clm/src/main/controlMod.F90
M       components/clm/src/main/clm_varctl.F90
M       components/clm/src/main/atm2lndMod.F90
M       components/clm/src/main/surfrdMod.F90

========= Remove topo field that is defined but never set
M       components/clm/src/main/histFileMod.F90

========= Add test to expected fail list; it seemed to pass for Erik, but fails
          for me even out of a fresh checkout of clm4_5_6_r159:
          ERP_Ly5.1x1_numaIA.ICRUCLM50BGCCROP.hobart_nag.clm-clm50BGCCROPmonthly
M       components/clm/cime_config/testdefs/ExpectedTestFails.xml

===============================================================
===============================================================
Tag name:  clm4_5_6_r159
Originator(s):  erik (Erik Kluzek)
Date: Thu Dec 10 15:46:47 MST 2015
One-line Summary: Update CIME version

Purpose of changes
------------------

Update to very latest version of CIME, which we had held off doing
for two months. The main user change is that CIME no longer names
scripts with your CASENAME.

This CIME version also updated PIO1 to PIO2 (pio2_0_27). These
early versions of PIO2 do have issues with potential hangs. See
bug 2256 below. As such we do not recommend use of this tag. Or
if you do and run into problems, do the workaround in the bug
report to move the PIO version to pio1_9_23. The behavior is that
after the simulation finishes it times out when writing history and
restart files. mpi-serial (single point) cases seem to work fine.

Also fix two minor bugs.

Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID):

    2251  Bad NH max planting date of 6/31
    2250  History filenames get truncated to 128 characters

Bugs Introduced (include bugzilla ID):

    2257 Unit tests fail in clm4_5_6_r159
    2256 Problems with early versions of PIO2 in CLM

Notes of particular relevance for users
---------------------------------------

Caveats for users: CASE SCRIPTS NO LONGER NAMED $CASE.build, $CASE.run, $CASE.submit 

    After ./create_newcase is run you have the scripts named:
       ./case.build
       ./case.run
       ./case.submit

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): None

Changes made to namelist defaults (e.g., changed parameter values): None

Changes to the datasets (e.g., parameter, surface or initial files): New params file

Substantial timing or memory changes: None


Code reviews and testing
------------------------

Code reviewed by: self, fvitt

CLM testing: regular

  build-namelist tests:

    yellowstone -  PASS

   (several comparision tests to clm4_5_6_r158 FAIL because of the new params
   file)

  unit-tests (components/clm/src):

    yellowstone -  FAIL

  tools-tests (components/clm/test/tools):

    yellowstone -  PASS

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - OK
    yellowstone_pgi - OK
    yellowstone_gnu (clm45 only) - OK
    hobart_nag - OK

    OK means failures are in the ExpectedFails list

CLM tag used for the baseline comparisons:  clm4_5_6_r158


Answer changes
--------------

Changes answers relative to baseline:  Yes (but just for two diagnostic cpl fields)

  Summarize any changes to answers, i.e.,
    - what code configurations: All
    - what platforms/compilers: All
    - nature of change: diagnostic change

atm topo field
For drydep TERPOOH (dd034) is different because of an update by Francis Vitt

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, cism, etc.): cime to cime4.3.1

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

    Increase max filename length from 128 to 199.
M       components/clm/src/main/ncdio_pio.F90.in -- increase tmp_string to 199
M       components/clm/src/main/histFileMod.F90 --- max length filename
           and max_chars to 199 and dimension locfnhr by max_length_filename

M       components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml -- new params file
           change 631 max planting date for NH to 701

===============================================================
===============================================================
Tag name:  clm4_5_6_r158
Originator(s):  andre (Benjamin Andre,UCAR/CSEG,303-497-1391)
Date:  Fri Dec  4 16:10:11 MST 2015
One-line Summary: misc clm 5.0 bugfixes

Purpose of changes
------------------

Misc. bugfixes for CLM 5.0

  * LUNA bugfix to endrun if simulation goes out of range.

  * Restore ability to run SP simulations on nag.

  * String length bugfix from Jim Edwards.

  * New long clm50 kitchen sink test.

  * endrun if history filenames exceed maximum allowed length.


Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID): 2209, 2213

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to run initial conditions through init_interp):

  CLM will now endrun if the generated history filename exceeds the
  maximum allowed length. This will result in run time failures for
  people running the test suite with the default or longer test ids.

  CLM 5.0 with LUNA will now endrun if nitrogen computations go
  outside a valid range.

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: unknown, none expected


Code reviews and testing
------------------------

Code reviewed by: self

CLM testing: regular

  build-namelist tests:

    yellowstone - unit tests pass

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - n/a, not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - n/a, not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - 40 - pass; 45 - ok
    yellowstone_pgi -  40 - pass; 45 - pass
    yellowstone_gnu (clm45 only) - 45 - pass
    hobart_nag - ok

CLM tag used for the baseline comparisons: clm4_5_6_r157

  Notes: 'ok' means:

  * Fixing bug 2213 restores tests an hobart_nag. These tests BFAIL
    because they don't have baselines.

  * r157 yellowstone baseline does not include clm history files for
    two tests because of filename length issues:

    ERS_D_Ld3.f09_g16_gl5.IG1850CRUCLM50BGCCROP.yellowstone_intel.clm-clm50KitchenSink
    ERP_P15x2_Lm25.f10_f10.ICLM45BGCDVCROP.yellowstone_intel.clm-clm50BGCDVCROPmonthly

  * New test does not have baseline:

    ERS_Ly3.f10_f10.I1850CRUCLM50BGCCROP.yellowstone_intel.clm-clm50KSinkMOut


Answer changes
--------------

Changes answers relative to baseline: bit for bit

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do:

  new clm50 kitchen sink test with monthly output
    clm/cime_config/testdefs/testmods_dirs/clm/clm50KSinkMOut/user_nl_clm
    clm/cime_config/testdefs/testmods_dirs/clm/clm50KSinkMOut/include_user_mods
    clm/cime_config/testdefs/testmods_dirs/clm/clm50KSinkMOut

List all existing files that have been modified, and describe the changes:

  new clm50 compset w/o glc and test for longer kitchen sink test
    clm/cime_config/config_compsets.xml
    clm/cime_config/testdefs/testlist_clm.xml

  string length bugfix from Jim Edwards
    clm/src/biogeochem/FireEmisFactorsMod.F90

  runtime error if constructed history filename exceeds max length
    clm/src/main/histFileMod.F90

  bug 2209
    clm/src/biogeophys/LunaMod.F90 - runtime error if LUNA nitrogen computations become unrealistic

  bug 2213
    clm/src/biogeophys/PhotosynthesisMod.F90 - remove association of CN variable that may not be allocated for SP runs.
    clm/src/biogeophys/CanopyFluxesMod.F90 - remove association of CN variable that may not be allocated for SP runs.
    clm/cime_config/testdefs/ExpectedTestFails.xml - remove nag tests from xfails.

===============================================================
===============================================================
Tag name:  clm4_5_6_r157
Originator(s):  sacks (Bill Sacks)
Date: Fri Nov 27 05:52:17 MST 2015
One-line Summary: Reduce memory use for init_interp

Purpose of changes
------------------

For high-resolution source files (e.g., f09 or higher), the new multilevel
interpolation was using unacceptable amounts of memory, since it was reading all
source points at all levels into memory at once - both for the actual data to
interpolate, and for the metadata used in the multilevel interpolators.

This tag reworks how 2-d interpolation is done so that only one level from the
source is needed in memory at a time, thus greatly reducing memory use in some
cases.

In making this change, I extracted routines to do 1-d interpolation. In doing
so, I made some minor changes to their behavior for consistency. The main change
was to remove special handling of inactive points: Inactive points used to have
their values set to spval, and I have now removed that logic, keeping inactive
points at their values before interpolation. This results in some NaNs appearing
in finidat_interp_dest (if values were NaN before interpolation); before spval
was put in all inactive points.

Also, some unrelated changes:

- Remove a duplicate and unused entry in config_component.xml (found by Jim
  Edwards)

- Remove redundant settings in CNZero (found by Dave Lawrence)

- Fix cray compilation problems (found by Jim Edwards)


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to run initial conditions through init_interp): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes:
- Big memory decrease in some cases when using init_interp


Code reviews and testing
------------------------

Code reviewed by: self

CLM testing:

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - pass
    yellowstone_pgi - pass
    yellowstone_gnu (clm45 only) - pass
    hobart_nag - pass

CLM tag used for the baseline comparisons: clm4_5_6_r156


Answer changes
--------------

Changes answers relative to baseline: NO

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do:

========= Extract interpolation routines so they can be called from a few
          places. Note that I have changed the behavior slightly, in ways that
          affect the produced restart file, but not a CLM run done with this
          restart file. In particular, inactive points are no longer set to
          spval.
A       components/clm/src/init_interp/initInterp1dData.F90


List all existing files that have been modified, and describe the changes:

========= Rework multi-level interpolation in order to reduce memory use
M       components/clm/src/init_interp/initInterp2dvar.F90.in
M       components/clm/src/init_interp/initInterpMultilevelInterp.F90
M       components/clm/src/init_interp/initInterpMultilevelContainer.F90
M       components/clm/src/init_interp/initInterpMultilevelSnow.F90
M       components/clm/src/init_interp/test/initInterpMultilevel_test/test_init_interp_multilevel_split.pf
M       components/clm/src/init_interp/test/initInterpMultilevel_test/initInterpMultilevelMock.pf
M       components/clm/src/init_interp/test/initInterpMultilevel_test/multilevel_interp_factory.F90
M       components/clm/src/init_interp/test/initInterpMultilevel_test/test_init_interp_multilevel_interp.pf
M       components/clm/src/init_interp/test/initInterpMultilevel_test/test_init_interp_multilevel_snow.pf
M       components/clm/src/init_interp/initInterpMultilevelBase.F90
M       components/clm/src/init_interp/initInterpMultilevelCopy.F90
M       components/clm/src/init_interp/initInterpMultilevelSplit.F90
M       components/clm/src/init_interp/initInterp.F90

========= Unrelated change: remove an entry that duplicates an entry in the
          driver's config_component, and is unused here
M       components/clm/cime_config/config_component.xml

========= Unrelated change: remove redundant settings in CNZero
M       components/clm/src/biogeochem/CNDriverMod.F90

========= Unrelated change: add helpful tip to output message
M       components/clm/src/init_interp/initInterpMindist.F90

========= Unrelated change: add a comment
M       components/clm/src/main/clm_varcon.F90

===============================================================
===============================================================
Tag name:  clm4_5_6_r156
Originator(s):  sacks (Bill Sacks)
Date: Tue Nov 24 10:19:07 MST 2015
One-line Summary: Fix QSNWCPICE and glacial inception

Purpose of changes
------------------

Previously, qflx_snwcp_ice_col (output to history file as QSNWCPICE) had served
two purposes: (1) the snow capping flux, which is used to specify surface mass
balance to GLC; and (2) the ice runoff flux, sent to ROF. However, these two
uses are not identical, which resulted in a number of problems.

This tag separates these uses, so that qflx_snwcp_ice_col truly gives the snow
capping flux, and the ice runoff flux is derived separately (via two new
variables: qflx_ice_runoff_snwcp_col and qflx_ice_runoff_xs_col).

This changes serves the following purposes:

(1) QSNWCPICE becomes a useful history field, actually giving the amount of snow capping

(2) Fixes snow balance check: bug 2238

(3) Fixes a problem where xs1 could initiate glacial inception, by contributing to qflx_glcice_frz

(4) simplifies some logic in BalanceCheckMod


Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID):
- 2238: Possible bug involving qflx_snwcp_ice in BalanceCheckMod.F90


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to run initial conditions through init_interp): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables):
  QSNWCPICE_TO_COUPLER history field renamed to QRUNOFF_ICE_TO_COUPLER

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none


Code reviews and testing
------------------------

Code reviewed by: Leo van Kampenhout

CLM testing:

  NOTE: most testing done on r75327 (prior to the workaround for the intel
  compiler bug); after that, just ran:
  ERP_Lm40.1x1_numaIA.ICRUCLM50BGCCROP.yellowstone_gnu.clm-clm50BGCCROPmonthly
  (previously-failing test)
  ERI_D_Ld9_P24x1.f10_f10.ICRUCLM50BGC.hobart_nag.clm-reduceOutput
  (to run one nag test with the change)

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

  'ok' means tests pass, baseline comparisons fail as noted below

  Also BFAILs for:
    BFAIL SMS_Ld5_D_P24x1.f10_f10.IHISTCLM45BGC.hobart_nag.clm-clm50BGCmonthly.GC.1123-1949.45.n.nlcomp
    BFAIL ERP_Ly5.1x1_numaIA.ICRUCLM50BGCCROP.hobart_nag.clm-clm50BGCCROPmonthly.GC.1123-1949.45.n.nlcomp

  And for the newly-passing:
  ERP_Lm40.1x1_numaIA.ICRUCLM50BGCCROP.yellowstone_gnu.clm-clm50BGCCROPmonthly

CLM tag used for the baseline comparisons: clm4_5_6_r155


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: diagnostic changes for all CLM45/CLM50;
  significant changes for IG compsets with CLM45/CLM50
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      Changes for IG compsets are potentially climate changing

   Changes in non-IG compsets are in the following three fields:
   - QSNWCPICE
   - ERRH2OSNO
   - SNOW_SINKS (roundoff-level)

   Bigger changes in IG compsets are due to no longer including the xs1 term in
   qice (SMB) sent to GLC. Of the tests in the test suite, this was just
   observed for SMS_Lm37.T31_g37_gl5.IG1850CLM45.yellowstone_intel.clm-glcMEC_long.

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Main changes
M       components/clm/src/biogeophys/WaterfluxType.F90
M       components/clm/src/biogeophys/HydrologyDrainageMod.F90
M       components/clm/src/biogeophys/SoilHydrologyMod.F90
M       components/clm/src/biogeophys/LakeHydrologyMod.F90
M       components/clm/src/main/lnd2atmType.F90
M       components/clm/src/main/lnd2atmMod.F90
M       components/clm/src/biogeophys/BalanceCheckMod.F90
          - also add dtime multiplier for some log message output

========= Unrelated change: workaround for intel compiler bug
M       components/clm/src/biogeochem/CNFireLi2016Mod.F90

========= Unrelated change: edit ChangeLog entry for clm4_5_6_r153
M       ChangeLog
M       components/clm/doc/ChangeLog


===============================================================
===============================================================
Tag name:  clm4_5_6_r155
Originator(s):  erik (Erik Kluzek)
Date: etl xim 23  1:11:04 carra MST 2015
One-line Summary: Bring FUN (Fixation and Uptake of Nitrogen) code option to trunk from Mingjie, 
                  as well as latitude varying spinup from Charlie, and a fix for crop with dynamic 
                  roots from Beth

Purpose of changes
------------------

FUN Model (Fixation and Uptake of Nitrogen): Mingjie Shi, Josh Fisher, 
                                             and implmentation changes from Rosie Fisher

  FUN is the Fixation and Uptake of Nitrogen, and is designed to extract N from numerous 
  sources (fixation, active uptake, retranslocation) in proportion to the inverse of the 
  cost of uptake in term of C spent per unit N acquired. 

  The FUN model developed by Fisher et al. 2010 and end Brzostek et al. 2014. Coded by Mingjie Shi 2015.
  Coding logic and structure altered by Rosie Fisher. October 2015. 
  Critically, this removes the 'FUN-resistors' idea of Brzostek et al. 2014
  and replaces it with uptake that is proportional to the N/C exchange rate. 
  and adjusts the logic so that FUN does not depends upon the CLM4.0 'FPG' downregulation idea
  and instead it takes C spent on N uptake away from growth.
  The critical output so fthis code are sminn_to_plant_fun and npp_Nuptake, which are the N 
  available to the plant for growth, and the C spent on obtaining it.

  When FUN is on and flex-CN is on, do NOT do the burn off of excess Carbon.

  Add in Kyla's rainfall trigger for stress decidious when FUN is on.

  Call FUN in the middle of SoilBiogeochemCompetition. Split CNPhenology into
  two sections for FUN. Get N available from N in NutrientCompetetion. Add
  annual average ET needed for CNFreeLivingFixation which is used in place
  of CNNFixation when FUN on.
 
Dynamic Roots bug fix: Beth Drewniak

  Initialize huigrain to zero (rather than nan). And add a check for huigrain non zero
  to prevent a divide by zero.

BGC Spinup Changes: Charlie Koven

  Add a latitude dependent factor for accellerated decomposition spinup that is 
  about 1 at the equator goes to 26 at 60 degree's latitude (south and north) 
  and then about 50 at the poles.

Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID):  2237
    2237 (dynamic root code divides by 0)

Known bugs introduced in this tag (include bugzilla ID): 2249
   2249 Simulations have low LAI in the amazon with FUN and Luna on

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to run initial conditions through init_interp):
   LAI is low in Amazon (see bug 2249)
   FUN requires use_nitrif_denitrif to be on.

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): new CLM namelist variables
   Add br_root (maintenence respiration for roots)
   And leaf_mr_vcm (Scalar of leaf respiration to vcmax)
   And use_fun logical to turn the FUN model on

Changes made to namelist defaults (e.g., changed parameter values):
   For CLM50 set leaf_mr_vcm to 0.032 (from Atkin 2015)
   For CLM50 with FUN on br_root=2.525e-06

Changes to the datasets (e.g., parameter, surface or initial files):
   New params files with FUN parameters on them

Substantial timing or memory changes: Slower with FUN
    Will notices that simulations with FUN are slower
    (there are optimization issues that I saw that could be worked on)

Code reviews and testing
------------------------

Code reviewed by: self, rfisher, koven, drewniak

CLM testing:

  build-namelist tests:

    yellowstone - PASS

  unit-tests (components/clm/src):

    yellowstone - PASS

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - OK
    yellowstone_pgi - OK
    yellowstone_gnu (clm45 only) - OK
    hobart_nag - OK

OK, means tests PASS or only expected fails do not.
SSP comparision tests FAIL for CLM50, since spinup changes


CLM tag used for the baseline comparisons:  clm4_5_6_r154


Answer changes
--------------

Changes answers relative to baseline: No 

  Except when spinup on, or when FUN turned on.

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, cism, etc.): None

List all files eliminated:

=========== Remove flexibleCN test directory and add one for flexCN and FUN
D       components/clm/cime_config/testdefs/testmods_dirs/clm/flexibleCN
D       components/clm/cime_config/testdefs/testmods_dirs/clm/flexibleCN/user_nl_clm
D       components/clm/cime_config/testdefs/testmods_dirs/clm/flexibleCN/include_user_mods

List all files added and what they do:

=========== Add new tests
=========== NOTE: clm50* tests can be used with CLM45 compsets to create new CLM50 configurations
A       components/clm/cime_config/testdefs/testmods_dirs/clm/clm50BGCDVCROPmonthly/shell_commands
A       components/clm/cime_config/testdefs/testmods_dirs/clm/clm50BGCDVCROPmonthly/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/clm50BGCDVCROPmonthly
A       components/clm/cime_config/testdefs/testmods_dirs/clm/flexCN_FUN/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/flexCN_FUN/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/flexCN_FUN
A       components/clm/cime_config/testdefs/testmods_dirs/clm/ciso_flexCN_FUN/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/ciso_flexCN_FUN/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/ciso_flexCN_FUN
A       components/clm/cime_config/testdefs/testmods_dirs/clm/noFUN_flexCN/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/noFUN_flexCN/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/noFUN_flexCN
A       components/clm/cime_config/testdefs/testmods_dirs/clm/clm50BGCCROPmonthly/shell_commands
A       components/clm/cime_config/testdefs/testmods_dirs/clm/clm50BGCCROPmonthly/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/clm50BGCCROPmonthly
A       components/clm/cime_config/testdefs/testmods_dirs/clm/clm50BGCmonthly/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/clm50BGCmonthly/shell_commands
A       components/clm/cime_config/testdefs/testmods_dirs/clm/clm50BGCmonthly

=========== Add unit test for AC spinup
A       components/clm/src/soilbiogeochem/CMakeLists.txt
A       components/clm/src/soilbiogeochem/test/CMakeLists.txt
A       components/clm/src/soilbiogeochem/test/ACSpinup_test/test_acspinup.pf
A       components/clm/src/soilbiogeochem/test/ACSpinup_test/CMakeLists.txt
A       components/clm/src/soilbiogeochem/test/ACSpinup_test
A       components/clm/src/soilbiogeochem/test

=========== New FUN module
A       components/clm/src/biogeochem/CNFUNMod.F90

List all existing files that have been modified, and describe the changes:

M       components/clm/cime_config/testdefs/testmods_dirs/clm/clm50KitchenSink/user_nl_clm - Remove
           fsurdat, new finidat file, turn: luna, flex-CN, dynroots, and FUN on, 
           for interpolation fill missing with bare ground, limit_lake_evap to false
           set leaf_mr_vcm to 0.015
M       components/clm/cime_config/testdefs/testmods_dirs/clm/cropMonthOutput/user_nl_clm - turn dynroots on

M       components/clm/bld/namelist_files/namelist_definition.xsl ------- Update to work again
M       components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml -- New params file with FUN parameters
             c151024 and ED.c151023, turn dynroots off for bgc, add phys version to finidat, set use_fun
             br_root, leaf_mr_vcm
M       components/clm/bld/namelist_files/namelist_definition_clm4_5.xml  Add br_root, leaf_mr_vcm, use_fun
M       components/clm/bld/CLMBuildNamelist.pm -------------------------- Handle cnmresp_inparm,
             clm_canopy_inparm, send phys for finidat
M       components/clm/bld/unit_testers/build-namelist_test.pl ---------- Add tests for fun w/o CN,
             or w/o nitrif_denitrif, or flexCN w/o CN

M       components/clm/cime_config/config_compsets.xml - Change IGCRUCLM50BGCCROP to IG1850CRUCLM50BGCCROP
             add IG1850CRUCLM50BGC

M       components/clm/cime_config/testdefs/testlist_clm.xml ---- Add new tests (noFUN_flexCN, flexCN_FUN, 
             ciso_flexCN_FUN, clm50KitchenSink w/o crop, clm50BGCDVCROPmonthly, transient clm50BGC, 
             and new CROP-off clm50KitchenSink test add luna test on hobart, ICRUCLM50BGCCROP tests
             use clm50BGCCROPmonthly test-mods (with dynroots on, so change answers)
M       components/clm/cime_config/testdefs/testmods_dirs/clm/luna/user_nl_clm - Turn flexCN on
M       components/clm/cime_config/testdefs/testmods_dirs/clm/cropMonthOutput/user_nl_clm - Turn dynroot on
             (so these tests change answers)

M       components/clm/src/ED/fire/SFMainMod.F90 - Comment from Rosie

M       components/clm/src/biogeophys/WaterfluxType.F90 --- Add running annual mean of ET when FUN is on
M       components/clm/src/biogeophys/BalanceCheckMod.F90 - Increase tolerance for snow balance check (see bug 2238)
M       components/clm/src/biogeophys/LunaMod.F90 --------- Make 0.015 constant a parameter 
                                                  (later should use parameter in CanopyStateMod)
M       components/clm/src/biogeophys/PhotosynthesisMod.F90 - Use leaf_mr_vcm constant from canopystate_ins
            Remove (.not.use_cn) for recalculation of lmr25 when luna on, for natural C3 veg (see bug 2249)
M       components/clm/src/biogeophys/CanopyStateType.F90 - Make parameter for leaf_mr_vcm, add ReadNML sub

M       components/clm/src/soilbiogeochem/SoilBiogeochemCompetitionMod.F90 ---- Call FUN module
M       components/clm/src/soilbiogeochem/SoilBiogeochemPrecisionControlMod.F90 When FUN on, do not
                do precision control of low values for no3 and nh4
M       components/clm/src/soilbiogeochem/SoilBiogeochemLittVertTranspMod.F90 -- Increase transport by
                same factor as spinup acceleration by latitude
M       components/clm/src/soilbiogeochem/SoilBiogeochemCarbonFluxType.F90 ----- Add soilc_change_col
M       components/clm/src/soilbiogeochem/SoilBiogeochemCarbonStateType.F90 ---- Take into account latitude
                varying spinup acceleration for exit and enter spinup states
M       components/clm/src/soilbiogeochem/SoilBiogeochemStateType.F90 ---------- Add function for increase
                of spinup acceleration by latitude
M       components/clm/src/soilbiogeochem/SoilBiogeochemNStateUpdate1Mod.F90 --- For FUN N deposition and fixation put into NH4
                use FUN version of sminn_to_plant_fun

M       components/clm/src/soilbiogeochem/SoilBiogeochemNitrogenFluxType.F90 --- Add several FUN nitrogen fixation
                terms: ffix_to_sminn_col, ffix_to_sminn_col, sminn_to_plant_fun_no3_vr_col,
                       sminn_to_plant_fun_nh4_vr_col, sminn_to_plant_fun_vr_col
M       components/clm/src/soilbiogeochem/SoilBiogeochemDecompCascadeBGCMod.F90  Changes from Charlie to make
                spinup acceleration higher as latitude increases.
M       components/clm/src/soilbiogeochem/SoilBiogeochemNitrogenStateType.F90 -- decomp_npools_vr depends
                on spinup state and depends on latitude.

M       components/clm/src/CMakeLists.txt - Add soilbiogeochem directory for unit tests

M       components/clm/src/biogeochem/CNBalanceCheckMod.F90 --------- Add cbalance warning, for FUN
                add in free living fixation, decrease n-balance error from e-8 to e-6, add nbalance warn
M       components/clm/src/biogeochem/CNVegStateType.F90 ------------ Init huigrain to zero, add leafcn_offset
                and plantCN for FUN
M       components/clm/src/biogeochem/CNMRespMod.F90 ---------------- Add CNMRespReadNML, br_root
M       components/clm/src/biogeochem/CNVegNitrogenStateType.F90 ---- Add leafn_storage_xfer_acc and 
                storage_ndemand for FUN, change two conditionals on spinup_state/restart_spinup_state 
                to include 0 AND 1
MM      components/clm/src/biogeochem/CNRootDynMod.F90 -------------- Only update root_depth if huigrain>0
M       components/clm/src/biogeochem/CNPhenologyMod.F90 ------------ Add phase to CNPhenology (divides
                into two parts, needed for FUN), add Kyla's rainfall trigger (ONLY when FUN on)
                other changes when FUN on
M       components/clm/src/biogeochem/CNCStateUpdate1Mod.F90 -------- Add carbon spent on uptake respiration
M       components/clm/src/biogeochem/CNSharedParamsMod.F90 --------- Add use_fun
M       components/clm/src/biogeochem/NutrientCompetitionCLM45defaultMod.F90 If FUN on get N available from FUN
                turn off some sections when fun on
M       components/clm/src/biogeochem/CNFireLi2016Mod.F90 ----------- Changes for spinup from Charlie
M       components/clm/src/biogeochem/CNNDynamicsMod.F90 ------------ Add CNFreeLivingFixation subroutine
                set ndep_to_sminn to zero for FUN
M       components/clm/src/biogeochem/CNVegNitrogenFluxType.F90 ----- Add N demand and aquired arrays for FUN
M       components/clm/src/biogeochem/CNDriverMod.F90 --------------- If FUN on call CNFreeLivingFixation
                rather than CNNFixation. If FUN on split CNPhenology into two segments
M       components/clm/src/biogeochem/CNC14DecayMod.F90 ------------- Speed up radioactive decay by lat factor
M       components/clm/src/biogeochem/NutrientCompetitionFlexibleCNMod.F90 Changes for FUN. Burning off option
                not used for FUN, for FUN, growth respiration is not part of the allometry calculation
M       components/clm/src/biogeochem/CNVegCarbonFluxType.F90 ------- Carbon flux fields for FUN
M       components/clm/src/biogeochem/CNVegCarbonStateType.F90 ------ Add leafc_storage_xfer_acc and
                storage_cdemand for FUN, change some spinup state if statements from Charlie

MM      components/clm/src/main/clm_initializeMod.F90 - Call clm_instReadNML and waterflux_inst%initAccVar
MM      components/clm/src/main/clm_varcon.F90 -------- Add fun_period and small_value for FUN
M       components/clm/src/main/pftconMod.F90 --------- Add FUN pft-varying parameters
M       components/clm/src/main/clm_instMod.F90 ------- Add clm_instReadNML for namelists, calls
              canopystate_inst%ReadNML, add waterflux_inst%InitAccBuffer
M       components/clm/src/main/readParamsMod.F90 ----- Add readCNFUNParams
MM      components/clm/src/main/controlMod.F90 -------- Set use_fun and call CNMRespReadNML
M       components/clm/src/main/clm_driver.F90 -------- Call waterflux_inst%UpdateAccVars

===============================================================
===============================================================
Tag name:  clm4_5_6_r154
Originator(s):  andre (Benjamin Andre,UCAR/CSEG,303-497-1391)
Date: Wed Nov 18 16:35:53 MST 2015
One-line Summary: one year grain product pool

Purpose of changes
------------------

  Introduce logic to have the harvested grain products decay over the
  course of one year. This is distinct from previous versions, in
  which the grain products decayed immediately. Including the one-year
  decay time changes soil carbon and nitrogen pools, and is on by
  default in the CLM5 crop model. (Danica Lombardozzi, Dave Lawrence)

  Add temporary test for all the clm50 functionality being used in the
  preliminary cesm2 coupled run:

    ERS_D_Ld3.f09_g16_gl5.IGCRUCLM50BGCCROP.yellowstone_intel.clm-clm50KitchenSink

  Note: Because of the brittle situation with the surface
  datasets/initial conditions files being inconsistent, we had to use
  the f09 grid for this test. The run length was kept short to keep
  the wall clock time ~30 min. This is too short exercise some new
  clm50 functionality, e.g. one year grain product pool.

Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to run initial conditions through init_interp): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables):

  New namelist variables: use_fertilizer, use_grainproduct

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: unknown, none expected


Code reviews and testing
------------------------

Code reviewed by: Lombardozzi, Sacks

CLM testing: regular

  build-namelist tests:

    yellowstone - unit tests pass

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - n/a, not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - n/a, not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - 4.0 pass; 4.5 ok
    yellowstone_pgi - 4.0 pass; 4.5 ok
    yellowstone_gnu (clm45 only) - 4.5 ok
    hobart_nag - 4.5 ok

    'ok' means: all tests passed functionality and baseline
    comparisons. only nlcomp failures. new test did not have a
    baseline.

  Note: Grain product pool is active by default for clm50 with crops,
  and will change answers. None of the tests are affected because they
  do not run long enough to trigger the new code.

CLM tag used for the baseline comparisons: clm4_5_6_r153


Answer changes
--------------

Changes answers relative to baseline: yes

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: clm50-crop
    - what platforms/compilers: all/all
    - nature of change (roundoff; larger than roundoff/same climate; new climate):
      expected to be larger than roundoff, same climate.

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: none

   URL for LMWG diagnostics output used to validate new climate: none


Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do:

  test mods for new test
    clm/cime_config/testdefs/testmods_dirs/clm/clm50KitchenSink/user_nl_clm
    clm/cime_config/testdefs/testmods_dirs/clm/clm50KitchenSink/include_user_mods

List all existing files that have been modified, and describe the changes:

  one year grain product pool
    clm/src/biogeochem/CNPhenologyMod.F90 - fertilizer switch
    clm/src/biogeochem/CNVegNitrogenFluxType.F90
    clm/src/biogeochem/CNDriverMod.F90
    clm/src/biogeochem/CNVegCarbonFluxType.F90
    clm/src/biogeochem/CNVegCarbonStateType.F90
    clm/src/biogeochem/CNVegNitrogenStateType.F90
    clm/src/biogeochem/CNWoodProductsMod.F90

  new namelist/control variables for fertilizer and grain product pool
    clm/src/main/clm_varctl.F90
    clm/src/main/controlMod.F90
    clm/bld/namelist_files/namelist_definition_clm4_5.xml
    clm/bld/namelist_files/namelist_defaults_clm4_5.xml
    clm/bld/CLMBuildNamelist.pm

  new test
    clm/cime_config/config_compsets.xml
    clm/cime_config/testdefs/testlist_clm.xml


===============================================================
===============================================================
Tag name:  clm4_5_6_r153
Originator(s):  Sean Swenson, Bill Sacks
Date: Tue Nov 17 06:01:47 MST 2015
One-line Summary: Fix snow cover fraction bug

Purpose of changes
------------------

The fix for infinite snow growth made in clm4_5_3_r144 turned out to have a bug
of its own: It made snow cover fraction rarely reach ~ 1, instead maxing out
around 0.8 or 0.9.

This tag fixes the snow cover fraction bug while still (it appears) preventing
infinite snow growth.

This results in a potentially large change in model behavior, so the version
number is bumped from clm4_5_5 to clm4_5_6. However, this is mainly due to
backing out some of the (buggy) changes that were put in place in
clm4_5_3_r144. That is, if the changes in this new tag were made on top of
clm4_5_3_r143, the differences would likely be relatively small.

Changes made by Sean Swenson, brought to trunk by Bill Sacks.


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to run initial conditions through init_interp): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none


Code reviews and testing
------------------------

Code reviewed by: Bill Sacks

CLM testing:

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

    'ok' means: tests pass, but answers change for CLM45 / CLM50 cases

CLM tag used for the baseline comparisons: clm4_5_5_r152


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: All CLM45 / CLM50 cases
    - what platforms/compilers: All
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      New climate

      Main changes are due to backing out some of the (buggy) changes that were
      put in place in clm4_5_3_r144. That is, if the changes in this new tag
      were made on top of clm4_5_3_r143, the differences would likely be
      relatively small.

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Main changes. The change to CanopyHydrologyMod backs out a change that
          was made in r144. The change to SnowHydrologyMod is new.
M       components/clm/src/biogeophys/CanopyHydrologyMod.F90
M       components/clm/src/biogeophys/SnowHydrologyMod.F90

========= Unrelated change: get rid of a write statement that was resulting in
          lots of messages to the log file
M       components/clm/src/biogeophys/SoilHydrologyMod.F90

===============================================================
===============================================================
Tag name:  clm4_5_5_r152
Originator(s):  sacks (Bill Sacks)
Date: Tue Nov 17 05:22:58 MST 2015
One-line Summary: Fix glc_mec energy conservation bug

Purpose of changes
------------------

Fix an energy conservation bug that appears when running glc_mec (i.e., in runs
with CISM). Energy loss due to ice melt was essentially being double-counted:
First, all snow capping was being sent as ice runoff, and thus melted by the
ocean; in addition, glacier ice melt removed energy from CLM. This removal of
energy due to both accumulation (snow capping) and melt amounts to
double-counting.

This is fixed by: For each unit of ice melt, remove one unit of ice runoff
(possibly resulting in negative ice runoff), adding one unit of liquid
runoff. You can think of this as: each unit of ice melt indicates one unit of
snow capping that should not have made it to the ocean, but instead melted en
route.

Note that we currently adjust qflx_snwcp_ice in order to achieve this ice runoff
adjustment. This affects the QSNWCPICE history field. (In an upcoming tag, I
plan to return qflx_snwcp_ice to its original values (i.e., truly indicating
snow capping), by introducing a new field that explicitly gives ice runoff.)

This tag also fixes a minor bug in the calculation of negative runoff for
glc_mec columns with glc_dyn_runoff_routing=T. In addition, it reorders some
code in HydrologyDrainageMod in order to remove some complexity.


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to run initial conditions through init_interp): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none


Code reviews and testing
------------------------

Code reviewed by: self

CLM testing:

  build-namelist tests:

    yellowstone - not run

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - pass

    'ok' means: pass except for baseline failures in IG tests (IG compsets plus
    ICLM45GLCMEC)

    Also, unexpected baseline failures in the following tests; however, these
    same baseline failures were observed when comparing a fresh checkout of r151
    against the r150 baselines (this new branch is bit-for-bit with a fresh
    checkout of r151 for these tests):

     NCK_Ld5.f10_f10.I.yellowstone_pgi.clm-40default
        RMS x2l_Flrr_volr                    8.8324E-18            NORMALIZED  2.2700E-15
         RMS x2l_Flrr_volrmch                 8.8324E-18            NORMALIZED  2.2700E-15

     SMS_D_Ld3.f10_f10.ICRUCLM50BGC.yellowstone_pgi.clm-default
     SMS_Ld5.f19_g16.IRCP45CLM45BGC.yellowstone_pgi.clm-decStart
        FILLDIFF topo                            

     NCK_Ld1.f10_f10.ICRUCLM45.yellowstone_intel.clm-default
        RMS VOLR                             8.9604E-05            NORMALIZED  1.2335E-14
         RMS VOLRMCH                          8.9604E-05            NORMALIZED  1.2335E-14
        RMS x2l_Flrr_volr                    2.8268E-17            NORMALIZED  6.8542E-15
         RMS x2l_Flrr_volrmch                 2.8268E-17            NORMALIZED  6.8542E-15

CLM tag used for the baseline comparisons: clm4_5_4_r151 (baseline directory
named clm4_5_4_r150)


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: All IG compsets (compsets with CISM / glc_mec)
    - what platforms/compilers: All
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      Likely new climate

      For each unit of glacier melt, there is an extra unit of liquid runoff,
      and one unit less of ice runoff.

      This results in changes in the following CLM history fields: ERRH2O,
      ERRH2OSNO, QRGWL, QRUNOFF, QRUNOFF_TO_COUPLER, QSNWCPICE,
      QSNWCPICE_TO_COUPLER, TWS, VOLR, VOLRMCH

      And the following changes in l2x cpl hist fields: l2x_Flrl_rofdto,
      l2x_Flrl_rofgwl, l2x_Flrl_rofi

      There are also changes in the consequent x2r, r2x and x2l cpl hist fields.

      I did one test run to confirm that the differences in (l2x_Flrl_rofdto +
      l2x_Flrl_rofgwl) exactly balanced the differences in l2x_Flrl_rofi.


   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Main changes
M       components/clm/src/biogeophys/BalanceCheckMod.F90
M       components/clm/src/biogeophys/HydrologyDrainageMod.F90

========= Unrelated change: just change a comment
M       components/clm/src/main/clm_instMod.F90

===============================================================
===============================================================
Tag name:  clm4_5_4_r151
Originator(s):  erik (Erik Kluzek)
Date:  Fri Nov 13 15:50:58 MST 2015
One-line Summary: Fix broken r150 tag, with bgc_spinup issue in it

Purpose of changes
------------------

Backout changes to -bgc_spinup in CLM build-namelist should NOT
have been committed.

Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID): 2245
    2245 setup doesn't work, because of issue iwth -bgc_spinup

Notes of particular relevance for users None
---------------------------------------

Code reviews and testing
------------------------

Code reviewed by: self

CLM testing: None! (but this is the same as what was actually tested for clm4_5_4_r150)

CLM tag used for the baseline comparisons:  clm4_5_4_r150


Answer changes
--------------

Changes answers relative to baseline: No

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, cism, etc.): None

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

>>>>>>> Remove non-working on-accell option to -bgc_spinup to namelist
M       components/clm/bld/CLMBuildNamelist.pm
M       components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml
M       components/clm/bld/namelist_files/namelist_definition_clm4_5.xml

===============================================================
===============================================================
Tag name:  clm4_5_4_r150
Originator(s):  erik (Erik Kluzek)
Date: Fri Nov 13 13:42:39 MST 2015
One-line Summary: Some needed answer changing fixes for: fire, disallow negative photosynthis, 
                  and reduce LAI of DBT in evergreen state

Purpose of changes
------------------

Add in changes to fire fluxes for deadstem (both clm4_5 and clm5_0). Don't allow
photosynthis to be less than zero. Reduce the Leaf Area Index (LAI) of Deciduous 
Broadleaf Tree (DBT) when in an evergreen state (warm enough that all of the leaves never
all fall off) by taking into account leaf longevity and only allowing the amount of 
leaf or fine root Carbon storage transfered to be more than the amount of remaining leaf 
or fine root Carbon (would be zero unless in an evergreen state). Previously, DBT in 
evergreen state would have unrealistically high LAI, that would then cause them to take up 
too much water and then kill the trees. So they had an unrealistic cycle for trees that are 
supposed to be in an evergreen state.

Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID): 2242, 2243, and 2244
   2244 Change to reduce leaf area of DBT in evergreen state (rfisher)
   2243 Deadstem not taken into account in fire-fluxes for clm4_5 (koven)
   2242 Disallow negative photosynthis (olesen and bonan)

Known bugs introduced in this tag (include bugzilla ID): 2245
    2245 setup doesn't work, because of issue iwth -bgc_spinup

Notes of particular relevance for users None
---------------------------------------

Caveats for users (e.g., need to run initial conditions through init_interp): None

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): None

Changes made to namelist defaults (e.g., changed parameter values): None

Changes to the datasets (e.g., parameter, surface or initial files): None

Substantial timing or memory changes: None


Code reviews and testing
------------------------

Code reviewed by: self, koven, rfisher, oleson

CLM testing:

  build-namelist tests:

    yellowstone - yes

  unit-tests (components/clm/src):

    yellowstone -  yes

  tools-tests (components/clm/test/tools):

    yellowstone -  no

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - no

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - yes
    yellowstone_pgi - yes
    yellowstone_gnu (clm45 only) - yes
    hobart_nag - yes

CLM tag used for the baseline comparisons:  clm4_5_3_r149


Answer changes
--------------

Changes answers relative to baseline:

  Summarize any changes to answers, i.e.,
    - what code configurations: clm4_5 and clm5_0
    - what platforms/compilers: all
    - nature of change: similar climate

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, cism, etc.): None

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

M components/clm/src/biogeochem/CNFireLi2014Mod.F90 --- Deal with deadstem for fire fluxes
M components/clm/src/biogeochem/CNFireLi2016Mod.F90 --- Deal with deadstem for fire fluxes
M components/clm/src/biogeochem/CNPhenologyMod.F90 ---- In CNStressDecidPhenology take into
      account leaf longevity in lgsf, lower leaf and froot Carbon storage to transfer, by
      the leaf and froot Carbon
M components/clm/src/biogeophys/PhotosynthesisMod.F90 - Make ag max of zero or calculated value
     

===============================================================
===============================================================
Tag name:  clm4_5_3_r149
Originator(s):  sacks (Bill Sacks)
Date: Sun Nov  8 12:41:59 MST 2015
One-line Summary: Change cold start initialization of snow pack

Purpose of changes
------------------

Change cold start initialization of snow pack to lead to fewer instances where
cold start conditions negatively impact the simulation for long periods. Main
change is to make initial snow pack over glacier and high-latitude vegetation
much smaller.

Also make istice consistent with istice_mec.

New method developed in conjunction with Jan Lenaerts, Leo van Kampenhout, and
Dave Lawrence.


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to run initial conditions through init_interp): none

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: none


Code reviews and testing
------------------------

Code reviewed by: self

CLM testing:

  build-namelist tests:

    yellowstone - NOT RUN

  unit-tests (components/clm/src):

    yellowstone - OK

  tools-tests (components/clm/test/tools):

    yellowstone - NOT RUN

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - NOT RUN

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - OK
    yellowstone_pgi - OK
    yellowstone_gnu (clm45 only) - OK
    hobart_nag - OK

CLM tag used for the baseline comparisons: clm4_5_3_r148


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: All CLM45/CLM5 cold start runs
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      larger than roundoff; not investigated carefully

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Main changes
M       components/clm/src/main/clm_instMod.F90

========= Add a comment in changelog entry for clm4_5_3_r148
M       ChangeLog
M       components/clm/doc/ChangeLog

========= Minor tweak to template
M       .ChangeLog_template

===============================================================
===============================================================
Tag name:  clm4_5_3_r148
Originator(s):  sacks (Bill Sacks)
Date: Sat Nov  7 06:41:25 MST 2015
One-line Summary: For CLM5, increase max snow depth to 20 m

Purpose of changes
------------------

Change CLM5 snow defaults:

- h2osno_max = 20m rather than 1m

- nlevsno = 12 rather than 5

- glc_snow_persistence_max_days = 0 rather than 7300 (this is just used for
  modeling glacial inception when coupled to CISM)


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to run initial conditions through init_interp):

   For CLM5 cases, need to run initial conditions through init_interp, because
   of the change in nlevsno. See caveats under clm4_5_3_r146 before doing so.

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values):

- h2osno_max = 20m rather than 1m

- nlevsno = 12 rather than 5

- glc_snow_persistence_max_days = 0 rather than 7300 (this is just used for
  modeling glacial inception when coupled to CISM)

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes:

   This change will lead to some memory increase, and some increase in timing,
   due to having more snow layers. I have not investigated this closely. The
   tputcomp tests all passed, but these are not very meaningful - in part
   because there likely weren't any grid cells with substantially more than 5
   layers in these test runs.


Code reviews and testing
------------------------

Code reviewed by: self

CLM testing:

  build-namelist tests:

    yellowstone: NOT RUN

  unit-tests (components/clm/src):

    yellowstone: NOT RUN

  tools-tests (components/clm/test/tools):

    yellowstone: NOT RUN

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone: NOT RUN

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    yellowstone_gnu (clm45 only): ok
    hobart_nag: ok

CLM tag used for the baseline comparisons: clm4_5_3_r147


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM5
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      larger than roundoff, likely new climate in some regions

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename:

       Some runs documented here:
       https://docs.google.com/document/d/1Y5kCwa0GUnQ0hy7vNwvtFOKaC3ikysfLXdcNVqRygok/edit

   URL for LMWG diagnostics output used to validate new climate:

       http://www.staff.science.uu.nl/~kampe004/lnd_diag/tr_eraimod_5_cap-tr_eraimod_12_cap/setsIndex.html
       - note that this uses 10m snow pack rather than 20m

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Change namelist defaults, as listed above
M       components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml

========= Add documentation
M       components/clm/bld/namelist_files/namelist_definition_clm4_5.xml

===============================================================
===============================================================
Tag name:  clm4_5_3_r147
Originator(s):  andre (Benjamin Andre,UCAR/CSEG,303-497-1391)
Date:  Thu Nov  5 21:51:53 MST 2015
One-line Summary: swenson bedrock and coupler runoff bugfixes

Purpose of changes
------------------

  Science bugfixs from Sean Swenson for bedrock and coupler runoff fields.

    The bugfix for bedrock corrects an issue where running with debug
    flags and bedrock on would generate floating point errors or
    unreproducible behavior when run with a surface data set that
    contained bedrock data.

    coupler runoff fields bugfix: splitting of runoff for mosart did
    not contain all surface and subsurface fields. surface runoff is
    the sum of qflx_over, qflx_h2osfc_surf, and qflx_irrig. subsurface
    runoff is the sum of qflx_drain and qflx_perched_drain

  Add cropColdStart test mods directory missing from r145.


Bugs fixed or introduced
------------------------

Bugs fixed (include bugzilla ID): 2241


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to run initial conditions through
init_interp):
  use_bedrock is still not true by default because we do
  not have a fully consistent set of surface data sets and initial
  conditions for testing.

Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files): none

Substantial timing or memory changes: unknown, none expected


Code reviews and testing
------------------------

Code reviewed by: Swenson, Andre

CLM testing: regular

  build-namelist tests:

    yellowstone - unit tests pass

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - n/a, not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - n/a, not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - 40 pass; 45 ok
    yellowstone_pgi - 40 pass; 45 ok
    yellowstone_gnu (clm45 only) - 45 ok
    hobart_nag - ok

  'ok' means - all clm45/50 compsets have only the 'baseline compare'
  answer changing failures. Fields described below.

  test BFAIL ERP_D_P15x2_Ld3.f10_f10.ICRUCLM50BGCCROP.yellowstone_intel.clm-cropColdStart because baseline is not in r146.

CLM tag used for the baseline comparisons: clm4_5_3_r146


Answer changes
--------------

Changes answers relative to baseline: yes

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: clm45/clm50
    - what platforms/compilers: all/all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): larger than roundoff

   All clm45 and clm50 compsets will have answer changes in the clm
   and coupler history files because of changes to the runoff passed
   from clm to the coupler. Only the following fields have changed:

   clm: TWS, VOLRMCH, VOLR

   cpl: l2x_Flrl_rofgwl, x2r_Flrl_rofsub, x2r_Flrl_rofsur,
   r2x_Flrr_volrmch, r2x_Flrr_volr, r2x_Forr_rofl, x2l_Flrr_volrmch,
   x2l_Flrr_volr, l2x_Flrl_rofsub, l2x_Flrl_rofsur, x2r_Flrl_rofgwl

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: none

   URL for LMWG diagnostics output used to validate new climate: none


Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do:

    Add missing cropColdStart test mods
      clm/cime_config/testdefs/testmods_dirs/clm/cropColdStart/user_nl_clm
      clm/cime_config/testdefs/testmods_dirs/clm/cropColdStart/include_user_mods
      clm/cime_config/testdefs/testmods_dirs/clm/cropColdStart

List all existing files that have been modified, and describe the changes:

    Bedrock bug fix, initialize and size arrays correctly.
      clm/src/biogeophys/SoilWaterMovementMod.F90

    Remove expected failure from missing test mods:
      clm/cime_config/testdefs/ExpectedTestFails.xml

    Coupler runoff bugfix:
      clm/src/cpl/lnd_import_export.F90
      clm/src/main/lnd2atmType.F90
      clm/src/main/clm_driver.F90
      clm/src/main/lnd2atmMod.F90


===============================================================
===============================================================
Tag name:  clm4_5_3_r146
Originator(s):  sacks (Bill Sacks)
Date: Wed Nov  4 06:48:41 MST 2015
One-line Summary: Implement vertical interpolation in init_interp

Purpose of changes
------------------

The major requirements this addresses are:

(1) Handle changes in the vertical discretization of the soil column,
    including changing the number of layers and/or changing the depth of layers.

(2) Handle changes in which soil layers are considered bedrock vs. "standard"
    soil: Information from bedrock layers should not be transmitted to soil
    layers, and vice versa.

(3) Handle changing number of snow layers

There was previously-existing code to handle (1). However, while it was mostly
right, it was hard-coded to just handle the interpolation from "standard"
vertical levels to "more_vertlevels". And there were a number of special cases
that it mis-handled (such as urban points, which have a different vertical
discretization; also, spvals were not handled correctly). It was also going to
be hard to fit requirements #2 and #3 into the old code. So I removed the old
code and replaced it with a new, object-oriented design.

Because the number of files involved in init_interp has now grown significantly,
I have moved this code to a new directory (src/init_interp).

As part of the handling of vertical interpolation, I needed to fix a few
inconsistencies in the use of spval in some multi-level fields (see below for
details).

Finally, to aid with testing of this new code, and because it is useful in
general, Sean Swenson added nbedrock to the first history file of a run.


Bugs fixed or introduced
------------------------

Known bugs introduced in this tag (include bugzilla ID): [If none, remove this line]
- 2239: need new initial conditions files with extra metadata on them


Notes of particular relevance for users
---------------------------------------

Caveats for users (e.g., need to run initial conditions through init_interp):

- If you want to use init_interp on an initial conditions file generated prior
  to this tag, you will need to first get some new metadata onto your initial
  conditions file: COL_Z, LEVGRND_CLASS, COL_Z_p and LEVGRND_CLASS_p. You have
  two options for how to do this:

  (1) Run the model for a short time using this tag, with a configuration that
      matches the source file, using the source file as finidat (with
      use_init_interp = .false.), in order to produce a new restart file with
      the necessary metadata.  Then use that new file as the finidat file for
      init_interp.
  
  (2) If that is not possible, then an alternative is to run the model for a
      short time using this tag, with cold start initial conditions (finidat = " ").
      Then use a tool like ncks to copy the misssing fields onto the original source
      finidat file. Then use that patched file as the finidat file for
      init_interp. CAUTION: A bug in the netcdf library means that adding fields
      using ncks can result in data corruption of existing fields. I have
      observed this in the plant_nalloc field, which fortunately does not seem
      to be needed at all on the restart file. However, if you use this method,
      you should compare the old and new files to ensure that nothing other than
      plant_nalloc has been changed.


Changes to CLM's user interface (e.g., new/renamed XML or namelist variables): none

Changes made to namelist defaults (e.g., changed parameter values): none

Changes to the datasets (e.g., parameter, surface or initial files):
   Some new initial conditions files: same as old, but with metadata needed for
   running them through init_interp

Substantial timing or memory changes: none


Code reviews and testing
------------------------

Code reviewed by: self; CLM-CMT plans to do a more detailed review later

CLM testing:

  build-namelist tests:

    yellowstone: NOT RUN

  unit-tests (components/clm/src):

    yellowstone: ok

  tools-tests (components/clm/test/tools):

    yellowstone: NOT RUN

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone: NOT RUN

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    yellowstone_gnu (clm45 only): ok
    hobart_nag: ok

CLM tag used for the baseline comparisons: clm4_5_3_r145


Answer changes
--------------

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM45 / CLM50 runs that use init_interp to
  interpolate to a different resolution
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
        larger than roundoff; not investigated closely

    Changes arise from the fact that multi-level points are now interpolated
    rather than copied from the input to the output. This changes results for
    urban points, where the vertical level structure of walls and rooves varies
    from gridcell to gridcell.

    There are also FILLDIFFs in SOILLIQ and SOILICE in vector (dov2xy = .false.)
    history files, due to a bug fix in the treatment of spval for these
    variables.

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	

Detailed list of changes
------------------------

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated:

========= Moved to new directory for init_interp code
D       components/clm/src/main/initInterpMindist.F90
D       components/clm/src/main/initInterp.F90
D       components/clm/src/main/test/initInterpMindist_test/CMakeLists.txt
D       components/clm/src/main/test/initInterpMindist_test/test_init_interp_mindist.pf
D       components/clm/src/main/test/initInterpMindist_test

List all files added and what they do:

========= Added new directory for init_interp code, populated with files that
          used to be in main
A       components/clm/src/init_interp
A       components/clm/src/init_interp/initInterpMindist.F90
A       components/clm/src/init_interp/CMakeLists.txt
A       components/clm/src/init_interp/test/initInterpMindist_test/CMakeLists.txt
A       components/clm/src/init_interp/test/initInterpMindist_test/test_init_interp_mindist.pf
A       components/clm/src/init_interp/test/initInterpMindist_test
A       components/clm/src/init_interp/test

========= Main changes needed for vertical interpolation
A       components/clm/src/init_interp/initInterpMultilevelBase.F90
A       components/clm/src/init_interp/initInterpMultilevelCopy.F90
A       components/clm/src/init_interp/initInterpMultilevelInterp.F90
A       components/clm/src/init_interp/initInterpMultilevelSnow.F90
A       components/clm/src/init_interp/initInterpMultilevelSplit.F90
A       components/clm/src/init_interp/initInterpMultilevelContainer.F90
A       components/clm/src/init_interp/initInterp.F90
A       components/clm/src/init_interp/initInterp2dvar.F90.in
A       components/clm/src/init_interp/initInterpBounds.F90

========= Wrappers to transpose and pack that handle allocation for you (needed
          for pgi)
A       components/clm/src/utils/array_utils.F90.in

========= Put unit tests around the parts of the vertical interpolation that
          have significant logic
A       components/clm/src/init_interp/test/CMakeLists.txt
A       components/clm/src/init_interp/test/initInterpMultilevel_test/test_init_interp_multilevel_split.pf
A       components/clm/src/init_interp/test/initInterpMultilevel_test/initInterpMultilevelMock.pf
A       components/clm/src/init_interp/test/initInterpMultilevel_test/multilevel_interp_factory.F90
A       components/clm/src/init_interp/test/initInterpMultilevel_test/test_init_interp_multilevel_interp.pf
A       components/clm/src/init_interp/test/initInterpMultilevel_test/test_init_interp_multilevel_snow.pf
A       components/clm/src/init_interp/test/initInterpMultilevel_test/CMakeLists.txt
A       components/clm/src/init_interp/test/initInterpMultilevel_test

========= Allow vrtlay tests to use init_interp
A       components/clm/cime_config/testdefs/testmods_dirs/clm/vrtlay_interp/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/vrtlay_interp/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/vrtlay_interp/README
A       components/clm/cime_config/testdefs/testmods_dirs/clm/vrtlay_interp

========= Add a CLM5 crop test that uses init_interp (init_interp is needed for
          CLM5 cases with non-cold-start initial conditions)
A       components/clm/cime_config/testdefs/testmods_dirs/clm/cropMonth_interp/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/cropMonth_interp/README
A       components/clm/cime_config/testdefs/testmods_dirs/clm/cropMonth_interp/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/cropMonth_interp

List all existing files that have been modified, and describe the changes:

========= Added new directory for init_interp code
M       components/clm/bld/configure
M       components/clm/src/CMakeLists.txt
M       components/clm/src/main/test/CMakeLists.txt

========= Added new metadata to restart file that is needed for the vertical interpolation
M       components/clm/src/main/initVerticalMod.F90
M       components/clm/src/main/subgridRestMod.F90
M       components/clm/src/main/ColumnType.F90
M       components/clm/src/main/column_varcon.F90
M       components/clm/src/main/filterMod.F90
M       components/clm/src/utils/restUtilMod.F90.in

========= New routines used to add metadata to restart file and to read
          variables in init_interp
M       components/clm/src/main/ncdio_pio.F90.in

========= Remove unnecessary use of spval (the vertical interpolation was not
          handling this use of spval correctly, because it is inconsistent with
          other uses of spval in the code; it turns out this use of spval wasn't
          necessary to begin with)
M       components/clm/src/biogeochem/ch4Mod.F90
M       components/clm/src/soilbiogeochem/SoilBiogeochemNitrifDenitrifMod.F90

========= Fix bug: calculations were being done on spval, leading to values of
          1e75 on the restart file (this was causing problems with the new
          vertical interpolation)
M       components/clm/src/biogeophys/WaterStateType.F90

========= Added new necessary metadata to any initial conditions file that is
          used for init_interp testing. I have NOT taken the time to do this for
          other out-of-the-box initial conditions, figuring that they'll be
          replaced soon anyway. (Any file generated with the new tag will have
          the necassary metadata on it.)
M       components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml
M       components/clm/cime_config/testdefs/testmods_dirs/clm/interp_f19_crop/user_nl_clm
M       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_spunup_1way/user_nl_clm
M       components/clm/cime_config/testdefs/testmods_dirs/clm/interp_f19_noncrop/user_nl_clm

========= Tangentially-related change: add nbedrock to first history file
          (changes from Sean Swenson)
M       components/clm/src/main/GridcellType.F90
M       components/clm/src/main/histFileMod.F90

========= Totally unrelated change: add a comment
M       components/clm/src/biogeophys/test/Irrigation_test/IrrigationWrapperMod.F90

========= Added another system test of init_interp, and modify snowlayer tests
          and some vrtlay tests to use init_interp
M       components/clm/cime_config/testdefs/testlist_clm.xml
M       components/clm/cime_config/testdefs/testmods_dirs/clm/snowlayers_3_monthly/user_nl_clm
M       components/clm/cime_config/testdefs/testmods_dirs/clm/snowlayers_12/user_nl_clm

========= Put unit tests around the parts of the vertical interpolation that
          have significant logic
M       components/clm/src/utils/CMakeLists.txt
M       components/clm/src/main/CMakeLists.txt

========= Remove old failing vrtlay tests from xfail list, add new vrtlay_interp
          tests to xfail list (fail due to bug 2239); add two new CLM5 crop
          tests to xfail list (bugs 2240 and 2241)
M       components/clm/cime_config/testdefs/ExpectedTestFails.xml

========= New ChangeLog template, with sections removed / added / rearranged
M       .ChangeLog_template


===============================================================
===============================================================
Tag name:  clm4_5_3_r145
Originator(s):  andre (Benjamin Andre,UCAR/CSEG,303-497-1391)
Date:  Tue Nov  3 14:25:30 MST 2015
One-line Summary: update clm50 defaults, enable clm50 crop compsets

Purpose of changes:

  CLM 5.0 defaults update from David Lawrence and Erik Kluzek.

  - New namelist defaults for clm50:
    - use_bedrock = false
    - lower_boundray_condition = 2
    - limit_lake_evap_irrig = true
    - use_dynroot = false

  - Remove QICE from default history output in use cases.

  - Some history output variables are now inactive by default:
    CONC_CH4_SAT, CONC_CH4_UNSAT, FPI, N tendency due to vertical
    transport, vertically resolved N.

  - Some history output is now active by default: O2 decomp depth
    unsat, SMINN.

  - Update cime configuration to allow creation of CLM 5.0 crop compsets.

  - Update clm4.0 for pio2 from Jim Edwards.

  Test list update from Ben Andre
  - Add tests: short CLM 5.0 crop test, renamed aux_clm_short test suite to
  clm_short_45, create clm_short_50 test suite.


Requirements for tag: regular

Test level of tag: regular

Bugs fixed (include bugzilla ID): cime issue #238 (https://github.com/CESM-Development/cime/issues/238)

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
  1147 (mkgriddata can't straddle over Greenwich)
  1025 (SCM mode can NOT use a global finidat file)
  1017 (SCM mode can NOT restart)
   896 (T62 mode does not work)
   701 (svn keyword)
   452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist:

  Update namelist defaults for clm50 compsets
    - use_bedrock = false
    - lower_boundray_condition = 2
    - limit_lake_evap_irrig = true
    - use_dynroot = false

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: Erik Kluzek, Ben Andre

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

    clm/bld/CLMBuildNamelist.pm - add_default() call for use_bedrock

    clm/bld/namelist_files/namelist_defaults_clm4_5.xml - new clm50 defaults

    remove QICE from output
      clm/bld/namelist_files/use_cases/20thC_glacierMEC_transient.xml
      clm/bld/namelist_files/use_cases/2000_glacierMEC_control.xml
      clm/bld/namelist_files/use_cases/1850_glacierMEC_control.xml
      clm/bld/namelist_files/use_cases/1850-2100_rcp2.6_glacierMEC_transient.xml
      clm/bld/namelist_files/use_cases/1850-2100_rcp6_glacierMEC_transient.xml
      clm/bld/namelist_files/use_cases/1850-2100_rcp4.5_glacierMEC_transient.xml
      clm/bld/namelist_files/use_cases/1850-2100_rcp8.5_glacierMEC_transient.xml
      clm/bld/namelist_files/use_cases/glacierMEC_pd.xml

    clm/cime_config/testdefs/testlist_clm.xml - new clm50 crop test, clm_short testlist update

    clm/cime_config/config_compsets.xml - clm50 crop compset
    clm/cime_config/config_component.xml - clm50 crop compset

    clm/src_clm40/main/ncdio_pio.F90.in - pio2 update

    change default histroy status for variables listed above.
      clm/src/biogeochem/ch4Mod.F90
      clm/src/soilbiogeochem/SoilBiogeochemStateType.F90
      clm/src/soilbiogeochem/SoilBiogeochemNitrogenFluxType.F90
      clm/src/soilbiogeochem/SoilBiogeochemNitrogenStateType.F90

CLM testing: regular

  build-namelist tests:

    yellowstone - unit tests pass

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - n/a, not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - n/a, not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - 40, pass; 45, ok
    yellowstone_pgi - 40, pass; 45, ok
    yellowstone_gnu (clm45 only) - 45, ok
    hobart_nag - not finished prior to tag. no problems expected based on prior branch testing.

    'ok' means: clm45 tests passed, including baseline comparisons. clm50
    test functionality passed, baseline comparisons failed as expected
    because of changes to namelist defaults. nlcomp will fail for clm50 tests.

CLM tag used for the baseline comparisons: clm4_5_3_r144

Changes answers relative to baseline: some

  Summarize any changes to answers, i.e.,
    - what code configurations: all clm50 compsets
    - what platforms/compilers: all/all
    - nature of change (roundoff; larger than roundoff/same climate; new climate):
      larger than roundoff

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: none

   URL for LMWG diagnostics output used to validate new climate: none

===============================================================
===============================================================
Tag name:  clm4_5_3_r144
Originator(s): Sean Swenson, Keith Oleson, Bill Sacks
Date: Tue Oct 27 09:47:58 MDT 2015
One-line Summary: Better fix for bug that leads to infinite growth in snow depth

Purpose of changes:

   Back out fix for infinite snow growth that was put in in clm4_5_3_r141. Put
   in place new fix from Sean Swenson and Keith Oleson that fixes the problem
   more fundamentally, rather than putting in place a band-aid fix that had its
   own problems.

Test level of tag: regular

Bugs fixed (include bugzilla ID):

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: Sean Swenson, Keith Oleson, Bill Sacks, Leo van Kampenhout

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

M       components/clm/src/biogeophys/CanopyHydrologyMod.F90
M       components/clm/src/biogeophys/SnowHydrologyMod.F90

CLM testing:

  build-namelist tests:

    yellowstone: NOT RUN

  unit-tests (components/clm/src):

    yellowstone: ok

  tools-tests (components/clm/test/tools):

    yellowstone: NOT RUN

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone: NOT RUN

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    yellowstone_gnu (clm45 only): ok
    hobart_nag: ok

CLM tag used for the baseline comparisons: clm4_5_3_r143

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: ALL CLM45 & CLM50
    - what platforms/compilers: ALL
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      Not investigated carefully, but likely to be larger than roundoff/same climate

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	
===============================================================
===============================================================
Tag name:  clm4_5_3_r143
Originator(s):  andre (Benjamin Andre,UCAR/CSEG,303-497-1391)
Date:  Thu Oct 22 23:39:50 MDT 2015
One-line Summary: flexibleCN and luna bugfixes.

Purpose of changes:

  flexibleCN and LUNA bugfix changes from Bardan Ghimire, Rosie Fisher
  and Chonggang Xu.

  Changes to FlexCN to burn off excess C. Corrected the cpool problem
  not going to 0 by changing the order of processes.

  Turn off LUNA for crops and put a boundary cut-off on lnc for very
  high lnc fed to LUNA


Requirements for tag: regular

Test level of tag: regular

Bugs fixed (include bugzilla ID): none

Known bugs (include bugzilla ID): none
    http://bugs.cgd.ucar.edu/

Known Limitations:
   1147 (mkgriddata can't straddle over Greenwich)
   1025 (SCM mode can NOT use a global finidat file)
   1017 (SCM mode can NOT restart)
    896 (T62 mode does not work)
    701 (svn keyword)
    452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: new namelist carbon_resp_opt

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: unknown, none expected

Code reviewed by: Bardan Ghimire, Chonggang Xu, Rosie Fischer, Dave Lawrence

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

  new namelist option carbon_resp_opt
    clm/bld/CLMBuildNamelist.pm
    clm/bld/namelist_files/namelist_definition_clm4_5.xml
    clm/bld/namelist_files/namelist_defaults_clm4_5.xml - update defaults for carbon_storage_excess_opt
    clm/src/main/controlMod.F90
    clm/src/main/clm_varctl.F90

  flexibleCN
    clm/src/biogeochem/NutrientCompetitionFlexibleCNMod.F90 - change order of processes
    clm/src/biogeochem/CNVegCarbonFluxType.F90 - carbon_resp_opt
    clm/src/biogeochem/CNCStateUpdate1Mod.F90 - carbon_resp_opt
    clm/src/biogeochem/NutrientCompetitionMethodMod.F90 - update interface
    clm/src/biogeochem/NutrientCompetitionCLM45defaultMod.F90 - update interface
    clm/src/biogeochem/CNDriverMod.F90 - update interface

  LUNA
    clm/src/biogeophys/LunaMod.F90 - leaf nitrogen cutoff
    clm/src/biogeophys/PhotosynthesisMod.F90 - turnoff luna for crops

  whitespace / remove dead code
    clm/src/biogeochem/CNPhenologyMod.F90


CLM testing: regular

  build-namelist tests:

    yellowstone - unit tests pass

  unit-tests (components/clm/src):

    yellowstone - pfunit tests pass

  tools-tests (components/clm/test/tools):

    yellowstone - n/a, not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - n/a, not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - pass, flexibleCN not expected to be bit for bit with baseline
    yellowstone_pgi - pass
    yellowstone_gnu (clm45 only) - pass
    hobart_nag - not finished at time of tag, expected to be ok based on prior branch testing.

CLM tag used for the baseline comparisons: clm4_5_3_r142

Changes answers relative to baseline: some

  Summarize any changes to answers, i.e.,
    - what code configurations: clm50 with flexibleCN and clm50 with LUNA and crop on
    - what platforms/compilers: all/all
    - nature of change (roundoff; larger than roundoff/same climate; new climate):

    larger than roundoff

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: none

   URL for LMWG diagnostics output used to validate new climate: none

===============================================================
===============================================================
Tag name:  clm4_5_3_r142
Originator(s):  sacks (Bill Sacks)
Date: Mon Oct 19 19:57:35 MDT 2015
One-line Summary: Fix bug in initialization of 12-layer snow pack

Purpose of changes:

   Expand the dzmax arrays to have 12 elements, with the last element being
   'huge'. This fixes a bug in the initialization of the snow pack when you try
   to initialize it to need all 12 layers. And, more generally, this helps avoid
   special-case code that would otherwise be needed to handle the edge case at
   the bottom layer.

Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID):

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: Leo van Kampenhout

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

M       components/clm/src/biogeophys/SnowHydrologyMod.F90

CLM testing:

  build-namelist tests:

    yellowstone: NOT RUN

  unit-tests (components/clm/src):

    yellowstone: ok

  tools-tests (components/clm/test/tools):

    yellowstone: NOT RUN

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone: NOT RUN

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    yellowstone_gnu (clm45 only): ok
    hobart_nag: ok

CLM tag used for the baseline comparisons: clm4_5_3_r141

Changes answers relative to baseline: NO
	
===============================================================
===============================================================
Tag name:  clm4_5_3_r141
Originator(s):  Keith Oleson, Bill Sacks
Date: Mon Oct 19 14:15:06 MDT 2015
One-line Summary: Fix bug that leads to infinite growth in snow depth

Purpose of changes:

   Restore 'qflx_snow_grnd_col(c) > 0.0_r8' condition in check for whether snow
   pack should be initialized. This was removed in clm4_5_1_r121, because Leo found
   that, in some rare cases, with this condition in place, the snow pack wasn't
   being initialized when it should have been. However, we have more recently found
   that, without this condition, there are some rare cases when snow depth can grow
   infinitely - and Keith Oleson traced this bug to the removal of this condition.

   We haven't managed to trace the entire logic here, but for now we feel it's
   safest to restore this condition.

Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID):

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: Keith Oleson, Bill Sacks

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

M       components/clm/src/biogeophys/CanopyHydrologyMod.F90

CLM testing:

  build-namelist tests:

    yellowstone: NOT RUN

  unit-tests (components/clm/src):

    yellowstone: NOT RUN

  tools-tests (components/clm/test/tools):

    yellowstone: NOT RUN

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone: NOT RUN

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    yellowstone_gnu (clm45 only): ok
    hobart_nag: ok

CLM tag used for the baseline comparisons: clm4_5_3_r140

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: ALL CLM45 & CLM50
    - what platforms/compilers: ALL
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      Not investigated carefully, but likely to be larger than roundoff/same climate

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	
===============================================================
===============================================================
Tag name:  clm4_5_3_r140
Originator(s):  andre (Benjamin Andre,UCAR/CSEG,303-497-1391)
Date:  Thu Oct 15 23:45:49 MDT 2015
One-line Summary: mosart, direct to ocean runoff

Purpose of changes:
  Coordinated changes to clm, mosart and rtm to handle direct to
  ocean runoff.

Requirements for tag: regular

Test level of tag: regular

Bugs fixed (include bugzilla ID): none

Known bugs (include bugzilla ID): 2233
    http://bugs.cgd.ucar.edu/

Known Limitations:
   1147 (mkgriddata can't straddle over Greenwich)
   1025 (SCM mode can NOT use a global finidat file)
   1017 (SCM mode can NOT restart)
    896 (T62 mode does not work)
    701 (svn keyword)
    452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: unknown, none expected

Code reviewed by: Sean Swenson

List any svn externals directories updated (cime, rtm, cism, etc.): cime, rtm, mosart

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

  SVN_EXTERNAL_DIRECTORIES - update externals
  clm/cime_config/config_compsets.xml - new compset IMCRUCLM50BGC for testing mosart
  clm/cime_config/testdefs/ExpectedTestFails.xml - known issue in cime causes test failure
  clm/cime_config/testdefs/testlist_clm.xml - add IM compset test for mosart

  add coupler fields for direct ocean runoff
    clm/src_clm40/main/clm_cpl_indices.F90
    clm/src_clm40/main/lnd_import_export.F90
    clm/src/biogeophys/WaterfluxType.F90
    clm/src/biogeophys/HydrologyDrainageMod.F90
    clm/src/cpl/clm_cpl_indices.F90
    clm/src/cpl/lnd_import_export.F90
    clm/src/main/lnd2atmMod.F90
    clm/src/main/lnd2atmType.F90


CLM testing: regular


  build-namelist tests:

    yellowstone - n/a, not run

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - n/a, not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - n/a, not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - generate tests not finished at time of tag, but expected to be ok based on earlier testing.

  Notes:

    - ok means that all functionality tests pass. bit for bit
    comparison with baselines only show differences in the following
    runoff fields when rtm or mosart is running:
      clm - TWS, VOLR, VOLRMCH
     coupler - l2x_Flrl_rofgwl, x2l_Flrr_volr, x2l_Flrr_volrmch, r2x_Forr_rofl, r2x_Flrr_volr, r2x_Flrr_volrmch, x2r_Flrl_rofgwl

    - bfail for new mosart test

    - new expected failure for ERI_N2_Ld9.f19_g16.ICRUCLM45BGCCROP.yellowstone_intel.clm-default because of cime issue.

CLM tag used for the baseline comparisons: clm4_5_3_r139

Changes answers relative to baseline: some

  Summarize any changes to answers, i.e.,
    - what code configurations: all with rtm or mosart
    - what platforms/compilers: all/all
    - nature of change (roundoff; larger than roundoff/same climate; new climate):  larger than roundoff.

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: none

   URL for LMWG diagnostics output used to validate new climate: none

===============================================================
===============================================================
Tag name:  clm4_5_3_r139
Originator(s):  andre (Benjamin Andre,UCAR/CSEG,303-497-1391)
Date:  Tue Oct 13 10:17:43 MDT 2015
One-line Summary: dynamic roots from Beth Drewniak

Purpose of changes:

  Introduce dynamic roots from Beth Drewniak.  Allows roots to grow
  dynamically, optimizing for water and nutrient uptake.  Crop roots
  start from zero each season.  Generally leads to higher root
  densities near the surface, but also deeper maximum root depth.
  Overall, water stress is reduced.  If use_bedrock = true, roots are
  confined exist in soil layers only.  Root litter is input into the
  soil according to the dynamic root distribution.

Requirements for tag: regular

Test level of tag: regular

Bugs fixed (include bugzilla ID): none

Known bugs (include bugzilla ID): none
    http://bugs.cgd.ucar.edu/

Known Limitations:
   1147 (mkgriddata can't straddle over Greenwich)
   1025 (SCM mode can NOT use a global finidat file)
   1017 (SCM mode can NOT restart)
    896 (T62 mode does not work)
    701 (svn keyword)
    452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: new variable use_dynroot

List any changes to the defaults for the boundary datasets:
  updated pft parameter file to c151012, includes merge of dynamic
  roots and flexCN params.

  NOTE: ED parameter file was not update.

Describe any substantial timing or memory changes: unknown, none expected

Code reviewed by: Dave Lawrence

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do: 

  clm/src/biogeochem/CNRootDynMod.F90 - implement dynamic roots

List all existing files that have been modified, and describe the changes:

  new namelist variable use_dynroots and defaults
    clm/bld/CLMBuildNamelist.pm
    clm/bld/namelist_files/namelist_definition_clm4_5.xml
    clm/bld/namelist_files/namelist_defaults_clm4_5.xml

  clm/src/biogeochem/CNDriverMod.F90 - call dynamic roots
  clm/src/main/controlMod.F90 - read use_dynroot namelist var
  clm/src/main/clm_varctl.F90 - add use_dynroot switch
  clm/src/main/pftconMod.F90 - new dynamic root variable
  clm/src/biogeophys/SoilStateType.F90 - add root_depth_patch variable


CLM testing: regular

  build-namelist tests:

    yellowstone - unit tests pass

  unit-tests (components/clm/src):

    yellowstone - pfunit tests pass

  tools-tests (components/clm/test/tools):

    yellowstone - n/a, not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - n/a, not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - a couple of manual tests compiled and ran. full suite not finished at time of tag. 

    NOTE: ok = amelist changes expected for clm45/50. New defaults
    namelist for clm50 turns on dynamic roots, expect all clm50
    compsets to be answer changing.

CLM tag used for the baseline comparisons: clm4_5_3_r138

Changes answers relative to baseline: some

  Summarize any changes to answers, i.e.,
    - what code configurations: clm50 with use_dynroot = true (default)
    - what platforms/compilers: all/all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): new climate

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: none

   URL for LMWG diagnostics output used to validate new climate: none


===============================================================
===============================================================
Tag name:  clm4_5_3_r138
Originator(s):  andre (Benjamin Andre,UCAR/CSEG,303-497-1391)
Date:  Sun Oct 11 13:23:12 MDT 2015
One-line Summary: new accelerated spinup and soil vertical structure

Purpose of changes: Two sets of changes are included in this tag:

  Accelerated spinup
 
    New accelerated spinup mode introduced from Dan Ricciuto.
    Acceleration factors are calculated directly from the base
    decomposition rates for each pool and CWD is added to the pools that
    are accelerated.  Wood mortality is also accelerated by a factor of 10
    through increasing rates of gap mortality and fire.
     
    There are now three accelerated spinup modes
     
    Spinup_state = 0  ; no accelerated spinup
    Spinup_state = 1 ; standard accelerated spinup
    Spinup_state = 2 ; accelerated accelerated spinup
     
    Set through env_run.xml  (-bgc_spinup on) and via namelist.
     
    In tests, new spinup method accelerates spinup by ~ a factor of 2 for
    a case starting from pre-spunup conditions but shifting to another
    forcing dataset.
 
  Vertical soil structure
 
    The vertical soil structure has been cleaned up and a new vertical
    soil structure has been added.  The namelist options more_vertlayers
    and deep_soilcolumn have been removed and replaced with the more
    general soil_layerstruct.  Four options for soil_layerstruct are
    included.
     
    10SL_3.5m - original soil structure from CLM4.5 and prior versions
    20SL_8.5m - proposed new soil structure for CLM5
    23SL_3.5m - replaces more_vertlayers
    49SL_10m  - replace deep_soilcolumn

Requirements for tag: regular

Test level of tag: regular

Bugs fixed (include bugzilla ID): none

Known bugs (include bugzilla ID): 2232
    http://bugs.cgd.ucar.edu/

Known Limitations:
  1147 (mkgriddata can't straddle over Greenwich)
  1025 (SCM mode can NOT use a global finidat file)
  1017 (SCM mode can NOT restart)
   896 (T62 mode does not work)
   701 (svn keyword)
   452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: remove more_vertlayers,
deep_soilcolumn are removed, add soil_layerstruct. new default soil
for clm50 compsets

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: improved spinup, none expected for regular runs.

Code reviewed by: dlawren

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

  remove deep_soilcolumn and more_vertlayers namelist, add soil_layerstruct, update spinup_state:
    clm/bld/namelist_files/namelist_definition_clm4_5.xml
    clm/bld/namelist_files/namelist_defaults_clm4_5.xml
    clm/bld/CLMBuildNamelist.pm

  switch tests to use new namelist variable:
    clm/cime_config/testdefs/testmods_dirs/clm/vrtlay/user_nl_clm
    clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subset/user_nl_clm
    clm/cime_config/testdefs/testmods_dirs/clm/deepsoil_bedrock/user_nl_clm

  add failing tests
    clm/cime_config/testdefs/ExpectedTestFails.xml

  switch soil layer structure from old to new namelist variable
    clm/src/main/clm_varpar.F90 - switch to new namelist variables for soil vertiacal structure
    clm/src/main/controlMod.F90 - update namelist variables
    clm/src/main/clm_varctl.F90 - add soil_layerstruct
    clm/src/main/initVerticalMod.F90 - switch to new namelist variables for soil vertiacal structure
    clm/src/biogeophys/SoilHydrologyInitTimeConstMod.F90 - switch to soil_layerstruct
    clm/src/biogeophys/SoilStateInitTimeConstMod.F90 - switch to soil_layerstruct
    clm/src/biogeophys/IrrigationMod.F90
    clm/src/biogeophys/SoilHydrologyMod.F90 - remove comment

  new spinup mode:
    clm/src/biogeochem/CNGapMortalityMod.F90
    clm/src/biogeochem/CNVegStructUpdateMod.F90
    clm/src/biogeochem/CNVegCarbonStateType.F90
    clm/src/biogeochem/CNFireLi2016Mod.F90
    clm/src/biogeochem/CNVegStateType.F90
    clm/src/biogeochem/CNVegNitrogenStateType.F90
    clm/src/biogeochem/CNC14DecayMod.F90
    
    clm/src/soilbiogeochem/SoilBiogeochemLittVertTranspMod.F90
    clm/src/soilbiogeochem/SoilBiogeochemCarbonStateType.F90
    clm/src/soilbiogeochem/SoilBiogeochemDecompCascadeConType.F90
    clm/src/soilbiogeochem/SoilBiogeochemStateType.F90
    clm/src/soilbiogeochem/SoilBiogeochemDecompCascadeBGCMod.F90
    clm/src/soilbiogeochem/SoilBiogeochemNitrogenStateType.F90
    clm/src/soilbiogeochem/SoilBiogeochemVerticalProfileMod.F90

CLM testing:

  build-namelist tests:

    yellowstone - unit tests pass

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - n/a - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - n/a - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

    all clm50 compsets fail bit for bit with baseline because of new
    default soil_layer structure.

    spinup tests fail because of new spinup code.

    two new expected fails for clm45 compsets, see bugzilla 2232

CLM tag used for the baseline comparisons: clm4_5_3_r137

Changes answers relative to baseline: some

  Summarize any changes to answers, i.e.,
    - what code configurations: clm50, spinup
    - what platforms/compilers: all/all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): new climate

    clm50 compsets use a new soil layer structure.

    new accelerated spinup

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: none

   URL for LMWG diagnostics output used to validate new climate: none

===============================================================
===============================================================
Tag name:  clm4_5_3_r137
Originator(s):  erik (Erik Kluzek)
Date: Fri Oct  9 12:07:35 MDT 2015
One-line Summary: Bring in changes for fire-emissions as well tuning changes to the  fire model to be used with clm5_0

Purpose of changes:
     Move fire_clm4_5_2_r128_tags/fire06_clm4_5_3_r136 branch originated from Francis Vitt and Fang Li
     to trunk. This does two things: sends fire-emissions from land to coupler (then to ATM), and has
     an updated (retuned) version of CNFire from Fang Li. The retuned version is tuned for running with
     CAM, but there are fire parameter changes that allow it to be tuned with CRU forcing.

     CLM can test fire-emissions with the -fire_emis option to CLM_BLDNML_OPTS. Coupled configurations
     with CAM-CHEM will turn on fire-emissions when fire_emis_nl namelist added to drv_flds_in coupler
     namelist file.

Requirements for tag: fire-emissions added and tested, clm4_5 identical, clm5_0 uses newly tuned fire-model

Test level of tag: regular

Bugs fixed (include bugzilla ID):

  Bug 2231  Issue with PTCLM with changes in cime4.0.1
  Bug 2229  clm scripts not compatible with cime > cime2.x.y
  Bug 2220  Bug in fire model with ED for RH24 and WIND24

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: None

Describe any changes made to the namelist: Add ability to use and generate fire-emission namelist: fire_emis_nl
    Add cnfire_inparm namelist for clm4_5 with fire_method to either li2014qianfrc (clm4_5 default), 
    or li2016crufrc (clm5_0 default)
    Add -fire_emis option to CLM build-namelist
    Add shr_fire_emis_factors_file file to use when fire-emissions are sent to coupler

List any changes to the defaults for the boundary datasets: None

Describe any substantial timing or memory changes: None

Code reviewed by: self, fang-li, fvitt

List any svn externals directories updated (cime, rtm, cism, etc.):

   PTCLM to PTCLM2_151009

List all files eliminated:

D       components/clm/src/biogeochem/CNFireMod.F90 --- clm4_5 fire model was split into
          polymorphic versions that include clm4_5 and clm5_0 default versions

List all files added and what they do:

A       components/clm/bld/namelist_files/namelist_defaults_fire_emis.xml -- fire emissions
          defaults to use when -fire_emis CLM_BLDNML_OPTS option is used

------- Add some clm4_0 specific testmods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/fire_emis/user_nl_clm ------- Set fire-emission
            history fields, include fire_emis_elevated=.true.
A       components/clm/cime_config/testdefs/testmods_dirs/clm/fire_emis/include_user_mods - use default
A       components/clm/cime_config/testdefs/testmods_dirs/clm/fire_emis
A       components/clm/cime_config/testdefs/testmods_dirs/clm/flexibleCN/include_user_mods ---- use default
A       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subset/shell_commands - turn -fire_emis
A       components/clm/cime_config/testdefs/testmods_dirs/clm/40default/user_nl_clm ---- Same as default
A       components/clm/cime_config/testdefs/testmods_dirs/clm/40default/shell_commands - Same as default, but no -fire_emis
A       components/clm/cime_config/testdefs/testmods_dirs/clm/40default
A       components/clm/cime_config/testdefs/testmods_dirs/clm/reduceOutput/shell_commands - -no-fire_emis

------- Fire model polymorphic options
------- CNFireFactory chooses which version, CNFireMethod is abstract class, CNFireBase is base class
------- CNFireLi2014 extends the base class for clm4_5 default version CNFireLi2016 extends base class
------- for clm5_0 default version
A       components/clm/src/biogeochem/CNFireFactoryMod.F90 --- Factory and namelist to figure out which
           version to implement.
A       components/clm/src/biogeochem/CNFireMethodMod.F90 ---- Abstract class to define all interfaces
A       components/clm/src/biogeochem/CNFireBaseMod.F90 ------ Base class, does initialization and
           handles lightning and pop-dens datasets
A       components/clm/src/biogeochem/CNFireLi2014Mod.F90 ---- Implements CNFireArea and CNFireFluxes
           for the clm4_5 default version
A       components/clm/src/biogeochem/CNFireLi2016Mod.F90 ---- Implements CNFireArea and CNFireFluxes
           for the clm5_0 default version, tuned with CAM5 (parameter changes for version tuned to CRUNCEP)

------- Fire emission factors
A       components/clm/src/biogeochem/FireEmisFactorsMod.F90 -- Fire emission factors from new NetCDF dataset
A       components/clm/src/biogeochem/CNFireEmissionsMod.F90 -- Gathers carbon emissions from fire sources 
              to be sent to CAM-Chem via the coupler

List all existing files that have been modified, and describe the changes:

------- Get working with cime4.0.1
M       components/clm/test/tools/TCBCFGtools.sh --- change location of configure and soft link Macros.make
M       components/clm/test/tools/TCBtools.sh ------ change location of configure and soft link Macros.make

------- Update sample namelist (used for tools tests)
M       components/clm/tools/clm4_5/mksurfdata_map/mksurfdata_map.namelist

------- 
M       components/clm/bld/unit_testers/build-namelist_test.pl ----------- Add fire_emis tests
M       components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml --- Add default fire_method options
M       components/clm/bld/namelist_files/namelist_definition_clm4_5.xml - Add cnfire_inparm, and fire_emis_nl
           namelist groups.  Adding: fire_method, fire_emis_elevated, fire_emis_factors_file, and fire_emis_specifier
M       components/clm/bld/CLMBuildNamelist.pm --------------------------- Add cnfire_inparm namelist and
           handle fire_emis option simialr to megan and drydep options. 
           Add: fire_emis_elevated, fire_emis_factors_file, and fire_emis_specifier

------- 
M       components/clm/cime_config/testdefs/testmods_dirs/clm/crop/include_user_mods - use 40defaults
M       components/clm/cime_config/testdefs/testmods_dirs/clm/flexibleCN/user_nl_clm - use defaults, so just set use_flexibleCN
M       components/clm/cime_config/testdefs/testmods_dirs/clm/pts/include_user_mods -- use 40defaults
M       components/clm/cime_config/testdefs/testmods_dirs/clm/default/shell_commands - Add -fire_emis
M       components/clm/cime_config/testdefs/testlist_clm.xml ------- Change clm4_0 tests to use 40default
             and add fire_emis test
M       components/clm/cime_config/user_nl_clm ---- Add mention of -fire_emis option

------- 
M       components/clm/src/dyn_subgrid/dynSubgridControlMod.F90 - NFileName to NLFilename, and read_namelist
M       components/clm/src/dyn_subgrid/dynSubgridDriverMod.F90 -- Pass NLFilename down to dynSubgrid_init
M       components/clm/src/cpl/clm_cpl_indices.F90 -------------- Add fire-fluxes, and top of fire emissions
M       components/clm/src/cpl/lnd_import_export.F90 ------------ Set fire-fluxes and top of fire emission
M       components/clm/src/biogeochem/VOCEmissionMod.F90 -------- Add an additional coefficient multiply
              (currently just set to 1.0)
M       components/clm/src/biogeochem/CNDriverMod.F90 ----------- Pass NLFilename and cnfire_method
              down to CNDriverInit and cnfire_method to CNDriverNoLeaching, and use for CNFireArea and
              CNFireFluxes calls
M       components/clm/src/biogeochem/CNVegCarbonStateType.F90 -- Correct fire variable descriptions 
              (fuelc_col, fuelc_crop_col)
MM      components/clm/src/main/clm_initializeMod.F90 ----------- Add create_cnfire_method, pass NLFilename
               down to CNDriverInit, ndep_init, and dynSubgrid_init
M       components/clm/src/main/lnd2atmMod.F90 ------------------ Add use shr_fire_emis_mod to handle
               fire emissions to send from land to ATM
M       components/clm/src/main/ndepStreamMod.F90 --------------- NLFilename passed down rather than using 
               controlMod
M       components/clm/src/main/lnd2atmType.F90 ----------------- Add wild-fire emissions flux and vertical
               distribution
M       components/clm/src/main/atm2lndType.F90 ----------------- Add RH30, PREC10, and PREC60
              ( 30 day relative humidity, 10 and 60 day precipitation) Fix bug 2220 for ED
M       components/clm/src/main/clm_instMod.F90 ----------------- Add cnfire and fireemis objects
              call initialize for fireemis
MM      components/clm/src/main/controlMod.F90 ------------------ Call CNFireReadNML
M       components/clm/src/main/clm_driver.F90 ------------------ Replace cnfire_method object
              for calls to CNFire module, add call to CNFireEmisUpdate

CLM testing: regular

  build-namelist tests:

    yellowstone   yes

  unit-tests (components/clm/src):

    yellowstone yes

  tools-tests (components/clm/test/tools):

    yellowstone yes

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone yes

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel yes
    yellowstone_pgi   yes
    yellowstone_gnu   yes
    hobart_nag        yes

CLM tag used for the baseline comparisons:  clm4_5_3_r137

Changes answers relative to baseline: Yes, for clm5_0

  Summarize any changes to answers, i.e.,
    - what code configurations: clm5_0
    - what platforms/compilers: All
    - nature of change (fire tuned differently):

===============================================================
===============================================================
Tag name:  clm4_5_3_r136
Originator(s):  andre (Benjamin Andre,UCAR/CSEG,303-497-1391)
Date: Thu Oct  8 10:15:33 MDT 2015
One-line Summary: coupler field prep for mosart and externals update

Purpose of changes:

    Changes from T. Craig, M. Vertenstein and S. Swenson to enable
    separation of runoff fields passed from CLM to RTM

    Update externals.

Requirements for tag: regular

Test level of tag: regular

Bugs fixed (include bugzilla ID): 2223

Known bugs (include bugzilla ID): 2229
    http://bugs.cgd.ucar.edu/

Known Limitations:
      1147 (mkgriddata can't straddle over Greenwich)
      1025 (SCM mode can NOT use a global finidat file)
      1017 (SCM mode can NOT restart)
       896 (T62 mode does not work)
       701 (svn keyword)
       452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: unknown, none expected

Code reviewed by: mvertens, swenson

List any svn externals directories updated (cime, rtm, cism, etc.): cime, cism, rtm

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

  Split river fluxes sent to the coupler into surface, frozen, subsurface and gwl (glacier/wetland/lake).

    clm/src_clm40/main/lnd_import_export.F90
    clm/src_clm40/main/clm_cpl_indices.F90
    clm/src_clm40/main/clm_atmlnd.F90
    clm/src/main/lnd2atmMod.F90
    clm/src/main/atm2lndType.F90
    clm/src/main/lnd2atmType.F90
    clm/src/cpl/lnd_import_export.F90
    clm/src/cpl/clm_cpl_indices.F90

CLM testing: regular

  build-namelist tests:

    yellowstone - unit tests pass

  unit-tests (components/clm/src):

    yellowstone - pfunit tests pass

  tools-tests (components/clm/test/tools):

    yellowstone - mksurfdata_map unit tests pass
                  tools system tests not cime compatible - bug 2229

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    NOTE: the filenames for some tests exceeded the allowed length and comparison against the original r136 baselines may show bfail for:

   ERP_D_P15x2_Ld3.f10_f10.ICRUCLM50BGC.yellowstone_intel.clm-limit_river_withdraw
   ERP_P15x2_Lm36.f10_f10.ICLM45BGCCROP.yellowstone_intel.clm-irrig_o3_reduceOutput

    yellowstone_intel - 40 ok, 45 ok
    yellowstone_pgi - 40 ok, 45 ok
    yellowstone_gnu (clm45 only) - ok
    hobart_nag - ok

CLM tag used for the baseline comparisons: clm4_5_3_r135

Changes answers relative to baseline: yes

  Summarize any changes to answers, i.e.,
    - what code configurations:
       * cism update is answer changing for all IG compsets. see cism for details
       * splitting river fluxes to the coupler is answer changing for all clm45/50 compsets.
    - what platforms/compilers: all/all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): much larger than roundoff, assumed new climate.

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: no runs were performed

   URL for LMWG diagnostics output used to validate new climate:
	no diagnostics created.
===============================================================
===============================================================
Tag name:  clm4_5_3_r135
Originator(s):  sacks (Bill Sacks)
Date: Tue Oct  6 05:59:45 MDT 2015
One-line Summary: Substantial reduction in memory allocation for prognostic crops

Purpose of changes:

   With the introduction of "global" crops (78 pfts), memory use was increased
   substantially. The memory use itself was not a problem, but this led to a
   significant model slow-down, presumably due to a decrease in cache use
   efficiency. Much of this increase in memory use was unnecessary: CLM only
   knows about a minority of the new crop functional types (CFTs) - other CFTs
   are merged into those known CFTs. Yet space was being set aside in the patch
   and column-level arrays even for the CFTs that are never used.

   In this tag, I have reduced prognostic crop memory use by only allocating
   space in patch and column-level arrays for the crops CLM knows about.

   This leads to a speedup of prognostic crop cases by about 1.5x.

Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID):

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets:

   New initial conditions files for crops, needed because of the change in
   number of patches and columns. These were generated by running the old
   initial conditions through initInterp.

Describe any substantial timing or memory changes: Speedup of prognostic crop
cases by about 1.5x.

Code reviewed by: Erik Kluzek, Ben Andre, Mariana Vertenstein

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Main changes, as described above
M       components/clm/src/main/subgridMod.F90
M       components/clm/src/main/pftconMod.F90
M       components/clm/src/main/initGridCellsMod.F90
M       components/clm/src/main/clm_varpar.F90

========= Replace old conditional with use of new is_pft_known_to_model, which
          is a more general/robust way to accomplish the conditional
M       components/clm/src/biogeochem/CNPhenologyMod.F90

========= New initial conditions files for crop
M       components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml

========= Remove unneeded 'use' statements
M       components/clm/src/main/restFileMod.F90
M       components/clm/src/main/surfrdMod.F90

CLM testing:

  build-namelist tests:

    yellowstone: NOT RUN

  unit-tests (components/clm/src):

    yellowstone: ok

  tools-tests (components/clm/test/tools):

    yellowstone: NOT RUN

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone: NOT RUN

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    yellowstone_gnu (clm45 only): ok
    hobart_nag: ok

CLM tag used for the baseline comparisons: clm4_5_3_r134

Changes answers relative to baseline: NO
	
===============================================================
===============================================================
Tag name:  clm4_5_3_r134
Originator(s):  sacks (Bill Sacks)
Date: Sun Oct  4 07:25:05 MDT 2015
One-line Summary: Fixes for transient and preindustrial crop cases

Purpose of changes:

   (1) Important bug fix for transient crop: Collapse crop types in the
       transient run. Previously, when the transient portion started, (a) the
       collapse of the 78 pfts to the "known" crops was not happening, and (b)
       the collapse of irrigated pfts in a non-irrigation run was not
       happening. These two problems are fixed now.

   (2) Restore lost transient crop test cases

   (3) Add 1850 crop raw dataset (created using
       https://github.com/billsacks/clm_misc-make_crop_1850_dataset)

   (4) Add out-of-the-box surface datasets for 1850 crop, and out-of-the-box
       landuse timeseries datasets for transient crop

Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID):
- 2010 (create year-1850 surface datasets for crop)
- 2149 (tweak smallville transient test case)

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: new out-of-the-box defaults (see below)

Describe any substantial timing or memory changes: none

Code reviewed by: self

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated:

========= Remove testmods directories that are no longer needed because
          transient crop cases now pick up a surface dataset and landuse
          timeseries file out-of-the-box
D       components/clm/cime_config/testdefs/testmods_dirs/clm/crop_trans_sville/README
D       components/clm/cime_config/testdefs/testmods_dirs/clm/crop_trans_sville/user_nl_clm
D       components/clm/cime_config/testdefs/testmods_dirs/clm/crop_trans_sville/include_user_mods
D       components/clm/cime_config/testdefs/testmods_dirs/clm/crop_trans_sville
D       components/clm/cime_config/testdefs/testmods_dirs/clm/crop_trans_f10/README
D       components/clm/cime_config/testdefs/testmods_dirs/clm/crop_trans_f10/user_nl_clm
D       components/clm/cime_config/testdefs/testmods_dirs/clm/crop_trans_f10/include_user_mods
D       components/clm/cime_config/testdefs/testmods_dirs/clm/crop_trans_f10

========= Remove testmods directory that is no longer used (should have been removed in clm4_5_2_r127)
D       components/clm/cime_config/testdefs/testmods_dirs/clm/interp_from_f09/README
D       components/clm/cime_config/testdefs/testmods_dirs/clm/interp_from_f09/user_nl_clm
D       components/clm/cime_config/testdefs/testmods_dirs/clm/interp_from_f09/include_user_mods
D       components/clm/cime_config/testdefs/testmods_dirs/clm/interp_from_f09

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Collapse crop types in a transient run
M       components/clm/src/main/surfrdUtilsMod.F90
M       components/clm/src/main/surfrdMod.F90
M       components/clm/src/dyn_subgrid/dyncropFileMod.F90

========= Relax tolerance for check of PCT_NAT_PFT between landuse timeseries
          file and surface dataset. Transient crop runs exceeded the previous
          strict tolerance. I'm not sure why they need this relaxed tolerance,
          but given the manipulations that were needed both to create the
          year-1850 crop raw dataset and to create the crop landuse timeseries
          file, I'm willing to accept that this is needed. I have made this
          tolerance about 2 orders of magnitude looser than the differences I
          observed, to try to prevent the check from being wrongly triggered in
          the future. The tolerance of 1e-6 still seems sufficient to catch any
          real problems.
M       components/clm/src/dyn_subgrid/dynpftFileMod.F90

========= Add rules to make some 1850 crop surface datasets
M       components/clm/tools/clm4_5/mksurfdata_map/Makefile.data

========= Add raw dataset for 1850 crop
M       components/clm/bld/namelist_files/namelist_defaults_clm4_5_tools.xml

========= Add some surface datasets for 1850 crop, and landuse timeseries files
          for crop
M       components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml

========= Just add a comment
M       components/clm/tools/clm4_5/mksurfdata_map/mksurfdata.pl

========= Restore transient crop tests that were lost shortly after they were
          added (when the test list was migrated out of scripts into CLM)
M       components/clm/cime_config/testdefs/testlist_clm.xml

========= Unrelated change: add a note at Ben's request
M       components/clm/cime_config/testdefs/testmods_dirs/clm/interp_f19_noncrop/README
M       components/clm/cime_config/testdefs/testmods_dirs/clm/interp_f19_crop/README

CLM testing:

  build-namelist tests:

    yellowstone: ok

  unit-tests (components/clm/src):

    yellowstone: ok

  tools-tests (components/clm/test/tools):

    yellowstone: NOT RUN

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone: NOT RUN

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    yellowstone_gnu (clm45 only): ok
    hobart_nag: ok

CLM tag used for the baseline comparisons: clm4_5_3_r132

Changes answers relative to baseline: YES - just for transient crop cases

  Summarize any changes to answers, i.e.,
    - what code configurations: transient crop cases
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      not investigated, likely to be new climate

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A


   Note that there were no transient crop tests in the test suite prior to this
   tag, so the answer changes do not affect any existing tests.

   Note the following unexpected BFAILs:

    BFAIL ERP_D_P15x2_Ld3.f10_f10.ICRUCLM50BGC.yellowstone_intel.clm-limit_river_withdraw.clm2.h0.nc : baseline compare clm2.h0 (baseline: compare .base file with clm4_5_3_r132 file) (baseline history file does not exist)
    BFAIL ERP_D_P15x2_Ld3.f10_f10.ICRUCLM50BGC.yellowstone_intel.clm-limit_river_withdraw.clm2.h1.nc : baseline compare clm2.h1 (baseline: compare .base file with clm4_5_3_r132 file) (baseline history file does not exist)

    BFAIL ERP_P15x2_Lm36.f10_f10.ICLM45BGCCROP.yellowstone_intel.clm-irrig_o3_reduceOutput.clm2.h1.nc : baseline compare clm2.h1 (baseline: compare .base file with clm4_5_3_r132 file) (baseline history file does not exist)


===============================================================
===============================================================
Tag name:  clm4_5_3_r133
Originator(s):  andre (Benjamin Andre,UCAR/CSEG,303-497-1391)
Date:  Fri Oct  2 16:24:53 MDT 2015
One-line Summary: Bugfix for mksurfdata_map - add file missed by clm4_5_2_r125.

Purpose of changes:

  Bugfix for mksurfdata_map. Add new file needed for soil depth. File should have been included in clm4_5_2_r125.

Requirements for tag: tools

Test level of tag: mksurfdata_map unit tests

Bugs fixed (include bugzilla ID): not in bugzilla

Known bugs (include bugzilla ID): systems tests for clm tools not cime3 compatible.
    http://bugs.cgd.ucar.edu/

Known Limitations:
   1147 (mkgriddata can't straddle over Greenwich)
   1025 (SCM mode can NOT use a global finidat file)
   1017 (SCM mode can NOT restart)
    896 (T62 mode does not work)
    701 (svn keyword)
    452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: self

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do:

  clm/tools/clm4_5/mksurfdata_map/src/mksoildepthMod.F90 - include soil depth data

List all existing files that have been modified, and describe the changes: none

CLM testing: tools

  build-namelist tests: not run

  unit-tests (components/clm/src): not run

  tools-tests (components/clm/test/tools):

    yellowstone - clm4_5/mksurfdata_map/unit_testers - all tests passed

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone not run

  regular tests (aux_clm40, aux_clm45): not run. no changes to main clm code.

CLM tag used for the baseline comparisons: none.

Changes answers relative to baseline: no


===============================================================
===============================================================
Tag name:  clm4_5_3_r132
Originator(s):  andre (Benjamin Andre,UCAR/CSEG,303-497-1391)
Date:  Fri Oct  2 10:29:57 MDT 2015
One-line Summary: Modify soil BGC diffusion and cryoturbation code to allow for spatially variable soil thickness.

Purpose of changes:

  Changes from Dave Lawrence to modify soil BGC diffusion and
  cryoturbation code to allow for spatially variable soil thickness
  (e.g. if use_bedrock = true); fixed dzsoi_decomp for new vertical
  grids

Requirements for tag: regular

Test level of tag: regular

Bugs fixed (include bugzilla ID): none

Known bugs (include bugzilla ID): 2213, 2219
    http://bugs.cgd.ucar.edu/

Known Limitations:
   1147 (mkgriddata can't straddle over Greenwich)
   1025 (SCM mode can NOT use a global finidat file)
   1017 (SCM mode can NOT restart)
    896 (T62 mode does not work)
    701 (svn keyword)
    452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: unknown none expected

Code reviewed by: Dave Lawrence

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

  clm/src/main/initVerticalMod.F90 - use zmin_bedrock param, fix dzsoi_decomp 
  clm/src/main/clm_varcon.F90 - make zmin_bedrock a constant parameter
  clm/src/main/clm_varpar.F90 - write subsurface discretization levels to land log
  clm/src/soilbiogeochem/SoilBiogeochemVerticalProfileMod.F90 - spatially variable soil thickness
  clm/src/soilbiogeochem/SoilBiogeochemLittVertTranspMod.F90 - spatially variable soil thickness

CLM testing: regular

  build-namelist tests:

    yellowstone - unit tests pass

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - 40, pass; 45, ok (see below)
    yellowstone_pgi - 40, pass; 45, pass
    yellowstone_gnu (clm45 only) - pass
    hobart_nag - pass

  Only test not bit for bit with baseline is:
    ERS_D_Ld3.f10_f10.ICRUCLM50BGC.yellowstone_intel.clm-deepsoil_bedrock

CLM tag used for the baseline comparisons: clm4_5_3_r131

Changes answers relative to baseline: some

  Tag changes answers for clm50 bgc compsets where use_bedrock =
  true. No change to default version of model, doesn't change
  results for use_bedrock = true when in SP mode.

  Summarize any changes to answers, i.e.,
    - what code configurations: clm50 bgc with use_bedrock = true
    - what platforms/compilers: all/all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): new climate


   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename:  none

   URL for LMWG diagnostics output used to validate new climate:
	none

===============================================================
===============================================================
Tag name:  clm4_5_3_r131
Originator(s):  mvertens, sacks
Date: Wed Sep 30 05:13:45 MDT 2015
One-line Summary: Bring in cime3

Purpose of changes:

   Bring in cime3 (de-CESMization of CIME), which requires the addition of a
   cime_config directory and a bit of other rework.

   Also, port the pnetcdf problem with dov2xy=false from clm45 to clm4 code base
   (workaround for bug 1730 - and 2214 and 2222). This was needed because now
   pnetcdf is on by default in most runs.

Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID):
- 2214: CLM4 test fails in PIO while trying to write h1 file
- 2222: CLM4 cases die when writing 1-d history files with pnetcdf

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: rework for cime3

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: self

List any svn externals directories updated (cime, rtm, cism, etc.):
cime2.0.18-p1.1 -> cime3.0.7
cism2_1_02 -> cism2_1_05
rtm1_0_52 -> rtm1_0_53


List all files eliminated:

========= Moved into cime_config
D       components/clm/cimetest/testlist_clm.xml
D       components/clm/cimetest/ExpectedTestFails.xml
D       components/clm/cimetest/testmods_dirs/clm/glcMEC_long/user_nl_clm
D       components/clm/cimetest/testmods_dirs/clm/glcMEC_long/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/glcMEC_long/README
D       components/clm/cimetest/testmods_dirs/clm/glcMEC_long
D       components/clm/cimetest/testmods_dirs/clm/decStart/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/decStart/xmlchange_cmnds
D       components/clm/cimetest/testmods_dirs/clm/decStart
D       components/clm/cimetest/testmods_dirs/clm/tropicAtl_subsetMid/xmlchange_cmnds
D       components/clm/cimetest/testmods_dirs/clm/tropicAtl_subsetMid/README
D       components/clm/cimetest/testmods_dirs/clm/tropicAtl_subsetMid/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/tropicAtl_subsetMid
D       components/clm/cimetest/testmods_dirs/clm/irrigOn_reduceOutput/user_nl_clm
D       components/clm/cimetest/testmods_dirs/clm/irrigOn_reduceOutput/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/irrigOn_reduceOutput/xmlchange_cmnds
D       components/clm/cimetest/testmods_dirs/clm/irrigOn_reduceOutput
D       components/clm/cimetest/testmods_dirs/clm/default/user_nl_clm
D       components/clm/cimetest/testmods_dirs/clm/default/shell_commands
D       components/clm/cimetest/testmods_dirs/clm/default
D       components/clm/cimetest/testmods_dirs/clm/crop_trans_sville/README
D       components/clm/cimetest/testmods_dirs/clm/crop_trans_sville/user_nl_clm
D       components/clm/cimetest/testmods_dirs/clm/crop_trans_sville/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/crop_trans_sville
D       components/clm/cimetest/testmods_dirs/clm/edTest/shell_commands
D       components/clm/cimetest/testmods_dirs/clm/edTest/user_nl_clm
D       components/clm/cimetest/testmods_dirs/clm/edTest
D       components/clm/cimetest/testmods_dirs/clm/reduceOutput/user_nl_clm
D       components/clm/cimetest/testmods_dirs/clm/reduceOutput
D       components/clm/cimetest/testmods_dirs/clm/cropMonthOutput/user_nl_clm
D       components/clm/cimetest/testmods_dirs/clm/cropMonthOutput/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/cropMonthOutput
D       components/clm/cimetest/testmods_dirs/clm/monthly/user_nl_clm
D       components/clm/cimetest/testmods_dirs/clm/monthly/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/monthly/user_nl_cpl
D       components/clm/cimetest/testmods_dirs/clm/monthly
D       components/clm/cimetest/testmods_dirs/clm/glcMEC/user_nl_clm
D       components/clm/cimetest/testmods_dirs/clm/glcMEC/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/glcMEC/user_nl_cpl
D       components/clm/cimetest/testmods_dirs/clm/glcMEC
D       components/clm/cimetest/testmods_dirs/clm/ciso/user_nl_clm
D       components/clm/cimetest/testmods_dirs/clm/ciso/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/ciso
D       components/clm/cimetest/testmods_dirs/clm/luna/user_nl_clm
D       components/clm/cimetest/testmods_dirs/clm/luna/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/luna
D       components/clm/cimetest/testmods_dirs/clm/monthly_noinitial/user_nl_clm
D       components/clm/cimetest/testmods_dirs/clm/monthly_noinitial/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/monthly_noinitial
D       components/clm/cimetest/testmods_dirs/clm/interp_from_f09/user_nl_clm
D       components/clm/cimetest/testmods_dirs/clm/interp_from_f09/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/interp_from_f09/README
D       components/clm/cimetest/testmods_dirs/clm/interp_from_f09
D       components/clm/cimetest/testmods_dirs/clm/glcMEC_increase/user_nl_cism
D       components/clm/cimetest/testmods_dirs/clm/glcMEC_increase/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/glcMEC_increase/README
D       components/clm/cimetest/testmods_dirs/clm/glcMEC_increase
D       components/clm/cimetest/testmods_dirs/clm/crop/user_nl_clm
D       components/clm/cimetest/testmods_dirs/clm/crop/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/crop
D       components/clm/cimetest/testmods_dirs/clm/allActive/user_nl_clm
D       components/clm/cimetest/testmods_dirs/clm/allActive
D       components/clm/cimetest/testmods_dirs/clm/cn_conly/user_nl_clm
D       components/clm/cimetest/testmods_dirs/clm/cn_conly/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/cn_conly
D       components/clm/cimetest/testmods_dirs/clm/glcMEC_spunup_1way/shell_commands
D       components/clm/cimetest/testmods_dirs/clm/glcMEC_spunup_1way/README
D       components/clm/cimetest/testmods_dirs/clm/glcMEC_spunup_1way/user_nl_clm
D       components/clm/cimetest/testmods_dirs/clm/glcMEC_spunup_1way/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/glcMEC_spunup_1way
D       components/clm/cimetest/testmods_dirs/clm/snowlayers_12/user_nl_clm
D       components/clm/cimetest/testmods_dirs/clm/snowlayers_12/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/snowlayers_12
D       components/clm/cimetest/testmods_dirs/clm/ptsROA/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/ptsROA/xmlchange_cmnds
D       components/clm/cimetest/testmods_dirs/clm/ptsROA
D       components/clm/cimetest/testmods_dirs/clm/NoVSNoNI/user_nl_clm
D       components/clm/cimetest/testmods_dirs/clm/NoVSNoNI/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/NoVSNoNI
D       components/clm/cimetest/testmods_dirs/clm/SNICARFRC/user_nl_clm
D       components/clm/cimetest/testmods_dirs/clm/SNICARFRC/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/SNICARFRC
D       components/clm/cimetest/testmods_dirs/clm/flexibleCN/user_nl_clm
D       components/clm/cimetest/testmods_dirs/clm/flexibleCN
D       components/clm/cimetest/testmods_dirs/clm/glcMEC_changeFlags/xmlchange_cmnds
D       components/clm/cimetest/testmods_dirs/clm/glcMEC_changeFlags/README
D       components/clm/cimetest/testmods_dirs/clm/glcMEC_changeFlags/user_nl_clm
D       components/clm/cimetest/testmods_dirs/clm/glcMEC_changeFlags/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/glcMEC_changeFlags
D       components/clm/cimetest/testmods_dirs/clm/interp_f19_noncrop/user_nl_clm
D       components/clm/cimetest/testmods_dirs/clm/interp_f19_noncrop/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/interp_f19_noncrop/README
D       components/clm/cimetest/testmods_dirs/clm/interp_f19_noncrop
D       components/clm/cimetest/testmods_dirs/clm/crop_trans_f10/README
D       components/clm/cimetest/testmods_dirs/clm/crop_trans_f10/user_nl_clm
D       components/clm/cimetest/testmods_dirs/clm/crop_trans_f10/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/crop_trans_f10
D       components/clm/cimetest/testmods_dirs/clm/o3/user_nl_clm
D       components/clm/cimetest/testmods_dirs/clm/o3/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/o3
D       components/clm/cimetest/testmods_dirs/clm/vrtlay/user_nl_clm
D       components/clm/cimetest/testmods_dirs/clm/vrtlay/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/vrtlay
D       components/clm/cimetest/testmods_dirs/clm/tropicAtl_subsetEarly/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/tropicAtl_subsetEarly/xmlchange_cmnds
D       components/clm/cimetest/testmods_dirs/clm/tropicAtl_subsetEarly/README
D       components/clm/cimetest/testmods_dirs/clm/tropicAtl_subsetEarly
D       components/clm/cimetest/testmods_dirs/clm/oldhyd/user_nl_clm
D       components/clm/cimetest/testmods_dirs/clm/oldhyd
D       components/clm/cimetest/testmods_dirs/clm/interp_f19_noncrop2crop/README
D       components/clm/cimetest/testmods_dirs/clm/interp_f19_noncrop2crop/user_nl_clm
D       components/clm/cimetest/testmods_dirs/clm/interp_f19_noncrop2crop/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/interp_f19_noncrop2crop
D       components/clm/cimetest/testmods_dirs/clm/irrig_o3_reduceOutput/user_nl_clm
D       components/clm/cimetest/testmods_dirs/clm/irrig_o3_reduceOutput/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/irrig_o3_reduceOutput/README
D       components/clm/cimetest/testmods_dirs/clm/irrig_o3_reduceOutput
D       components/clm/cimetest/testmods_dirs/clm/glcMEC_decrease/user_nl_cism
D       components/clm/cimetest/testmods_dirs/clm/glcMEC_decrease/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/glcMEC_decrease/README
D       components/clm/cimetest/testmods_dirs/clm/glcMEC_decrease
D       components/clm/cimetest/testmods_dirs/clm/tropicAtl_subset/README
D       components/clm/cimetest/testmods_dirs/clm/tropicAtl_subset/user_nl_clm
D       components/clm/cimetest/testmods_dirs/clm/tropicAtl_subset
D       components/clm/cimetest/testmods_dirs/clm/USUMB/xmlchange_cmnds
D       components/clm/cimetest/testmods_dirs/clm/USUMB/user_nl_clm
D       components/clm/cimetest/testmods_dirs/clm/USUMB
D       components/clm/cimetest/testmods_dirs/clm/tropicAtl_subsetLate/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/tropicAtl_subsetLate/xmlchange_cmnds
D       components/clm/cimetest/testmods_dirs/clm/tropicAtl_subsetLate/README
D       components/clm/cimetest/testmods_dirs/clm/tropicAtl_subsetLate
D       components/clm/cimetest/testmods_dirs/clm/drydepnomegan/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/drydepnomegan/xmlchange_cmnds
D       components/clm/cimetest/testmods_dirs/clm/drydepnomegan
D       components/clm/cimetest/testmods_dirs/clm/rootlit/user_nl_clm
D       components/clm/cimetest/testmods_dirs/clm/rootlit/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/rootlit
D       components/clm/cimetest/testmods_dirs/clm/deepsoil_bedrock/user_nl_clm
D       components/clm/cimetest/testmods_dirs/clm/deepsoil_bedrock/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/deepsoil_bedrock
D       components/clm/cimetest/testmods_dirs/clm/af_bias_v5/xmlchange_cmnds
D       components/clm/cimetest/testmods_dirs/clm/af_bias_v5/user_nl_datm
D       components/clm/cimetest/testmods_dirs/clm/af_bias_v5/user_nl_clm
D       components/clm/cimetest/testmods_dirs/clm/af_bias_v5
D       components/clm/cimetest/testmods_dirs/clm/limit_river_withdraw/user_nl_clm
D       components/clm/cimetest/testmods_dirs/clm/limit_river_withdraw/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/limit_river_withdraw
D       components/clm/cimetest/testmods_dirs/clm/snowlayers_3_monthly/user_nl_clm
D       components/clm/cimetest/testmods_dirs/clm/snowlayers_3_monthly/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/snowlayers_3_monthly
D       components/clm/cimetest/testmods_dirs/clm/interp_f19_crop/README
D       components/clm/cimetest/testmods_dirs/clm/interp_f19_crop/user_nl_clm
D       components/clm/cimetest/testmods_dirs/clm/interp_f19_crop/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/interp_f19_crop
D       components/clm/cimetest/testmods_dirs/clm/ptsRLA/xmlchange_cmnds
D       components/clm/cimetest/testmods_dirs/clm/ptsRLA/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/ptsRLA
D       components/clm/cimetest/testmods_dirs/clm/pts/xmlchange_cmnds
D       components/clm/cimetest/testmods_dirs/clm/pts/README
D       components/clm/cimetest/testmods_dirs/clm/pts/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/pts
D       components/clm/cimetest/testmods_dirs/clm/ptsRLB/xmlchange_cmnds
D       components/clm/cimetest/testmods_dirs/clm/ptsRLB/include_user_mods
D       components/clm/cimetest/testmods_dirs/clm/ptsRLB
D       components/clm/cimetest/testmods_dirs/clm
D       components/clm/cimetest/testmods_dirs
D       components/clm/cimetest
D       components/clm/bld/clm.buildlib
D       components/clm/bld/user_nl_clm
D       components/clm/bld/clm.buildnml

========= This is no longer needed - it is generated automatically by the build script
D       components/clm/src_clm40/main/ncdio_pio.F90


List all files added and what they do:

========= New stuff needed for cime3
A       components/clm/cime_config
A       components/clm/cime_config/config_component.xml
A       components/clm/cime_config/config_pes.xml
A       components/clm/cime_config/config_compsets.xml

========= Moved from elsewhere (new organization needed for cime3)
A       components/clm/cime_config/testdefs/ExpectedTestFails.xml
A       components/clm/cime_config/testdefs/testmods_dirs/clm/USUMB/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/USUMB/xmlchange_cmnds
A       components/clm/cime_config/testdefs/testmods_dirs/clm/USUMB
A       components/clm/cime_config/testdefs/testmods_dirs/clm/rootlit/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/rootlit/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/rootlit
A       components/clm/cime_config/testdefs/testmods_dirs/clm/drydepnomegan/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/drydepnomegan/xmlchange_cmnds
A       components/clm/cime_config/testdefs/testmods_dirs/clm/drydepnomegan
A       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subsetLate/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subsetLate/xmlchange_cmnds
A       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subsetLate/README
A       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subsetLate
A       components/clm/cime_config/testdefs/testmods_dirs/clm/deepsoil_bedrock/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/deepsoil_bedrock/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/deepsoil_bedrock
A       components/clm/cime_config/testdefs/testmods_dirs/clm/limit_river_withdraw/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/limit_river_withdraw/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/limit_river_withdraw
A       components/clm/cime_config/testdefs/testmods_dirs/clm/af_bias_v5/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/af_bias_v5/xmlchange_cmnds
A       components/clm/cime_config/testdefs/testmods_dirs/clm/af_bias_v5/user_nl_datm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/af_bias_v5
A       components/clm/cime_config/testdefs/testmods_dirs/clm/snowlayers_3_monthly/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/snowlayers_3_monthly/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/snowlayers_3_monthly
A       components/clm/cime_config/testdefs/testmods_dirs/clm/interp_f19_crop/README
A       components/clm/cime_config/testdefs/testmods_dirs/clm/interp_f19_crop/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/interp_f19_crop/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/interp_f19_crop
A       components/clm/cime_config/testdefs/testmods_dirs/clm/ptsRLA/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/ptsRLA/xmlchange_cmnds
A       components/clm/cime_config/testdefs/testmods_dirs/clm/ptsRLA
A       components/clm/cime_config/testdefs/testmods_dirs/clm/ptsRLB/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/ptsRLB/xmlchange_cmnds
A       components/clm/cime_config/testdefs/testmods_dirs/clm/ptsRLB
A       components/clm/cime_config/testdefs/testmods_dirs/clm/pts/README
A       components/clm/cime_config/testdefs/testmods_dirs/clm/pts/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/pts/xmlchange_cmnds
A       components/clm/cime_config/testdefs/testmods_dirs/clm/pts
A       components/clm/cime_config/testdefs/testmods_dirs/clm/decStart/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/decStart/xmlchange_cmnds
A       components/clm/cime_config/testdefs/testmods_dirs/clm/decStart
A       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_long/README
A       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_long/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_long/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_long
A       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subsetMid/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subsetMid/xmlchange_cmnds
A       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subsetMid/README
A       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subsetMid
A       components/clm/cime_config/testdefs/testmods_dirs/clm/irrigOn_reduceOutput/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/irrigOn_reduceOutput/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/irrigOn_reduceOutput/xmlchange_cmnds
A       components/clm/cime_config/testdefs/testmods_dirs/clm/irrigOn_reduceOutput
A       components/clm/cime_config/testdefs/testmods_dirs/clm/default/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/default/shell_commands
A       components/clm/cime_config/testdefs/testmods_dirs/clm/default
A       components/clm/cime_config/testdefs/testmods_dirs/clm/reduceOutput/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/reduceOutput
A       components/clm/cime_config/testdefs/testmods_dirs/clm/edTest/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/edTest/shell_commands
A       components/clm/cime_config/testdefs/testmods_dirs/clm/edTest
A       components/clm/cime_config/testdefs/testmods_dirs/clm/crop_trans_sville/README
A       components/clm/cime_config/testdefs/testmods_dirs/clm/crop_trans_sville/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/crop_trans_sville/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/crop_trans_sville
A       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC/user_nl_cpl
A       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC
A       components/clm/cime_config/testdefs/testmods_dirs/clm/monthly/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/monthly/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/monthly/user_nl_cpl
A       components/clm/cime_config/testdefs/testmods_dirs/clm/monthly
A       components/clm/cime_config/testdefs/testmods_dirs/clm/cropMonthOutput/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/cropMonthOutput/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/cropMonthOutput
A       components/clm/cime_config/testdefs/testmods_dirs/clm/ciso/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/ciso/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/ciso
A       components/clm/cime_config/testdefs/testmods_dirs/clm/luna/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/luna/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/luna
A       components/clm/cime_config/testdefs/testmods_dirs/clm/monthly_noinitial/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/monthly_noinitial/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/monthly_noinitial
A       components/clm/cime_config/testdefs/testmods_dirs/clm/interp_from_f09/README
A       components/clm/cime_config/testdefs/testmods_dirs/clm/interp_from_f09/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/interp_from_f09/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/interp_from_f09
A       components/clm/cime_config/testdefs/testmods_dirs/clm/crop/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/crop/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/crop
A       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_increase/user_nl_cism
A       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_increase/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_increase/README
A       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_increase
A       components/clm/cime_config/testdefs/testmods_dirs/clm/cn_conly/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/cn_conly/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/cn_conly
A       components/clm/cime_config/testdefs/testmods_dirs/clm/allActive/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/allActive
A       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_spunup_1way/shell_commands
A       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_spunup_1way/README
A       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_spunup_1way/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_spunup_1way/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_spunup_1way
A       components/clm/cime_config/testdefs/testmods_dirs/clm/snowlayers_12/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/snowlayers_12/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/snowlayers_12
A       components/clm/cime_config/testdefs/testmods_dirs/clm/ptsROA/xmlchange_cmnds
A       components/clm/cime_config/testdefs/testmods_dirs/clm/ptsROA/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/ptsROA
A       components/clm/cime_config/testdefs/testmods_dirs/clm/NoVSNoNI/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/NoVSNoNI/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/NoVSNoNI
A       components/clm/cime_config/testdefs/testmods_dirs/clm/SNICARFRC/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/SNICARFRC/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/SNICARFRC
A       components/clm/cime_config/testdefs/testmods_dirs/clm/flexibleCN/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/flexibleCN
A       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_changeFlags/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_changeFlags/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_changeFlags/xmlchange_cmnds
A       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_changeFlags/README
A       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_changeFlags
A       components/clm/cime_config/testdefs/testmods_dirs/clm/interp_f19_noncrop/README
A       components/clm/cime_config/testdefs/testmods_dirs/clm/interp_f19_noncrop/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/interp_f19_noncrop/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/interp_f19_noncrop
A       components/clm/cime_config/testdefs/testmods_dirs/clm/crop_trans_f10/README
A       components/clm/cime_config/testdefs/testmods_dirs/clm/crop_trans_f10/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/crop_trans_f10/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/crop_trans_f10
A       components/clm/cime_config/testdefs/testmods_dirs/clm/o3/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/o3/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/o3
A       components/clm/cime_config/testdefs/testmods_dirs/clm/vrtlay/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/vrtlay/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/vrtlay
A       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subsetEarly/xmlchange_cmnds
A       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subsetEarly/README
A       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subsetEarly/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subsetEarly
A       components/clm/cime_config/testdefs/testmods_dirs/clm/oldhyd/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/oldhyd
A       components/clm/cime_config/testdefs/testmods_dirs/clm/interp_f19_noncrop2crop/README
A       components/clm/cime_config/testdefs/testmods_dirs/clm/interp_f19_noncrop2crop/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/interp_f19_noncrop2crop/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/interp_f19_noncrop2crop
A       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_decrease/README
A       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_decrease/user_nl_cism
A       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_decrease/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/glcMEC_decrease
A       components/clm/cime_config/testdefs/testmods_dirs/clm/irrig_o3_reduceOutput/README
A       components/clm/cime_config/testdefs/testmods_dirs/clm/irrig_o3_reduceOutput/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/irrig_o3_reduceOutput/include_user_mods
A       components/clm/cime_config/testdefs/testmods_dirs/clm/irrig_o3_reduceOutput
A       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subset/README
A       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subset/user_nl_clm
A       components/clm/cime_config/testdefs/testmods_dirs/clm/tropicAtl_subset
A       components/clm/cime_config/testdefs/testmods_dirs/clm
A       components/clm/cime_config/testdefs/testmods_dirs
A       components/clm/cime_config/testdefs/testlist_clm.xml
A       components/clm/cime_config/testdefs
A       components/clm/cime_config/user_nl_clm
A       components/clm/cime_config/buildlib
A       components/clm/cime_config/buildnml


List all existing files that have been modified, and describe the changes:

========= Minor changes for cime3
M       components/clm/bld/CLMBuildNamelist.pm

========= Port bug 1730 workaround to clm40, fixing bugs 2214 & 2222
M       components/clm/src_clm40/main/histFileMod.F90
M       components/clm/src_clm40/main/ncdio_pio.F90.in


CLM testing:

  build-namelist tests:

    yellowstone: ok
    (ran unit_testers and test_build_namelist tests)

  unit-tests (components/clm/src):

    yellowstone: ok

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    yellowstone_gnu (clm45 only): ok
    hobart_nag: ok

CLM tag used for the baseline comparisons: clm4_5_3_r130

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  There are large differences in the anomaly forcing, due to a bug fix that has
  been incorporated in the cime3 changes. This changes answers for this test:

  SMS_Ld1.f09_g16.ICRUCLM45.yellowstone_intel.clm-af_bias_v5

  In addition, there are roundoff-level changes in x2l_Flrr_volr, VOLR and TWS
  in these tests:
  ERS_E_Ld9.f45_g37.I.yellowstone_intel.clm-default
  ERI_D_Ld9.ne30_g16.ICLM45BGC.yellowstone_intel.clm-vrtlay

  Also, this BFAILed:
  BFAIL ERP_P15x2_Lm36.f10_f10.ICLM45BGCCROP.yellowstone_intel.clm-irrig_o3_reduceOutput.clm2.h1.nc : baseline compare clm2.h1 (baseline: compare .base file with clm4_5_3_r130 file) (baseline history file does not exist)

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	
===============================================================
===============================================================
Tag name:  clm4_5_3_r130
Originator(s):  andre (Benjamin Andre,UCAR/CSEG,303-497-1391)
Date:  Mon Sep 28 11:16:54 MDT 2015
One-line Summary: add namelist option to reduce lake evaporation and irrigation when river water storage falls below a threshold value, and add an additional constraint on stress deciduous leaf onset.

Purpose of changes:

    To maintain river storage above a minimum threshold.  To add a
    second condition that must be fulfilled prior to leaf onset
    occurring for stress deciduous pfts.

Requirements for tag: regular

Test level of tag: regular

Bugs fixed (include bugzilla ID): none

Known bugs (include bugzilla ID): 2213, 2219
    http://bugs.cgd.ucar.edu/

Known Limitations:
  1147 (mkgriddata can't straddle over Greenwich)
  1025 (SCM mode can NOT use a global finidat file)
  1017 (SCM mode can NOT restart)
   896 (T62 mode does not work)
   701 (svn keyword)
   452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist:

  new namelist flags:
    limit_lake_evap_and_irrig
    constrain_stress_deciduous_onset

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: unknown, none expected

Code reviewed by: Sean Swenson, Dave Lawrence, Bill Sacks (irrigation)

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

  clm/cimetest/testmods_dirs/clm/limit_river_withdraw - testmods for new flag

List all existing files that have been modified, and describe the changes:

  clm/src/biogeochem/CNDriverMod.F90 - add atm2lnd_inst to function call for phenology
  clm/src/biogeochem/CNPhenologyMod.F90 - add atm2lnd_inst, new check for stress deciduous
  clm/src/biogeochem/CNSharedParamsMod.F90 - new stress deciduous namelist variable

  clm/src/main/init_hydrology.F90 - note
  clm/src/main/controlMod.F90 - add limit_lake_evap_and_irrig namelist variable
  clm/src/main/clm_driver.F90 - add volr_grc to ApplyIrrigation function call
  clm/src/main/clm_varctl.F90 - add limit_lake_evap_and_irrig namelist variable

  clm/src/biogeophys/IrrigationMod.F90 - check for limit irrigation
  clm/src/biogeophys/LakeFluxesMod.F90 - check for limit lake evap
  clm/src/biogeophys/test/Irrigation_test/test_irrigation_singlepatch.pf - new unit test
  clm/src/biogeophys/test/Irrigation_test/IrrigationWrapperMod.F90 - new unit test

  clm/src/unit_test_stubs/utils/spmdMod_stub.F90 - add stub mpi type

  clm/bld/namelist_files/namelist_defaults_clm4_5.xml - new namelist variables
  clm/bld/namelist_files/namelist_definition_clm4_5.xml
  clm/bld/CLMBuildNamelist.pm

  clm/cimetest/testlist_clm.xml - new tests


CLM testing: regular

  build-namelist tests:

    yellowstone - unit tests pass

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - pass
    yellowstone_pgi - pass
    yellowstone_gnu (clm45 only) pass
    hobart_nag - run, ok

CLM tag used for the baseline comparisons: clm4_5_2_r128/clm4_5_3_r129

  Note: new test for limit_river_withdraw got dropped from the
  testlist during a merge/manage_testlist update. This wasn't noticed
  until after baselines were generated. This test was added to the
  baselines manually.

Changes answers relative to baseline: yes

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: all clm50 compsets
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate):

     When active, these changes will be climate changing.  Lake
     evaporation and irrigation limitation will change the surface energy
     balance by reducing latent heat and increasing sensible heat when
     river storage is below a threshold value.  Constraining leaf onset
     with a secondary constraint will modify vegetation dynamics,
     e.g. LAI will differ in magnitude and seasonality, which will change
     the surface energy balance by altering evapotranspiration.

     Note: all of the aux_clm tests for clm50 compsets triggered were
     bit for bit with the baseline. The stress deciduous flag is on by
     default for clm50, and changes should have been observed. Sean
     Swenson verified that the flag is active in 30 day runs, so it is
     assumed that the shorter three and nine day runs were not enough
     to trigger the new code. A new 30 day test was added.

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: none

   URL for LMWG diagnostics output used to validate new climate: none


===============================================================
===============================================================
Tag name:  clm4_5_3_r129
Originator(s):  andre (Benjamin Andre,UCAR/CSEG,303-497-1391)
Date:  Fri Sep 25 15:30:39 MDT 2015
One-line Summary: bump tag revision number because clm4_5_2_r128 was climate changing.

Purpose of changes:

    Bump tag revision number only. This is the same code base as
    clm4_5_2_r128. No additional testing was done.

    Further review of the answer changes in clm4_5_2_r128 indicated
    that they were a climate changing bugfix, and the patch level
    version number should have been bumped.

    S. Swenson and D. Lawrence performed a code review of the changes
    and decided the original calculation of heat capacity for soil
    layers > nlevsoi (i.e. bedrock layers) was incorrect due to the
    heat capacity being scaled by (1-watsat).  This scaling, which
    takes into account the presence of soil voids (the porosity), is
    not appropriate for the bedrock layers, which are assumed to be
    rock rather than soil.  The new code simply applies the bedrock
    value for heat capacity without the scaling, which leads to an
    increase in heat content for bedrock layers.  The code change
    therefore results in non-b4b changes to the simulation.


===============================================================
===============================================================
Tag name:  clm4_5_2_r128
Originator(s):  andre (Benjamin Andre,UCAR/CSEG,303-497-1391)
Date:  Thu Sep 24 10:34:39 MDT 2015
One-line Summary: science bugfixes for root fraction and bedrock thermal properties. not bit for bit with baseline.

Purpose of changes:

    1) To explicitly set rooting fraction to zero in baresoil patches.

    2) To place definition of bedrock heat capacity in a location
	consistent with other bedrock parameters (e.g. thermal conductivity).

Requirements for tag: regular

Test level of tag: regular

Bugs fixed (include bugzilla ID): none

Known bugs (include bugzilla ID): 2213, 2219
    http://bugs.cgd.ucar.edu/

Known Limitations:
    1147 (mkgriddata can't straddle over Greenwich)
    1025 (SCM mode can NOT use a global finidat file)
    1017 (SCM mode can NOT restart)
     896 (T62 mode does not work)
     701 (svn keyword)
     452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none expected

Code reviewed by: Sean Swenson, Dave Lawrence

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

M clm/src/biogeophys/SoilTemperatureMod.F90 - move heat capacity from SoilTemperature
M clm/src/biogeophys/LakeTemperatureMod.F90 - include heat capacity of bedrock
M clm/src/biogeophys/SoilStateInitTimeConstMod.F90 - move heat capacity to SoilTemperature
M clm/src/main/clm_varcon.F90 - move vol heat copacity from SoilStateInitTimeConstMod

M clm/src/soilbiogeochem/SoilBiogeochemVerticalProfileMod.F90 - set root fraction to zero

CLM testing: regular

  build-namelist tests:

    yellowstone - unit tests pass

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - not run

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - 40 ok, 45 expected not bfb with baseline
    yellowstone_pgi - 40 ok, 45 expected not bfb with baseline
    yellowstone_gnu (clm45 only) - 40 ok, 45 expected not bfb with baseline
    hobart_nag - 45 compiles, bug 2213

CLM tag used for the baseline comparisons: clm4_5_2_r127

Changes answers relative to baseline: yes

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: all clm45 and clm50 compsets
    - what platforms/compilers: all/all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): roundoff

   If bitwise differences were observed, how did you show they were no worse
   than roundoff?
      Monthly history files were compared from a short CLM Swenson case run.
      No further testing was performed

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: No runs were performed

   URL for LMWG diagnostics output used to validate new climate:
    No diagnostics were generated

===============================================================
===============================================================
Tag name:  clm4_5_2_r127
Originator(s):  sacks (Bill Sacks)
Date: Fri Sep 18 10:53:12 MDT 2015
One-line Summary: Fix interpolation of initial conditions for glc_mec and crop <-> non-crop

Purpose of changes:

   Fixes the following bugs in initInterp: (1) interpolation of one glc_mec case
   to another glc_mec case (due to bug 2126); (2) interpolation of a non-crop
   case to a crop case (problems with generic crop type); (3) interpolation of a
   crop case to a non-crop case (problems with generic crop type).

   Note: If you want to use initInterp with an old glc_mec initial conditions
   file (generated before this tag), you will need to either: (1) run the same
   case with this tag or later, without use_init_interp, for at least one time
   step to generate a new (fixed) initial conditions file; or (2) overwrite the
   pfts1d_topoglc variable on your original initial conditions file so that it
   has the correct size. (1) is easier if it is feasible for you to do so.

   Some related changes to initInterp:

   - Changed the "user interface" for interpolating initial conditions: There is
     no longer a finidat_interp_source namelist option; instead, you set finidat
     to point to the initial conditions file to interpolate, and set the
     use_init_interp namelist option to .true.

   - Changed the default behavior so that it does NOT fill missing points (e.g.,
     landunits that are in the new case but not on the input file) with the bare
     ground patch / vegetated landunit. Instead, it dies with an error message
     if it can't find a reasonable template column. If you want to it to use the
     nearest bare ground / vegetated point in this case, then rerun with
     init_interp_fill_missing_with_natveg set to .true.

   - Added system and unit tests of initInterp. System tests include both
     interpolation of a file onto an identical configuration, and ensuring they
     are bit-for-bit (LII test), and tests that involve interpolation from one
     resolution or configuration to another. For the latter, I have done some
     very quick checks, but have NOT carefully checked the current operation to
     ensure it is correct.

   Some (mostly) unrelated changes:

   (1) Write more metadata on column type to 1-d (vector) history files

   (2) Updated cime; this included, among other things:
   - fix RESUBMIT bug
   - no longer set FORCE_COLDSTART for glc_mec runs
   - addition of LII test

Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID):
- 1447 (interpinic needs to be extended to work for glc_mec)
- 1703 (need better testing of interpinic)
- 1725 (interpinic doesn't work right for crop)
- 2126 (Error in writing pfts1d_topoglc to restart file)

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist:
- Removed finidat_interp_source namelist option
- Added use_init_interp and init_interp_fill_missing_with_natveg namelist option

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: self

List any svn externals directories updated (cime, rtm, cism, etc.):

   cime: cime2.0.17 -> cime2.0.18-p1.1 (see summary above)

List all files eliminated: none

List all files added and what they do:

========= Separate testable parts of initInterp into their own module; fix
          initInterp bugs as noted above
A       components/clm/src/main/initInterpMindist.F90

========= Add system tests that exercise initInterp
A       components/clm/cimetest/testmods_dirs/clm/interp_from_f09/user_nl_clm
A       components/clm/cimetest/testmods_dirs/clm/interp_from_f09/include_user_mods
A       components/clm/cimetest/testmods_dirs/clm/interp_from_f09/README
A       components/clm/cimetest/testmods_dirs/clm/interp_from_f09
A       components/clm/cimetest/testmods_dirs/clm/glcMEC_spunup_1way/shell_commands
A       components/clm/cimetest/testmods_dirs/clm/glcMEC_spunup_1way/README
A       components/clm/cimetest/testmods_dirs/clm/glcMEC_spunup_1way/user_nl_clm
A       components/clm/cimetest/testmods_dirs/clm/glcMEC_spunup_1way/include_user_mods
A       components/clm/cimetest/testmods_dirs/clm/glcMEC_spunup_1way
A       components/clm/cimetest/testmods_dirs/clm/interp_f19_noncrop/user_nl_clm
A       components/clm/cimetest/testmods_dirs/clm/interp_f19_noncrop/include_user_mods
A       components/clm/cimetest/testmods_dirs/clm/interp_f19_noncrop/README
A       components/clm/cimetest/testmods_dirs/clm/interp_f19_noncrop
A       components/clm/cimetest/testmods_dirs/clm/interp_f19_noncrop2crop/user_nl_clm
A       components/clm/cimetest/testmods_dirs/clm/interp_f19_noncrop2crop/include_user_mods
A       components/clm/cimetest/testmods_dirs/clm/interp_f19_noncrop2crop/README
A       components/clm/cimetest/testmods_dirs/clm/interp_f19_noncrop2crop
A       components/clm/cimetest/testmods_dirs/clm/interp_f19_crop/README
A       components/clm/cimetest/testmods_dirs/clm/interp_f19_crop/user_nl_clm
A       components/clm/cimetest/testmods_dirs/clm/interp_f19_crop/include_user_mods
A       components/clm/cimetest/testmods_dirs/clm/interp_f19_crop

========= Add unit tests that exercise initInterp: set_mindist
A       components/clm/src/main/test/initInterpMindist_test/CMakeLists.txt
A       components/clm/src/main/test/initInterpMindist_test/test_init_interp_mindist.pf
A       components/clm/src/main/test/initInterpMindist_test

List all existing files that have been modified, and describe the changes:

========= Fix incorrect dimension for pfts1d_topoglc
M       components/clm/src/main/subgridRestMod.F90

========= Remove finidat_interp_source namelist option; add use_init_interp and
          init_interp_fill_missing_with_natveg options
M       components/clm/bld/namelist_files/namelist_definition_clm4_5.xml
M       components/clm/bld/CLMBuildNamelist.pm
M       components/clm/src/main/controlMod.F90
M       components/clm/src/main/clm_varctl.F90

========= Refactor to split into two modules; parse new namelist option; change
          line endings from DOS to UNIX (changes all lines!)
M       components/clm/src/main/initInterp.F90

========= Write column type metadata to 1-d (vector) history files
M       components/clm/src/main/column_varcon.F90
M       components/clm/src/main/histFileMod.F90
M       components/clm/src/main/restFileMod.F90

========= Add optional msg argument to check_dim
M       components/clm/src/main/ncdio_pio.F90.in

========= Add system tests that exercise initInterp
M       components/clm/cimetest/testlist_clm.xml

========= Add unit tests that exercise initInterp: set_mindist
M       components/clm/src/main/CMakeLists.txt
M       components/clm/src/main/test/CMakeLists.txt
M       components/clm/src/unit_test_stubs/main/ncdio_pio_fake.F90.in



CLM testing:

  build-namelist tests:

    yellowstone: ok

      This test fails; it looks like it started failing in r125:
      131/547 < FAIL> <Test Id: 131> <Desc: both l_ncpl and dtime>  

  unit-tests (components/clm/src):

    yellowstone: ok

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    yellowstone_gnu (clm45 only): ok
    hobart_nag: ok

    Note: There was one BFAIL:
        BFAIL ERP_P15x2_Lm36.f10_f10.ICLM45BGCCROP.yellowstone_intel.clm-irrig_o3_reduceOutput.clm2.h1.nc : baseline compare clm2.h1 (baseline: compare .base file with clm4_5_2_r126 file) (baseline history file does not exist)


CLM tag used for the baseline comparisons: clm4_5_2_r126

Changes answers relative to baseline: NO
	
===============================================================
===============================================================
Tag name:  clm4_5_2_r126
Originator(s):  andre (Benjamin Andre,UCAR/CSEG,303-497-1391)
Date:  Thu Sep 17 14:53:49 MDT 2015
One-line Summary: New decomp_depth_efolding value for clm5.0, set as a namelist parameter instead of netcdf params file.

Purpose of changes:
    Set decomp_depth_efolding as a namelist parameter instead of netcdf params file. New default value for CLM 5.0.

    Improved error message from build namelist when turning on irrigation.

Requirements for tag: regular

Test level of tag: regular

Bugs fixed (include bugzilla ID): 2190

Known bugs (include bugzilla ID): 2213 
    http://bugs.cgd.ucar.edu/

Known Limitations:
     1147 (mkgriddata can't straddle over Greenwich)
     1025 (SCM mode can NOT use a global finidat file)
     1017 (SCM mode can NOT restart)
      896 (T62 mode does not work)
      701 (svn keyword)
      452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: add namelist group bgc_shared and namelist parameter decomp_depth_efolding. New default value for clm 5.0.

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: self

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

    clm/bld/namelist_files/namelist_defaults_clm4_5.xml - new defaults for decomp_depth_efolding
    clm/bld/namelist_files/namelist_definition_clm4_5.xml - put decomp_depth_efolding in new namelist group
    clm/bld/CLMBuildNamelist.pm - logic for new namelist variable, improve error message
    clm/src/unit_test_stubs/utils/spmdMod_stub.F90 - add mpi_real8 so unit tests will compile
    clm/src/biogeochem/CNSharedParamsMod.F90 - add new method to set parameters from namelist.
    clm/src/main/readParamsMod.F90 - pass namelist filename into CNSharedParamsMod::CNParamsReadShared


CLM testing: regular

  build-namelist tests:

    yellowstone - unit tests pass

  unit-tests (components/clm/src):

    yellowstone - passed

  tools-tests (components/clm/test/tools):

    yellowstone - n/a

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - n/a

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel : 40 - ok; 45 - ok; 50 - ok, clm50 bgc answer changing
    yellowstone_pgi : 40 - ok; 45 - ok; 50 - ok, clm50 bgc answer changing
    yellowstone_gnu (clm45 only) : 45 - ok; 50 - ok, clm50 bgc answer changing
    hobart_nag : 45 - ok; 50 - ok, clm50 bgc answer changing

CLM tag used for the baseline comparisons: clm4_5_2_r125

Changes answers relative to baseline: yes

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: clm50 bgc compsets
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): climate changing for clm 5.0

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)

    Parameter change based on experiments described in

	Koven, C.D., D.M. Lawrence, and W.J. Riley, 2015:
	Permafrost-carbon feedback: Sensitivity to deep soil
	decomposability and nitrogen cycle. PNAS,
	DOI:10.1073/pnas.1415123112.

	Lawrence, D.M., C.D. Koven, S.C. Swenson, W.J. Riley, and
	A.G. Slater, 2015: Permafrost thaw and resulting soil moisture
	changes regulate projected high-latitude CO2 and CH4
	emission. ERL, 10, doi:10.1088/1748-9326/10/9/094011.

   URL for LMWG diagnostics output used to validate new climate:

===============================================================
===============================================================
Tag name:  clm4_5_2_r125
Originator(s):  andre (Benjamin Andre,UCAR/CSEG,303-497-1391)
Date:  Tue Sep 15 22:08:09 MDT 2015
One-line Summary: clm 5.0 hydrology

Purpose of changes: clm 5.0 hydrology

  Dry surface layer soil evaporative resistance from Sean Swenson
  Richards equation with adaptive time stepping from Martyn Clark
  Zero-flux lower boundary for soil moisture
  Deep soil column (10 meters)
  Variable depth to bedrock from Sean Swenson
  Canopy interception and maximum leaf wetted fraction change

Requirements for tag: regular

Test level of tag: regular

Bugs fixed (include bugzilla ID): unknown

Known bugs (include bugzilla ID): 2213
    http://bugs.cgd.ucar.edu/

Known Limitations:
      1147 (mkgriddata can't straddle over Greenwich)
      1025 (SCM mode can NOT use a global finidat file)
      1017 (SCM mode can NOT restart)
       896 (T62 mode does not work)
       701 (svn keyword)
       452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist:

    Added new namelist variables for clm 5.0 hydrology. See namelist
    definition file for details. use_bedrock, deep_soilcolumn,
    soilwater_movement_method, upeer_boundary_condition,
    lower_boundary_condition, soil_resis_method,
    rooting_profile_method, interception_fraction,
    maximum_leaf_wetted_fraction.

List any changes to the defaults for the boundary datasets: unknown

Describe any substantial timing or memory changes: unknown

Code reviewed by: Sean Swenson

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: unknown

List all files added and what they do:

  clm/cimetest/testmods_dirs/clm/deepsoil_bedrock - new test for clm50 hydrology options.

  clm/src/biogeophys/SoilWaterRetentionCurveVanGenuchten1980Mod.F90 - adds placeholder for vanGenuchten soil water retention curve


List all existing files that have been modified, and describe the changes: unknown

  clm/cimetest/testlist_clm.xml - new test
  
  clm/tools/clm4_5/mksurfdata_map/src/mksurfdat.F90
  clm/tools/clm4_5/mksurfdata_map/src/Srcfiles
  clm/tools/clm4_5/mksurfdata_map/src/mkvarctl.F90
  clm/tools/clm4_5/mksurfdata_map/src/mkfileMod.F90
  clm/tools/clm4_5/mksurfdata_map/mksurfdata.pl
  
  clm/bld/namelist_files/namelist_defaults_clm4_5.xml - new namelist options
  clm/bld/namelist_files/namelist_defaults_clm4_5_tools.xml
  clm/bld/namelist_files/namelist_definition_clm4_5.xml
  clm/bld/CLMBuildNamelist.pm
  
  clm/src/cpl/lnd_import_export.F90
  
  clm/src/biogeochem/CNVegStateType.F90
  
  clm/src/main/clm_varpar.F90
  clm/src/main/ColumnType.F90
  clm/src/main/init_hydrology.F90
  clm/src/main/controlMod.F90
  clm/src/main/clm_varctl.F90
  clm/src/main/pftconMod.F90
  clm/src/main/initVerticalMod.F90
  clm/src/main/clm_instMod.F90
  
  clm/src/biogeophys/WaterStateType.F90
  clm/src/biogeophys/SoilWaterRetentionCurveFactoryMod.F90
  clm/src/biogeophys/SoilWaterRetentionCurveClappHornberg1978Mod.F90
  clm/src/biogeophys/SoilWaterRetentionCurveMod.F90
  clm/src/biogeophys/IrrigationMod.F90
  clm/src/biogeophys/SurfaceResistanceMod.F90
  clm/src/biogeophys/HydrologyDrainageMod.F90
  clm/src/biogeophys/RootBiophysMod.F90
  clm/src/biogeophys/BalanceCheckMod.F90
  clm/src/biogeophys/SoilWaterMovementMod.F90
  clm/src/biogeophys/SoilMoistStressMod.F90
  clm/src/biogeophys/CanopyHydrologyMod.F90
  clm/src/biogeophys/CanopyTemperatureMod.F90
  clm/src/biogeophys/SoilHydrologyMod.F90
  clm/src/biogeophys/HydrologyNoDrainageMod.F90
  clm/src/biogeophys/SoilStateType.F90
  clm/src/biogeophys/SoilHydrologyType.F90
  clm/src/biogeophys/BareGroundFluxesMod.F90
  clm/src/biogeophys/CanopyFluxesMod.F90
  clm/src/biogeophys/SoilStateInitTimeConstMod.F90
  
  clm/src/soilbiogeochem/SoilBiogeochemVerticalProfileMod.F90
  clm/src/soilbiogeochem/SoilBiogeochemStateType.F90

CLM testing:

  build-namelist tests:

    yellowstone - CLMBuildNamelist unit tests pass

  unit-tests (components/clm/src):

    yellowstone - pass

  tools-tests (components/clm/test/tools):

    yellowstone - not run

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone - n/a

  regular tests (aux_clm40, aux_clm45):

    NOTE: for all aux_clm45 machine/compiler combinations - clm50 compsets not bit for bit with baseline (new hydrology model is used).

    yellowstone_intel : aux_clm40 - pass; aux_clm45 - clm 45 compsets pass, clm50 compsets not bit for bit
    yellowstone_pgi : aux_clm40 - pass; aux_clm45 - clm 45 compsets pass, clm50 compsets not bit for bit
    yellowstone_gnu (clm45 only) : aux_clm45 - clm 45 compsets ok, clm50 compsets not bit for bit
    hobart_nag : aux_clm45 - clm 45 compsets ok, clm50 compsets not bit for bit. bug 2213 still applies for clm45 compsets.

CLM tag used for the baseline comparisons: clm4_5_2_r124

Changes answers relative to baseline:
  clm40 and clm45 compsets are bit for bit. clm50 compsets are answer changing.

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: all clm50 compsets
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): larger than roundoff, unknown climate.

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: unknown

   URL for LMWG diagnostics output used to validate new climate:
	unknown

===============================================================
===============================================================
Tag name:  clm4_5_2_r124
Originator(s):  sacks (Bill Sacks)
Date: Sun Sep 13 06:33:20 MDT 2015
One-line Summary: Wind-dependent snow density

Purpose of changes:

   Add an option to make snow density dependent on wind speed. There are two
   components to this: (1) adding a wind-related factor to the fresh snow
   density, and (2) adding a wind-related factor for the compaction of the
   existing snow pack (applying just to the top layer). This allows for more
   realistic (higher) fresh snow densities in windy conditions.

   Other than myself, contributors to these changes are: Jan Lenaerts, Leo van
   Kampenhout and Drew Slater.

Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID):

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: new option: 'wind_dependent_snow_density'

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: self

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated:

========= Renamed
D       components/clm/src/biogeophys/test/SnowHydrology_test/test_SnowHydrology.pf

List all files added and what they do:

========= Tests of some of the new code
A       components/clm/src/biogeophys/test/SnowHydrology_test/test_SnowHydrology_windCompactionFactor.pf

========= Renamed
A       components/clm/src/biogeophys/test/SnowHydrology_test/test_SnowHydrology_initSnowLayers.pf

List all existing files that have been modified, and describe the changes:

========= Add wind-dependent snow density parameterizations and control flag
M       components/clm/src/main/controlMod.F90
M       components/clm/src/biogeophys/CanopyHydrologyMod.F90
M       components/clm/src/biogeophys/HydrologyNoDrainageMod.F90
M       components/clm/src/biogeophys/LakeHydrologyMod.F90
M       components/clm/src/biogeophys/SnowHydrologyMod.F90
M       components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml
M       components/clm/bld/namelist_files/namelist_definition_clm4_5.xml
M       components/clm/bld/CLMBuildNamelist.pm

========= Add tests for some of the new code
M       components/clm/src/biogeophys/test/SnowHydrology_test/CMakeLists.txt

CLM testing:

  build-namelist tests:

    yellowstone: ok

  unit-tests (components/clm/src):

    yellowstone: ok

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    yellowstone_gnu (clm45 only): ok
    hobart_nag: ok

CLM tag used for the baseline comparisons: clm4_5_2_r123

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: all CLM50
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
        larger than roundoff; magnitude not investigated in detail

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	
===============================================================
===============================================================
Tag name:  clm4_5_2_r123
Originator(s):  sacks (Bill Sacks)
Date: Thu Sep 10 10:25:55 MDT 2015
One-line Summary: Fix some problems with pgi and nag compilers

Purpose of changes:

   (1) Fix some problems with the nag compiler: fix bug 2208, but open new bug
       2213

   (2) Work around some problems that appear with pgi 15.7 (appear to be
       compiler bugs), which Sean Santos tracked down: The key problem is that
       PGI is exporting some names that should have been aliased. So for
       instance:

       use foo_mod, only: foo_bar => bar

       In this case, if you have a "use" without an "only" of foo_mod, you get
       both foo_bar and bar imported into the namespace.

       Note: I have not been able to test these changes with pgi 15.7, because
       there is a PIO build problem with pgi 15.7

   (3) No longer kill the run if we're using ozone with pgi: The pgi compiler
       bug that showed up with the ozone code has been fixed as of pgi 15.1,
       which is now our default.

Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID):
   2208: nag reports a problem with associate statement to un-allocated LUNA
         memory in photosynthesisMod (but see new bug 2213)
   2094: ozone code doesn't work with the PGI compiler

Known bugs (include bugzilla ID):
    2213: CLM45 / CLM50 runs without BGC die with NAG compiler, due to associate
    to unallocated memory

    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: self

List any svn externals directories updated (cime, rtm, cism, etc.):

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Fix for pgi 15.7. CLM40 changes from Sean Santos; I ported these
          changes to CLM45
M       components/clm/src_clm40/main/lnd_comp_mct.F90
M       components/clm/src_clm40/main/spmdGathScatMod.F90
M       components/clm/src/cpl/lnd_comp_mct.F90
M       components/clm/src/utils/spmdGathScatMod.F90

========= Fix for nag from Ben Andre
M       components/clm/src/biogeophys/PhotosynthesisMod.F90

========= No longer abort if running with pgi
M       components/clm/src/biogeophys/OzoneMod.F90

========= Remove ozone pgi test, because it runs out of wallclock time (but I
          believe it would now pass: a shorter version now passes)
M       components/clm/cimetest/testlist_clm.xml

========= Update xFails: Add hobart_nag xFails, remove no-longer-relevant or
          no-longer-failing tests (many have been passing for a while now)
M       components/clm/cimetest/ExpectedTestFails.xml


CLM testing:

  unit-tests (components/clm/src):

    yellowstone: ok

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    yellowstone_gnu (clm45 only): ok
    hobart_nag: ok
       However, all runs without BGC still die: see bug 2213 and
       ExpectedTestFails list

CLM tag used for the baseline comparisons: clm4_5_2_r122

Changes answers relative to baseline: NO
	
===============================================================
===============================================================
Tag name:  clm4_5_2_r122
Originator(s):  sacks (Bill Sacks)
Date: Wed Sep  9 05:57:15 MDT 2015
One-line Summary: Update to latest cime

Purpose of changes:

   Update cime to the version likely to be in cesm1_4_beta07

Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID):

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: none

List any svn externals directories updated (cime, rtm, cism, etc.):

   cime2.0.7 -> cime2.0.17

List all files eliminated:

List all files added and what they do:

List all existing files that have been modified, and describe the changes:

========= Change instructions: no longer need dot in your path
M       components/clm/src/README.unit_testing

========= Remove CME and NCK expected failures: these pass now, presumably due
          to fixes in cime (although since the failures were intermittent, it's
          hard to say definitively that the problem is fixed)
M       components/clm/cimetest/ExpectedTestFails.xml

-   <entry bugz="cime-115" >CFAIL CME_Ld5.f10_f10.ICN.yellowstone_intel</entry>
-   <entry bugz="cime-115" >CFAIL CME_Ly4.f10_f10.I1850CLM45BGC.yellowstone_intel.clm-monthly</entry>
-   <entry bugz="cime-116" >FAIL NCK_Ld1.f10_f10.ICRUCLM45.yellowstone_intel.clm-default</entry>
-   <entry bugz="cime-116" >RUN NCK_Ld1.f10_f10.ICRUCLM45.yellowstone_intel.clm-default</entry>

CLM testing:

  unit-tests (components/clm/src):

    yellowstone: ok

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    yellowstone_gnu (clm45 only): ok
    hobart_nag: clm40 ok, CLM45 NOT RUN
       Note that there is still a problem with clm45 nag

CLM tag used for the baseline comparisons: clm4_5_2_r121

Changes answers relative to baseline: NO

===============================================================
===============================================================
Tag name:  clm4_5_2_r121
Originator(s):  sacks (Bill Sacks)
Date: Fri Sep  4 10:55:54 MDT 2015
One-line Summary: Rework snow capping

Purpose of changes:

   Main change is a complete rework of snow capping. Previously, when the snow
   pack was in a "capped" state (i.e., h2osno >= h2osno_max), new snow and rain
   were prevented from falling on the snow pack: it was as if someone put a roof
   over the snow. (However, there were workarounds in place that caused the
   aerosol concentration and snow grain size in the top snow layer to continue
   to evolve as if new snow was still falling.) This was problematic in terms of
   the long-term evolution of the snow pack, since in effect the new, less dense
   snow was being removed due to capping. So, at least in some regions, the snow
   pack became much more dense than it should be.

   The new snow capping scheme allows snow and rain to fall on the top as they
   would in the uncapped state. But if h2osno exceeds h2osno_max, then mass is
   removed from the *bottom* snow layer. This removes the need for the old
   workarounds, and is more physically realistic: This represents the process of
   converting snow to glacial ice, which in reality occurs at the bottom (most
   dense) portion of the snow pack.


   Also, a mostly-unrelated change: rearrange the multi-layer snow history
   fields, so that index 1 is always the top of the snow pack.


   These changes are from Leo van Kampenhout (l.vankampenhout@uu.nl)

Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID):

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: self

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Rework handling of snow capping. This is now done pretty much entirely
          in SnowHydrologyMod, in a completely different way than before.
M       components/clm/src/biogeophys/SnowHydrologyMod.F90
M       components/clm/src/biogeophys/LakeFluxesMod.F90
M       components/clm/src/biogeophys/SoilFluxesMod.F90
M       components/clm/src/biogeophys/WaterStateType.F90
M       components/clm/src/biogeophys/BalanceCheckMod.F90
M       components/clm/src/biogeophys/WaterfluxType.F90
M       components/clm/src/biogeophys/LakeHydrologyMod.F90
M       components/clm/src/biogeophys/HydrologyNoDrainageMod.F90
M       components/clm/src/biogeophys/CanopyHydrologyMod.F90
M       components/clm/src/main/clm_driver.F90

========= Remove some old workarounds that were put in place to get reasonable
          answers with the old snow capping method
M       components/clm/src/biogeophys/AerosolMod.F90
M       components/clm/src/biogeophys/SnowSnicarMod.F90

========= Rearrange multi-layer snow history fields
M       components/clm/src/main/histFileMod.F90
M       components/clm/doc/UsersGuide/custom.xml

========= Trivial changes (removing associate lines, changing comments, etc.)
M       components/clm/src/biogeophys/HydrologyDrainageMod.F90
M       components/clm/src/biogeophys/SoilHydrologyMod.F90
M       components/clm/src/biogeophys/CanopyTemperatureMod.F90
M       components/clm/src/biogeophys/UrbanFluxesMod.F90
M       components/clm/src/biogeochem/ch4Mod.F90


CLM testing:

  unit-tests (components/clm/src):

    yellowstone: ok

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    yellowstone_gnu (clm45 only): ok
    hobart_nag: NOT RUN
      hobart_nag tests still all fail, as they did in clm4_5_1_r120

CLM tag used for the baseline comparisons: clm4_5_1_r120

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: All clm4.5 and clm5.0 configurations
    - what platforms/compilers: All
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 

      Definitely larger than roundoff. Whether this is the same or new climate
      has not been investigated carefully. However, at least in some regions
      with persistent snow cover, this change has a significant effect on the
      evolution of the snow pack, as described above.

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	
===============================================================
===============================================================
Tag name:  clm4_5_1_r120
Originator(s):  andre (Benjamin Andre,UCAR/CSEG,303-497-1391)
Date: Sat Aug 29 22:58:57 MDT 2015
One-line Summary: CLM 5 nitrogen models Flexible CN and LUNA

Purpose of changes:
  CLM 5 nitrogen models Flexible CN (Bardan Ghimire, LBNL)
  and LUNA (Chonggang Xu, LANL). The LUNA model predicts
  photosynthetic capacities as measured by Vc, max25 and Jmax25
  under different environmental conditions (see Ali et al 2015).

Requirements for tag: regular

Bugs fixed (include bugzilla ID): none

Known bugs (include bugzilla ID):
  http://bugs.cgd.ucar.edu/ - 2208
  https://github.com/CESM-Development/cime/issues - 115, 116

Known Limitations:
   1147 (mkgriddata can't straddle over Greenwich)
   1025 (SCM mode can NOT use a global finidat file)
   1017 (SCM mode can NOT restart)
    896 (T62 mode does not work)
    701 (svn keyword)
    452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: 
  addition of use_luna and use_flexibleCN. use_flexibleCN adds
  additional namelist options in the clm_nitrogen group. See xml
  definitions file for details.

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: self, Bardan Ghimire, Chonggang Xu

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do:

  src/biogeochem/NutrientCompetitionFlexibleCNMod.F90 - flexibleCN.
  cimetest/testmods_dirs/clm/flexibleCN - flexible cn regression test
  src/biogeophys/LunaMod.F90 - luna model
  cimetest/testmods_dirs/clm/luna - luna regression case

List all existing files that have been modified, and describe the changes:

  new namelist controls for flexibleCN and luna, clm_nitrogen namelist group:
    bld/namelist_files/namelist_definition_clm4_5.xml
    bld/namelist_files/namelist_defaults_clm4_5.xml
    bld/CLMBuildNamelist.pm
    src/main/clm_varctl.F90
    src/main/controlMod.F90

  flexibleCN
    src/biogeochem/CNVegCarbonStateType.F90 - Michaelis-Menten Nitrogen uptake
    src/biogeochem/CNVegNitrogenStateType.F90 - Michaelis-Menten Nitrogen uptake

    src/biogeochem/CNGRespMod.F90 - excess carbon storage
    src/biogeochem/CNGapMortalityMod.F90 - excess carbon storage

    src/biogeochem/NutrientCompetitionFactoryMod.F90 - add flexible cn option
    src/biogeochem/NutrientCompetitionMethodMod.F90 - modify interface to accomidate flexiblecn
    src/biogeochem/CNPhenologyMod.F90 - floating cn evergreen phenology
    src/biogeochem/CNDriverMod.F90 - update function call args
    src/main/pftconMod.F90 - flexible cn pft variables

    src/main/histFileMod.F90 - nlev canopy
    src/main/clm_driver.F90 - update function call args
    src/main/clm_instMod.F90 - update function call args
    src/biogeophys/WaterfluxType.F90 - additional water flux vars
    src/biogeophys/SoilWaterMovementMod.F90 - soil water work around

  LUNA
    src/main/clm_varcon.F90 - new constant for luna
    src/biogeophys/PhotosynthesisMod.F90 - luna use of vcmax25 and jmax25 
    src/biogeophys/CanopyFluxesMod.F90 - luna calculation of vcmax25 and jmax25
    src/main/atm2lndType.F90 - state data needed for luna
    src/biogeophys/FrictionVelocityMod.F90 - luna variables
    src/biogeophys/WaterStateType.F90 - luna variables
    src/biogeophys/TemperatureType.F90 - luna variables
    src/biogeophys/SolarAbsorbedType.F90 - luna variables
    src/biogeophys/QSatMod.F90 - saturated vapor pressure density
    src/biogeophys/SoilHydrologyType.F90 - luna var
    src/biogeophys/CanopyStateType.F90 - update vcmax and jmax for luna

    cimetest/ExpectedTestFails.xml - update for cime bugs 115 and 116
    cimetest/testlist_clm.xml - update test list for aux_clm_short, new luna and flexibleCN tests


CLM testing: regular, build-namelist

  build-namelist tests:

    yellowstone - unit tests : pass, other pass

  unit-tests (components/clm/src):

    yellowstone - ok

  tools-tests (components/clm/test/tools): n/a

  PTCLM testing (components/clm/tools/shared/PTCLM/test): n/a

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel - 40 ok, 45 ok
    yellowstone_pgi - 40 ok, 45 ok
    yellowstone_gnu (clm45 only) ok
    hobart_nag - not run, tests hang, see bug 2208

  Testing notes:

    * new namelist group clm_nitrogen causes all nlcomp tests to fail
    * introduces new tests for flexibleCN and luna that do not
    have baselines in clm4_5_1_r119.
    * two new expected fails believed to be related to cime issues
    115 and 116.
    * removes the existing aux_clm_short tests and replaces them with
    a new set of SMS, ERS and ERP tests that are replicated for
    yellowstone gnu, intel and pgi.

CLM tag used for the baseline comparisons: clm4_5_1_r119

Changes answers relative to baseline: none


===============================================================
===============================================================
Tag name:  clm4_5_1_r119
Originator(s):  erik (Erik Kluzek)
Date: Wed Aug 26 22:29:10 MDT 2015
One-line Summary: Bring hobart/nag bug fixes to trunk, and fix a few bugs

Purpose of changes:

Bring hobart/nag bug fixes to trunk. Fix ncl6.3.0 bug for getregional script. 
Fix use_c13 bug. Update RTM to handle regional direction files. Make sure _r8
constants in ED have a decimal point, so the NAG compiler will treat them as
double-precision rather than as integer*2.

Move testing from goldbach to hobart. For hobart_nag make all of the tests
on just one node (24 processors).

Requirements for tag: compile run with hobart/nag (fix bugs 2205 and 2199)
                      move testing from goldbach to hobart

Test level of tag: regular

Bugs fixed (include bugzilla ID):
     2206 (PTCLM stopped working with pft number in surface dataset filenames for mksurfdata.pl)
     2205 (Problems with some constants in ED for NAG compiler)
     2199 (crayftn compiler issue with continuation in middle of string)
     2180 (ncl6.3.0 bug for getregional script)
     2174 (use_c13 bug, unformatted write caused model to die)
     2156 (Update RTM to handle regional direction files)

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: None

Describe any changes made to the namelist: None

List any changes to the defaults for the boundary datasets: None

Describe any substantial timing or memory changes: None

Code reviewed by: self, klindsay

List any svn externals directories updated (cime, rtm, cism, etc.): PTCLM, cime and rtm
     cime  to cime2.0.07
     rtm   to rtm1_0_52
     PTCLM to PTCLM2_150826

List all files eliminated: Move goldbach to hobart

D    components/clm/test/tools/tests_posttag_goldbach_nompi

List all files added and what they do: Move goldbach to hobart

A    components/clm/test/tools/tests_posttag_hobart_nompi

List all existing files that have been modified, and describe the changes:

------------ Move goldbach to hobart, remove PGI option for hobart
M    components/clm/test/tools/test_driver.sh

M       components/clm/bld/unit_testers/build-namelist_test.pl -- Fix ED tests so megan off

M       components/clm/cimetest/testlist_clm.xml --- Move goldbach tests to hobart
            Make 2-node hobart_nag tests on a single node

M       components/clm/tools/shared/mkmapgrids/mkscripgrid.ncl -- Fix so will
            work with ncl6.3.0, bug 2180

M       components/clm/src/README.unit_testing --- add some notes about unit-testing

------------ Bug 2205, some _r8 constants in ED don't have a decimal point
------------ and the NAG compiler then treats them as integer*2.
M       components/clm/src/ED/main/EDCLMLinkMod.F90
M       components/clm/src/ED/main/EDRestVectorMod.F90
M       components/clm/src/ED/main/EDInitMod.F90
M       components/clm/src/ED/fire/SFMainMod.F90
M       components/clm/src/ED/biogeophys/EDPhotosynthesisMod.F90
M       components/clm/src/ED/biogeophys/EDBtranMod.F90
M       components/clm/src/ED/biogeochem/EDGrowthFunctionsMod.F90
M       components/clm/src/ED/biogeochem/EDCohortDynamicsMod.F90
M       components/clm/src/ED/biogeochem/EDPhysiologyMod.F90
M       components/clm/src/ED/biogeochem/EDPatchDynamicsMod.F90

------------ Bug 2199, write to iulog was unformatted, which caused the model
------------ to die after it had already done formatted writes.
M       components/clm/src/soilbiogeochem/SoilBiogeochemCarbonStateType.F90
M       components/clm/src/biogeochem/CNVegCarbonStateType.F90

CLM testing:

  build-namelist tests:

    yellowstone  yes

  unit-tests (components/clm/src):

    yellowstone  yes

  tools testing (components/clm/test/tools):

     yellowstone yes

  PTCLM testing (components/clm/tools/shared/PTCLM/test):

     yellowstone yes

  regular tests (aux_clm40, aux_clm45, aux_clm_short):

    yellowstone_intel             yes
    yellowstone_pgi               yes
    yellowstone_gnu (clm45 only)  yes
    hobart_nag                    yes
    hobart_pgi                    yes
    hobart_intel                  yes

CLM tag used for the baseline comparisons:  clm4_5_1_r118

Changes answers relative to baseline: no

===============================================================
===============================================================
Tag name:  clm4_5_1_r118
Originator(s):  sacks (Bill Sacks)
Date: Wed Aug  5 16:22:33 MDT 2015
One-line Summary: Minor rework of glc coupling fields

Purpose of changes:

   This makes CLM compatible with recent CIME changes.

   (1) Use renamed coupler field, in both clm40 and clm45

   (2) In clm45 code, rework clm_cpl_indices to use glc_elevclass_mod (simpler
   and more robust than the earlier code)

Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID):

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: self

List any svn externals directories updated (cime, rtm, cism, etc.):

   cime1.1.11 -> cime2.0.0
   cism2_0_09 -> cism2_1_02

List all files eliminated:

List all files added and what they do:

List all existing files that have been modified, and describe the changes:

========= Main changes
M       components/clm/src/cpl/clm_cpl_indices.F90
M       components/clm/src/cpl/lnd_import_export.F90
M       components/clm/src_clm40/main/clm_cpl_indices.F90
M       components/clm/src_clm40/main/lnd_import_export.F90

========= Document new unit testing method needed for yellowstone, due to cime update
M       components/clm/src/README.unit_testing

========= Rework test mods due to a fundamental change in how the forced
          decrease / increase in glc area works
M       components/clm/cimetest/testmods_dirs/clm/glcMEC_decrease/user_nl_cism
M       components/clm/cimetest/testmods_dirs/clm/glcMEC_increase/user_nl_cism

========= New failures, which seem to be attributable to the cime update,
          unrelated to my changes. However, the NCK and CME test failures seem
          dependent on the order in which tests are run, so these problems are
          hard to reproduce. Running them as single tests leads to PASSes.
M       components/clm/cimetest/ExpectedTestFails.xml
+   <entry bugz="cime-115" >CFAIL CME_Ld5.f10_f10.ICN.yellowstone_intel</entry>
+   <entry bugz="cime-116" >FAIL NCK_Ld1.f10_f10.ICRUCLM45.yellowstone_intel.clm-default</entry>
+   <entry bugz="2197" >RUN ERS_D_Mmpi-serial_Ld5.1x1_brazil.ICLM45ED.yellowstone_gnu.clm-edTest</entry>


CLM testing:

  unit-tests (models/lnd/clm/src):

    yellowstone: ok

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    yellowstone_gnu (clm45 only): ok
    goldbach_nag: ok - but see caveat below!

As noted above, there are three new test failures. The ERS_D ICLM45ED failure
seems to be a legitimate bug in CLM. The other two (CFAIL
CME_Ld5.f10_f10.ICN.yellowstone_intel and FAIL
NCK_Ld1.f10_f10.ICRUCLM45.yellowstone_intel.clm-default) seem to be intermittent
failures, likely due to a bug in the test system or elsewhere in cime. These
sometimes pass and sometimes fail. They always seem to pass when run as single
tests, but sometimes fail when run as part of a test suite. It's not clear if
the new cime is to blame directly, or if these are arising now simply because
tests are being run in a different order.

golbach-nag does not run out-of-the-box with this tag. However, it should run
out-of-the-box if you merge in the next commit in cime master
(4b52ec73086a4290323dddfde6087a6d6d12ab96). I did my changes with that commit
merged in, but this hadn't come to master in time for me to include it in this
CLM tag.

CLM tag used for the baseline comparisons: clm4_5_1_r117

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: Configurations with CISM (IG), both CLM4 and CLM45
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      Likely larger than roundoff/same climate (but not investigated closely)

      These changes are due to a complete rework of the coupling between CISM
      and CLM, manifested as major changes in the CIME and CISM externals. (The
      changes in CLM are not directly responsible for the answer changes.)

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	
===============================================================
===============================================================
Tag name:  clm4_5_1_r117
Originator(s):  sacks (Bill Sacks)
Date: Tue Jul 28 06:01:04 MDT 2015
One-line Summary: Repartition rain vs. snow from atmosphere

Purpose of changes:

   Add an option to repartition rain vs. snow from atmosphere based on
   near-surface temperature. This repartitioning uses a ramp-based partitioning
   that is also used in datm: we ignore the rain vs. snow partitioning sent from
   the atmosphere, and generate our own rain vs. snow partitioning. A sensible
   heat flux is generated to conserve energy with this repartitioning.

   The motivation for this is two-fold:

   (1) There are biases in CAM which cause rain to be generated in cold
       conditions. This is particularly a problem for glacier surface mass
       balance in Greenland. Andrew Gettelman has suggested putting in place
       this workaround in CLM until CAM can find a robust fix.

   (2) With the downscaling to glacier elevation classes, it is useful to have
       a different rain/snow partitioning in each elevation class. 

   This repartitioning is on by default in CLM5, off by default in CLM4.5.

   If / when the CAM bias is fixed, we could potentially change this code so
   that it just does the repartitioning over the do_smb filter, similarly to the
   other downscaling in atm2lndMod. (Rather than doing this correction
   everywhere - which we do now in order to correct the rain vs. snow
   partitioning bias in CAM.)

Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID):

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist:

   Removed glcmec_downscale_rain_snow_convert option, added
   repartition_rian_snow option

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: Sean Swenson reviewed the calculation of the sensible heat
flux correction

List any svn externals directories updated (cime, rtm, cism, etc.):

   cime1.1.10 -> cime1.1.11
   This creates a new shared routine for partitioning rain vs. snow, now shared
   between datm and CLM.

List all files eliminated:

List all files added and what they do:

========= Add unit tests for repartitioning of rain vs snow, and supporting
          utility code
A       components/clm/src/main/test/atm2lnd_test/test_sens_heat_from_precip_conversion.pf
A       components/clm/src/main/test/atm2lnd_test/CMakeLists.txt
A       components/clm/src/main/test/atm2lnd_test/test_partition_precip.pf
A       components/clm/src/main/test/atm2lnd_test
A       components/clm/src/unit_test_shr/unittestArrayMod.F90
A       components/clm/src/unit_test_shr/test/unittestArray_test/CMakeLists.txt
A       components/clm/src/unit_test_shr/test/unittestArray_test/test_unittestArray.pf
A       components/clm/src/unit_test_shr/test/unittestArray_test

List all existing files that have been modified, and describe the changes:

========= Repartition rain vs snow from atmosphere, and add a sensible heat flux
          correction for energy conservation
M       components/clm/src/biogeophys/EnergyFluxType.F90
M       components/clm/src/main/clm_driver.F90
M       components/clm/src/main/clm_varctl.F90
M       components/clm/src/main/controlMod.F90
M       components/clm/src/main/atm2lndType.F90
M       components/clm/src/main/lnd2atmType.F90
M       components/clm/src/main/atm2lndMod.F90
M       components/clm/src/main/lnd2atmMod.F90

========= Remove glcmec_rain_snow_threshold
M       components/clm/src/main/clm_varcon.F90

========= Remove glcmec_downscale_rain_snow_convert option, add
          repartition_rain_snow option
M       components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml
M       components/clm/bld/namelist_files/namelist_definition_clm4_5.xml
M       components/clm/bld/CLMBuildNamelist.pm

========= Add an IG CLM5 test
M       components/clm/cimetest/testlist_clm.xml

========= Remove glcmec_downscale_rain_snow_convert setting (which no longer exists)
M       components/clm/cimetest/testmods_dirs/clm/glcMEC_changeFlags/user_nl_clm

========= Add unit tests for repartitioning of rain vs snow, and supporting
          utility code
M       components/clm/src/main/CMakeLists.txt
M       components/clm/src/main/test/CMakeLists.txt
M       components/clm/src/biogeophys/CMakeLists.txt
M       components/clm/src/unit_test_shr/test/CMakeLists.txt
M       components/clm/src/unit_test_shr/unittestSimpleSubgridSetupsMod.F90
M       components/clm/src/unit_test_shr/CMakeLists.txt

CLM testing:

  build-namelist tests:

    yellowstone: ok (changes namelists, as expected)

  unit-tests (models/lnd/clm/src):

    yellowstone: ok

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    yellowstone_gnu (clm45 only): ok
    goldbach_nag: ok

CLM tag used for the baseline comparisons: clm4_5_1_r116

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM5 cases
    - what platforms/compilers: All
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      Likely new climate, but not investigated closely

   Answer changes are due to new rain vs. snow partitioning, which is on by
   default in CLM5.

   Also changes answers for
   ERP_D_Ld5.f19_g16.ICLM45GLCMEC.yellowstone_intel.clm-glcMEC_changeFlags
   (expected, since it no longer downscales precip).

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	
===============================================================
===============================================================
Tag name:  clm4_5_1_r116
Originator(s):  sacks (Bill Sacks)
Date: Wed Jul 22 06:39:28 EDT 2015
One-line Summary: Rename some history fields

Purpose of changes:

   (1) Make QSNOMELT point to qflx_snomelt, as it does in CLM4.0, rather than
   qflx_snow_drain (previously qflx_snow_melt)

   (2) Turn on QSNOFRZ by default (parallels QSNOMELT)

   (3) For the 3 history fields that have FOO and FOO_NODYNLNDUSE versions:
   Rename FOO to FOO_TO_COUPLER and FOO_NODYNLNDUSE to FOO. This is at Sean
   Swenson's suggestion: He points out that the version without the dyn landuse
   adjustment (and, soon, the sensible heat adjustment from rain/snow
   conversion) is the one most people will be interested in, so should be the
   one without the suffix.

   (4) Tweak test lists:

   (a) Move prealpha & prebeta goldbach tests to hobart

   (b) Move an aux_clm45 pgi test to intel: With recent versions of cime
   (starting with cime1.1.0), threading tests with pgi take a very long time. So
   this test took 3 hours with pgi, vs 20 min with intel.

Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID):
   - 2178 (QSNOMELT incorrect in clm4.5)

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: self

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= See summary above
M       components/clm/src/main/lnd2atmType.F90
M       components/clm/src/biogeophys/WaterfluxType.F90
M       components/clm/src/biogeophys/EnergyFluxType.F90
M       components/clm/cimetest/testlist_clm.xml


CLM testing:

  unit-tests (models/lnd/clm/src):

    yellowstone: NOT RUN
    mac: ok

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    yellowstone_gnu (clm45 only): ok
    goldbach_nag: ok

CLM tag used for the baseline comparisons: clm4_5_1_r115

Changes answers relative to baseline: YES

  Just changes a few diagnostic fields, for CLM4.5 and CLM5:

  - QSNOMELT: changed to qflx_snomelt rather than qflx_snow_drain

  - QRUNOFF: differs for cases with transient landcover

  - FSH: differs for cases with CISM

  - QSNWCPICE: differs for cases with CISM

===============================================================
===============================================================
Tag name:  clm4_5_1_r115
Originator(s):  sacks (Bill Sacks)
Date: Wed Jul 15 05:26:37 MDT 2015
One-line Summary: Remove redundant code, rename a variable

Purpose of changes:

   (1) Remove some redundant code in SnowHydrologyMod, related to 'void'. This
   was supposed to be removed a long time ago. (Apparently the issue this was
   trying to fix was fixed in a different, more robust way.)

   (2) Remove redundant, unused copy of accumulMod in utils/ (newer copy is in
   main/)

   (3) Rename qflx_snow_melt to qflx_snow_drain, to avoid confusion with the
   existing qflx_snomelt.

   (4) Clarify documentation of snowdp_col

Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID):

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: self

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated:

========= Redundant and unused (copy in main/ is used)
D       components/clm/src/utils/accumulMod.F90

List all files added and what they do:

List all existing files that have been modified, and describe the changes:

========= Rename qflx_snow_melt to qflx_snow_drain
M       components/clm/src/biogeophys/CanopyHydrologyMod.F90
M       components/clm/src/biogeophys/LakeHydrologyMod.F90
M       components/clm/src/biogeophys/BalanceCheckMod.F90
M       components/clm/src/biogeophys/WaterfluxType.F90
M       components/clm/src/biogeophys/SoilTemperatureMod.F90
M       components/clm/src/biogeophys/SnowHydrologyMod.F90
          - also remove redundant lines of code related to 'void' (see above)
M       components/clm/src/biogeophys/LakeTemperatureMod.F90

========= Clarify documentation for snowdp_col
M       components/clm/src/biogeophys/HydrologyNoDrainageMod.F90
M       components/clm/src/biogeophys/WaterStateType.F90

========= Remove SMS_Lm25.f10_f10.ICLM45BGCCROP.goldbach_nag.clm-reduceOutput
          (runs out of wall-clock time, and we have sufficient test coverage of
          that configuration)
M       components/clm/cimetest/testlist_clm.xml


CLM testing:

  unit-tests (models/lnd/clm/src):

    yellowstone: ok

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    yellowstone_gnu (clm45 only): ok
    goldbach_nag: ok

CLM tag used for the baseline comparisons: clm4_5_1_r114

Changes answers relative to baseline: NO
	
===============================================================
===============================================================
Tag name:  clm4_5_1_r114
Originator(s):  sacks (Bill Sacks)
Date: Fri Jul 10 19:34:57 MDT 2015
One-line Summary: Update cime external, remove genf90-generated files

Purpose of changes:

   Main purpose is to update the cime external to the version in cesm1_4_beta05.

   This also required updating the unit test build to use genf90 during the
   build rather than relying on already-generated files.

   Making this change led to some genf90'd files being regenerated in-source
   during the unit test build, which would lead these files to be updated every
   time we make a tag. To avoid this annoyance, I have removed the genf90'd
   files from the repository: These are not needed any more in either the unit
   test or system builds, and it simplifies things to remove them.

   Then I added an svn:ignore property to ignore files generated by genf90
   during the unit test build.

Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID):

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: self

List any svn externals directories updated (cime, rtm, cism, etc.):

   cime1.0.7 -> cime1.1.10

   Among other things, this brings in Jay's big batch system refactor

List all files eliminated:

========= Remove genf90-generated files, and some scripts that were used to
          create them (these are now created as part of the unit test or system build)
D       components/clm/src/dyn_subgrid/dynVarMod.F90
D       components/clm/src/dyn_subgrid/dynVarTimeInterpMod.F90
D       components/clm/src/dyn_subgrid/dynVarTimeUninterpMod.F90
D       components/clm/src/dyn_subgrid/do_genf90
D       components/clm/src/unit_test_stubs/utils/do_genf90
D       components/clm/src/unit_test_stubs/utils/restUtilMod_stub.F90
D       components/clm/src/unit_test_stubs/main/ncdio_var.F90
D       components/clm/src/unit_test_stubs/main/ncdio_pio_fake.F90
D       components/clm/src/unit_test_stubs/main/do_genf90
D       components/clm/src/utils/restUtilMod.F90
D       components/clm/src/main/ncdio_pio.F90

List all files added and what they do:

List all existing files that have been modified, and describe the changes:

========= Generate files with genf90 rather than using pre-generated files
M       components/clm/src/CMakeLists.txt

========= Document new, simpler method for building and running the unit tests
          (thanks largely to new default options in run_tests.py)
M       components/clm/src/README.unit_testing

========= Add svn:ignore property to ignore files generated by genf90 during the
          unit test build
 M      components/clm/src/dyn_subgrid
 M      components/clm/src/unit_test_stubs/utils
 M      components/clm/src/unit_test_stubs/main


CLM testing:

  build-namelist tests:

    yellowstone: ok

  unit-tests (models/lnd/clm/src):

    yellowstone: ok

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    yellowstone_gnu (clm45 only): ok
    goldbach_nag: ok

CLM tag used for the baseline comparisons: clm4_5_1_r112

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: ALL
    - what platforms/compilers: intel
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
       roundoff, according to cime documentation

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A: Trusting Sean Santos's cime documentation.

   These changes were likely due to this change in cime:

   commit 0d7eab6bd112565ba9eb6eb82b74127ae5a5f390
   Author: Sean Patrick Santos <SeanPatrickSantos@gmail.com>
   Date:   Fri May 15 12:35:31 2015 -0600

      Use our native gamma/erf implementations on Intel

===============================================================
===============================================================
Tag name:  clm4_5_1_r113
Originator(s):  sacks (Bill Sacks)
Date: Thu Jul  9 10:01:13 MDT 2015
One-line Summary: Support backwards compatibility of restart variable names

Purpose of changes:

   Previously, if a restart variable was renamed, backwards compatibility was
   implemented in an ad-hoc manner. A key point is taht none of these ad-hoc
   solutions allowed backwards compatibility when running
   initInterp. (initInterp would just skip any variable if it could not find an
   exact match on the input [template] file.)

   This tag provides a standard mechanism for putting in place backwards
   compatibility when renaming a restart variable. This backwards compatibility
   carries over to initInterp, by communicating the necessary metadata through a
   new attribute on the restart file: 'varnames_on_old_files'.

   In order to use this new mechanism, give a colon-delimited list of variable
   names in the varname argument to restartvar. For example, if a restart
   variable FOO has been renamed to BAR, then specify varname='BAR:FOO'. Note
   that this list is searched in order, and the first item should be the current
   restart variable name.

   Also, applied this new mechanism to the recently-added LIQCAN
   variable. Previously, backwards compatibility of this variable was handled in
   an ad-hoc manner, which did not work when running initInterp.

Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID):

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: Erik

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do:

========= Add module for higher-level netcdf utilities. Currently contains
          routine for finding a variable on a netcdf file from a list of
          possible variables. Also add unit tests for this routine.
A       components/clm/src/main/ncdio_utils.F90
A       components/clm/src/main/test/ncdio_utils_test/test_ncdio_utils.pf
A       components/clm/src/main/test/ncdio_utils_test/CMakeLists.txt
A       components/clm/src/main/test/ncdio_utils_test

List all existing files that have been modified, and describe the changes:

========= Allow multiple possible names in reading restart files and in reading
          the 'input' file in initInterp
M       components/clm/src/utils/restUtilMod.F90.in
M       components/clm/src/utils/restUtilMod.F90
M       components/clm/src/main/initInterp.F90

========= Apply new mechanism to recently-added LIQCAN restart field. Also
          remove redundant setting of snocan_patch to 0 if it isn't found on the
          restart file - not needed since initCold is always called.
M       components/clm/src/biogeophys/WaterStateType.F90

========= Changes to support unit testing of ncdio_utils
M       components/clm/src/main/CMakeLists.txt
M       components/clm/src/main/test/CMakeLists.txt
M       components/clm/src/unit_test_stubs/main/ncdio_pio_fake.F90.in
M       components/clm/src/unit_test_stubs/main/ncdio_pio_fake.F90

========= Fix path to genf90 for new cime organization
M       components/clm/src/unit_test_stubs/main/do_genf90
M       components/clm/src/unit_test_stubs/main/ncdio_var.F90

CLM testing:

  unit-tests (models/lnd/clm/src):

    yellowstone: ok

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    yellowstone_gnu (clm45 only): ok
    goldbach_nag: ok

CLM tag used for the baseline comparisons: clm4_5_1_r112

Changes answers relative to baseline: NO

===============================================================
===============================================================
Tag name:  clm4_5_1_r112
Originator(s):  oleson (Keith Oleson,UCAR/TSS,303-497-1332)
Date: Wed Jul  1 10:14:11 MDT 2015
One-line Summary: Justin Perket snow on vegetation

Purpose of changes: Incorporate Justin Perket's snow on vegetation changes

Requirements for tag:

Test level of tag: regular, build-namelist, unit_tests

Bugs fixed (include bugzilla ID):

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: Add snowveg_flag item

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: Keith Oleson, Justin Perket, Erik Kluzek

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:
M components/clm/src/README.unit_testing               Add note that instructions are for bash shell
M components/clm/src/biogeophys/CanopyFluxesMod.F90    snow/liq on vegetation
M components/clm/src/biogeophys/WaterStateType.F90     history/restart handling for snow/liq on vegetation
M components/clm/src/biogeophys/BalanceCheckMod.F90    line spaces only
M components/clm/src/biogeophys/WaterfluxType.F90      history handling for snow on vegetation
M components/clm/src/biogeophys/CanopyHydrologyMod.F90 snow/liq on vegetation and snowveg_flag handling
M components/clm/src/biogeophys/SurfaceAlbedoMod.F90   snow on vegetation optical properties
M components/clm/src/main/controlMod.F90               line spaces only
M components/clm/bld/test_build_namelist/t/input/namelist_defaults_clm4_5_test.xml snowveg_flag handling
M components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml                   snowveg_flag handling
M components/clm/bld/namelist_files/namelist_definition_clm4_5.xml                 snowveg_flag handling
M components/clm/bld/CLMBuildNamelist.pm                                           snowveg_flag handling

CLM testing:

  build-namelist tests:

    yellowstone: ok
    All CLM45 and CLM50 tests have namelist differences; this is expected due
     to addition of new namelist item

  unit-tests (models/lnd/clm/src):

    yellowstone: ok

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    yellowstone_gnu (clm45 only): ok
    goldbach_nag: ok

CLM tag used for the baseline comparisons:  clm4_5_1_r111

Changes answers relative to baseline: Yes, for CLM50

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM50
    - what platforms/compilers: All
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 

    New climate.  See Justin Perket (perketj@umich.edu)

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? NA

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: NA

   URL for LMWG diagnostics output used to validate new climate: NA
	
===============================================================
===============================================================
Tag name:  clm4_5_1_r111
Originator(s):  sacks (Bill Sacks)
Date: Fri Jun 12 20:19:25 MDT 2015
One-line Summary: Remove temporary hack to get bfb results in InitSnowLayers

Purpose of changes:

   In order to get bit-for-bit results in clm4_5_1_r110 (relative to r109), we
   put in place a temporary hack in InitSnowLayers that set dz based on the old
   equations rather than the new, more general ones - thus avoiding
   roundoff-level changes. This looked like:

             if (abs(dz(c,0)-3.59_r8) < eps) then ! TODO remove
                col%dz(c, 0) = snow_depth(c)-col%dz(c,-4)-col%dz(c,-3)-col%dz(c,-2)-col%dz(c,-1)
                if (abs(dz(c,0)-3.59_r8) > eps) &
                   call endrun(msg=errmsg(__FILE__, __LINE__))
             endif 

   This tag removes that temporary hack.

   In this way, we have separated the answer-changing from non-answer-changing
   parts of the r110 refactor. Note that the above code confirms that the
   differences are no larger than roundoff (eps was 1e-9 in the above case, but
   some tests showed that it could have been much smaller - e.g., ~ 1e-15).

Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID):

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: self

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

M       components/clm/src/biogeophys/SnowHydrologyMod.F90

CLM testing:

  unit-tests (models/lnd/clm/src):

    yellowstone: ok

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    yellowstone_gnu (clm45 only): ok
    goldbach_nag: ok

CLM tag used for the baseline comparisons: clm4_5_1_r110

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM4.5 / CLM5 cold start
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
         roundoff

   If bitwise differences were observed, how did you show they were no worse
   than roundoff?

      See above code sample, which confirms that the changes were no greater
      than roundoff-level.

===============================================================
===============================================================
Tag name:  clm4_5_1_r110
Originator(s):  sacks (Bill Sacks)
Date: Fri Jun 12 15:30:11 MDT 2015
One-line Summary: Add flexibility to have more snow layers

Purpose of changes:

   Generalize snow code so that it no longer assumes 5 snow layers. Instead,
   make the number of snow layers (and the maximum SWE in the snow pack) a
   runtime parameter, allowing 3 - 12 snow layers.

   Most changes were made by Leo van Kampenhout (l.vankampenhout@uu.nl).

Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID):
   - 2182 (possible threading issue with optimized pgi builds)

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist:
   - new namelist parameters: nlevsno, h2osno_max

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: self

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do:

========= Add tests with different number of snow layers
A       components/clm/cimetest/testmods_dirs/clm/snowlayers_12/user_nl_clm
A       components/clm/cimetest/testmods_dirs/clm/snowlayers_12/include_user_mods
A       components/clm/cimetest/testmods_dirs/clm/snowlayers_12
A       components/clm/cimetest/testmods_dirs/clm/snowlayers_3_monthly/user_nl_clm
A       components/clm/cimetest/testmods_dirs/clm/snowlayers_3_monthly/include_user_mods
A       components/clm/cimetest/testmods_dirs/clm/snowlayers_3_monthly

========= Add unit tests for snow pack initialization (note: these were added
          mainly to facilitate debugging InitSnowLayers; since this routine is
          only used in cold-start, these are not critical unit tests, and can be
          removed if the maintenance cost proves too high)
A       components/clm/src/biogeophys/test/SnowHydrology_test/CMakeLists.txt
A       components/clm/src/biogeophys/test/SnowHydrology_test/README
A       components/clm/src/biogeophys/test/SnowHydrology_test/test_SnowHydrology.pf
A       components/clm/src/biogeophys/test/SnowHydrology_test

List all existing files that have been modified, and describe the changes:

========= Major rework to remove assumption of 5 snow layers - instead allow
          runtime-setable number of snow layers, between 3 and 12.
          Also, clean up white space throughout file, and add mode/indentation
          emacs line.
M       components/clm/src/biogeophys/SnowHydrologyMod.F90

========= Minor changes to remove assumption of 5 snow layers
M       components/clm/src/biogeophys/SurfaceRadiationMod.F90
M       components/clm/src/biogeophys/SoilTemperatureMod.F90
          - also: remove unused variables, fix array argument declarations to
            conform to conventions
M       components/clm/src/main/initVerticalMod.F90
          - also: clean up some white space

========= Add namelist variables to control number of snow layers and maximum SWE
M       components/clm/src/main/clm_varcon.F90
M       components/clm/src/main/clm_varpar.F90
M       components/clm/src/main/controlMod.F90
M       components/clm/bld/namelist_files/namelist_defaults_clm4_5.xml
M       components/clm/bld/namelist_files/namelist_definition_clm4_5.xml
M       components/clm/bld/CLMBuildNamelist.pm

========= Minor changes needed for unit testing of SnowHydrologyMod
M       components/clm/src/biogeophys/CMakeLists.txt
M       components/clm/src/biogeophys/test/CMakeLists.txt
M       components/clm/src/biogeophys/SnowSnicarMod.F90
M       components/clm/src/biogeophys/SnowHydrologyMod.F90
M       components/clm/src/biogeophys/AerosolMod.F90
M       components/clm/src/main/CMakeLists.txt
M       components/clm/src/unit_test_stubs/main/histFileMod_stub.F90

========= Add tests with different number of snow layers
M       components/clm/cimetest/testlist_clm.xml

========= Unrelated change: remove unused variables in associate statements
M       components/clm/src/biogeophys/SoilFluxesMod.F90

========= Remove a test that now passes (hooray for weird compiler bugs!)
M       components/clm/cimetest/ExpectedTestFails.xml

CLM testing:

  build-namelist tests:

    yellowstone: ok
      All CLM45 and CLM50 tests have namelist differences; this is expected due
      to addition of 2 new namelist items.

  unit-tests (models/lnd/clm/src):

    yellowstone: ok

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    yellowstone_gnu (clm45 only): ok
    goldbach_nag: ok

CLM tag used for the baseline comparisons: clm4_5_1_r109

Changes answers relative to baseline: NO
	
===============================================================
===============================================================
Tag name:  clm4_5_1_r109
Originator(s):  sacks (Bill Sacks)
Date: Sat Jun  6 06:12:02 MDT 2015
One-line Summary: Fix bug in DivideSnowLayers

Purpose of changes:

   Fix bug in DivideSnowLayers. Leo van Kampenhout (l.vankampenhout@uu.nl)
   discovered the bug and determined how to fix it. He found this bug in the
   course of refactoring this routine to introduce loops; without this bug fix,
   answers differed with his new logic that removes duplication.

   Specifically: Logic using many IF-statements is employed to see whether or
   not a layer may be subdivided, depending on the layer thickness. Currently,
   the test for subdividing the BOTTOM layer are only reachable when the layer
   above it was also too thick.  As it turns out, this is faulty as a situation
   can arise where the bottom layers grows even though the layer above it was
   not divided, i.e. dumped mass to it.  The current understanding is that this
   happens through meltwater percolation (liquid h2o is translated to thickness
   as well).

   Note that the indentation has not been appropriately corrected, this is because this
   fix is only temporary (less cluttered logic will be implemented next).

Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID): 2183 (incorrect logic for sub-dividing bottom
snow layer in DivideSnowLayers)

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: Mark Flanner

List any svn externals directories updated (cime, rtm, cism, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Bug fix, described above
M       components/clm/src/biogeophys/SnowHydrologyMod.F90

========= Remove failures from here, now that we're using the file in cimetest
M       components/clm/bld/unit_testers/xFail/expectedClmTestFails.xml

========= Change a failure type from FAIL to RUN (presumably due to new test
          reporting)
M       components/clm/cimetest/ExpectedTestFails.xml

CLM testing:

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    yellowstone_gnu (clm45 only): ok
    goldbach_nag: ok

CLM tag used for the baseline comparisons: clm4_5_1_r108

Changes answers relative to baseline: YES

  Summarize any changes to answers, i.e.,
    - what code configurations: All clm4.5 and clm5
    - what platforms/compilers: All
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 

      Larger than roundoff. While not investigated carefully, Leo showed that
      the impacts are relatively small, so this is believed NOT to be
      climate-changing.

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	
===============================================================
===============================================================
Tag name:  clm4_5_1_r108
Originator(s):  andre (Benjamin Andre,UCAR/CSEG,303-497-1391)
Date:  Fri May 29 15:14:26 MDT 2015
One-line Summary: Crop changes from Sam Levis

Purpose of changes: Crop model changes from Sam Levis. Increases the number of
crops to 64, with 78 total pfts. Requires new parameters file, surface dataset,
and land use timeseries files.

Test level of tag: regular

Bugs fixed (include bugzilla ID): 2146, 2155

Known bugs (include bugzilla ID): 2180, 2182
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: n/a

Describe any changes made to the namelist: n/a

List any changes to the defaults for the boundary datasets:
    Regenerate surface data sets and land use timeseries to increase the number of
    pfts and crops with data from Levis. New raw datasets:
        rawdata/pftlanduse.3minx3min.simyr2000.c110913/mksrf_78pft_landuse_rc2000_c130927.nc
        rawdata/pftlandusedyn.0.5x0.5.simyr1850-2005.c090630/mksrf_78pft_landuse_rc2000_c150130.nc

Describe any substantial timing or memory changes:
    Increased memory usage for all crop runs. Exact consequences requires further study.

Code reviewed by: andre, levis

List any svn externals directories updated (cime, rtm, cism, etc.): n/a

List all files eliminated: n/a

List all files added and what they do:
    components/clm/cimetest/ExpectedTestFails.xml - new expected fails file for upcoming cime xfail integration
    components/clm/tools/clm4_5/mksurfdata_map/Makefile.data - automate generating all surface data sets 

List all existing files that have been modified, and describe the changes:
	clm/bld/CLMBuildNamelist.pm - increase max pft, add info to error message, fix quoted empty string processing (bug 2146)
	clm/bld/namelist_files/namelist_defaults_clm4_5.xml - point to new datasets
	clm/bld/namelist_files/namelist_defaults_clm4_5_tools.xml - update rawdata sets
	clm/bld/namelist_files/namelist_definition_clm4_5.xml - update sim year range to avoid special cases for testing
	clm/bld/test_build_namelist/t/test_do_harvest.pm - update test (bug 2146)
	clm/bld/test_build_namelist/t/test_do_transient_crops.pm - update test (bug 2146)
	clm/bld/test_build_namelist/t/test_do_transient_pfts.pm - update test (bug 2146)

	clm/cimetest/testmods_dirs/clm/crop_trans_f10/user_nl_clm - point to new datafiles
	clm/cimetest/testmods_dirs/clm/crop_trans_sville/user_nl_clm - point to new datafiles

	clm/src/biogeophys/WaterStateType.F90 - workaround for pgi compiler bug

	clm/src/biogeochem/CNNDynamicsMod.F90 - new crop model
	clm/src/biogeochem/CNPhenologyMod.F90
	clm/src/biogeochem/CNVegStructUpdateMod.F90
	clm/src/biogeochem/CropType.F90
	clm/src/biogeochem/NutrientCompetitionCLM45defaultMod.F90
	clm/src/biogeochem/VOCEmissionMod.F90
	clm/src/biogeophys/CanopyFluxesMod.F90
	clm/src/biogeophys/PhotosynthesisMod.F90
	clm/src/main/PatchType.F90
	clm/src/main/clm_varpar.F90
	clm/src/main/pftconMod.F90
	clm/src/main/subgridRestMod.F90
	clm/src/main/surfrdMod.F90

	clm/tools/clm4_5/mksurfdata_map/README
	clm/tools/clm4_5/mksurfdata_map/mksurfdata.pl - move file writes into functions. write to __dataset_name__.namelist
	clm/tools/clm4_5/mksurfdata_map/src/mklaiMod.F90 - update for new crops
	clm/tools/clm4_5/mksurfdata_map/src/mkpftConstantsMod.F90
	clm/tools/clm4_5/mksurfdata_map/src/mkpftMod.F90 - update for new crops, fix bug 2155.

	clm/tools/clm4_5/mksurfdata_map/src/mksurfdat.F90 - work around for an issue causing abort during urban dataset generation
	clm/tools/clm4_5/mksurfdata_map/src/mkurbanparMod.F90


CLM testing: regular

	build-namelist tests:

    yellowstone unit tests - ok

  unit-tests (components/clm/src):

    yellowstone_intel - ok

  regular tests (aux_clm40, aux_clm45):

    - yellowstone aux clm40 intel - ok
    - yellowstone aux clm40 pgi - ok
    - yellowstone aux clm45 intel - ok
      - all namelist fail - new datasets and parameters
      - crop - new crop model - baseline failures expected
      - ed - new parameters file - baseline failures expected, ok'd by rfisher
      - ERP_D_Ld5.f19_g16.ICLM45GLCMEC.yellowstone_intel.clm-glcMEC_changeFlags - baseline compare fails, roundoff level, unknown cause, ok'd by sacks
      - ERP_E_Ld5.f19_g16.I1850CRUCLM45CN.yellowstone_intel.clm-default - baseline compare fails, only occurs with esmf - ok'd by mvertens
    - yellowstone aux clm45 gnu - ok
      - all namelist fail - new datasets and parameters
      - crop - new crop model - baseline failures expected
    - yellowstone aux clm45 pgi -
      - all namelist fail - new datasets and parameters
      - crop - new crop model - baseline failures expected
      - ed - new parameters file - baseline failures expected, ok'd by rfisher
      - ERI_D_Ld9.f19_g16.I1850CLM45CN.yellowstone_pgi - roundoff in cpl baseline
      - ERI_D_Ld9.f19_g16.I1850CLM45CN.yellowstone_pgi.clm-drydepnomegan - roundoff in baseline
      - ERP_P15x2_Lm13.f10_f10.IHISTCLM45BGC.yellowstone_pgi.clm-monthly - new xfail, #2182, dies at runtime in optimized, threaded pgi builds only.
    - yellowstone mksurfdata_map unit_testers - ok
    - yellowstone tools tests - ok, known issues with PTCLMmkdata (bug 2180)

CLM tag used for the baseline comparisons: clm4_5_1_r106 (bit for bit with clm4_5_1_r107)

Changes answers relative to baseline: yes

  Summarize any changes to answers, i.e.,
    - what code configurations: crop, ed
    - what platforms/compilers: all
    - nature of change : answer changes updated crop model. approved by levis.

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - simulations with all pfts everywhere were run with merged code. Levis compared current runs with his archived runs.


===============================================================
===============================================================
Tag name:  clm4_5_1_r107
Originator(s):  andre (Benjamin Andre,UCAR/CSEG,303-497-1391)
Date:  Tue May 19 10:05:49 MDT 2015
One-line Summary: Update externals to use github version of cime1.0.7.

Purpose of changes: Switch the cime external from using svn to github. Update cime to cime1.0.7.

Test level of tag: regular

Bugs fixed (include bugzilla ID): N/A

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: N/A

Describe any changes made to the namelist: N/A

List any changes to the defaults for the boundary datasets: N/A

Describe any substantial timing or memory changes: N/A

Code reviewed by: self

List any svn externals directories updated (cime, rtm, cism, etc.): cime 1.0.7

List all files eliminated: N/A

List all files added and what they do: N/A

List all existing files that have been modified, and describe the changes: N/A

CLM testing: regular

  build-namelist tests:
    unit-tests: ok
    system-tests: not run

  unit-tests (models/lnd/clm/src):
    yellowstone: ok

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel 40 - ok; 45 - ok
    yellowstone_pgi 40 - ok; 45 - ok
    yellowstone_gnu (clm45 only) 45 - ok

CLM tag used for the baseline comparisons: clm4_5_1_r106

Changes answers relative to baseline: none


===============================================================
===============================================================
Tag name:  clm4_5_1_r106
Originator(s):  erik/fvitt
Date: Thu May 14 13:22:51 MDT 2015
One-line Summary: Fix CO2 forcing for MEGAN

Purpose of changes:

Bring in changes from Francis Vitt, and Louisa Emmons to correct CO2 forcing
for MEGAN and dry-deposition. Previously, the fixed value of CO2 was being used
rather than using the CO2 forcing sent in from the atmosphere model.

Also fix some issues with clm4_0 code where some urban diagnostic fields have
a different fill-value pattern on restart from startup. Fill-value is now only
set over non-land, and areas without urban, are set to zero.

+M    models/lnd/clm/src_clm40/biogeochem/VOCEmissionMod.F90
+ - use time-dependent atmospheric CO2 concentrations rather than
+   the CCSM_CO2_PPMV constant value
+
+M    models/lnd/clm/src_clm40/biogeochem/DryDepVelocity.F90
+ - science updates and bug fixes provided by Maria Val Martin
+
+M    models/lnd/clm/src/biogeochem/VOCEmissionMod.F90
+ - use time-dependent atmospheric CO2 concentrations rather than
+   the CCSM_CO2_PPMV constant value
+ - use 10-day average of LAI rather than 1-day average
+
+M    models/lnd/clm/src/biogeochem/DryDepVelocity.F90
+ - science updates and bug fixes provided by Maria Val Martin
+
+M    models/lnd/clm/src/biogeophys/CanopyStateType.F90
+ - get 10-day average of LAI rather than 1-day average

Requirements for tag: Fix 2177 and some 2165 clm40 tests

Test level of tag: regular

Bugs fixed (include bugzilla ID):
     2177 (MEGAN improperly uses constant CO2 rather than time varying)
     2176 (ED doesn't work with MEGAN -- partial just turn MEGAN off when ED on)
     2165 (some clm40 tests have history files differ on restart in urban fillvalue)

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: None

Describe any changes made to the namelist: Turn MEGAN off when ED on
    Have build-namelist make sure MEGAN is off when ED is on

List any changes to the defaults for the boundary datasets: None

Describe any substantial timing or memory changes: None

Code reviewed by: self,fvitt,simone,emmons

List any svn externals directories updated (cime, rtm, cism, etc.): cime, cism
    cime   up to cime0_3_21 (bring in optional orbital calculation)
    cism   up to cism2_0_09 (just bring the branch to the trunk)

List all files eliminated: None

List all files added and what they do: Turn MEGAN off for ED tests

A    components/clm/cimetest/testmods_dirs/clm/edTest/shell_commands

List all existing files that have been modified, and describe the changes:

   M  components/clm/src_clm40/biogeophys/UrbanInitMod.F90 -- Initialize to
         zero over land
   M  components/clm/src_clm40/main/clm_initializeMod.F90 --- Call urbanInit
         before reading restart files
   M  components/clm/src_clm40/main/accFldsMod.F90 ---------- Change running mean
         from 1 day to 10 days
   M  components/clm/src_clm40/main/clmtypeInitMod.F90 ------ Initilize to spval

   M  components/clm/src_clm40/biogeochem/VOCEmissionMod.F90
+ - use time-dependent atmospheric CO2 concentrations rather than
+   the CCSM_CO2_PPMV constant value
+ - use 10-day average of LAI rather than 1-day average
   M  components/clm/src_clm40/biogeochem/DryDepVelocity.F90
+ - science updates and bug fixes provided by Maria Val Martin

   M  components/clm/src/biogeochem/VOCEmissionMod.F90
+ - use time-dependent atmospheric CO2 concentrations rather than
+   the CCSM_CO2_PPMV constant value
+ - use 10-day average of LAI rather than 1-day average
   M  components/clm/src/biogeochem/DryDepVelocity.F90
+ - science updates and bug fixes provided by Maria Val Martin
   M  components/clm/src/biogeophys/CanopyStateType.F90
+ - get 10-day average of LAI rather than 1-day average

   M  README_cime --- Update documentation

   M  components/clm/bld/CLMBuildNamelist.pm -- Check that MEGAN off when ED on
   M  components/clm/bld/unit_testers/build-namelist_test.pl - Add check for
         MEGAN off when ED on
   M  components/clm/bld/clm.buildnml --- only copy drv_flds_in over if it
         was actually created.

   M  components/clm/tools/README ---- Have documentation point to gen_domain
        under cime/tools/mapping

CLM testing: regular

  build-namelist tests:

    yellowstone  yes

  unit-tests (models/lnd/clm/src):

    yellowstone  yes

  regular tests (aux_clm40, aux_clm45):

    yellowstone_intel  yes
    yellowstone_pgi    yes
    yellowstone_gnu    yes
    goldbach_nag       yes
    goldbach_intel     yes
    goldbach_pgi       yes

CLM tag used for the baseline comparisons:  clm4_5_1_r105

Changes answers relative to baseline:  Yes -- MEGAN diagnostic fields only!
    as well as dry-deposition because of science update

  Summarize any changes to answers, i.e.,
    - what code configurations: All with MEGAN on
    - what platforms/compilers: All
    - nature of change: Diagnostic fields change

    VOC emissions change 

===============================================================
===============================================================
Tag name:  clm4_5_1_r105
Originator(s):  erik (Erik)
Date: Thu Apr 16 13:23:19 MDT 2015
One-line Summary: Move test lists to beneath active components, change build scripts from cshell 
                  to perl, move to new cime directory structure

Purpose of changes:

   * Move CESM test lists from under scripts to under active components.
      Now clm and rtm have their own CESM test lists under their "cimetest" directory.
   * Change build scripts from cshell to perl
      cshell is buggy with arbitrary problems with line lengths and number of arguments
      cshell doesn't allow long scripts to be broken up into subroutine -- perl does
:::::::::: Get unit-testing working with directory structure change
 M     src/CMakeLists.txt
 M     src/README.unit_testing

:::::::::: Get tools testing working with directory structure change
 M     test/tools/TBLtools.sh
 M     test/tools/TSMCFGtools.sh
 M     test/tools/TSMscript_tools.sh
 M     test/tools/TCBCFGtools.sh
 M     test/tools/TCBscripttools.sh
 M     test/tools/TSMncl_tools.sh
 M     test/tools/TBLCFGtools.sh
 M     test/tools/TSMtools.sh
 M     test/tools/TBLscript_tools.sh
 M     test/tools/TCBtools.sh
 M     test/tools/test_driver.sh

:::::::::: Get tools working with directory structure change
 M     tools/clm4_0/mksurfdata_map/mksurfdata.pl
 M     tools/clm4_5/mksurfdata_map/mksurfdata.pl
 M     tools/shared/ncl_scripts/getco2_historical.ncl

:::::::::: Updates to build
 M     bld/CLMBuildNamelist.pm
 M     bld/configure
 M     bld/queryDefaultNamelist.pl
 M     bld/listDefaultNamelist.pl
 M     bld/unit_testers/xFail/wrapClmTests.pl
 M     bld/unit_testers/xFail/expectedFail.pm
 M     bld/test_build_namelist/test_build_namelist.pl
 M     bld/namelist_files/checkmapfiles.ncl
 M     bld/namelist_files/namelist_definition.xsl

:::::::::: Updates to documentation with new directory structure
 M     doc/README
 M     doc/UsersGuide/co2_streams.txt
 M     doc/Quickstart.userdatasets
 M     doc/Quickstart.GUIDE
 M     doc/KnownLimitations
 M     tools/README
 M     tools/README.filecopies
 M     tools/clm4_0/interpinic/README
 M     tools/clm4_0/mksurfdata_map/README
 M     tools/clm4_5/refactorTools/associate/README
 M     tools/clm4_5/refactorTools/clmType/README
 M     tools/clm4_5/mksurfdata_map/README
 M     tools/shared/mkmapgrids/README
 M     tools/shared/mkmapdata/README
 M     tools/shared/mkprocdata_map/README
 M     tools/shared/ncl_scripts/README
 M     tools/README.testing
 M     bld/README

CLM testing:

  build-namelist tests:

    yellowstone    yes

  unit-tests (models/lnd/clm/src):

    yellowstone    yes

  regular tests (aux_clm40, aux_clm45, and aux_clm_short):

    yellowstone_intel yes
    yellowstone_pgi   yes
    yellowstone_gnu   yes
    goldbach_nag      yes
    goldbach_intel    yes
    goldbach_pgi      yes

CLM tag used for the baseline comparisons:  clm4_5_1_r104

Changes answers relative to baseline:

===============================================================
===============================================================
Tag name:  clm4_5_1_r104
Originator(s):  erik (Erik)
Date: Tue Jan 27 11:22:48 MST 2015
One-line Summary: Update externals to latest cesm beta tag + bring in shared build for clm4_5/clm5_0 for testing

Purpose of changes:

* Update externals to cesm1_3_beta15+ shared clm4_5/clm5_0 library build for testing.
* Fix BG1850CN @ f09 by changing fglcmask (Bill Sacks)
* Update more prealpha/prebeta tests to test with clm4_5
* Create datasets for clm4_5 at ne16 and ne120 resolution
  (for ne120 create rcp8.5 and rcp4.5 transient datasets)
   M models/lnd/clm/src/cpl/lnd_comp_mct.F90 ----------- Add only for lnd_import_export use statement

------------ Change so sample subsetting uses the high resolution datasets
   M models/lnd/clm/tools/shared/ncl_scripts/README.getregional
   M models/lnd/clm/tools/shared/ncl_scripts/sample_inlist
   M models/lnd/clm/tools/shared/ncl_scripts/sample_outlist

CLM testing:

  build-namelist tests:

    yellowstone   yes

  unit-tests (models/lnd/clm/src):

    yellowstone   yes

  tools testing:

    yellowstone   yes

  regular tests (aux_clm40, aux_clm45, with '-model_gen_comp clm2'):

    yellowstone_intel              yes
    yellowstone_pgi                yes
    yellowstone_gnu (clm45 only)   yes
    goldbach_nag                   yes
    goldbach_intel                 yes
    goldbach_pgi                   yes

CLM tag used for the baseline comparisons:  clm4_5_1_r103

Changes answers relative to baseline: YES!

  Summarize any changes to answers, i.e.,
    - what code configurations: all
    - what platforms/compilers: time-change all, roundoff-intel
    - nature of change: roundoff

    Small change in driver changes time-stamps on history files by roundoff (drvseq5_1_05). 
    Normal cprnc comparison then does NOT compare fields and calls files different. Changes 
    in the intel build (on yellowstone) change answers to roundoff for intel on yellowstone 
    (Machines update between Machines_141125 and Machines_150106a causes answers to change)
	
===============================================================
===============================================================
Tag name:  clm4_5_1_r103
Originator(s):  sacks (Bill Sacks)
Date: Thu Jan  1 06:15:57 MST 2015
One-line Summary: enable transient crops

Purpose of changes:

(1) Allow transient crops! Note that carbon and nitrogen conservation still is
    not done, but this at least allows crop areas to evolve in time.

(2) Add control flags for which pieces of the transient dynamics should be done:
    transient natural PFTs, transient crops, and/or harvest.

(3) Reworked both source code and unit tests to be able to use the true CLM time
    manager in unit tests rather than a stub version. Also added functionality
    to time_info_type to be able to take the date from the end of the current
    time step or the beginning of the time step. This flexibility was needed
    because: (a) for crops, with an annual update, I wanted the update time to
    be consistent with the glacier update time: the first time step after
    crossing the year boundary (so take time from the start of the time step);
    (b) for transient PFTs and harvest, for consistency with what was being done
    before, we need to take the time from the end of the time step.

(4) Make CNBalanceCheck more modular and object-oriented. Also, bypass the
    balance check for newly-active columns, which is needed to avoid balance
    check errors with transient crops.


Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID):

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: New control flags that control which
aspects of transient subgrid dynamics (and harvest) are turned on/off. This lets
you turn on/off transient natural PFTs, transient crops, and/or harvest
independently.

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: some pieces reviewed by Erik

   scripts: append_nl_value_n03_scripts4_141201 -> append_nl_value_n07_scripts4_141201
   esmf_wrf_timemgr: esmf_wrf_timemgr_141028 -> esmf_wrf_timemgr_141217

List all files eliminated:

========= No longer use stub time manager - use true time manager instead
D       models/lnd/clm/src/unit_test_stubs/utils/clm_time_manager_stub.F90

List all files added and what they do:

========= Add transient crops
A       models/lnd/clm/src/dyn_subgrid/dyncropFileMod.F90

========= Reads and stores namelist items controlling transient dynamics. This
          allows turning off select pieces of the transient subgrid behavior.
A       models/lnd/clm/src/dyn_subgrid/dynSubgridControlMod.F90

========= Add unit test utilities that wrap the clm time manager
A       models/lnd/clm/src/unit_test_shr/unittestTimeManagerMod.F90

========= Start adding unit tests for the clm time manager
A       models/lnd/clm/src/utils/test/clm_time_manager_test/test_clm_time_manager.pf
A       models/lnd/clm/src/utils/test/clm_time_manager_test/CMakeLists.txt
A       models/lnd/clm/src/utils/test/clm_time_manager_test
A       models/lnd/clm/src/utils/test/CMakeLists.txt
A       models/lnd/clm/src/utils/test

========= Test logic for new control flags
A       models/lnd/clm/bld/test_build_namelist/t/test_do_transient_pfts.pm
A       models/lnd/clm/bld/test_build_namelist/t/test_do_harvest.pm
A       models/lnd/clm/bld/test_build_namelist/t/test_do_transient_crops.pm

List all existing files that have been modified, and describe the changes:

========= Reworked both source code and unit tests to be able to use the true
          CLM time manager in unit tests rather than a stub version. Also added
          functionality to time_info_type to be able to take the date from the
          end of the current time step or the beginning of the time step. Note
          that some unit test builds now need to link against the
          esmf_wrf_timemgr library, if they use the time manager either directly
          or indirectly.
M       models/lnd/clm/src/utils/clm_time_manager.F90
M       models/lnd/clm/src/dyn_subgrid/dynTimeInfoMod.F90
M       models/lnd/clm/src/dyn_subgrid/dynVarTimeInterpMod.F90.in
M       models/lnd/clm/src/dyn_subgrid/dynVarTimeInterpMod.F90
M       models/lnd/clm/src/dyn_subgrid/dynFileMod.F90
M       models/lnd/clm/src/unit_test_stubs/dyn_subgrid/dynFileMod_stub.F90
M       models/lnd/clm/src/unit_test_stubs/utils/CMakeLists.txt
M       models/lnd/clm/src/CMakeLists.txt
M       models/lnd/clm/src/unit_test_shr/CMakeLists.txt
M       models/lnd/clm/src/dyn_subgrid/test/dynTimeInfo_test/test_dynTimeInfo.pf
M       models/lnd/clm/src/dyn_subgrid/test/dynTimeInfo_test/CMakeLists.txt
M       models/lnd/clm/src/dyn_subgrid/test/dynVar_test/test_dynVarShared.F90
M       models/lnd/clm/src/dyn_subgrid/test/dynVar_test/test_dynVarTimeInterp.pf
M       models/lnd/clm/src/dyn_subgrid/test/dynVar_test/test_dynVarTimeUninterp.pf
M       models/lnd/clm/src/dyn_subgrid/test/dynVar_test/CMakeLists.txt
M       models/lnd/clm/src/biogeophys/test/Daylength_test/CMakeLists.txt
M       models/lnd/clm/src/biogeophys/test/Irrigation_test/CMakeLists.txt
M       models/lnd/clm/src/utils/CMakeLists.txt

========= Changes related to new control flags, as well as the rework of the
          time_info%set_current_year interface
M       models/lnd/clm/src/dyn_subgrid/dynpftFileMod.F90
M       models/lnd/clm/src/dyn_subgrid/dynHarvestMod.F90

========= Changes related to new control flags and addition of transient crops
M       models/lnd/clm/src/dyn_subgrid/dynSubgridDriverMod.F90

========= Moved flanduse_timeseries and other control flags into dynSubgridControlMod
M       models/lnd/clm/src/main/clm_varctl.F90
M       models/lnd/clm/src/main/controlMod.F90
M       models/lnd/clm/src/main/restFileMod.F90
M       models/lnd/clm/src/main/subgridRestMod.F90
M       models/lnd/clm/src/main/clm_varpar.F90
M       models/lnd/clm/src/biogeochem/CNDriverMod.F90
M       models/lnd/clm/src/biogeochem/CNFireMod.F90

========= Make CNBalanceCheck more modular and object-oriented
M       models/lnd/clm/src/biogeochem/CNBalanceCheckMod.F90
          - also, bypass balance checks for newly-active columns (needed to
            avoid balance check errors for newly-active crop columns)
M       models/lnd/clm/src/biogeochem/CNVegNitrogenStateType.F90
M       models/lnd/clm/src/biogeochem/CNVegCarbonStateType.F90
M       models/lnd/clm/src/main/clm_instMod.F90
M       models/lnd/clm/src/main/clm_driver.F90
          - also make alt_calc operate over inactive as well as active points

========= Added new control flags
M       models/lnd/clm/bld/CLMBuildNamelist.pm
M       models/lnd/clm/bld/namelist_files/namelist_definition_clm4_5.xml

========= Make test files (more) consistent with actual files. This may not have
          been necessary.
M       models/lnd/clm/bld/test_build_namelist/t/input/namelist_defaults_clm4_5_test.xml
M       models/lnd/clm/bld/test_build_namelist/t/input/namelist_definition_clm4_5_test.xml

========= Minor changes (e.g., changes to comments and other small changes)
M       models/lnd/clm/src/unit_test_stubs/utils/spmdMod_stub.F90
M       models/lnd/clm/src/dyn_subgrid/do_genf90
M       models/lnd/clm/src/dyn_subgrid/dynVarTimeUninterpMod.F90
M       models/lnd/clm/src/dyn_subgrid/dynVarMod.F90
M       models/lnd/clm/src/soilbiogeochem/SoilBiogeochemVerticalProfileMod.F90
M       models/lnd/clm/src/biogeophys/ActiveLayerMod.F90


CLM testing:

  build-namelist tests:

    yellowstone: ok

      Note that there are differences from baseline due to new control flags

  unit-tests (models/lnd/clm/src):

    yellowstone: ok

  regular tests (aux_clm40, aux_clm45, with '-model_gen_comp clm2'):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    yellowstone_gnu (clm45 only): ok
    goldbach_nag: ok

CLM tag used for the baseline comparisons: clm4_5_1_r102

Changes answers relative to baseline: NO

===============================================================
===============================================================
Tag name:  clm4_5_1_r102
Originator(s):  sacks (Bill Sacks)
Date: Sat Dec 27 06:52:20 MST 2014
One-line Summary: make new input datasets to support transient crops

Purpose of changes:

While the main purpose of this tag was to make new input datasets to support
transient crops, it also includes a number of reworks of mksurfdata_map, which
were either central or tangential to this overall goal. Specifically:

(1) Update mksurfdata_map to be able to generate datasets with transient
    crops. Currently the logic uses the non-prognostic-crop raw data for the
    transient time series: It takes the area of the generic crop from that
    timeseries to specify the transient PCT_CROP area, and sets the PCT_CFT
    areas based on the year-2000 areas.

(2) Rewrite mksurfdata_map code that normalizes pct_pft to account for special
    landunits. The code to handle urban was very confusing, and I hope this new
    code is at least astep towards being less confusing. Note that this
    introduces roundoff-level differences.

(3) Introduce new mksurfdata_map utility routines: ncd_def_spatial_var and
    ncd_put_time_slice. These encapsulate behavior that used to be duplicated in
    the code.

(4) Add mksurfdata_map unit tests using the new pfunit-based unit testing
    framework. However, I have NOT done a full migration of the mksurfdata_map
    unit tests. Thus, there are still some tests that use the old unit testing
    framework that I put in place (which leveraged the test stuff that Erik set
    up for csm_share a while ago). These tests can be migrated to pfunit
    incrementally: as someone touches code that is under test using the old
    framework, they could move the relevant tests into the new pfunit-based
    framework.

(5) Create new input datasets, based on the above changes:

    - new flanduse_timeseries files created because I have changed the
      information on these files

    - new surface datasets created because I introduced roundoff-level changes
      in the surface datasets, and so regenerated all surface datasets now in
      order to save someone a headache later.

    - new initial conditions files created so that out-of-the-box initial
      conditions will be compatible with the surface datasets, according to
      various consistency checks.

    See the following files in inputdata for documentation of how the new
    datasets were created:

    lnd/clm2/surfdata_map/README_c141219
    lnd/clm2/initdata_map/README_c141226

Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID):

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist:
- new surface datasets
- new flanduse_timeseries files
- new initial conditions files

List any changes to the defaults for the boundary datasets:
- new surface datasets
- new flanduse_timeseries files
- new initial conditions files

Describe any substantial timing or memory changes: none

Code reviewed by: Most changes sent to Erik for review, although I can't
remember how much he actually reviewed.

List any svn externals directories updated (csm_share, mct, etc.):

  scripts: append_nl_value_n02_scripts4_141201 -> append_nl_value_n03_scripts4_141201
  - point tropicAtl_subset tests to new file

List all files eliminated:

========= Move tests elsewhere
D       models/lnd/clm/tools/clm4_5/mksurfdata_map/unit_testers/test_mkpftMod.F90


List all files added and what they do:

========= New object-oriented class for storing and operating on pct_pft
          data. Encapsulating a bunch of behavior in here allowed me to simplify
          other code. Before this, I was keeping track of two separate
          representations of pct_pft: First it was stored as % of grid cell,
          then it was later converted into % of landunit together with the
          landunit's % of grid cell. This was starting to get hard to manage,
          because certain operations could only be done on the first
          representation, and other operations could only be done on the second
          representation  and at some point in the processing pipeline, the
          conversion happened and the first representation was no longer
          usable. Now there is a single representation, and the class allows any
          desired operation to be performed on that single representation. This
          adds some complexity within the class, but removes complexity from the
          rest of the code, particularly mksurfdat.F90.
A       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/mkpctPftTypeMod.F90

========= This new module contains routines that operate on both instances of
          pct_pft_type (pctnatpft and pctcft) at once. Thus, this contains
          higher-level logic than was appropriate for mkpctPftTypeMod. Yet, I
          wanted these routines in a separate module from mkpftMod as an aid to
          testing, since mkpftMod has a bunch of dependencies.
A       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/mkpftUtilsMod.F90

========= Moved constants from other places into here, partly to centralize
          them, and partly to remove problems with circular dependencies
A       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/mkpftConstantsMod.F90

========= Add automated test of making a transient crop surface dataset
A       models/lnd/clm/test/tools/nl_files/mksrfdt_10x15_crp_1850-2000

========= Add input file for creating a transient smallville dataset for testing
          transient crops
A       models/lnd/clm/tools/clm4_5/mksurfdata_map/single_point_dynpft_files/README.landuse_timeseries_smallvilleIA_hist_simyr1850-1855
A       models/lnd/clm/tools/clm4_5/mksurfdata_map/single_point_dynpft_files/landuse_timeseries_smallvilleIA_hist_simyr1850-1855.txt
A       models/lnd/clm/tools/clm4_5/mksurfdata_map/single_point_dynpft_files/README
A       models/lnd/clm/tools/clm4_5/mksurfdata_map/single_point_dynpft_files

========= Add pfunit-based unit tests for mksurfdata_map
A       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/CMakeLists.txt
A       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/test/mkpftUtils_test/test_adjust_total_veg_area.pf
A       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/test/mkpftUtils_test/CMakeLists.txt
A       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/test/mkpftUtils_test/test_convert_from_p2g.pf
A       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/test/mkpftUtils_test
A       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/test/mkpctPftType_test/CMakeLists.txt
A       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/test/mkpctPftType_test/test_mkpctPftType.pf
A       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/test/mkpctPftType_test
A       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/test/CMakeLists.txt
A       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/test
A       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/README.unit_testing


List all existing files that have been modified, and describe the changes:

========= Changes that take advantage of some of the other refactoring described
          here, plus add logic to allow input dataset to not contain crops even
          when generating a transient dataset for crops; also add PCT_CROP and
          PCT_CFT on the landuse_timeseries output file
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/mkpftMod.F90

========= Changes that take advantage of some of the other refactoring described
          here, especially making use of the new pct_pft_type methods. Plus: (a)
          save pctcft from the initial input file so it can be used when
          generating landuse_timeseries, (b) remove unwanted landunit percents
          from the landuse_timeseries file, (c) add transient PCT_CROP and
          PCT_CFT, (d) complete rewrite of the code that normalizes pct_pft to
          account for special landunits: the code to handle urban was very
          confusing, and I hope this new code is at least a step towards being
          less confusing [this change introduces roundoff-level differences],
          (e) remove some error-checking code that is now embedded in the
          pct_pft_type routines
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/mksurfdat.F90

========= Updated for new files
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/Srcfiles

========= Added two new routines: ncd_def_spatial_var and
          ncd_put_time_slice. These encapsulate behavior that used to be
          duplicated in the code. Also, moved convert_latlon from mkutilsMod to
          here, since it is really related to netcdf stuff.
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/mkncdio.F90

========= Simplify this module significantly by using the new
          ncd_def_spatial_var. Also change what fields are present on the
          transient landuse file: remove some no-longer-desired fields (% of
          special landunits, etc.).
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/mkfileMod.F90

========= Use new ncd_def_spatial_var
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/mksoilMod.F90

========= Delete routines that have been moved to a more appropriate place
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/mkutilsMod.F90

========= Remove tests from old test framework for code that I have deleted or
          migrated to my new modules; and fix some minor errors that appeared
          when runnng the old unit tests with gfortran.
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/unit_testers/test_mkchecksMod.F90
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/unit_testers/test_mkutilsMod.F90
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/unit_testers/test_mkgridmapMod.F90
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/unit_testers/Srcfiles
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/unit_testers/test_mksurfdata_map.F90
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/unit_testers/test_mkdomainMod.F90

========= Trivial changes (change 'use' statements to reflect migrated code, add
          comments, etc.)
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/mklaiMod.F90
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/mkdomainMod.F90
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/mkurbanparMod.F90
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/mkgridmapMod.F90

========= Add logic needed for creating transient crop datasets. The main
          differences are (a) for crop, we create a year-2000 surface dataset
          together with the transient dataset (rather than a year-1850 surface
          dataset), and (b) we always use the non-crop transient raw data, even
          when creating a transient crop dataset.
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/mksurfdata.pl

========= New fsurdat, flanduse_timeseries and finidat files
M       models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_5.xml

========= Add automated test of making a transient crop surface dataset
M       models/lnd/clm/test/tools/input_tests_master
M       models/lnd/clm/test/tools/tests_pretag_yellowstone_nompi


CLM testing:

  build-namelist tests:

    yellowstone: ok

  tools tests:

    yellowstone: ok

    Note that there were diffs in baseline comparisons for mksurfdata_map tests
    (and the PTCLM test, which uses mksurfdata_map). See below for details

  regular tests (aux_clm40, aux_clm45, with '-model_gen_comp clm2'):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    yellowstone_gnu (clm45 only): ok
    goldbach_nag: ok

CLM tag used for the baseline comparisons: clm4_5_1_r101

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: most clm4_5 runs
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      roundoff

   If bitwise differences were observed, how did you show they were no worse
   than roundoff?

     Note that there were no source code changes in this tag, so the only
     differences come from differences in datasets (fsurdat,
     flanduse_timeseries, finidat).

     I confirmed that differences in fsurdat and flanduse_timeseries are
     generally roundoff-level. There are greater than roundoff-level diffs in
     PCT_NAT_PFT at a small number of points, but all of these points have
     PCT_NATVEG = 0 (this is due to a fix in how PCT_NAT_PFT is determined for
     points with 0% vegetated landunit, and > 0% urban); this would only affect
     dynamic landunit runs. Other than that, max normalized RMS diffs are 2e-8,
     and most are considerbly smaller.

     finidat files were created as one-offs to ensure that the only differences
     are in the subgrid weights, arising from these surface dataset differences.

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	
===============================================================
===============================================================
Tag name:  clm4_5_1_r101
Originator(s):  sacks (Bill Sacks)
Date: Tue Dec  9 06:27:39 MST 2014
One-line Summary: rework cold start initialization for transient runs

Purpose of changes:

  (1) Do not adjust subgrid weights (or set harvest variables) in cold start
      initialization. Instead, wait to do this until the first run step. The
      motivation for this is (a) this is consistent with what is done for
      glacier (for which prognostic weights aren't available until the run
      phase), and (b) it simplifies what needs to be done in initialization,
      particularly for transient crops (which are coming soon).

  (2) Do not run the biogeophys & biogeochem dyn subgrid conservation code in
      the first step of a cold start run. This affects the current operation of
      glacier, and is important in conjunction with (1): this avoids doing a
      large adjustment of physics or BGC caused by a fictitious change in area
      in the first time step after cold start.

Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID):

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: mvertens reviewed conceptual changes to clm_time_manager and
  DaylengthMod; other changes only reviewed by self

List any svn externals directories updated (csm_share, mct, etc.): none

List all files eliminated:

List all files added and what they do:

List all existing files that have been modified, and describe the changes:

========= Main changes, as documented above
M       models/lnd/clm/src/main/clm_initializeMod.F90
M       models/lnd/clm/src/main/clm_varctl.F90
M       models/lnd/clm/src/dyn_subgrid/dynSubgridDriverMod.F90
M       models/lnd/clm/src/dyn_subgrid/dynHarvestMod.F90
M       models/lnd/clm/src/dyn_subgrid/dynConsBiogeochemMod.F90
M       models/lnd/clm/src/dyn_subgrid/dynpftFileMod.F90
M       models/lnd/clm/src/dyn_subgrid/dynConsBiogeophysMod.F90

========= Unrelated change: Fix a possible threading bug in DaylengthMod
          (although this would rarely cause problems: I think this would only
          cause a problem if you started / restarted exactly on the solstice)
M       models/lnd/clm/src/utils/clm_time_manager.F90
M       models/lnd/clm/src/biogeophys/DaylengthMod.F90



CLM testing:

  unit-tests (models/lnd/clm/src):

    yellowstone: ok

  regular tests (aux_clm40, aux_clm45, with '-model_gen_comp clm2'):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    yellowstone_gnu (clm45 only): ok
    goldbach_nag: ok

CLM tag used for the baseline comparisons: clm4_5_1_r100

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM4.5 cold start runs with glacier and/or
  transient PFTs
    - what platforms/compilers: ALL
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      
      Changes answers only in initialization. This shows up as changes in the
      fields set to the coupler in initialization, and/or changes in the initial
      history file. In offline runs (I compsets), this change does not affect
      the simulation beyond initialization, but it is expected to change the
      evolution of the system in coupled runs. However, again note that this
      only affects cold start runs wth glacier and/or transient PFTs, which
      would not be typical for production runs.


   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	
===============================================================
===============================================================
Tag name:  clm4_5_1_r100
Originator(s):  sacks (Bill Sacks); most changes from Jim Edwards
Date: Wed Dec  3 06:21:13 MST 2014
One-line Summary: update pio calls to pio2 API

Purpose of changes:

   Update pio calls to the pio2 API, so that the transition to pio2 will be
   seamless. Most changes were from Jim Edwards. There are also some other minor
   changes that are unrelated to this main change, as noted below.

Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID):

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: sacks

List any svn externals directories updated (csm_share, mct, etc.):
  
  pio: pio1_8_13 -> pio1_9_5

List all files eliminated:

List all files added and what they do:

List all existing files that have been modified, and describe the changes:

========= Main changes needed for pio2 API
M       models/lnd/clm/src_clm40/main/ncdio_pio.F90
M       models/lnd/clm/src_clm40/main/ncdio_pio.F90.in
M       models/lnd/clm/src/main/ncdio_pio.F90
M       models/lnd/clm/src/main/ncdio_pio.F90.in

========= Change 2-d array to 1-d. Jim says he thinks this was also needed for
          pio2 support.
M       models/lnd/clm/src_clm40/main/histFileMod.F90
M       models/lnd/clm/src/main/histFileMod.F90

========= Unrelated change: change len to len_trim. Jim says this was needed to
          fix a problem on some machine.
M       models/lnd/clm/src_clm40/biogeochem/MEGANFactorsMod.F90
M       models/lnd/clm/src/biogeochem/MEGANFactorsMod.F90


CLM testing:

  unit-tests (models/lnd/clm/src):

    yellowstone: ok

  regular tests (aux_clm40, aux_clm45, with '-model_gen_comp clm2'):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    yellowstone_gnu (clm45 only): ok
    goldbach_nag: ok

CLM tag used for the baseline comparisons: clm4_5_1_r099

Changes answers relative to baseline: NO
	
===============================================================
===============================================================
Tag name:  clm4_5_1_r099
Originator(s):  sacks (Bill Sacks)
Date: Tue Dec  2 15:05:09 MST 2014
One-line Summary: add ozone stress code from Danica Lombardozzi

Purpose of changes:

(1) Implement ozone stress. The scientific implementation was done by Danica
    Lombardozzi. The software reimplementation was done by Bill Sacks.

(2) Fix some misc. bugs, including a restart bug that was introduced in r097.

Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID):
- 2091: some restarts not bit-for-bit starting in clm4_5_1_r097
- 2029: Memory leak in GetGlobalValuesMod

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/
- 2094: ozone code doesn't work with the PGI compiler

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: new namelist option, use_ozone

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: ozone changes reviewed by Danica Lombardozzi (she reviewed
both the code and the changes seen due to ozone in a short simulation)

List any svn externals directories updated (csm_share, mct, etc.):

  scripts: append_nl_value_n02_scripts4_141129 -> append_nl_value_n02_scripts4_141201

List all files eliminated:

List all files added and what they do:

========= Implement ozone stress. Uses polymorphism to handle ozone-on vs. ozone-off.
A       models/lnd/clm/src/biogeophys/OzoneFactoryMod.F90
A       models/lnd/clm/src/biogeophys/OzoneOffMod.F90
A       models/lnd/clm/src/biogeophys/OzoneBaseMod.F90
A       models/lnd/clm/src/biogeophys/OzoneMod.F90

List all existing files that have been modified, and describe the changes:

========= Calculate and apply ozone stress
M       models/lnd/clm/src/biogeophys/PhotosynthesisMod.F90
M       models/lnd/clm/src/biogeophys/CanopyFluxesMod.F90
M       models/lnd/clm/src/main/clm_instMod.F90
          - also fix restart bug (bug 2091)
M       models/lnd/clm/src/main/clm_driver.F90

========= Add namelist flag to turn ozone on
M       models/lnd/clm/bld/namelist_files/namelist_definition_clm4_5.xml
M       models/lnd/clm/src/main/clm_varctl.F90
M       models/lnd/clm/src/main/controlMod.F90

========= Fix memory leak (bug 2029)
M       models/lnd/clm/src/main/GetGlobalValuesMod.F90
M       models/lnd/clm/src_clm40/main/GetGlobalValuesMod.F90
M       models/lnd/clm/src/ED/main/EDRestVectorMod.F90

========= Workarounds for compiler bugs
M       models/lnd/clm/src/biogeochem/CNDVType.F90
M       models/lnd/clm/src/biogeochem/CNDriverMod.F90

========= Improve documentation comments for compiler bug workarounds
M       models/lnd/clm/src/biogeophys/IrrigationMod.F90
M       models/lnd/clm/src/dyn_subgrid/dynHarvestMod.F90
M       models/lnd/clm/src/dyn_subgrid/dynpftFileMod.F90

========= Add allocation of Points, matching behavior of true routine
M       models/lnd/clm/src/unit_test_stubs/csm_share/mct_mod_stub.F90

M       models/lnd/clm/bld/unit_testers/xFail/expectedClmTestFails.xml
   Remove these two entries that now pass:
               <entry testId="ERS_Ly5.f10_f10.ICLM45BGCCROP.yellowstone_intel.clm-irrigOn_reduceOutput"      failType="FAIL"  bugz="2091" >restarts not bit-for-bit</entry>
               <entry testId="SMS_D_Mmpi-serial.5x5_amazon.ICLM45CNED.goldbach_nag.clm-edTest.compare_hist"  failType="FAIL"  >error on hist comparison</entry>

   Add this new failure:
               <entry testId="PET_P15x2_Ly3.f10_f10.ICLM45BGCCROP.yellowstone_pgi.clm-irrig_o3_reduceOutput" failType="FAIL" bugz="2094" >compiler bug in PGI's handling of polymorphism</entry>


CLM testing:

  Note: testing was done on ozone_polymorphism_n09_clm4_5_1_r098, which was
  before I put in place the abort if you're trying to run ozone with pgi. After
  that, I ran two tests with pgi (one with ozone and one without), and one test
  with intel (with ozone) in order to make sure that the abort check was put in
  properly. After all testing was complete, I reverted accidental whitespace
  changes in clm_initializeMod.F90 and restFileMod.F90 - I did not run any
  additional testing after reverting those whitespace changes.

  unit-tests (models/lnd/clm/src):

    yellowstone: ok

  regular tests (aux_clm40, aux_clm45, with '-model_gen_comp clm2'):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    yellowstone_gnu (clm45 only): ok
    goldbach_nag: ok

  Also, ran these two additional tests, with comparisons to baselines - these
  are tests that I have replaced with new tests:

  ERS_Ly5.f10_f10.ICLM45BGCCROP.yellowstone_intel.clm-irrigOn_reduceOutput
  PET_P15x2_Ly3.f10_f10.ICLM45BGCCROP.yellowstone_pgi.clm-irrigOn_reduceOutput


CLM tag used for the baseline comparisons: clm4_5_1_r098

Changes answers relative to baseline: NO
	
===============================================================
===============================================================
Tag name:  clm4_5_1_r098
Originator(s):  sacks (Bill Sacks)
Date: Sat Nov 29 06:18:59 MST 2014
One-line Summary: update externals to cesm1_3_beta14 or beyond

Purpose of changes:

   Update most externals to cesm1_3_beta14 or beyond. The one exception is mct,
   for which I had trouble accessing the tag at the location used in beta14, so
   I am sticking with the previous mct tag.

   Some notable changes:

   (1) update in intel compiler on yellowstone to intel15

   (2) robust fix for number of datm streams, using Sean Santos's dynamic vector

   (3) testmods reworked to use recursive testmods

   (4) unit_testing, CMake & Machines updated so that unit tests now work on
   yellowstone


Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID):

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: self

List any svn externals directories updated (csm_share, mct, etc.):

-scripts                         https://svn-ccsm-models.cgd.ucar.edu/scripts/branch_tags/refactor_koven_tags/refactor_koven_n02_scripts4_141023
+scripts                         https://svn-ccsm-models.cgd.ucar.edu/scripts/branch_tags/append_nl_value_tags/append_nl_value_n02_scripts4_141129
-scripts/ccsm_utils/Machines     https://svn-ccsm-models.cgd.ucar.edu/Machines/trunk_tags/Machines_141017a
+scripts/ccsm_utils/Machines     https://svn-ccsm-models.cgd.ucar.edu/Machines/trunk_tags/Machines_141125
-scripts/ccsm_utils/CMake        https://github.com/quantheory/CMake_Fortran_utils/tags/CMake_Fortran_utils_140715
+scripts/ccsm_utils/CMake        https://github.com/quantheory/CMake_Fortran_utils/tags/CMake_Fortran_utils_141122
-models/drv                      https://svn-ccsm-models.cgd.ucar.edu/drv/seq_mct/trunk_tags/drvseq5_0_17
+models/drv                      https://svn-ccsm-models.cgd.ucar.edu/drv/seq_mct/trunk_tags/drvseq5_0_18
-models/csm_share                https://svn-ccsm-models.cgd.ucar.edu/csm_share/trunk_tags/share3_141022
+models/csm_share                https://svn-ccsm-models.cgd.ucar.edu/csm_share/trunk_tags/share3_141121
-models/utils/esmf_wrf_timemgr   https://svn-ccsm-models.cgd.ucar.edu/esmf_wrf_timemgr/trunk_tags/esmf_wrf_timemgr_140529
+models/utils/esmf_wrf_timemgr   https://svn-ccsm-models.cgd.ucar.edu/esmf_wrf_timemgr/trunk_tags/esmf_wrf_timemgr_141028
-models/utils/pio                http://parallelio.googlecode.com/svn/trunk_tags/pio1_8_12/pio
+models/utils/pio                http://parallelio.googlecode.com/svn/trunk_tags/pio1_8_13/pio
-tools/load_balancing_tool       https://svn-ccsm-models.cgd.ucar.edu/tools/load_balancing_tool/trunk_tags/load_balancing_tool_140818/
+tools/load_balancing_tool       https://svn-ccsm-models.cgd.ucar.edu/tools/load_balancing_tool/trunk_tags/load_balancing_tool_141008
-tools/pyReshaper                https://subversion.ucar.edu/asap/pyReshaper/tags/v0.9.1/
+tools/pyReshaper                https://proxy.subversion.ucar.edu/pubasap/pyReshaper/tags/v0.9.1
-tools/unit_testing              https://svn-ccsm-models.cgd.ucar.edu/unit_testing/trunk_tags/unit_testing_0_08
+tools/unit_testing              https://svn-ccsm-models.cgd.ucar.edu/unit_testing/trunk_tags/unit_testing_0_12


List all files eliminated:

List all files added and what they do:

List all existing files that have been modified, and describe the changes:

========= Workaround for pgi internal compiler error
M       models/lnd/clm/src/main/clm_driver.F90

========= Rework README, mainly to remove the need for using '--clean'
M       models/lnd/clm/src/README.unit_testing

========= Move an xfail from goldbach to yellowstone; add xfail for ERS_Ly5 test
          (bug 2091)
M       models/lnd/clm/bld/unit_testers/xFail/expectedClmTestFails.xml

========= Update what machine-comiler combos we test
M       .ChangeLog_template

CLM testing:

  unit-tests (models/lnd/clm/src):

    yellowstone: ok

  regular tests (aux_clm40, aux_clm45, with '-model_gen_comp clm2'):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    yellowstone_gnu (clm45 only): ok
    goldbach_nag: ok

    Other than xFails, note that the following failed:

    *** presumably this failed in the previous tag, so baselines didn't exist
    BFAIL SMS_D.1x1_mexicocityMEX.I.goldbach_nag.compare_hist.clm4_5_1_r097 

    *** ozone tests that won't work until an upcoming tag that brings ozone in
    SFAIL ERS_D.f10_f10.I1850CLM45.goldbach_nag.clm-o3.GC.1128-0838.45.n
    SFAIL PET_P15x2_Ly3.f10_f10.ICLM45BGCCROP.yellowstone_pgi.clm-irrig_o3_reduceOutput.GC.1128-0838.45.p
    SFAIL ERS_Ly5.f10_f10.ICLM45BGCCROP.yellowstone_intel.clm-irrig_o3_reduceOutput.GC.1128-0838.45.i

    Also, note that the following test failed:

    FAIL  ERH_D.f19_g16.I1850CLM45CN.yellowstone_pgi.clm-drydepnomegan 

    This appears to be a scripts problem. Since Mariana wants to do away with
    ERH tests anyway, I just replaced this with:

    PASS  ERI_D.f19_g16.I1850CLM45CN.yellowstone_pgi.clm-drydepnomegan 


    Also ran the following two tests, which have been replaced with
    (currently-failing) o3 tests:

    ERS_Ly5.f10_f10.ICLM45BGCCROP.yellowstone_intel.clm-irrigOn_reduceOutput
    PET_P15x2_Ly3.f10_f10.ICLM45BGCCROP.yellowstone_pgi.clm-irrigOn_reduceOutput

    The PET test passed, but the ERS test failed (see bug 2091)

CLM tag used for the baseline comparisons: clm4_5_1_r097

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: ALL
    - what platforms/compilers: yellowstone-intel
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
       NOT INVESTIGATED

       These diffs are presumably due to the yellowstone-intel compiler upgrade
       to v15.


   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	
===============================================================
===============================================================
Tag name:  clm4_5_1_r097
Originator(s): mvertens mvertens (Mariana Vertenstein,UCAR/CSEG,303-497-1349)
Date:  Mon Nov 24 11:06:30 MST 2014
One-line Summary: major refactorization to introduce new soilbiogeochem data
	types and routines that are independent of either ED or CN datatypes

Purpose of changes: Major refactorization to introduce new soilbiogeochem
  data types and permit ED and CN vegetation to be independent of each other
  AND both work with either the same soilbiogeochem or in the future 
  potentially different soilbiogeochem modules

Requirements for tag: None

Test level of tag: regular

Bugs fixed (include bugzilla ID): None

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
    1147 (mkgriddata can't straddle over Greenwich)
    1025 (SCM mode can NOT use a global finidat file)
    1017 (SCM mode can NOT restart)
     896 (T62 mode does not work)
     701 (svn keyword)
     452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: bld/configure modified to
  accomodate new directory structure - introduction of soilbiogeochem/ 
  directory

Describe any changes made to the namelist: None

List any changes to the defaults for the boundary datasets: None

Describe any substantial timing or memory changes: Since use_cn and use_ed
  are now mutually exclusive, CN memory is not longer allocated when ED is run
  and the memory reduction (for f19_g16) seems to be about 50%.

Code reviewed by: mvertens, muszala, sacks

List any svn externals directories updated (csm_share, mct, etc.): scripts branch is used
  https://svn-ccsm-models.cgd.ucar.edu/scripts/branch_tags/refactor_koven_tags/refactor_koven_n01_scripts4_141023

List all files eliminated, added and modified: (see below)
List all files added and what they do: (see below)
List all existing files that have been modified, and describe the changes: (see below)

These are all grouped together here - since splitting the items up simply did
not make sense in this case

---------------------------------------------------
New module where all instances are now declared (moved from clm_initializeMod)
- all calls to instance restarts are here as well - so restFileMod
  is greatly simplified
---------------------------------------------------
A       models/lnd/clm/src/main/clm_instMod.F90

---------------------------------------------------
New soilbiogeochem/ directory introduced (new modules and data types)
---------------------------------------------------
A       models/lnd/clm/src/soilbiogeochem

---------------------------------------------------
CN state and flux types split into: 
SoilBiogeoChem[Carbon|Nitrogen][State|Flux]Type and SoilBiogoechemStateType 
CNVeg[Carbon|Nitrogen][State|Flux]Type and CNVegStateType
---------------------------------------------------
D       models/lnd/clm/src/biogeochem/CNStateType.F90
D       models/lnd/clm/src/biogeochem/CNCarbonFluxType.F90
D       models/lnd/clm/src/biogeochem/CNCarbonStateType.F90
D       models/lnd/clm/src/biogeochem/CNNitrogenFluxType.F90
D       models/lnd/clm/src/biogeochem/CNNitrogenStateType.F90
A       models/lnd/clm/src/biogeochem/CNVegStateType.F90
A       models/lnd/clm/src/biogeochem/CNVegCarbonFluxType.F90
A       models/lnd/clm/src/biogeochem/CNVegCarbonStateType.F90
A       models/lnd/clm/src/biogeochem/CNVegNitrogenStateType.F90
A       models/lnd/clm/src/biogeochem/CNVegNitrogenFluxType.F90
A       models/lnd/clm/src/soilbiogeochem/SoilBiogeochemCarbonFluxType.F90
A       models/lnd/clm/src/soilbiogeochem/SoilBiogeochemCarbonStateType.F90
A       models/lnd/clm/src/soilbiogeochem/SoilBiogeochemStateType.F90
A       models/lnd/clm/src/soilbiogeochem/SoilBiogeochemNitrogenFluxType.F90
A       models/lnd/clm/src/soilbiogeochem/SoilBiogeochemNitrogenStateType.F90

---------------------------------------------------
New modules in soilbiogeochem/ directory that are independent of CNVeg or ED types
---------------------------------------------------
D       models/lnd/clm/src/biogeochem/CNDecompCascadeConType.F90
D       models/lnd/clm/src/biogeochem/CNNitrifDenitrifMod.F90
D       models/lnd/clm/src/biogeochem/CNVerticalProfileMod.F90
D       models/lnd/clm/src/biogeochem/CNDecompMod.F90
D       models/lnd/clm/src/biogeochem/CNAllocationMod.F90
D       models/lnd/clm/src/biogeochem/CNDecompCascadeBGCMod.F90
D       models/lnd/clm/src/biogeochem/CNDecompCascadeCNMod.F90
D       models/lnd/clm/src/biogeochem/CNSoilLittVertTranspMod.F90
A       models/lnd/clm/src/soilbiogeochem/SoilBiogeochemDecompCascadeConType.F90
A       models/lnd/clm/src/soilbiogeochem/SoilBiogeochemNitrifDenitrifMod.F90
A       models/lnd/clm/src/soilbiogeochem/SoilBiogeochemNStateUpdate1Mod.F90
A       models/lnd/clm/src/soilbiogeochem/SoilBiogeochemDecompCascadeBGCMod.F90
A       models/lnd/clm/src/soilbiogeochem/SoilBiogeochemNLeachingMod.F90
A       models/lnd/clm/src/soilbiogeochem/SoilBiogeochemVerticalProfileMod.F90
A       models/lnd/clm/src/soilbiogeochem/SoilBiogeochemCompetitionMod.F90
A       models/lnd/clm/src/soilbiogeochem/SoilBiogeochemDecompCascadeCNMod.F90
A       models/lnd/clm/src/soilbiogeochem/SoilBiogeochemPrecisionControlMod.F90
A       models/lnd/clm/src/soilbiogeochem/SoilBiogeochemNitrogenUptakeMod.F90
A       models/lnd/clm/src/soilbiogeochem/SoilBiogeochemPotentialMod.F90
A       models/lnd/clm/src/soilbiogeochem/SoilBiogeochemLittVertTranspMod.F90
A       models/lnd/clm/src/soilbiogeochem/SoilBiogeochemDecompMod.F90

---------------------------------------------------
Moved CNEcosystemDynMod to CNDRiverMod
---------------------------------------------------
D       models/lnd/clm/src/biogeochem/CNEcosystemDynMod.F90
A       models/lnd/clm/src/biogeochem/CNDriverMod.F90 

---------------------------------------------------
Changes to modules in biogeochem/ directory to now use new datatypes (see above)
---------------------------------------------------
A       models/lnd/clm/src/biogeochem/C14BompbSpikeMod.F90
M       models/lnd/clm/src/biogeochem/CNCStateUpdate2Mod.F90
M       models/lnd/clm/src/biogeochem/CNGapMortalityMod.F90
M       models/lnd/clm/src/biogeochem/CNGRespMod.F90
M       models/lnd/clm/src/biogeochem/CNNStateUpdate1Mod.F90
M       models/lnd/clm/src/biogeochem/CNBalanceCheckMod.F90
M       models/lnd/clm/src/biogeochem/CNNStateUpdate3Mod.F90
M       models/lnd/clm/src/biogeochem/CNFireMod.F90
M       models/lnd/clm/src/biogeochem/CNDVDriverMod.F90
M       models/lnd/clm/src/biogeochem/CNMRespMod.F90
M       models/lnd/clm/src/biogeochem/MEGANFactorsMod.F90
M       models/lnd/clm/src/biogeochem/SatellitePhenologyMod.F90
M       models/lnd/clm/src/biogeochem/CNWoodProductsMod.F90
M       models/lnd/clm/src/biogeochem/CNPrecisionControlMod.F90
M       models/lnd/clm/src/biogeochem/CNCIsoFluxMod.F90
M       models/lnd/clm/src/biogeochem/ch4Mod.F90
M       models/lnd/clm/src/biogeochem/DUSTMod.F90
M       models/lnd/clm/src/biogeochem/CNDVLightMod.F90
M       models/lnd/clm/src/biogeochem/NutrientCompetitionMethodMod.F90
M       models/lnd/clm/src/biogeochem/CNPhenologyMod.F90
M       models/lnd/clm/src/biogeochem/ch4varcon.F90
M       models/lnd/clm/src/biogeochem/CNCStateUpdate1Mod.F90
M       models/lnd/clm/src/biogeochem/CNCStateUpdate3Mod.F90
M       models/lnd/clm/src/biogeochem/CNSharedParamsMod.F90
M       models/lnd/clm/src/biogeochem/CNDVType.F90
M       models/lnd/clm/src/biogeochem/NutrientCompetitionCLM45defaultMod.F90
M       models/lnd/clm/src/biogeochem/VOCEmissionMod.F90
M       models/lnd/clm/src/biogeochem/CNAnnualUpdateMod.F90
M       models/lnd/clm/src/biogeochem/CNNStateUpdate2Mod.F90
M       models/lnd/clm/src/biogeochem/CropType.F90
M       models/lnd/clm/src/biogeochem/CNNDynamicsMod.F90
M       models/lnd/clm/src/biogeochem/DryDepVelocity.F90
M       models/lnd/clm/src/biogeochem/CNVegStructUpdateMod.F90
M       models/lnd/clm/src/biogeochem/CNDVEstablishmentMod.F90
M       models/lnd/clm/src/biogeochem/CNC14DecayMod.F90

---------------------------------------------------
Moved frictionvel_type to FrictionVelocityMod
---------------------------------------------------
D       models/lnd/clm/src/biogeophys/FrictionVelocityType.F90

---------------------------------------------------
Moved aerosol_type to AerosolMod
---------------------------------------------------
D       models/lnd/clm/src/biogeophys/AerosolType.F90

---------------------------------------------------
Moved photosyns_type to PhotosynthesisMod
---------------------------------------------------
D       models/lnd/clm/src/biogeophys/PhotosynthesisType.F90

---------------------------------------------------
Moved soilstate cold start initialization to a new module
---------------------------------------------------
A       models/lnd/clm/src/biogeophys/SoilStateInitTimeConstMod.F90

---------------------------------------------------
Moved soilhydrology time constant initialization to a new module
---------------------------------------------------
A       models/lnd/clm/src/biogeophys/SoilHydrologyInitTimeConstMod.F90

---------------------------------------------------
ED Refactorization1
(1) EDPhenologyMod changed to EDPhenologyType 
(2) EDBioType moved as a module type (ed_clm_type) in EDCLMLINKMod.F90
(3) EDVecPatchType no longer needed (for now is_veg, is_bareground and wt_ed are in PatchType.F90)
---------------------------------------------------
D       models/lnd/clm/src/ED/main/EDBioType.F90
M       models/lnd/clm/src/ED/main/EDCLMLinkMod.F90
D       models/lnd/clm/src/ED/main/EDVecPatchType.F90 
D       models/lnd/clm/src/ED/biogeophys/EDPhenologyMod.F90
A       models/lnd/clm/src/ED/biogeochem/EDPhenologyType.F90
A       models/lnd/clm/src/ED/biogeochem/EDSharedParamsMod.F90

---------------------------------------------------
ED Refactorization2
(1) Modified EDTypesMod.F90 
    Removed gridcell_edstate_type (array of pointers) and instance 
    gridcelledstate  - now have the following ED types and instance
    defined in clm_instMod.F90 and passed down in clm_initialize and clm_driver (top level)
       type(ed_site_type), allocatable, target :: ed_allsites_inst(:)
       type(ed_phenology_type)                 :: ed_phenology_inst
       type(ed_clm_type)                       :: ed_clm_inst
    so now have ed_allsites_inst which is an array of sites (at this point allocated at the
    gridcell level - but that could easily be modified to be at some other level like the
    column level
(2) In EDTypesMod.F90 added method map_clmpatch_to_edpatch that
    maps a CLM vector patch to an ED linked-list patch - there is still 
    a one to one correspondence between an ED patch and a CLM vector patch. The
    call looks like the following
       currentPatch => map_clmpatch_to_edpatch(ed_allsites_inst(g), p) 

(3) In EDTypesMod.F90 added a ED Patch type-bound method set_root_fraction that computes
    the root fraction for an ED patch
(4) In EDTypes.F90 eliminated the following components of userdata
      type (site)  , pointer :: firstsite_pnt => null()         ! pointer to the first site in the system
      type (cohort), pointer :: storesmallcohort => null()      ! storage of the smallest cohort for insertion routine
      type (cohort), pointer :: storebigcohort => null()        ! storage of the largest cohort for insertion routine 
    These are no longer needed since the above pointers are now local variables 
    in EDCohortDynamics and EDPatchDynamics   
---------------------------------------------------
M       models/lnd/clm/src/ED/main/EDVecCohortType.F90
M       models/lnd/clm/src/ED/main/EDRestVectorMod.F90
M       models/lnd/clm/src/ED/main/EDInitMod.F90
M       models/lnd/clm/src/ED/main/EDMainMod.F90
M       models/lnd/clm/src/ED/main/EDTypesMod.F90
M       models/lnd/clm/src/ED/fire/SFMainMod.F90
M       models/lnd/clm/src/ED/biogeochem/EDGrowthFunctionsMod.F90
M       models/lnd/clm/src/ED/biogeochem/EDCohortDynamicsMod.F90
M       models/lnd/clm/src/ED/biogeochem/EDPhysiologyMod.F90
M       models/lnd/clm/src/ED/biogeochem/EDPatchDynamicsMod.F90
M       models/lnd/clm/src/ED/biogeochem/EDCanopyStructureMod.F90
M       models/lnd/clm/src/ED/biogeophys/EDAccumulateFluxesMod.F90
M       models/lnd/clm/src/ED/biogeophys/EDSurfaceAlbedoMod.F90
M       models/lnd/clm/src/ED/biogeophys/EDPhotosynthesisMod.F90
M       models/lnd/clm/src/ED/biogeophys/EDBtranMod.F90

---------------------------------------------------
The following changes are implemented below (and in the above routines)
(1) _vars% changed to _inst%
(2)  pft% changed to patch%
(3)  merged ecophyscon and pftvarcon into single derived type pftcon (in pftconMod)
     "use EcophysConType, only : ecophyscon" changed to "use pftconMod, only : pftcon"
(4)  module save statements removed in majority of routines
---------------------------------------------------
D       models/lnd/clm/src/main/EcophysConType.F90
D       models/lnd/clm/src/main/pftvarcon.F90
A       models/lnd/clm/src/main/pftconMod.F90
M       models/lnd/clm/src/main/initInterp.F90
M       models/lnd/clm/src/main/clm_varpar.F90
M       models/lnd/clm/src/main/landunit_varcon.F90
M       models/lnd/clm/src/main/accumulMod.F90
M       models/lnd/clm/src/main/subgridWeightsMod.F90
M       models/lnd/clm/src/main/decompInitMod.F90
M       models/lnd/clm/src/main/clm_initializeMod.F90
M       models/lnd/clm/src/main/subgridRestMod.F90
M       models/lnd/clm/src/main/ColumnType.F90
M       models/lnd/clm/src/main/subgridMod.F90
M       models/lnd/clm/src/main/PatchType.F90
M       models/lnd/clm/src/main/ndepStreamMod.F90
M       models/lnd/clm/src/main/lnd2atmType.F90
M       models/lnd/clm/src/main/atm2lndType.F90
M       models/lnd/clm/src/main/histFileMod.F90
M       models/lnd/clm/src/main/restFileMod.F90
M       models/lnd/clm/src/main/clm_varsur.F90
M       models/lnd/clm/src/main/LandunitType.F90
M       models/lnd/clm/src/main/GetGlobalValuesMod.F90
M       models/lnd/clm/src/main/controlMod.F90
M       models/lnd/clm/src/main/initSubgridMod.F90
M       models/lnd/clm/src/main/filterMod.F90
M       models/lnd/clm/src/main/lnd2glcMod.F90
M       models/lnd/clm/src/main/clm_driver.F90
M       models/lnd/clm/src/main/clm_varctl.F90
M       models/lnd/clm/src/main/subgridAveMod.F90
M       models/lnd/clm/src/main/initGridCellsMod.F90
M       models/lnd/clm/src/main/atm2lndMod.F90
M       models/lnd/clm/src/main/lnd2atmMod.F90
M       models/lnd/clm/src/main/ncdio_pio.F90
M       models/lnd/clm/src/main/surfrdMod.F90
M       models/lnd/clm/src/main/decompMod.F90
M       models/lnd/clm/src/main/reweightMod.F90
M       models/lnd/clm/src/main/readParamsMod.F90
M       models/lnd/clm/src/biogeophys/BalanceCheckMod.F90
M       models/lnd/clm/src/biogeophys/WaterfluxType.F90
M       models/lnd/clm/src/biogeophys/SoilTemperatureMod.F90
M       models/lnd/clm/src/biogeophys/SnowSnicarMod.F90
M       models/lnd/clm/src/biogeophys/SnowHydrologyMod.F90
M       models/lnd/clm/src/biogeophys/LakeTemperatureMod.F90
M       models/lnd/clm/src/biogeophys/FrictionVelocityMod.F90
M       models/lnd/clm/src/biogeophys/SoilFluxesMod.F90
M       models/lnd/clm/src/biogeophys/TemperatureType.F90
M       models/lnd/clm/src/biogeophys/HumanIndexMod.F90
M       models/lnd/clm/src/biogeophys/PhotosynthesisMod.F90
M       models/lnd/clm/src/biogeophys/LakeFluxesMod.F90
M       models/lnd/clm/src/biogeophys/AerosolMod.F90
M       models/lnd/clm/src/biogeophys/ActiveLayerMod.F90
M       models/lnd/clm/src/biogeophys/SurfaceResistanceMod.F90
M       models/lnd/clm/src/biogeophys/SoilStateType.F90
M       models/lnd/clm/src/biogeophys/SoilHydrologyType.F90
M       models/lnd/clm/src/biogeophys/HydrologyDrainageMod.F90
M       models/lnd/clm/src/biogeophys/UrbanAlbedoMod.F90
M       models/lnd/clm/src/biogeophys/BareGroundFluxesMod.F90
M       models/lnd/clm/src/biogeophys/CanopyFluxesMod.F90
M       models/lnd/clm/src/biogeophys/RootBiophysMod.F90
M       models/lnd/clm/src/biogeophys/SurfaceRadiationMod.F90
M       models/lnd/clm/src/biogeophys/SoilWaterMovementMod.F90
M       models/lnd/clm/src/biogeophys/SoilMoistStressMod.F90
M       models/lnd/clm/src/biogeophys/UrbBuildTempOleson2015Mod.F90
M       models/lnd/clm/src/biogeophys/CanopyHydrologyMod.F90
M       models/lnd/clm/src/biogeophys/EnergyFluxType.F90
M       models/lnd/clm/src/biogeophys/CanopyStateType.F90
M       models/lnd/clm/src/biogeophys/UrbanFluxesMod.F90
M       models/lnd/clm/src/biogeophys/SurfaceAlbedoMod.F90
M       models/lnd/clm/src/biogeophys/UrbanRadiationMod.F90
M       models/lnd/clm/src/biogeophys/SoilHydrologyMod.F90
M       models/lnd/clm/src/biogeophys/IrrigationMod.F90
M       models/lnd/clm/src/biogeophys/CanopyTemperatureMod.F90
M       models/lnd/clm/src/biogeophys/HydrologyNoDrainageMod.F90
M       models/lnd/clm/src/biogeophys/LakeHydrologyMod.F90
M       models/lnd/clm/src/biogeophys/UrbanParamsType.F90
M       models/lnd/clm/src/dyn_subgrid/dynLandunitAreaMod.F90
M       models/lnd/clm/src/dyn_subgrid/dynTimeInfoMod.F90
M       models/lnd/clm/src/dyn_subgrid/dynSubgridDriverMod.F90
M       models/lnd/clm/src/dyn_subgrid/dynHarvestMod.F90
M       models/lnd/clm/src/dyn_subgrid/dynFileMod.F90
M       models/lnd/clm/src/dyn_subgrid/dynConsBiogeochemMod.F90
M       models/lnd/clm/src/dyn_subgrid/dynPriorWeightsMod.F90
M       models/lnd/clm/src/dyn_subgrid/dynVarMod.F90
M       models/lnd/clm/src/dyn_subgrid/dynEDMod.F90
M       models/lnd/clm/src/dyn_subgrid/dynVarTimeInterpMod.F90
M       models/lnd/clm/src/dyn_subgrid/dynpftFileMod.F90
M       models/lnd/clm/src/dyn_subgrid/dynCNDVMod.F90
M       models/lnd/clm/src/dyn_subgrid/dynConsBiogeophysMod.F90
M       models/lnd/clm/src/dyn_subgrid/dynVarMod.F90.in
M       models/lnd/clm/src/dyn_subgrid/dynVarTimeInterpMod.F90.in
M       models/lnd/clm/src/dyn_subgrid/dynInitColumnsMod.F90
M       models/lnd/clm/src/cpl/lnd_comp_esmf.F90
M       models/lnd/clm/src/cpl/lnd_import_export.F90
M       models/lnd/clm/src/cpl/lnd_comp_mct.F90
M       models/lnd/clm/src/utils/accumulMod.F90
M       models/lnd/clm/src/utils/domainMod.F90

---------------------------------------------------
Changes for Unit testing
---------------------------------------------------
R       models/lnd/clm/src/ED/main/CMakeLists.txt
M       models/lnd/clm/src/unit_test_shr/unittestSubgridMod.F90
M       models/lnd/clm/src/CMakeLists.txt

---------------------------------------------------
Configuration changes for new soilbiogeochem/
---------------------------------------------------
M       models/lnd/clm/bld/configure

CLM testing:

  unit-tests (models/lnd/clm/src):

    yellowstone - okay 

  regular tests (aux_clm40, aux_clm45, with '-model_gen_comp clm2'):

    yellowstone_intel - okay
    yellowstone_pgi - okay
    yellowstone_gnu - okay
    goldbach_nag - okay

    goldbach_intel (moved these to yellowstone_intel for future tests)

CLM tag used for the baseline comparisons: clm4_5_1_r096

Changes answers relative to baseline: NO (bit-for-bit)
	
===============================================================
===============================================================
Tag name:  clm4_5_1_r096
Originator(s):  erik (Erik)
Date: Wed Nov 19 02:11:09 MST 2014
One-line Summary: Several answer changing bug-fixes: snow grain size, lake hydrology, default settings, organic soil

Purpose of changes:

Bring in several bug-fixes most of which change answers.

Snow grain size bug that Mark Flanner discovered under snow layer combination. 
Lake hydrology fix from Zack Subin that would rarely cause the code to abort. Snow depth fix from
Sean Swenson. Use Priglent inversion as recommended by Charlie Koven. Correct population density for 2000 conditions
from 1850 to peroperly be 2000. Modify all Carbon on spinup from Dave Lawrenece. Add option to square or not square
the organic fraction (default is to square for clm4_5 and to NOT for clm5_0). Bug with pervious road that Keith
Oleson found. Simplify an if for urban to consistently use a double precision constant. Point to the new CLMNCEP_V5
dataset.

For clm4_0 rcp6 and rcp8.5 pftdyn datasets are updated for after 2005.

Some fixes that don't change answers. Get the Prigilent inversion and usephfact options working again.
Fix a bug in interp_source option that Sean Swenson found. Split out test datasets for getregional script since
the datasets all have to be at the same resolution as the domain file. Also read filelist rather than use env 
variables.

Requirements for tag: Fix the bugs below

Test level of tag: regular

Bugs fixed (include bugzilla ID):
                1934 -- snow grain size (both clm4_0 and clm4_5). Just fix on clm4_5 side.
                1717 -- lake hydrology fix (clm4_5 only)
                1941 -- snowdp fix from Sean (both clm4_0 and clm4_5) (fix in clm4_5_1_r087)
                1759 -- ngwh for clm4_0 datasets (apply cesm1_2_x_n10_clm4_5_10)
                1772 -- use Priglent inversion
                1838 -- pop dens is 1850 for 2000 compsets
                1774 -- modify all Carbon on spinup
                1765 -- remove duplicate setting of bd and tkdry
                1764 -- Bug with pervious road
                2066 -- getregional_datasets.pl bug for long lists of files
                2067 -- get Prigilent inversion and usephfact options working.
                2081 -- point to new CLMNCEP_V5 version
                2061 -- make constant consistently double precision rather than have an if around it
                2089 -- bug in interp_source that Sean Swenson found

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: None

Describe any changes made to the namelist: Add organic_frac_squared=.false. logical as a clm5_0 default feature
   The old behavior organic_frac_squared=.true. is on as before for clm4_5.

List any changes to the defaults for the boundary datasets: None

Describe any substantial timing or memory changes: None

Code reviewed by: self, dlawren, swensosc, mflanner, subin

List any svn externals directories updated (csm_share, mct, etc.): datm
   update datm to datm8_141113 update CRUNCEP_V5 dataset version used

List all files eliminated: None

List all files added and what they do:

=========== Split out getregional lists (all files in list MUST be at same res as domain file)
A       models/lnd/clm/test/tools/nl_files/getregional_05popd
A       models/lnd/clm/test/tools/nl_files/getregional_T62
A       models/lnd/clm/test/tools/nl_files/getregional_ndep
A       models/lnd/clm/tools/shared/ncl_scripts/sample_inlist_0.5popd
A       models/lnd/clm/tools/shared/ncl_scripts/sample_inlist_ndep
A       models/lnd/clm/tools/shared/ncl_scripts/sample_outlist_0.5popd
A       models/lnd/clm/tools/shared/ncl_scripts/sample_outlist_ndep
A       models/lnd/clm/tools/shared/ncl_scripts/sample_inlist_T62
A       models/lnd/clm/tools/shared/ncl_scripts/sample_outlist_T62

List all existing files that have been modified, and describe the changes:

=========== Change getregional tests
M       models/lnd/clm/test/tools/input_tests_master
M       models/lnd/clm/test/tools/tests_posttag_nompi_regression

=========== Bring in 
M       models/lnd/clm/tools/shared/ncl_scripts/getregional_datasets.pl
M       models/lnd/clm/tools/shared/ncl_scripts/getregional_datasets.ncl
M       models/lnd/clm/tools/shared/ncl_scripts/sample_inlist
M       models/lnd/clm/tools/shared/ncl_scripts/sample_outlist

M       models/lnd/clm/bld/unit_testers/build-namelist_test.pl ------------ correct number of tests
M       models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_0.xml ---- Update rcp6 and rcp8.5 pftdyn datasets
M       models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_5.xml ---- Add organic_frac_squared,
             set fin_use_fsat=.false. by default
M       models/lnd/clm/bld/namelist_files/namelist_definition_clm4_5.xml -- Add organic_frac_squared
M       models/lnd/clm/bld/namelist_files/use_cases/2000_control.xml ------ Correct year for popd from 1850 to 2000
M       models/lnd/clm/bld/namelist_files/use_cases/2000_glacierMEC_control.xml - Correct year for popd from 1850 to 2000

M       models/lnd/clm/bld/CLMBuildNamelist.pm - Add organic_frac_squared and change setup_logic_more_vertlayers to
                                                 setup_logic_soilstate

M       models/lnd/clm/src/utils/CMakeLists.txt - Add namelist util to source list

M       models/lnd/clm/src/biogeochem/ch4Mod.F90 ------------- Pass fsurdat to initCold
M       models/lnd/clm/src/biogeochem/CNCarbonStateType.F90 -- Use nlevdecomp_full in place of nlevdecomp
M       models/lnd/clm/src/main/initInterp.F90 --------------- Change use of rbufsli to rbufslo
M       models/lnd/clm/src/main/clm_initializeMod.F90 -------- Pass nlfilename into soilstate_vars init
M       models/lnd/clm/src/biogeophys/BalanceCheckMod.F90 ---- Add col%itype(c) == icol_road_perv to an if condition
M       models/lnd/clm/src/biogeophys/SoilTemperatureMod.F90 - Use 1.0_r8 constant always, rather than integer 1
                                                               for clm4_5
M       models/lnd/clm/src/biogeophys/SnowHydrologyMod.F90 --- Use Mass-weighted combination of radius for combo
M       models/lnd/clm/src/biogeophys/SoilStateType.F90 ------ Add organic_frac_squared logical and namelist read
                                                               for it. Add two if's that determine if organic_frac
                                                               should be squared or not.
M       models/lnd/clm/src/biogeophys/LakeHydrologyMod.F90 --- Break apart if-condition for snl==-1

CLM testing: regular

  build-namelist tests:

    yellowstone    yes

  unit-tests (models/lnd/clm/src):

    yellowstone    yes (although still fails)

  regular tests (aux_clm40, aux_clm45, with '-model_gen_comp clm2'):

    yellowstone_intel  yes
    yellowstone_pgi    yes
    yellowstone_gnu    yes
    goldbach_nag       yes
    goldbach_intel     yes

  short tests (aux_clm_short) (generally these are NOT used when making a tag):

    yellowstone_intel yes
    yellowstone_pgi   yes
    goldbach_nag      yes

  tools testing: (when tools modified or scripts updated (for PTCLM))

    yellowstone interactive   yes
    PTCLM (models/lnd/clm/tools/shared/PTCLM/test) yellowstone  yes

CLM tag used for the baseline comparisons: 

Changes answers relative to baseline:  Yes!

  Summarize any changes to answers, i.e.,
    - what code configurations:   clm4_5 and clm5_0
    - what platforms/compilers:   all
    - nature of change (similar climate, except new clm5_0 feature)

   clm4_0 for rcp6 and rcp8.5 changes answers by using the new good wood harvest
   datasets for after 2005.

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)

   /home/erik/noorg_clm451r092_I1850CRUCLM45BGC -- clm4_5 default version
   /home/erik/clm451r092_I1850CRUCLM45BGC -------- clm4_5 with organic_frac_squared=.false.
                                                   (clm5_0 default version)

	
===============================================================
===============================================================
Tag name:  clm4_5_1_r095
Originator(s):  andre (Benjamin Andre,UCAR/CSEG,303-497-1391)
Date:  Mon Nov 10 17:54:18 MST 2014
One-line Summary: refactoring N comp by Jinyun Tang (LBL) and transpiration sink isolation by Gautam Bisht (LBL)

Purpose of changes: Bring in two refactorings:
	Jinyun Tang (LBL) - isolation of the routines to do soil nutrient
	competition dynamics into a module, and allow for different
	implementations through runtime polymorphism.

	Gautam Bisht (LBL) - new function to make transpiration sink
	distribution independent of subsurface flow physics

Test level of tag: regular

Bugs fixed (include bugzilla ID): 2039

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: andre, cmt

List any svn externals directories updated (csm_share, mct, etc.): none

List all files eliminated: none

Nutrient Competition
  List all files added and what they do:
    A       clm/src/biogeochem/NutrientCompetitionFactoryMod.F90 - factory module to select soil nutrient competition method
    A       clm/src/biogeochem/NutrientCompetitionMethodMod.F90 - abstract base class for soil nutrient competition dynamics
    A       clm/src/biogeochem/NutrientCompetitionCLM45defaultMod.F90 - existing clm45 implementation of soil nutrient competition dynamics

  List all existing files that have been modified, and describe the changes:
    M       clm/src/biogeochem/CNDecompMod.F90 - add nutrient competition method to function parameters
    M       clm/src/biogeochem/CropType.F90 - rename UpdateAccVars() to work around pgi compiler error, remove dependency on temperature_type
    M       clm/src/biogeochem/CNAllocationMod.F90 - move code into clm45 default nutrient competition module
    M       clm/src/biogeochem/CNEcosystemDynMod.F90 - add nutrient competition method to function parameters
    MM      clm/src/main/clm_initializeMod.F90 - add nutrient competition method to function parameters
    M       clm/src/main/clm_driver.F90 - add nutrient competition method to function parameters, call to renamed CropUpdateAccVars
    M       clm/src/main/readParamsMod.F90 - add nutrient competition method to function parameters

Transpiration Sink:
  List all existing files that have been modified, and describe the changes:
M       clm/src/biogeophys/SoilWaterMovementMod.F90 - move transpiration sink into separate function so it is independent of physics.


CLM testing:

  build-namelist tests: n/a

  unit-tests (models/lnd/clm/src): no

    yellowstone

  regular tests (aux_clm40, aux_clm45, with '-model_gen_comp clm2'):

    yellowstone_intel - 4.0 ok; 4.5 ok
    yellowstone_pgi - 4.0 ok; 4.5 ok
    yellowstone_gnu - n/a; 4.5 ok
    goldbach_nag - 4.0 ok; 4.5 ok
    goldbach_intel - 4.0 ok; 4.5 ok

  short tests (aux_clm_short) - no

  tools testing: (when tools modified or scripts updated (for PTCLM)) - n/a

CLM tag used for the baseline comparisons: clm4_5_1_r094

Changes answers relative to baseline: no

===============================================================
===============================================================
Tag name:  clm4_5_1_r094
Originator(s):  sacks (Bill Sacks,UCAR/CSEG,303-497-1762)
Date: Fri Nov  7 13:43:38 MST 2014
One-line Summary: misc. glacier-related updates

Purpose of changes:

(1) Add dlnd, satm and srof externals, so that TG compsets (CISM-only, forced by
    dlnd) can be run from a CLM tag. This will facilitate CISM development and
    testing.

(2) Remove CLM's dependence on the CISM grid. Previously, CLM used the CISM grid
    to determine which fglcmask file to use. But the differences between the
    fglcmask files were inconsequential (all of them included the full area of
    Greenland, which is what was important). I have created a new set of
    fglcmask files that are independent of the CISM grid, and point CLM to these
    new files. This will make it easier to add new CISM grids in the future,
    because no changes will be needed in CLM for this purpose. However, note
    that the use of these new files means that the number of virtual landunits &
    columns changes for glcmec runs.

(3) In subgridAveMod, fix c2l routines: change pft%wtlunit to col%wtlunit (bugz
    2077)

Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID):
- 2077 (c2l references pft instead of col)
- 2085 (listDefaultNamelist is broken)

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: change fglcmask

List any changes to the defaults for the boundary datasets: change fglcmask

Describe any substantial timing or memory changes: none

Code reviewed by: self

List any svn externals directories updated (csm_share, mct, etc.):

========= Added new externals for the sake of running TG compsets (CISM-only)
          from a CLM tag
+models/lnd/dlnd                 https://svn-ccsm-models.cgd.ucar.edu/dlnd7/trunk_tags/dlnd8_131201
+models/atm/satm                 https://svn-ccsm-models.cgd.ucar.edu/stubs/trunk_tags/stubs1_4_04/satm
+models/rof/srof                 https://svn-ccsm-models.cgd.ucar.edu/stubs/trunk_tags/stubs1_4_04/srof

========= Other externals updates
-tools/unit_testing              https://svn-ccsm-models.cgd.ucar.edu/unit_testing/trunk_tags/unit_testing_0_07
+tools/unit_testing              https://svn-ccsm-models.cgd.ucar.edu/unit_testing/trunk_tags/unit_testing_0_08


List all files eliminated:

List all files added and what they do:

List all existing files that have been modified, and describe the changes:

========= Remove dependence on CISM grid
M       models/lnd/clm/bld/listDefaultNamelist.pl
          - also fix bug 2085
M       models/lnd/clm/bld/unit_testers/build-namelist_test.pl
M       models/lnd/clm/bld/test_build_namelist/t/input/namelist_defaults_clm4_5_test.xml
M       models/lnd/clm/bld/test_build_namelist/t/input/namelist_definition_clm4_5_test.xml
M       models/lnd/clm/bld/clm.buildnml.csh
M       models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_0.xml
M       models/lnd/clm/bld/namelist_files/namelist_definition_clm4_0.xml
M       models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_5.xml
M       models/lnd/clm/bld/namelist_files/namelist_defaults_overall.xml
M       models/lnd/clm/bld/namelist_files/namelist_definition_clm4_5.xml
M       models/lnd/clm/bld/namelist_files/namelist_defaults.xsl
M       models/lnd/clm/bld/user_nl_clm
M       models/lnd/clm/bld/CLMBuildNamelist.pm
M       models/lnd/clm/doc/UsersGuide/custom.xml
M       models/lnd/clm/src_clm40/main/controlMod.F90
M       models/lnd/clm/src_clm40/main/clm_varctl.F90
M       models/lnd/clm/src/main/controlMod.F90
M       models/lnd/clm/src/main/clm_varctl.F90

========= Change pft%wtlunit to col%wtlunit in c2l routines (which currently
          aren't called from anywhere in the code) (bugz 2077)
M       models/lnd/clm/src/main/subgridAveMod.F90

========= fix numbers of build-namelist unit test failures, due to removal of a test
M       models/lnd/clm/bld/unit_testers/xFail/expectedClmTestFails.xml


CLM testing:

  build-namelist tests:

    yellowstone: ok

      expected failure in 23, due to change in fglcmask

  unit-tests (models/lnd/clm/src):

    yellowstone: still broken, due to internal compiler error
    roo2 (mac laptop): ok

    See notes in clm4_5_1_r090. Point (2) has been fixed, but point (1) remains.

  regular tests (aux_clm40, aux_clm45, with '-model_gen_comp clm2'):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    yellowstone_gnu: ok
    goldbach_nag: ok
    goldbach_intel: ok

CLM tag used for the baseline comparisons: clm4_5_1_r093

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: IG compsets - both CLM40 and CLM45
    - what platforms/compilers: ALL
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
        only changes diagnostic cpl hist fields - no change in the simulation

        The changes arise from the new glcmask files, which exclude a few points
        from the glcmask that used to be included. These points are all outside
        of Greenland, so they are not important for coupling to CISM. However,
        it means that a few virtual columns have been removed. This, in turn,
        changes the values of some l2x topo, tsrf and qice fields sent to the
        coupler. But this does NOT feed back on the simulation in any way.
    
        Some tests also exhibit diffs in the CLM diagnostic fields PCT_GLC_MEC
        and QICE_FORC. Again, these are due to changes in where we have virtual
        columns, and do not affect the simulation.

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	
===============================================================
===============================================================
Tag name:  clm4_5_1_r093
Originator(s):  sacks (Bill Sacks,UCAR/CSEG,303-497-1762)
Date: Fri Nov  7 13:17:47 MST 2014
One-line Summary: change cold-start snow initialization, update cism external

Purpose of changes:

(1) Change cold-start snow initialization logic. The original logic did
different snow initialization depending on whether we are inside or outside the
glcmask. That's a problem in that answers change depending on the glcmask. The
new logic instead uses a latitude threshold for determining where to initialize
a non-zero snow pack. Note that this will change answers for all cold-start
cases, including non-glcmec cases.

(2) Update CISM to version 2.

Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID):

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: self; Dave Lawrence agreed with the change to snow initialization

List any svn externals directories updated (csm_share, mct, etc.):
-models/glc/cism                 https://svn-ccsm-models.cgd.ucar.edu/glc/trunk_tags/cism1_140916
+models/glc/cism                 https://svn-ccsm-models.cgd.ucar.edu/glc/trunk_tags/cism2_0_02


List all files eliminated:

List all files added and what they do:

List all existing files that have been modified, and describe the changes:

M       models/lnd/clm/src/main/clm_initializeMod.F90

CLM testing:

  regular tests (aux_clm40, aux_clm45, with '-model_gen_comp clm2'):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    yellowstone_gnu: ok
    goldbach_nag: ok
    goldbach_intel: ok

CLM tag used for the baseline comparisons: clm4_5_1_r092

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations:
      (1) any CLM4.5 case with cold start initialization, due to change in snow
          initialization

      (2) any case that includes CISM, due to answer changes in the CISM external

      I carefully checked the yellowstone-intel clm4.5 tests to ensure that:
        (a) FAILed compare_hist all had finidat = ' '
        (b) PASSed compare_hist either had non-blank finidat OR were single-point

    - what platforms/compilers: ALL
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      Not investigated, but expected to be larger than roundoff/same climate

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	
===============================================================
===============================================================
Tag name:  clm4_5_1_r092
Originator(s):  muszala (Stefan Muszala)
Date:  Tue Nov  4 06:10:16 MST 2014
One-line Summary:  bug fixes from santos that address valgrind problems.  update rtm external 

Purpose of changes: Addresses issues found with Valgrind by Santos.  Update RTM.

Requirements for tag: N/A

Test level of tag: regular

Bugs fixed (include bugzilla ID): N/A

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: N/A

Describe any changes made to the namelist: N/A

List any changes to the defaults for the boundary datasets: N/A

Describe any substantial timing or memory changes: N/A

Code reviewed by: santos, self

List any svn externals directories updated (csm_share, mct, etc.):
-models/rof/rtm                  https://svn-ccsm-models.cgd.ucar.edu/rivrtm/trunk_tags/rtm1_0_39
+models/rof/rtm                  https://svn-ccsm-models.cgd.ucar.edu/rivrtm/trunk_tags/rtm1_0_40

List all files eliminated: N/A

List all files added and what they do:

A  +    models/lnd/clm/src/main/dtypes.h

List all existing files that have been modified, and describe the changes:

M       models/lnd/clm/bld/unit_testers/xFail/expectedClmTestFails.xml
-- update failures

M       SVN_EXTERNAL_DIRECTORIES
-- rtm update to 40

M       models/lnd/clm/src_clm40/main/ncdio_pio.F90
M       models/lnd/clm/src_clm40/main/ncdio_pio.F90.in
M       models/lnd/clm/src/main/ncdio_pio.F90
M       models/lnd/clm/src/main/ncdio_pio.F90.in
-- example changes:
-       status = pio_inq_vardimid(ncid, vardesc , dids)
+       status = pio_inq_vardimid(ncid, vardesc , dids(1:ndims))

M       models/lnd/clm/src_clm40/biogeophys/FrictionVelocityMod.F90
M       models/lnd/clm/src/biogeophys/FrictionVelocityMod.F90
-- change 1.0_8 to  1.0_r8

CLM testing:

  build-namelist tests: N/A

  unit-tests (models/lnd/clm/src): N/A

  regular tests (aux_clm40, aux_clm45, with '-model_gen_comp clm2'):

    yellowstone_intel 40- OK  45- OK
    yellowstone_pgi   40- OK  45- OK
    yellowstone_gnu   40- N/A 45- OK
    goldbach_nag      40- OK  45- OK
    goldbach_intel    40- OK  45- OK

  tools testing: (when tools modified or scripts updated (for PTCLM)) N/A

CLM tag used for the baseline comparisons:  clm4_5_1_r091

Changes answers relative to baseline: No

===============================================================
===============================================================
Tag name:  clm4_5_1_r091
Originator(s):  muszala (Stefan Muszala)
Date: Mon Oct 27 09:48:56 MDT 2014
One-line Summary:  update externals.  fix bug so CLM runs with Intel 14x. 

Purpose of changes: Update externals.  Fix bug in VOCEmissionMod.F90 that prevented
CLM from running with Intel 14x on yellowstone.  Bring in workaround for bug 1730 from
Sacks.

Requirements for tag: N/A

Test level of tag: regular

Bugs fixed (include bugzilla ID): N/A

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/ - see CLM test fail list

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: N/A

Describe any changes made to the namelist: N/A

List any changes to the defaults for the boundary datasets: N/A

Describe any substantial timing or memory changes: N/A

Code reviewed by: self, clm developers, particularly Bill Sacks.

List any svn externals directories updated (csm_share, mct, etc.):
-scripts                         https://svn-ccsm-models.cgd.ucar.edu/scripts/trunk_tags/scripts4_141009
+scripts                         https://svn-ccsm-models.cgd.ucar.edu/scripts/trunk_tags/scripts4_141023
-scripts/ccsm_utils/Machines     https://svn-ccsm-models.cgd.ucar.edu/Machines/trunk_tags/Machines_141001
+scripts/ccsm_utils/Machines     https://svn-ccsm-models.cgd.ucar.edu/Machines/trunk_tags/Machines_141017a
-models/csm_share                https://svn-ccsm-models.cgd.ucar.edu/csm_share/trunk_tags/share3_141003
+models/csm_share                https://svn-ccsm-models.cgd.ucar.edu/csm_share/trunk_tags/share3_141022
-models/utils/timing             https://svn-ccsm-models.cgd.ucar.edu/timing/trunk_tags/timing_140416
+models/utils/timing             https://svn-ccsm-models.cgd.ucar.edu/timing/trunk_tags/timing_140925

List all files eliminated: N/A

List all files added and what they do: N/A

List all existing files that have been modified, and describe the changes:

-- reflect changes in new testlists
M       models/lnd/clm/bld/unit_testers/xFail/expectedClmTestFails.xml
-- Sacks' workaround for bug 1730
M       models/lnd/clm/src/main/histFileMod.F90
M       models/lnd/clm/src/main/ncdio_pio.F90
M       models/lnd/clm/src/main/ncdio_pio.F90.in
-- remove duplicate assignment of 0_r8 to meg_out(imeg)%flux_out
M       models/lnd/clm/src/biogeochem/VOCEmissionMod.F90
-- update externals
M       SVN_EXTERNAL_DIRECTORIES

CLM testing:

  Please view the CLM expected fail list for new test failures.  They are matched
  to bugzilla bug ids.

  regular tests (aux_clm40, aux_clm45, with '-model_gen_comp clm2'):

    yellowstone_intel - 40 - OK   45 - OK
    yellowstone_pgi   - 40 - OK   45 - OK
    yellowstone_gnu   - 40 - N/A  45 - OK
    goldbach_nag      - 40 - OK   45 - OK
    goldbach_intel    - 40 - OK   45 - OK

CLM tag used for the baseline comparisons:  clm4_5_1_r090

Changes answers relative to baseline: No

===============================================================
===============================================================
Tag name:  clm4_5_1_r090
Originator(s):  sacks (Bill Sacks)
Date: Thu Oct 16 06:39:52 MDT 2014
One-line Summary: modularize irrigation; do some unit test rework

Purpose of changes:

(1) Pull irrigation code out of CanopyFluxes and CanopyHydrology, into its
    own module

(2) Pull out the locally-created filters from CanopyFluxes and BareGroundFluxes
    into filterMod, in order to support pulling irrigation out of
    CanopyFluxes. This will also be needed to support pulling other hydrology
    stuff out of CanopyFluxes.

(3) Add unit tests for irrigation

(4) Rework some irrigation infrastruture, and add some more unit test utility
    routines


Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID): 2063 (HumanIndexMod fails to compile with gfortran)

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: muszala

List any svn externals directories updated (csm_share, mct, etc.): none

List all files eliminated:

========= Renamed to unit_test_stubs
D       models/lnd/clm/src/unit_test_mocks/util_share/ncdio_var.F90
D       models/lnd/clm/src/unit_test_mocks/util_share/restUtilMod_mock.F90
D       models/lnd/clm/src/unit_test_mocks/util_share/GetGlobalValuesMod_mock.F90
D       models/lnd/clm/src/unit_test_mocks/util_share/ncdio_var.F90.in
D       models/lnd/clm/src/unit_test_mocks/util_share/restUtilMod_mock.F90.in
D       models/lnd/clm/src/unit_test_mocks/util_share/clm_time_manager_mock.F90
D       models/lnd/clm/src/unit_test_mocks/util_share/ncdio_pio_mock.F90
D       models/lnd/clm/src/unit_test_mocks/util_share/spmdMod_mock.F90
D       models/lnd/clm/src/unit_test_mocks/util_share/do_genf90
D       models/lnd/clm/src/unit_test_mocks/util_share/CMakeLists.txt
D       models/lnd/clm/src/unit_test_mocks/util_share/ncdio_pio_mock.F90.in
D       models/lnd/clm/src/unit_test_mocks/util_share
D       models/lnd/clm/src/unit_test_mocks/csm_share/shr_mpi_mod_mock.F90
D       models/lnd/clm/src/unit_test_mocks/csm_share/mct_mod_mock.F90
D       models/lnd/clm/src/unit_test_mocks/csm_share/CMakeLists.txt
D       models/lnd/clm/src/unit_test_mocks/csm_share
D       models/lnd/clm/src/unit_test_mocks/main/CMakeLists.txt
D       models/lnd/clm/src/unit_test_mocks/main/histFileMod_mock.F90
D       models/lnd/clm/src/unit_test_mocks/main
D       models/lnd/clm/src/unit_test_mocks/dyn_subgrid/dynFileMod_mock.F90
D       models/lnd/clm/src/unit_test_mocks/dyn_subgrid/CMakeLists.txt
D       models/lnd/clm/src/unit_test_mocks/dyn_subgrid
D       models/lnd/clm/src/unit_test_mocks/CMakeLists.txt
D       models/lnd/clm/src/unit_test_mocks

========= Remove unnecessary files
D       models/lnd/clm/src/ED/CMakeLists.txt
D       models/lnd/clm/src/ED/biogeophys/CMakeLists.txt

List all files added and what they do:

========= Pull out irrigation code into its own module
A       models/lnd/clm/src/biogeophys/IrrigationMod.F90

========= Add some unit test utility code (and some tests for the utility code)
A       models/lnd/clm/src/unit_test_shr/unittestFilterBuilderMod.F90
A       models/lnd/clm/src/unit_test_shr/unittestSimpleSubgridSetupsMod.F90
A       models/lnd/clm/src/unit_test_shr/test/unittestFilterBuilder_test/test_filterBuilder.pf
A       models/lnd/clm/src/unit_test_shr/test/unittestFilterBuilder_test/CMakeLists.txt
A       models/lnd/clm/src/unit_test_shr/test/unittestFilterBuilder_test
A       models/lnd/clm/src/unit_test_shr/test/CMakeLists.txt
A       models/lnd/clm/src/unit_test_shr/test

========= Renamed from unit_test_mocks to unit_test_stubs; also renamed
          individual files from mock to stub (or 'fake' for ncdio_pio, because
          it does more than a stub); also, moved some stubs to match the current
          organization of the main source tree
A       models/lnd/clm/src/unit_test_stubs/utils/restUtilMod_stub.F90
A       models/lnd/clm/src/unit_test_stubs/utils/do_genf90
A       models/lnd/clm/src/unit_test_stubs/utils/restUtilMod_stub.F90.in
A       models/lnd/clm/src/unit_test_stubs/utils/CMakeLists.txt
A       models/lnd/clm/src/unit_test_stubs/utils/clm_time_manager_stub.F90
A       models/lnd/clm/src/unit_test_stubs/utils/spmdMod_stub.F90
A       models/lnd/clm/src/unit_test_stubs/utils
A       models/lnd/clm/src/unit_test_stubs/csm_share/shr_mpi_mod_stub.F90
A       models/lnd/clm/src/unit_test_stubs/csm_share/mct_mod_stub.F90
A       models/lnd/clm/src/unit_test_stubs/csm_share/CMakeLists.txt
A       models/lnd/clm/src/unit_test_stubs/csm_share
A       models/lnd/clm/src/unit_test_stubs/main/histFileMod_stub.F90
A       models/lnd/clm/src/unit_test_stubs/main/ncdio_var.F90
A       models/lnd/clm/src/unit_test_stubs/main/ncdio_pio_fake.F90
A       models/lnd/clm/src/unit_test_stubs/main/ncdio_var.F90.in
A       models/lnd/clm/src/unit_test_stubs/main/GetGlobalValuesMod_stub.F90
A       models/lnd/clm/src/unit_test_stubs/main/do_genf90
A       models/lnd/clm/src/unit_test_stubs/main/ncdio_pio_fake.F90.in
A       models/lnd/clm/src/unit_test_stubs/main/CMakeLists.txt
A       models/lnd/clm/src/unit_test_stubs/main
A       models/lnd/clm/src/unit_test_stubs/dyn_subgrid/dynFileMod_stub.F90
A       models/lnd/clm/src/unit_test_stubs/dyn_subgrid/CMakeLists.txt
A       models/lnd/clm/src/unit_test_stubs/dyn_subgrid
A       models/lnd/clm/src/unit_test_stubs/CMakeLists.txt
A       models/lnd/clm/src/unit_test_stubs

========= Add dependencies (direct & indirect) of IrrigationMod
A       models/lnd/clm/src/biogeochem/CMakeLists.txt

========= Add unit tests for irrigation (see README file for some design notes)
A       models/lnd/clm/src/biogeophys/test/Irrigation_test/test_irrigation_deficit.pf
A       models/lnd/clm/src/biogeophys/test/Irrigation_test/test_irrigation_multipatch.pf
A       models/lnd/clm/src/biogeophys/test/Irrigation_test/IrrigationWrapperMod.F90
A       models/lnd/clm/src/biogeophys/test/Irrigation_test/test_irrigation_singlepatch.pf
A       models/lnd/clm/src/biogeophys/test/Irrigation_test/CMakeLists.txt
A       models/lnd/clm/src/biogeophys/test/Irrigation_test/README
A       models/lnd/clm/src/biogeophys/test/Irrigation_test

List all existing files that have been modified, and describe the changes:

========= Pull irrigation out of CanopyFluxes into its own routine, and also
          pull out the filters that used to be created locally in CanopyFluxes
          and BareGroundFluxes
M       models/lnd/clm/src/main/clm_driver.F90

========= Pull out filters that used to be created locally in CanopyFluxes and
          BareGroundFluxes, so that they can be reused in irrigation and
          elsewhere
M       models/lnd/clm/src/main/filterMod.F90

========= Add calls to irrigation init & restart routines
MM      models/lnd/clm/src/main/clm_initializeMod.F90
M       models/lnd/clm/src/main/restFileMod.F90

========= Irrigation computations are now done in the irrigation module; also,
          the relevant filter is now created outside CanopyFluxes
MM      models/lnd/clm/src/biogeophys/CanopyFluxesMod.F90

========= Irrigation computations are now done in the irrigation module
M       models/lnd/clm/src/biogeophys/CanopyHydrologyMod.F90
M       models/lnd/clm/src/biogeophys/LakeHydrologyMod.F90

========= Irrigation variables are now defined in the irrigation module
M       models/lnd/clm/src/biogeophys/BalanceCheckMod.F90
M       models/lnd/clm/src/biogeophys/WaterfluxType.F90
M       models/lnd/clm/src/biogeophys/HydrologyDrainageMod.F90

========= Filter is now created outside BareGroundFluxes; also, moved some bare
          ground initialization from CanopyFluxes (needed because the filters
          are no longer created locally, so CanopyFluxes does not know what
          points it would need to set for bare ground)
MM      models/lnd/clm/src/biogeophys/BareGroundFluxesMod.F90

========= Remove some dependencies to aid unit testing (this includes combining
          two branches of a conditional (allowlakeprod) that were doing the same
          thing
M       models/lnd/clm/src/biogeophys/SoilStateType.F90


========= Add dependencies (direct & indirect) of IrrigationMod for unit testing
M       models/lnd/clm/src/utils/CMakeLists.txt
M       models/lnd/clm/src/main/CMakeLists.txt
M       models/lnd/clm/src/ED/main/CMakeLists.txt
M       models/lnd/clm/src/CMakeLists.txt
M       models/lnd/clm/src/biogeophys/CMakeLists.txt
M       models/lnd/clm/src/biogeophys/test/CMakeLists.txt

========= Add new unit test utilities
M       models/lnd/clm/src/unit_test_shr/CMakeLists.txt

========= Make newly-added subgrid units active by default
M       models/lnd/clm/src/unit_test_shr/unittestSubgridMod.F90

========= Unrelated fix for gfortran
MM      models/lnd/clm/src/biogeophys/HumanIndexMod.F90

========= Change whitespace
M       models/lnd/clm/src/dyn_subgrid/CMakeLists.txt


CLM testing:

  build-namelist tests:

    yellowstone: not run

  unit-tests (models/lnd/clm/src):

    yellowstone: fail due to two issues:

      (1) The unit tests currently won't build on yellowstone due to an ICE that
      will probably be fixed when we remove dependencies of SoilStateType.

      (2) In addition, even once that's fixed, the yellowstone unit tests either
      need (a) a bump in the unit testing external (unit_testing_0_08) and
      Machines external (Machines_141007) (I didn't do that for my tag because
      it pulls in a bump in the intel compiler version to 14 rather than 13.1),
      or (b) the following diffs:

      Index: tools/unit_testing/python/machine_setup.py
      ===================================================================
      --- tools/unit_testing/python/machine_setup.py	(revision 64421)
      +++ tools/unit_testing/python/machine_setup.py	(working copy)
      @@ -52,7 +52,7 @@
               mod.load("ncarenv/1.0")
               mod.load("ncarbinlibs/1.0")
               if compiler == "intel":
      -            mod.load("intel/13.1.2")
      +            mod.load("intel/14.0.2")
               elif compiler == "pgi":
                   mod.load("pgi/13.9")
               mod.load("ncarcompilers/1.0")
      Index: scripts/ccsm_utils/Machines/config_compilers.xml
      ===================================================================
      --- scripts/ccsm_utils/Machines/config_compilers.xml	(revision 64421)
      +++ scripts/ccsm_utils/Machines/config_compilers.xml	(working copy)
      @@ -547,7 +547,7 @@
         <ADD_FFLAGS>  -xHost </ADD_FFLAGS>
         <ADD_CFLAGS>  -xHost </ADD_CFLAGS>
         <TRILINOS_PATH>$(TRILINOS_PATH)</TRILINOS_PATH>
      -  <PFUNIT_PATH>/glade/u/home/santos/pFUnit/pFUnit_Intel</PFUNIT_PATH>
      +  <PFUNIT_PATH>/glade/u/home/sacks/pFUnit/pFUnit3.0.1_Intel14.0.2_Serial</PFUNIT_PATH>
       </compiler>
       
       <compiler MACH="yellowstone" COMPILER="pgi">



       However, I have run the unit tests on my mac, with gfortran, and they all
       pass


  regular tests (aux_clm40, aux_clm45, with '-model_gen_comp clm2'):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    yellowstone_gnu: NOT RUN
    goldbach_nag: ok
    goldbach_intel: ok

CLM tag used for the baseline comparisons: clm4_5_1_r089

Changes answers relative to baseline: YES (but only because of bug 1998)

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: irrigation
    - what platforms/compilers: all
    - nature of change: larger than roundoff, not investigated closely

    The changes are entirely due to the btran bug (bug 1998): The old flow was:
      - compute btran
      - calculate irrigation (depends on btran)
      - hack btran for soybeans

    whereas the new flow is:
      - call CanopyFluxes: computes btran and hacks btran for soybeans
      - calculate irrigation (depends on btran)

    I have confirmed that answers are bit-for-bit for both irrigation tests (for
    both cpl and clm hist files), when I introduce the following diffs in both
    the trunk and the branch:

    Index: src/biogeophys/CanopyFluxesMod.F90
    ===================================================================
    --- src/biogeophys/CanopyFluxesMod.F90	(revision 64406)
    +++ src/biogeophys/CanopyFluxesMod.F90	(working copy)
    @@ -842,9 +842,6 @@
                       btran(p) = min(1._r8, btran(p) * 3.33_r8)
                    end if
                 end if
    -            if (pft%itype(p) == nsoybean .or. pft%itype(p) == nsoybeanirrig) then
    -               btran(p) = min(1._r8, btran(p) * 1.25_r8)
    -            end if
              end do
     
              if ( use_ed ) then      
    @@ -894,9 +891,6 @@
                          btran(p) = min(1._r8, btran(p) * 3.33_r8)
                       end if
                    end if
    -               if (pft%itype(p) == nsoybean .or. pft%itype(p) == nsoybeanirrig) then
    -                  btran(p) = min(1._r8, btran(p) * 1.25_r8)
    -               end if
                 end do
     
                 call Photosynthesis (bounds, fn, filterp, &



	
===============================================================
===============================================================
Tag name:  clm4_5_1_r089
Originator(s):  erik (Erik)
Date: Mon Oct 13 13:46:43 MDT 2014
One-line Summary: Bring new urban building temperature to trunk as a clm5.0 feature 
                  as well as human-stress index calculations

Purpose of changes:

New prognostic internal building air temperature methodology for CLM5.0. Retain the older simpler method
for CLM4.5. The namelist toggle to switch between them is: building_temp_method. By default for clm4_5 physics
the older method is used and for clm5_0 the newer one is used. Also add in a package of human-stress index
calculations. Again this is by default on for clm5_0 and off for clm4_5. 

The new building air temperature methodology, solves the system of equations for internal: air, roof, floor, 
and wall (shade and sunlit) Temperatures. It uses the LAPACK subroutine DGESV to solve the system. It also
figures out the energy flux needed to either cool the building air temperature to a maximum allowed temperature
or to heat it to the minimum allowed temperature.

Add in the new load balancing tool and the PyReshaper tool (changes multi-variable 
monthly history files into single-variable time-series files).

Remove the now unneeded clm4_5 interpinic as well as the mkmapgrids FORTRAN program.

Requirements for tag: Bring in new clm5_0 building temperature as option, Fix scripts bugs, bug 2053/2032

Test level of tag: regular

Bugs fixed (include bugzilla ID):
            2053 Problems with dry-deposition for fully coupled cases with CLM4.5 in cesm1_3_beta13
            2032 rtm.buildnml.csh kills cesm_setup if GET_REFCASE is FALSE
            1685 Drydeposition potentially using "rs" variable before it's defined (over water)
                 (was fixed but came back)
            Fix bugs: 2024, 2035, 2037 in scripts SBN and namelistcompare issues

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: None

Describe any changes made to the namelist: new namelists and namelist items
    add: clmu_inparm and clm_humanindex_inparm namelists
    move: urban_hac and urban_traffic to clmu_inparm
    add: calc_human_stress_indices to clm_humanindex_inparm
          building_temp_method to clmu_inparm

List any changes to the defaults for the boundary datasets: None

Describe any substantial timing or memory changes:
   clm5_0 memory use is greater than clm4_5 due to human_stress_indices calculations
   and output on history (I've seen it make up to a 20% difference)

Code reviewed by: self, oleson, sacks, mvertens, andre

List any svn externals directories updated (csm_share, mct, etc.): scripts, Machines, rtm, cism, csm_share
   Update to cesm1_3_alpha13c externals.
   Also add in load_balancing_tool and pyReshaper

    scripts             to scripts4_141009
    Machines            to Machines_141001
    rtm                 to rtm1_0_39
    cism                to cism1_140916
    csm_share           to share3_141003
    load_balancing_tool to load_balancing_tool_140818
    pyReshaper          to v0.9.1

List all files eliminated:

--------- Remove clm4_5 interpinic, online interpinic supersedes it
D       models/lnd/clm/tools/clm4_5/interpinic
D       models/lnd/clm/tools/clm4_5/interpinic/*
D       models/lnd/clm/tools/clm4_5/interpinic/src/*

--------- Remove mkmapgrids program
D       models/lnd/clm/tools/shared/mkmapgrids/src
D       models/lnd/clm/tools/shared/mkmapgrids/src/*
D       models/lnd/clm/tools/shared/mkmapgrids/mkmapgrids.namelist
D       models/lnd/clm/tools/shared/mkmapgrids/mkmapgrids.csh

--------- shr_sys_mod was mocked only because of it's use of shr_mpi_mod
--------- mock shr_mpi_mod instead and standard shr_sys_mod can be used
D       models/lnd/clm/src/unit_test_mocks/csm_share/shr_sys_mod_mock.F90

List all files added and what they do:

A       models/lnd/clm/src/biogeophys/HumanIndexMod.F90 -- New module to
           calculate a bunch of human stress index values.

A       models/lnd/clm/src/biogeophys/UrbBuildTempOleson2015Mod.F90 --- New module
           for calculating the prognostic internal building air temperature.

--------- New simple unit tester for humanstress indices module
A       models/lnd/clm/src/biogeophys/test/HumanStress_test/test_humanstress.pf
A       models/lnd/clm/src/biogeophys/test/HumanStress_test/CMakeLists.txt
A       models/lnd/clm/src/biogeophys/test/HumanStress_test

A       models/lnd/clm/src/unit_test_mocks/csm_share/shr_mpi_mod_mock.F90 -- shell
           for most shr_mpi_ calls that do nothing (so assumes MPI is NOT being done)
           shr_mpi_abort does a stop

List all existing files that have been modified, and describe the changes:

--------- remove the mkgriddata and clm4_5 interpinic tools from testing
M       models/lnd/clm/test/tools/input_tests_master
M       models/lnd/clm/test/tools/tests_posttag_yong
M       models/lnd/clm/test/tools/tests_posttag_nompi_regression
M       models/lnd/clm/test/tools/tests_pretag_yellowstone_nompi

--------- remove documentation of mkgriddata and clm4_5 interpinic tools
--------- but add documentation on ncl script
M       models/lnd/clm/tools/shared/mkmapgrids/README
M       models/lnd/clm/tools/README

--------- Add new namelists: clmu_inparm and clm_humanindex_inparm
M       models/lnd/clm/bld/configure ---- use same configuration for clm4_5 AND clm5_0
M       models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_5.xml --- Set
           calc_human_stress_indices, and building_temp_method by clm4_5/clm5_0
M       models/lnd/clm/bld/namelist_files/namelist_definition_clm4_5.xml - Move 
           urban_hac and urban_traffic to new clmu_inparm namelist and
           add building_temp_method and add calc_human_stress_indices to
           clm_humanindex_inparm namelist
M       models/lnd/clm/bld/CLMBuildNamelist.pm -------- Handle new namelists:
           clmu_inparm and clm_humanindex_inparm

--------- Get unit tests working again, and add a simple humanindex test
M       models/lnd/clm/src/utils/CMakeLists.txt
M       models/lnd/clm/src/ED/main/CMakeLists.txt
M       models/lnd/clm/src/ED/biogeophys/CMakeLists.txt
M       models/lnd/clm/src/README.unit_testing
M       models/lnd/clm/src/biogeophys/CMakeLists.txt
M       models/lnd/clm/src/biogeophys/test/CMakeLists.txt
M       models/lnd/clm/src/unit_test_mocks/util_share/spmdMod_mock.F90 - set mpicom
M       models/lnd/clm/src/unit_test_mocks/csm_share/CMakeLists.txt
M       models/lnd/clm/src/CMakeLists.txt

--------- Fix so can work with drydeposition namelist and without megan namelist
M       models/lnd/clm/src/biogeochem/VOCEmissionMod.F90 - Don't initialize if
           megan namelist is turned off (bug 2053)
M       models/lnd/clm/src/biogeochem/DryDepVelocity.F90 - Make sure rs is set 
           before used (bug 1685)

--------- Handle new building temperature options, add new constants
MM      models/lnd/clm/src/main/clm_varcon.F90 -------- Bunch of new constants 
            for urban-building (should be moved to modules that use them). 
            Also pass is_simple_buildtemp into init method
MM      models/lnd/clm/src/main/clm_initializeMod.F90 - Pass building temp type 
            down to relevent init methods add initialization for humanindex_vars, 
            initialize drydepvel_vars (bug 2053)
M       models/lnd/clm/src/main/restFileMod.F90 ------- Pass building temp type 
            logicals down to energyflux_vars and temperature_vars restart methods
M       models/lnd/clm/src/main/LandunitType.F90 ------ Add documentation, correct 
            error in documentation 
MM      models/lnd/clm/src/main/controlMod.F90 -------- Move urban namelist items to 
            UrbanReadNML, add HumanIndexReadNML
M       models/lnd/clm/src/main/clm_driver.F90 -------- Pass humanindex_vars down as needed

--------- Change for new shr_cal_mod names
M       models/lnd/clm/src/ED/biogeophys/EDPhenologyMod.F90 - Use full name of month 
            "january" instead of "jan"

--------- Add new building temperature module and add capability to do old clm4_5
--------- method as well as new method, also do human_stress_indices calculations
MM      models/lnd/clm/src/biogeophys/SoilTemperatureMod.F90 --- Add BuildingHAC for 
           simple building temp method (should move to it's own module) add if 
           statements for building_temp_method type, call BuildingTemperature
           when prognostic method used
M       models/lnd/clm/src/biogeophys/SoilFluxesMod.F90 -------- Change name of 
           eflx_building_heat to eflx_building_heat_errsoi
M       models/lnd/clm/src/biogeophys/TemperatureType.F90 ------ Add building
           temperature variables (should move to urbBuildTemp module), pass building_temp
           method logical down for initialization, add documentation headers
           hist, cold, and restart init depends on building temp method logical
M       models/lnd/clm/src/biogeophys/LakeFluxesMod.F90 -------- calc_human_stress_indices
           (should move to method in humanIndexMod)
MM      models/lnd/clm/src/biogeophys/BareGroundFluxesMod.F90 -- calc_human_stress_indices
           (should move to method in humanIndexMod)
MM      models/lnd/clm/src/biogeophys/CanopyFluxesMod.F90 ------ calc_human_stress_indices
           (should move to method in humanIndexMod)
M       models/lnd/clm/src/biogeophys/EnergyFluxType.F90 ---- change name of eflx_building_heat_col
           to eflx_building_heat_errsoi_col, add some new building temperature flux terms
           add documentation, alloc, hist, restart and cold initialization depends on 
           building temperature method type (should move to urban building module)
M       models/lnd/clm/src/biogeophys/UrbanFluxesMod.F90 ---- Add private functions: 
           wasteheat, simple_wasteheatfromac, calc_simple_internal_building_temp 
           (should move to building_temp modules). 
           calc_human_stress_indices (should move to method in humanIndexMod)
M       models/lnd/clm/src/biogeophys/UrbanParamsType.F90 --- Add methods: UrbanReadNML, 
           IsSimpleBuildTemp, IsProgBuildTemp, add clmu_inparm namelist, and move urban_* items
           there and add building_temp_method to it.

CLM testing:

  build-namelist tests:

    yellowstone        yes

  unit-tests (models/lnd/clm/src):

    yellowstone        yes

  regular tests (aux_clm40, aux_clm45, with '-model_gen_comp clm2'):

    yellowstone_intel  yes
    yellowstone_pgi    yes
    yellowstone_gnu    yes
    goldbach_nag       yes
    goldbach_intel     yes

  short tests (aux_clm_short):

    yellowstone_intel yes
    yellowstone_pgi   yes
    goldbach_nag      yes

  tools testing:      

    yellowstone interactive                                     yes
    PTCLM (models/lnd/clm/tools/shared/PTCLM/test) yellowstone  yes

CLM tag used for the baseline comparisons:  clm4_5_1_r088

Changes answers relative to baseline: No for CLM40 and CLM45
       But, answers DO change for CLM50
       (except scripts tag update changes history files for IG and irrigation compsets/tests)

	
===============================================================
===============================================================
Tag name:  clm4_5_1_r088
Originator(s):  muszala (Stefan Muszala)
Date: Wed Oct  1 09:24:43 MDT 2014
One-line Summary: Pull out ED deps. in TemperatureTypeMod, can now compile with pgi 14.7

Purpose of changes:  Pull out the dependency on EDBioType in TemperatureType.F90.  The ED
variables related to phenology now reside in EDPhenologyMod.F90.  This refactor also had
the effect of getting past a PGI 14.7 ICE which looks like it was due to the use of EDbio_vars
in TemperatureType.F90.  When I pulled out lines 1227 and 1226 of biogeophys/TemperatureType.F90
(in clm4_5_1_r087) and passed the two EDbio_vars variables through the argument list the ICE 
went away.

This tag breaks ED restart tests.  We went ahead with the tag because we had to fix a more 
general problem with the CESM and CAM builds and PGI 14.7.  the ED v0.1.0 branch does not
have these modifications and may be used as an alternative.  A new clm tag will shortly
follow that addresses any remaining problems.

Requirements for tag: None

Test level of tag: regular

Bugs fixed (include bugzilla ID): N/A

Known bugs (include bugzilla ID): N/A
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: N/A

Describe any changes made to the namelist: N/A

List any changes to the defaults for the boundary datasets: N/A

Describe any substantial timing or memory changes: N/A

Code reviewed by: self

List any svn externals directories updated (csm_share, mct, etc.): 

Temporary addition of a cal parameter type in a branch tag.  Will be merged into csm_share trunk shortly. 

-models/csm_share                https://svn-ccsm-models.cgd.ucar.edu/csm_share/trunk_tags/share3_140723
+models/csm_share                https://svn-ccsm-models.cgd.ucar.edu/csm_share/branch_tags/share_ece_tags/share_ece_01_140723

List all files eliminated: N/A

List all files added and what they do:

! new home for ED phenology variables and type-bound procedures that
! allow for accumulation of buffers
A  +    models/lnd/clm/src/ED/biogeophys/EDPhenologyMod.F90
! put some CMakeLists.txt in place for ED unittests
A  +    models/lnd/clm/src/ED/main/CMakeLists.txt
A  +    models/lnd/clm/src/ED/biogeophys/CMakeLists.txt
A  +    models/lnd/clm/src/ED/CMakeLists.txt

List all existing files that have been modified, and describe the changes:

! pull out deps. on EDBioType
M       models/lnd/clm/src/biogeophys/TemperatureType.F90
! add code for new class instance, EDphenology_inst
M       models/lnd/clm/src/main/clm_initializeMod.F90
! add code for new class instance, EDphenology_inst
M       models/lnd/clm/src/main/restFileMod.F90
! add code for new class instance, EDphenology_inst
M       models/lnd/clm/src/main/clm_driver.F90

! add code for new class instance, EDphenology_inst
M       models/lnd/clm/src/ED/biogeochem/EDPhysiologyMod.F90
! pull out ED_GDD_patch and phen_cd_status_patch
M       models/lnd/clm/src/ED/main/EDBioType.F90
! add code for new class instance, EDphenology_inst
M       models/lnd/clm/src/ED/biogeochem/EDPhysiologyMod.F90
! add code for new class instance, EDphenology_inst
M       models/lnd/clm/src/ED/main/EDMainMod.F90
! add code for new class instance, EDphenology_inst
M       models/lnd/clm/src/ED/main/EDCLMLinkMod.F90
! add code for new class instance, EDphenology_inst
M       models/lnd/clm/src/ED/main/EDRestVectorMod.F90
! add code for new class instance, EDphenology_inst
M       models/lnd/clm/src/ED/main/EDInitMod.F90

! for ED unit tests
M       models/lnd/clm/src/CMakeLists.txt

! update CNED failures
M       models/lnd/clm/bld/unit_testers/xFail/expectedClmTestFails.xml

CLM testing:

ERS CNED tests are failing in this tag.  It is expected.  expectedClmTestFails.xml is updated to reflect this.

  build-namelist tests: N/A

    yellowstone

  regular tests (aux_clm40, aux_clm45, with '-model_gen_comp clm2'):

    yellowstone_intel 40-OK, 45-OK
    yellowstone_pgi   40-OK, 45-OK
    goldbach_nag      40-OK, 45-OK
    goldbach_intel    40-OK, 45-OK

CLM tag used for the baseline comparisons: clm4_5_1_r087

Changes answers relative to baseline: No
	
===============================================================
===============================================================
Tag name:  clm4_5_1_r087
Originator(s):  erik (Erik)
Date: Tue Sep 30 12:07:10 MDT 2014
One-line Summary: Fix two balance check errors, and turn abort for balance check back on to appropriate levels

Purpose of changes:

Fix two balance check errors that were causing problems for simulations. Also some of the balance check aborts
were turned off in clm4_5_1_r082, so turn them back on again. Tighten water balance error from 1.e-4 to 1.e-5.
Tighten LW, surface-flux and solar radiation balance errors from 1.e-3 to 1.e-5 and add warning for 1.e-7.
Turn surface-flux balance and soil balance check errors abort back on. Soil balance tightened to 1.e-4 (from 1.e-3)
with warnings shown at 1.e-6.

Also bring in an update to PTCLM, and allow tools tester to be submitted to geyser or caldera. Just as an aside
as something that was already done.

Requirements for tag: Fix bugs: 2026 and 1941

Test level of tag: regular

Bugs fixed (include bugzilla ID):
    2026 Soil balance error
    1941 snowdp balance error

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: None

Describe any changes made to the namelist: None

List any changes to the defaults for the boundary datasets: None

Describe any substantial timing or memory changes: None

Code reviewed by: self, swensosc

List any svn externals directories updated (csm_share, mct, etc.): Update PTCLMmkdata version

   Update PTCLM to PTCLM2_140816

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

M       models/lnd/clm/test/tools/test_driver.sh ------ Allow to run in caldera and geyser as well

M       models/lnd/clm/src/biogeophys/BalanceCheckMod.F90 ---- Add aborts back as well as warnings
            and tighten some error conditions and warnings.
M       models/lnd/clm/src/biogeophys/SoilTemperatureMod.F90 - Remove calculation and use of the 
              heat capacity of frozen h2osfc layer but use the  heat capacity of the liquid layer
              as balance check doesn't know about the frozen, and the discrepency causes balance
              check errors.
M       models/lnd/clm/src/biogeophys/SnowHydrologyMod.F90 --- snow includes dew.

CLM testing:

  build-namelist tests:

    yellowstone YES

  regular tests (aux_clm40, aux_clm45, with '-model_gen_comp clm2'):

    yellowstone_intel           YES
    yellowstone_pgi             YES
    yellowstone_gnu (optional)  YES
    goldbach_nag                YES
    goldbach_intel              YES

CLM tag used for the baseline comparisons:  clm4_5_1_r086

Changes answers relative to baseline: YES!

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM4.5
    - what platforms/compilers: ALL
    - nature of change: same climate (some shorter simulations are still exact)

Simulations that Keith ran to test the snowdp change are:

/glade/p/work/oleson/urb2dev_n00_clm4_5_52/scripts/urb2dev_n03_clm4_5_64_V2DomLam_I20TRCRUCLM45

/glade/p/work/oleson/urb2dev_n00_clm4_5_52/scripts/urb2dev_n03_clm4_5_64_V2DomLam_IRCP85CRUCLM45

   URL for LMWG diagnostics output used to validate new climate:

   For soil balance error...

http://www.cgd.ucar.edu/staff/swensosc/public/diagnostics/ColdtestTRENDYspinupf091850CRU-ColdtestTRENDYspinupf091850CRU_control/setsIndex.html
	
===============================================================
===============================================================
Tag name:  clm4_5_1_r086
Originator(s):  muszala (Stefan Muszala)
Date: Thu Sep 25 09:04:08 MDT 2014
One-line Summary: critical ED modifications from r fisher, fix bug 2043

Purpose of changes:  add modifications to ED, particularly for cold deciduous.  add
                     fix for bug 2043.  Consider these ED baselines as fixed (ie.
                     unless you are modifying ED science, these should now be BFB).

Requirements for tag: N/A

Test level of tag: regular

Bugs fixed (include bugzilla ID): 2043

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: N/A

Describe any changes made to the namelist: N/A

List any changes to the defaults for the boundary datasets: N/A

Describe any substantial timing or memory changes: N/A

Code reviewed by: self, r fisher 

List any svn externals directories updated (csm_share, mct, etc.): N/A

List all files eliminated: N/A

List all files added and what they do: N/A

List all existing files that have been modified, and describe the changes:

M       models/lnd/clm/src/main/lnd2atmMod.F90
-- change intent of waterstate_vars to inout (fixes bug 2043)

M       models/lnd/clm/src/main/clm_driver.F90
-- add EDbio_vars to edmodel actual argument list

M       models/lnd/clm/src/ED/biogeochem/EDCohortDynamicsMod.F90
-- change leaves_off_switch and laimemory handling

M       models/lnd/clm/src/ED/biogeochem/EDPhysiologyMod.F90
-- rework cold deciduous and threshold code.  add fragmentation_scaler routine

M       models/lnd/clm/src/ED/main/EDMainMod.F90
-- change argument lists to include EDbio_vars for ecosystem_dynamics and phenology

M       models/lnd/clm/src/ED/biogeophys/EDSurfaceAlbedoMod.F90
-- overhaul ED norman radiation code

M       models/lnd/clm/src/ED/biogeophys/EDPhotosynthesisMod.F90
-- tweak calculation of jmax25top and tpu25top

M       models/lnd/clm/src/biogeophys/SurfaceAlbedoMod.F90
-- clean up two comments

CLM testing:

  ED compsets change values.

  For bug 2043.  Confirmed that a gnu compile on yellowstone gets passed the intent problem.

  build-namelist tests: N/A

  regular tests (aux_clm40, aux_clm45, with '-model_gen_comp clm2'):

    yellowstone_intel - 40 OK - 45 OK
    yellowstone_pgi   - 40 OK - 45 OK
    goldbach_nag      - 40 OK - 45 OK
    goldbach_intel    - 40 OK - 45 OK

CLM tag used for the baseline comparisons: clm4_5_1_r085

Changes answers relative to baseline: Only for ED compsets

===============================================================
===============================================================
Tag name:  clm4_5_1_r085
Originator(s):  sacks (Bill Sacks)
Date: Fri Sep 19 10:22:30 MDT 2014
One-line Summary: replace conditionals with polymorphism for soil water retention curve

Purpose of changes:

The main motivation for this tag was the need to introduce a
soil_suction_inverse routine, which will be used for irrigation. It is important
that soil_suction_inverse remains consistent with soil_suction for every soil
water retention curve method. In talking with Ben Andre and Erik, we felt the
best way to ensure this consistency was to have a separate, small module for
each soil retention curve method. We felt the best way to implement this was via
polymorphism. Polymorphism is arguably overkill in this simple case, but we
thought it would be good to convert it to polymorphism partly as an example that
we and others can follow in more complex cases where it will provide greater
benefit.

To add a new soil retention curve method:

   (1) Create a module similar to
   SoilWaterRetentionCurveClappHornberg1978Mod.F90
   
   (2) Modify the select case statement in SoilWaterRetentionCurveFactoryMod.F90
   so that it is able to create an instance of your new type

Note that this refactor also combines the soil_suction and soil_hk
parameterization options into a single option. Dave Lawrence and Rosie Fisher
felt that was preferable, and Jinyun Tang was okay with this.

Requirements for tag: N/A

Test level of tag: regular

Bugs fixed (include bugzilla ID):

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: andre, muszala, Jinyun Tang

List any svn externals directories updated (csm_share, mct, etc.): none

List all files eliminated:

========= Replaced with the 3 new files noted below
D       models/lnd/clm/src/biogeophys/SoiWatRetCurveParMod.F90

List all files added and what they do:

========= Replacement for SoiWatRetCurveParMod, implemented using
          polymorphism. Note that I have also added a soil_suction_inverse
          routine, which is not yet used or tested. I'll be using (and testing)
          this in an upcoming tag, where I refactor the irrigation code to use this.
A       models/lnd/clm/src/biogeophys/SoilWaterRetentionCurveMod.F90
A       models/lnd/clm/src/biogeophys/SoilWaterRetentionCurveFactoryMod.F90
A       models/lnd/clm/src/biogeophys/SoilWaterRetentionCurveClappHornberg1978Mod.F90

List all existing files that have been modified, and describe the changes:

========= Minor changes to accommodate the refactored code
M       models/lnd/clm/src/main/clm_initializeMod.F90
M       models/lnd/clm/src/main/init_hydrology.F90
M       models/lnd/clm/src/main/clm_driver.F90
M       models/lnd/clm/src/biogeophys/CanopyFluxesMod.F90
M       models/lnd/clm/src/biogeophys/SoilWaterMovementMod.F90
M       models/lnd/clm/src/biogeophys/SoilMoistStressMod.F90
M       models/lnd/clm/src/biogeophys/HydrologyNoDrainageMod.F90


CLM testing:

  regular tests (aux_clm40, aux_clm45, with '-model_gen_comp clm2'):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    yellowstone_gnu: NOT RUN
    goldbach_nag: ok
    goldbach_intel: ok

CLM tag used for the baseline comparisons: clm4_5_1_r084

Changes answers relative to baseline: NO - bfb

===============================================================
===============================================================
Tag name:  clm4_5_1_r084
Originator(s):  sacks (Bill Sacks)
Date: Thu Sep 18 14:39:44 MDT 2014
One-line Summary: make glc_dyn_runoff_routing spatially-varying, based on input from glc

Purpose of changes:

Dave Lawrence, Bill Lipscomb and Jeremy Fyke have pointed out that
glc_dyn_runoff_routing needs to be spatially-varying: Even when we're coupling
to CISM, we should continue to use the old scheme in regions that don't have an
active icesheet model underneath (which currently includes Antarctica and all of
the world's smaller glaciers - i.e., everything except Greenland). Furthermore,
we have introduced a new ability into CISM to run in diagnostic mode, without
sending calving/runoff fluxes to the coupler. In this case, too, CLM should
revert to using the old scheme (glc_dyn_runoff_routing = .false.).

To accomplish both of these things, I have introduced a new coupling field,
through which GLC tells CLM which areas have an icesheet that is "active" in the
sense of sending fluxes to the coupler. In this CLM tag, CLM sets a
spatially-varying version of glc_dyn_runoff_routing based on this new coupler
field - replacing the old, namelist-settable version of this flag.

Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID):

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist:

  - removed glc_dyn_runoff_routing

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: self

List any svn externals directories updated (csm_share, mct, etc.):

  drv: drvseq5_0_15 -> drvseq5_0_17
    - fix for some multi-instance runs
    - add icemask_coupled_fluxes field

  cism: cism1_140602 -> cism1_140914
    - Add zero_gcm_fluxes option; send icemask_coupled_fluxes field to coupler

  scripts: scripts4_140916b -> scripts4_140916c
    - Rename CLM_UPDATE_GLC_AREAS to GLC_TWO_WAY_COUPLING

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Rename CLM_UPDATE_GLC_AREAS xml variable to GLC_TWO_WAY_COUPLING.
          Remove glc_dyn_runoff_routing namelist variable (this is now a
          spatially-varying field, tied more tightly to CISM).
M       models/lnd/clm/bld/namelist_files/namelist_definition_clm4_5.xml
M       models/lnd/clm/bld/CLMBuildNamelist.pm
M       models/lnd/clm/bld/unit_testers/build-namelist_test.pl
M       models/lnd/clm/bld/user_nl_clm
M       models/lnd/clm/bld/env_run.xml

========= Receive icemask_coupled_fluxes from CISM
M       models/lnd/clm/src/cpl/lnd_import_export.F90
M       models/lnd/clm/src/cpl/clm_cpl_indices.F90

========= Set spatially-varying glc_dyn_runoff_routing field based on
          icemask_coupled_fluxes, and use this in place of the old scalar
          glc_dyn_runoff_routing flag
M       models/lnd/clm/src/main/glc2lndMod.F90
M       models/lnd/clm/src/main/clm_driver.F90
M       models/lnd/clm/src/main/clm_varctl.F90
M       models/lnd/clm/src/main/controlMod.F90
M       models/lnd/clm/src/biogeophys/BalanceCheckMod.F90
M       models/lnd/clm/src/biogeophys/HydrologyDrainageMod.F90
M       models/lnd/clm/src/dyn_subgrid/dynSubgridDriverMod.F90

========= Add write statement to workaround a pgi compiler problem
M       models/lnd/clm/src/main/restFileMod.F90

CLM testing:

  build-namelist tests:

    yellowstone: ok (baseline comparisons fail for clm45 & clm50, as expected)

  regular tests (aux_clm40, aux_clm45, with '-model_gen_comp clm2'):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    yellowstone_gnu: NOT RUN
    goldbach_nag: ok
    goldbach_intel: ok

    Note: Most testing was run on glc_runoff_routing_n06_clm4_5_1_r083. After
    that tag, I added the following write statement in restFileMod, as a
    workaround for a PGI compiler bug:

       write(iulog,*) 'about to call aerosol_vars%restart: ', ubound(waterstate_vars%h2osoi_ice_col)    

    After that addition, I just reran a subset of tests: 6 yellowstone-intel
    tests, 10 yellowstone-pgi tests (including the 2 that had failed due to the
    compiler bug), and 5 goldbach-nag tests. 

NOTE: Unit test build is currently failing due to a change in r082. Stefan is
working on a fix.

CLM tag used for the baseline comparisons: clm4_5_1_r083

Changes answers relative to baseline: YES

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM45 with CISM (i.e., IG)
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 

    (1) Large changes in runoff from glaciers in IG compsets, due to setting
    glc_dyn_runoff_routing to .false. outside of Greenland.

    (2) Roundoff-level changes in icemask for some resolutions and compilers,
    due to changes in the cism external.

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? For icemask changes: examined cprnc RMS errors. For other
   changes, diffs are greater than roundoff.

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	
===============================================================
===============================================================
Tag name:  clm4_5_1_r083
Originator(s):  muszala (Stefan Muszala)
Date: Wed Sep 17 09:21:31 MDT 2014
One-line Summary: only update scripts and run new baselines.  this due to an error in yellowstone pgi test naming (clm_aux45 changed to aux_clm45)

Purpose of changes: Update scripts due to an error in a previous scripts tag in which I named pgi tests as clm_aux45 instead
of aux_clm45.  These were for tests moved from goldbach to yellowstone.

Requirements for tag: N/A

Test level of tag: regular

Bugs fixed (include bugzilla ID): N/A

Known bugs (include bugzilla ID): N/A
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: N/A

Describe any changes made to the namelist: N/A

List any changes to the defaults for the boundary datasets: N/A

Describe any substantial timing or memory changes: N/A

Code reviewed by: self

List any svn externals directories updated (csm_share, mct, etc.): scripts4_140910 -> scripts4_140916b

List all files eliminated: N/A

List all files added and what they do: N/A

List all existing files that have been modified, and describe the changes: N/A

- update test list failures
M       models/lnd/clm/bld/unit_testers/xFail/expectedClmTestFails.xml

CLM testing:

  regular tests (aux_clm40, aux_clm45, with '-model_gen_comp clm2'):

    WJS: note: Stef told me that he actually ran all the yellowstone tests, and
    all were okay

    yellowstone_intel - 40 OK 
    yellowstone_pgi

    goldbach_nag      - 40 OK, 45 OK 
    goldbach_intel    - 40 OK, 45 OK

Note 1:  Due to the fact that in older baselines component_gen_comp was failing due to a scripts error (now fixed)
some older baselines don't have the clm history files.  As one example:

   BFAIL ERI_D.f10_f10.ICRUCLM50BGC.goldbach_intel.clm-reduceOutput.compare_hist.clm4_5_1_r082 
   - rerun.  compare against clm4_5_1_r081, then it passes.
   PASS  ERI_D.f10_f10.ICRUCLM50BGC.goldbach_intel.clm-reduceOutput 
   PASS  ERI_D.f10_f10.ICRUCLM50BGC.goldbach_intel.clm-reduceOutput.memleak
   PASS  ERI_D.f10_f10.ICRUCLM50BGC.goldbach_intel.clm-reduceOutput.compare_hist.clm4_5_1_r082_oldPgi 
   PASS  ERI_D.f10_f10.ICRUCLM50BGC.goldbach_intel.clm-reduceOutput.memcomp.clm4_5_1_r082_oldPgi 
   PASS  ERI_D.f10_f10.ICRUCLM50BGC.goldbach_intel.clm-reduceOutput.tputcomp.clm4_5_1_r082_oldPgi 
   PASS ERI_D.f10_f10.ICRUCLM50BGC.goldbach_intel.clm-reduceOutput.C.140917-082253.nlcomp

   For these tests, I made sure that clm2 history files were in the clm4_5_1_r083 baseline dirs.  They
   should pass going forward.

   ERI_D.f10_f10.ICRUCLM50BGC.goldbach_intel.clm-reduceOutput
   PEM.f10_f10.ICLM45BGCCROP.goldbach_intel.clm-crop
   SSP.f19_g16.I1850CLM45BGC.yellowstone_pgi.clm-default

Note 2: For these N2 tests, there was a scripts problem with st_archiver in the previous tag.  These should pass next time.
   BFAIL ERI_N2.f19_g16.ICRUCLM45BGCCROP.yellowstone_intel.compare_hist.clm4_5_1_r082 
   BFAIL ERI_N2.f19_g16.ICRUCLM45BGCCROP.yellowstone_intel.clm-default.compare_hist.clm4_5_1_r082 
   BFAIL ERI_N2.f19_g16.ICRUCLM45BGCCROP.yellowstone_intel.clm-default.clm2.h0.compare_hist.clm4_5_1_r082 
   BFAIL ERI_N2.f19_g16.ICRUCLM45BGCCROP.yellowstone_intel.clm-default.clm2.h1.compare_hist.clm4_5_1_r082

CLM tag used for the baseline comparisons: clm4_5_1_r082

Changes answers relative to baseline: No

===============================================================
===============================================================
Tag name:  clm4_5_1_r082
Originator(s):  muszala (Stefan Muszala)
Date: Thu Sep 11 14:07:58 MDT 2014
One-line Summary: Merge in a number of ED changes to address science bugs and infrastructure (particularly restarts)

Purpose of changes: Merge in ED changes.  Most of these have to do with science changes from rfisher.  There
is also a refactor and added functionality for ED restarts.

Requirements for tag: N/A

Test level of tag: regular

Bugs fixed (include bugzilla ID): N/A

Known bugs (include bugzilla ID): Bug 2041, 2042
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: N/A

Describe any changes made to the namelist: N/A

List any changes to the defaults for the boundary datasets: N/A

Describe any substantial timing or memory changes: N/A

Code reviewed by: self, rfisher

List any svn externals directories updated (csm_share, mct, etc.): 
    scripts4_140814a -> scripts4_140910

List all files eliminated: N/A

List all files added and what they do: N/A

List all existing files that have been modified, and describe the changes:

M       models/lnd/clm/bld/unit_testers/xFail/expectedClmTestFails.xml
-- add failing N2 tests (due to scripts, see below).

M       models/lnd/clm/bld/build-namelist
-- documentation at top of file should reference CLMBuildNamelist.pm

M       models/lnd/clm/src/main/clm_driver.F90
-- add call to SurfaceAlbedo for use_ed logical branch, add EDBioVars as 
-- argument to temperature_vars%UpdateAccVars and add canopystate_vars as 
-- argument to BalanceCheck (for ED)
M       models/lnd/clm/src/main/decompMod.F90
-- added openMP output...remove mods after getting ED working with openMP

M       models/lnd/clm/src/ED/biogeochem/EDCanopyStructureMod.F90
-- change handling of CWD_AG and CWD_BG
M       models/lnd/clm/src/ED/biogeochem/EDGrowthFunctionsMod.F90
-- added tree_sai function
M       models/lnd/clm/src/ED/biogeochem/EDCohortDynamicsMod.F90
-- signifcant reworking of entire module 
M       models/lnd/clm/src/ED/biogeochem/EDPhysiologyMod.F90
-- minor code clean up 
M       models/lnd/clm/src/ED/biogeochem/EDPatchDynamicsMod.F90
-- change an error check to: if (( areatot - area ) > 0._r8 ) then 

M       models/lnd/clm/src/ED/main/EDBioType.F90
-- add infrastrucutre (define, allocate, etc...) 
M       models/lnd/clm/src/ED/main/EDMainMod.F90
-- major update for updating canopy biomass pools 
M       models/lnd/clm/src/ED/main/EDCLMLinkMod.F90
-- modify calls for history file output and error checking
M       models/lnd/clm/src/ED/main/EDRestVectorMod.F90
-- add resp_clm as restart variable and use SHR_ASSERT instead of call assert.  major refactor
-- of createPatchCohortStructure to handle arbitrary number of cohorts and patches
M       models/lnd/clm/src/ED/main/EDInitMod.F90
-- add logical to deal with different values of assignemnt dc%laimemory
M       models/lnd/clm/src/ED/main/EDTypesMod.F90
-- add cohort_type and change paramters: numCohortsPerPatch, cohorts_per_gcell and fire_threshold

M       models/lnd/clm/src/ED/fire/SFMainMod.F90
-- clean up write statemnts and a bug fix:  change tau_b(dg_sf) -> tau_b(c)

M       models/lnd/clm/src/ED/biogeophys/EDPhotosynthesisMod.F90
-- change  tpu25top(FT)  = 0.06_r8   * jmax25top(FT) to tpu25top(FT)  = 0.167_r8   * jmax25top(FT), some cleanup

M       models/lnd/clm/src/biogeophys/SnowHydrologyMod.F90
-- clean up a use statement
M       models/lnd/clm/src/biogeophys/BareGroundFluxesMod.F90
-- remove whitespaces after a statement
M       models/lnd/clm/src/biogeophys/SurfaceAlbedoMod.F90
-- add a use_ed block to prevent some unassigned pointer errors
M       models/lnd/clm/src/biogeophys/BalanceCheckMod.F90
-- add canopystate_vars as argument for elai and esai for more verbose error
-- reporting added by rfisher
M       models/lnd/clm/src/biogeophys/TemperatureType.F90
-- add arg. for UpdateAccVars for new calculations, split out use_ed and use_crop
M       models/lnd/clm/src/biogeophys/SurfaceRadiationMod.F90
-- add associate statement to tlai for error reporting

M       UpDateChangeLog.pl
-- fix tiny typo

M       SVN_EXTERNAL_DIRECTORIES
-- for scripts update

CLM testing:

  build-namelist tests:

    yellowstone - N/A, no namelist changes made in this tag

  regular tests (aux_clm40, aux_clm45, with '-model_gen_comp clm2'):

    yellowstone_intel - 45 OK , 40 OK

    Changes due to update of scripts from scripts4_140814a -> scripts4_140910 (this change came with scripts4_140828)
    FAIL namelist compare:  user_nl_clm differs
    These should pass next time.

       NEW:        flanduse_timeseries = '$DIN_LOC_ROOT/lnd/clm2/surfdata_map/surfdata.pftdyn_1x1_tropicAtl_TEST_simyr1939-1943_c140108.nc'
       BASELINE: flanduse_timeseries = '/glade/p/cesmdata/cseg/inputdata/lnd/clm2/surfdata_map/surfdata.pftdyn_1x1_tropicAtl_TEST_simyr1939-1943_c140108.nc'

          FAIL SMS_Ly3.1x1_tropicAtl.I20TRCLM45BGC.yellowstone_intel.clm-tropicAtl_subsetLate.GC.newPgi_45_intel.nlcomp
          FAIL SMS_Ly5.1x1_tropicAtl.I20TRCLM45BGC.yellowstone_intel.clm-tropicAtl_subsetMid.GC.newPgi_45_intel.nlcomp
          FAIL SMS_Ly8.1x1_tropicAtl.I20TRCLM45BGC.yellowstone_intel.clm-tropicAtl_subsetEarly.GC.newPgi_45_intel.nlcomp

    These fail due to a bug in scripts4_140905c.  Alice is aware of this and will provide a fix for a future CLM tag (but 2041):
       FAIL  ERI_N2.f19_g16.ICRUCLM45BGCCROP.yellowstone_intel 
       FAIL  ERI_N2.f19_g16.ICRUCLM45BGCCROP.yellowstone_intel.clm-default 

    Failure that looks like a hardware problem and that Erik is looking into (bug 2042):
       RUN   ERI_D.ne30_g16.ICLM45BGC.yellowstone_intel.GC.newPgi_45_intel

    yellowstone_pgi   - 45 OK , 40 OK

    New PGI tests brought over from goldbach.  These are expected as there are no baselines for this on yellowstone

       BFAIL ERI_D.f10_f10.ICLM45BGC.yellowstone_pgi.clm-reduceOutput.compare_hist.clm4_5_1_r081 
       BFAIL ERI_D.f10_f10.ICRUCLM50BGC.yellowstone_pgi.clm-reduceOutput.compare_hist.clm4_5_1_r081 
       BFAIL ERI_D.f19_g16.ICLM45BGC.yellowstone_pgi.clm-reduceOutput.compare_hist.clm4_5_1_r081 
       BFAIL ERI_D.f19_g16.ICLM45.yellowstone_pgi.clm-reduceOutput.compare_hist.clm4_5_1_r081 
       BFAIL ERI_D.f19_g16.ICRUCLM50BGC.yellowstone_pgi.clm-reduceOutput.compare_hist.clm4_5_1_r081 
       BFAIL ERI.f10_f10.ICLM45BGC.yellowstone_pgi.clm-reduceOutput.compare_hist.clm4_5_1_r081 
       BFAIL ERI.f10_f10.ICRUCLM50BGC.yellowstone_pgi.clm-reduceOutput.compare_hist.clm4_5_1_r081 
       BFAIL ERI.f19_g16.ICLM45BGC.yellowstone_pgi.clm-reduceOutput.compare_hist.clm4_5_1_r081 
       BFAIL ERI.f19_g16.ICRUCLM50BGC.yellowstone_pgi.clm-reduceOutput.compare_hist.clm4_5_1_r081 
       BFAIL ERS_D.f10_f10.I20TRCLM45BGC.yellowstone_pgi.clm-decStart.clm2.h0.compare_hist.clm4_5_1_r081 
       BFAIL ERS_D.f10_f10.I20TRCLM45BGC.yellowstone_pgi.clm-decStart.clm2.h1.compare_hist.clm4_5_1_r081 
       BFAIL ERS_D.f10_f10.I20TRCLM45BGC.yellowstone_pgi.clm-decStart.compare_hist.clm4_5_1_r081 
       BFAIL ERS_D.f10_f10.ICLM45BGC.yellowstone_pgi.clm-ciso.clm2.h0.compare_hist.clm4_5_1_r081 
       BFAIL ERS_D.f10_f10.ICLM45BGC.yellowstone_pgi.clm-ciso.clm2.h1.compare_hist.clm4_5_1_r081 
       BFAIL ERS_D.f10_f10.ICLM45BGC.yellowstone_pgi.clm-ciso.compare_hist.clm4_5_1_r081 
       BFAIL ERS.f10_f10.I1850CLM45BGC.yellowstone_pgi.clm-default.clm2.h0.compare_hist.clm4_5_1_r081 
       BFAIL ERS.f10_f10.I1850CLM45BGC.yellowstone_pgi.clm-default.clm2.h1.compare_hist.clm4_5_1_r081 
       BFAIL ERS.f10_f10.I1850CLM45BGC.yellowstone_pgi.clm-default.compare_hist.clm4_5_1_r081 
       BFAIL ERS_Lm3.1x1_smallvilleIA.ICLM45BGCCROP.yellowstone_pgi.clm2.h0.compare_hist.clm4_5_1_r081 
       BFAIL ERS_Lm3.1x1_smallvilleIA.ICLM45BGCCROP.yellowstone_pgi.compare_hist.clm4_5_1_r081 
       BFAIL SMS_D.1x1_vancouverCAN.ICLM45.yellowstone_pgi.clm-default.clm2.h0.compare_hist.clm4_5_1_r081 
       BFAIL SMS_D.1x1_vancouverCAN.ICLM45.yellowstone_pgi.clm-default.clm2.h1.compare_hist.clm4_5_1_r081 
       BFAIL SMS_D.1x1_vancouverCAN.ICLM45.yellowstone_pgi.clm-default.compare_hist.clm4_5_1_r081 
       BFAIL SMS.f45_f45.ICLM45.yellowstone_pgi.clm-ptsRLB.clm2.h0.compare_hist.clm4_5_1_r081 
       BFAIL SMS.f45_f45.ICLM45.yellowstone_pgi.clm-ptsRLB.clm2.h1.compare_hist.clm4_5_1_r081 
       BFAIL SMS.f45_f45.ICLM45.yellowstone_pgi.clm-ptsRLB.compare_hist.clm4_5_1_r081 
       BFAIL SMS.f45_f45.ICLM45.yellowstone_pgi.clm-ptsROA.compare_hist.clm4_5_1_r081 
       BFAIL SMS_Ld5.f19_g16.IRCP45CLM45BGC.yellowstone_pgi.clm-decStart.clm2.h0.compare_hist.clm4_5_1_r081 
       BFAIL SMS_Ld5.f19_g16.IRCP45CLM45BGC.yellowstone_pgi.clm-decStart.clm2.h1.compare_hist.clm4_5_1_r081 
       BFAIL SMS_Ld5.f19_g16.IRCP45CLM45BGC.yellowstone_pgi.clm-decStart.compare_hist.clm4_5_1_r081 

    goldbach_nag - 45 OK , 40 OK

    Baseline missing from previous tag:
       ERI_D.f19_g16.ICLM45BGC.goldbach_nag.clm-reduceOutput-  
          file /fs/cgd/csm/ccsm_baselines/clm4_5_1_r081/ERI_D.f19_g16.ICLM45BGC.goldbach_nag.clm-reduceOutput/cpl.hi.nc does not exis
       SMS.f09_g16.ICRUCLM45.goldbach_nag.clm-af_bias_v5
          file /fs/cgd/csm/ccsm_baselines/clm4_5_1_r081/SMS.f09_g16.ICRUCLM45.goldbach_nag.clm-af_bias_v5/cpl.hi.nc does not exist
       SMS_Ly1.f19_g16.ICLM45BGCCROP.goldbach_nag.clm-reduceOutput 
          file /fs/cgd/csm/ccsm_baselines/clm4_5_1_r081/SMS_Ly1.f19_g16.ICLM45BGCCROP.goldbach_nag.clm-reduceOutput/cpl.hi.nc does no
       SMS_Ly1.f19_g16.ICLM45BGCCROP.goldbach_nag.clm-reduceOutput
          file /fs/cgd/csm/ccsm_baselines/clm4_5_1_r081/SMS_Ly1.f19_g16.ICLM45BGCCROP.goldbach_nag.clm-reduceOutput/cpl.hi.nc does no    t exist

    goldbach_intel - 45 OK , 40 OK

    goldbach_pgi (These have been moved to yellowstone due to PGI 14.1 throwing and ICE on goldbach)

CLM tag used for the baseline comparisons: clm4_5_1_r081

Changes answers relative to baseline: Only for ED compsets

===============================================================
===============================================================
Tag name:  clm4_5_1_r081
Originator(s):  mvertens (Mariana Vertenstein)
Date: Sun Aug 24 19:39:50 MDT 2014
One-line Summary: major infrastructure changes and directory reorganization under src

Purpose of changes:

   Overview of previous code design
   ==========================================
   - data structures arranged by subgrid type (pps, cps, lps, grc)
   - all functional categorization lumped in that one subgrid type which led to
   - centralization rather than modularization of all data
   - definition and instantiation in ONE big module (clmtype.F90)
   - allocation and initialization in ONE big module (clmtypeInitMod.F90)
   - history variables all in ONE big module (histFldsMod.F90)
   - restart variables in effectively TWO big modules (biogeophysicsRestMod.F90 and CNRestMod.F90)
   - time constant initialization in ONE complex module (initTimeConst.F90)
   - time varying cold start initialization in ONE module (initColdMod.F90)
   - accumulation variables in ONE module (accumulMod.F90)

   Overview of new code design
   ==========================================
   data structures arranged by scientific functional categories
     (e.g. temperature_type, waterstate_type, energyflux_type, etc)
   - a given data structure now contains ALL subgrid levels are in the data structure -
     and variables in the data structure are now appended with a unique suffix to
     indicate their subgrid levels (new suffixes: _patch, _col, _lun, _grc)
   - this does NOT effect the science code base, ONLY the associate statements
   - there are separate module for each data type definition
     (e.g. TemperatureType.F90, WaterstateType.F90, EnergyFluxType.F90, etc)
   - each data type has associated methods for
     - Allocation:
       variables now initialized as NaNs upon allocation
     - Cold Start Initialization:
       cold start initialization of variables is now ALWAYS done
       and overwritten if finidat is read in as spun up dataset (also now
       have on line interpolation of initial conditions as part of this refactor as well)
     - History initialization of variables
       All history fields now initialized as spval
     - Restart initialization of variables
     - Accumulation Initialization 
       initialization and accumulation update of variables
   - Instantiation of datatypes is now separate from their declaration
     (for now in clm_initialize.F90 - will be moved in the future)

   Centralized routines that no longer exist:
   ==========================================
   Data types  	  : clmtype.F90, clmtypeInitMod.F90
   Initialization : initTimeConst.F90, initCold.F90
   History	  : histFldsMod.F90
   Accumulation	  : accumulMod.F90
   Restart        : biogeophysRestMod.F90, CNRestMod.F90
   Biogeochemistry: CNSetValue.F90

   New Type modules that now replace clmtype.F90
   ==========================================
   main/atm2lndType.F90
   main/lnd2atmType.F90
   main/ColumnType.F90
   main/EcophysConType.F90
   main/GridcellType.F90
   main/LandunitType.F90
   main/PatchType.F90

   biogeochem/CNCarbonFluxType.F90
   biogeochem/CNCarbonStateType.F90
   biogeochem/CNDecompCascadeConType.F90
   biogeochem/CNDVType.F90
   biogeochem/CNNitrogenFluxType.F90
   biogeochem/CNNitrogenStateType.F90
   biogeochem/CNStateType.F90
   biogeochem/CropType.F90

   biogeophys/AerosolType.F90
   biogeophys/CanopyStateType.F90
   biogeophys/EnergyFluxType.F90
   biogeophys/FrictionVelocityType.F90
   biogeophys/LakeStateType.F90
   biogeophys/PhotosynthesisType.F90
   biogeophys/SoilHydrologyType.F90
   biogeophys/SoilStateType.F90
   biogeophys/SolarAbsorbedType.F90
   biogeophys/SurfaceAlbedoType.F90
   biogeophys/TemperatureType.F90
   biogeophys/UrbanParamsType.F90
   biogeophys/WaterfluxType.F90
   biogeophys/WaterStateType.F90

   ED/main/EDBioType.F90
   ED/main/EDEcophysConType.F90
   ED/main/EDVecCohortType.F90
   ED/main/EDVecPatchType.F90


   Instantiation of Types

2) Public Types:

   - the following are public types that can BE PASSED AS ARGUMENTS 
   - the type instances FOR NOW are clm_initialized and then used by the driver
   - this will be generalized in the future	

  type(ch4_type)              :: ch4_vars
  type(carbonstate_type)      :: carbonstate_vars
  type(carbonstate_type)      :: c13_carbonstate_vars
  type(carbonstate_type)      :: c14_carbonstate_vars
  type(carbonflux_type)       :: carbonflux_vars
  type(carbonflux_type)       :: c13_carbonflux_vars
  type(carbonflux_type)       :: c14_carbonflux_vars
  type(nitrogenstate_type)    :: nitrogenstate_vars
  type(nitrogenflux_type)     :: nitrogenflux_vars
  type(dgvs_type)             :: dgvs_vars
  type(crop_type)             :: crop_vars
  type(cnstate_type)          :: cnstate_vars
  type(dust_type)             :: dust_vars
  type(vocemis_type)          :: vocemis_vars
  type(drydepvel_type)        :: drydepvel_vars
  type(aerosol_type)          :: aerosol_vars
  type(canopystate_type)      :: canopystate_vars
  type(energyflux_type)       :: energyflux_vars
  type(frictionvel_type)      :: frictionvel_vars
  type(lakestate_type)        :: lakestate_vars
  type(photosyns_type)        :: photosyns_vars
  type(soilstate_type)        :: soilstate_vars
  type(soilhydrology_type)    :: soilhydrology_vars
  type(solarabs_type)         :: solarabs_vars
  type(surfalb_type)          :: surfalb_vars
  type(surfrad_type)          :: surfrad_vars
  type(temperature_type)      :: temperature_vars
  type(urbanparams_type)      :: urbanparams_vars
  type(waterflux_type)        :: waterflux_vars
  type(waterstate_type)       :: waterstate_vars
  type(atm2lnd_type)          :: atm2lnd_vars
  type(glc2lnd_type)          :: glc2lnd_vars
  type(lnd2atm_type)          :: lnd2atm_vars
  type(lnd2glc_type)          :: lnd2glc_vars
  type(glc_diagnostics_type)  :: glc_diagnostics_vars
  type(EDbio_type)            :: EDbio_vars

  - private Types (now som modules have their own PRIVATE types) 
 
   DUSTMod.F90       :    type(dust_type)     
   VOCEmissionMod.F90:    type(vocemis_type)  
   ch4Mod.F90        :    type(ch4_type)      

   API Changes:
   ==========================================
   Original APIs:
   clmtype was in effect a global common block and all routines had use statements into it
   difficult to track any intent or flow through system
   difficult to set up functional unit testing (.e.g. CanopyFluxesMod.F90, etc)
	
   Refactorized APIs:
   all new datatype instances are passed as arguments
   science code is effectively the same since only the associate statements have been modified

   New Directory Structure under clm/
   ==========================================
   bld/
   doc/	
   src/biogeochem/
   src/biogeophys/
   src/cpl/
   src/dyn_subgrid/
   src/ED/
   src/ED/biogeochem
   src/ED/biogeophys
   src/ED/fire
   src/ED/main	
   src/main/
   src/unit_test_mocks/
   src/unit_test_shr/
   src/utils/
   src_clm4_0/
   test/
   tools/  	
	
   Advantages of refactorization:
   ==========================================
   - Lets compiler enforce intent attributes
   - Makes functional unit testing easier since module drivers can be
     constructed with relevant mock data more easily
   - Makes more sense scientifically since now easier to extend code logic as
     to where you want to introduce new variables
   - Easier to maintain code since code flow is easier to follow and to modify
   - Easy to move variables around from one data type to another since now
     know everything that is logically connected to that variable that
     needs to be moved Offers new modularity for trading in and out new
     formulations of targeted functionality

Requirements for tag: N.A.

Test level of tag: regular

Bugs fixed (include bugzilla ID): N.A.

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system:
    directory restructuring has been reflected in changes to configure in setting up the Filepath

Describe any changes made to the namelist:
    clm_hydrology1_inparm changed to clm_canopyhydrology_inparm

List any changes to the defaults for the boundary datasets: None

Describe any substantial timing or memory changes: None

Code reviewed by: myself, Bill Sacks

List any svn externals directories updated (csm_share, mct, etc.): None

List all files eliminated: 

D       clm/src/clm4_5
D       clm/src/clm4_5/biogeochem
D       clm/src/clm4_5/biogeochem/CNCStateUpdate2Mod.F90
D       clm/src/clm4_5/biogeochem/CNGapMortalityMod.F90
D       clm/src/clm4_5/biogeochem/CNRestMod.F90
D       clm/src/clm4_5/biogeochem/CropRestMod.F90
D       clm/src/clm4_5/biogeochem/CNGRespMod.F90
D       clm/src/clm4_5/biogeochem/CNNitrifDenitrifMod.F90
D       clm/src/clm4_5/biogeochem/CNNStateUpdate1Mod.F90
D       clm/src/clm4_5/biogeochem/CNBalanceCheckMod.F90
D       clm/src/clm4_5/biogeochem/CNNStateUpdate3Mod.F90
D       clm/src/clm4_5/biogeochem/CNFireMod.F90
D       clm/src/clm4_5/biogeochem/CNMRespMod.F90
D       clm/src/clm4_5/biogeochem/MEGANFactorsMod.F90
D       clm/src/clm4_5/biogeochem/SatellitePhenologyMod.F90
D       clm/src/clm4_5/biogeochem/CNVerticalProfileMod.F90
D       clm/src/clm4_5/biogeochem/ch4RestMod.F90
D       clm/src/clm4_5/biogeochem/CNPrecisionControlMod.F90
D       clm/src/clm4_5/biogeochem/CNCIsoFluxMod.F90
D       clm/src/clm4_5/biogeochem/CNWoodProductsMod.F90
D       clm/src/clm4_5/biogeochem/CNSummaryMod.F90
D       clm/src/clm4_5/biogeochem/ch4Mod.F90
D       clm/src/clm4_5/biogeochem/DUSTMod.F90
D       clm/src/clm4_5/biogeochem/CNDVLightMod.F90
D       clm/src/clm4_5/biogeochem/CNInitMod.F90
D       clm/src/clm4_5/biogeochem/CNPhenologyMod.F90
D       clm/src/clm4_5/biogeochem/ch4varcon.F90
D       clm/src/clm4_5/biogeochem/CNCStateUpdate1Mod.F90
D       clm/src/clm4_5/biogeochem/CNDecompMod.F90
D       clm/src/clm4_5/biogeochem/CNCStateUpdate3Mod.F90
D       clm/src/clm4_5/biogeochem/CNDVMod.F90
D       clm/src/clm4_5/biogeochem/ED
D       clm/src/clm4_5/biogeochem/ED/EDCanopyStructureMod.F90
D       clm/src/clm4_5/biogeochem/ED/EDSetValuesMod.F90
D       clm/src/clm4_5/biogeochem/ED/EDGrowthFunctionsMod.F90
D       clm/src/clm4_5/biogeochem/ED/EDPhysiologyMod.F90
D       clm/src/clm4_5/biogeochem/ED/EDCohortDynamicsMod.F90
D       clm/src/clm4_5/biogeochem/ED/EDPatchDynamicsMod.F90
D       clm/src/clm4_5/biogeochem/CNSharedParamsMod.F90
D       clm/src/clm4_5/biogeochem/VOCEmissionMod.F90
D       clm/src/clm4_5/biogeochem/ch4InitMod.F90
D       clm/src/clm4_5/biogeochem/CNAnnualUpdateMod.F90
D       clm/src/clm4_5/biogeochem/CNNStateUpdate2Mod.F90
D       clm/src/clm4_5/biogeochem/DryDepVelocity.F90
D       clm/src/clm4_5/biogeochem/CNAllocationMod.F90
D       clm/src/clm4_5/biogeochem/CNNDynamicsMod.F90
D       clm/src/clm4_5/biogeochem/CNEcosystemDynMod.F90
D       clm/src/clm4_5/biogeochem/CNDecompCascadeBGCMod.F90
D       clm/src/clm4_5/biogeochem/CNSetValueMod.F90
D       clm/src/clm4_5/biogeochem/CNVegStructUpdateMod.F90
D       clm/src/clm4_5/biogeochem/CNDecompCascadeCNMod.F90
D       clm/src/clm4_5/biogeochem/CNDVEstablishmentMod.F90
D       clm/src/clm4_5/biogeochem/CNSoilLittVertTranspMod.F90
D       clm/src/clm4_5/biogeochem/CNDVInitMod.F90
D       clm/src/clm4_5/biogeochem/CNC14DecayMod.F90
	
D       clm/src/clm4_5/main
D       clm/src/clm4_5/main/clm_varcon.F90
D       clm/src/clm4_5/main/initInterp.F90
D       clm/src/clm4_5/main/clm_varpar.F90
D       clm/src/clm4_5/main/landunit_varcon.F90
D       clm/src/clm4_5/main/initTimeConstMod.F90
D       clm/src/clm4_5/main/subgridWeightsMod.F90
D       clm/src/clm4_5/main/decompInitMod.F90
D       clm/src/clm4_5/main/clm_initializeMod.F90
D       clm/src/clm4_5/main/subgridRestMod.F90
D       clm/src/clm4_5/main/clm_glclnd.F90
D       clm/src/clm4_5/main/paramUtilMod.F90
D       clm/src/clm4_5/main/accFldsMod.F90
D       clm/src/clm4_5/main/subgridMod.F90
D       clm/src/clm4_5/main/clmtypeInitMod.F90
D       clm/src/clm4_5/main/ndepStreamMod.F90
D       clm/src/clm4_5/main/init_hydrology.F90
D       clm/src/clm4_5/main/initColdMod.F90
D       clm/src/clm4_5/main/column_varcon.F90
D       clm/src/clm4_5/main/histFileMod.F90
D       clm/src/clm4_5/main/pft2colMod.F90
D       clm/src/clm4_5/main/clm_atmlnd.F90
D       clm/src/clm4_5/main/findHistFields.pl
D       clm/src/clm4_5/main/clm_varsur.F90
D       clm/src/clm4_5/main/restFileMod.F90
D       clm/src/clm4_5/main/CMakeLists.txt
D       clm/src/clm4_5/main/controlMod.F90
D       clm/src/clm4_5/main/spitfireSF
D       clm/src/clm4_5/main/spitfireSF/SFParamsMod.F90
D       clm/src/clm4_5/main/spitfireSF/SFMainMod.F90
D       clm/src/clm4_5/main/test
D       clm/src/clm4_5/main/test/subgridWeights_test
D       clm/src/clm4_5/main/test/subgridWeights_test/test_subgridWeights.pf
D       clm/src/clm4_5/main/test/subgridWeights_test/CMakeLists.txt
D       clm/src/clm4_5/main/test/clm_glclnd_test
D       clm/src/clm4_5/main/test/clm_glclnd_test/test_clm_glclnd.pf
D       clm/src/clm4_5/main/test/clm_glclnd_test/CMakeLists.txt
D       clm/src/clm4_5/main/test/CMakeLists.txt
D       clm/src/clm4_5/main/initSubgridMod.F90
D       clm/src/clm4_5/main/filterMod.F90
D       clm/src/clm4_5/main/clm_varctl.F90
D       clm/src/clm4_5/main/clm_driver.F90
D       clm/src/clm4_5/main/surfrdUtilsMod.F90
D       clm/src/clm4_5/main/ED
D       clm/src/clm4_5/main/ED/EDInitTimeConst.F90
D       clm/src/clm4_5/main/ED/EDCLMLinkMod.F90
D       clm/src/clm4_5/main/ED/EDClmType.F90
D       clm/src/clm4_5/main/ED/EDRestVectorMod.F90
D       clm/src/clm4_5/main/ED/EDHistFldsMod.F90
D       clm/src/clm4_5/main/ED/EDClmTypeInitMod.F90
D       clm/src/clm4_5/main/ED/EDPftvarcon.F90
D       clm/src/clm4_5/main/ED/EDParamsMod.F90
D       clm/src/clm4_5/main/ED/EDInitMod.F90
D       clm/src/clm4_5/main/ED/EDTypesMod.F90
D       clm/src/clm4_5/main/ED/EDMainMod.F90
D       clm/src/clm4_5/main/subgridAveMod.F90
D       clm/src/clm4_5/main/initGridCellsMod.F90
D       clm/src/clm4_5/main/initSoilParVICMod.F90
D       clm/src/clm4_5/main/pftvarcon.F90
D       clm/src/clm4_5/main/surfrdMod.F90
D       clm/src/clm4_5/main/decompMod.F90
D       clm/src/clm4_5/main/FuncPedotransferMod.F90
D       clm/src/clm4_5/main/clmtype.F90
D       clm/src/clm4_5/main/reweightMod.F90
D       clm/src/clm4_5/main/readParamsMod.F90
D       clm/src/clm4_5/main/histFldsMod.F90
	
D       clm/src/clm4_5/biogeophys
D       clm/src/clm4_5/biogeophys/BalanceCheckMod.F90
D       clm/src/clm4_5/biogeophys/SLakeInitMod.F90
D       clm/src/clm4_5/biogeophys/SoilTemperatureMod.F90
D       clm/src/clm4_5/biogeophys/SLakeFluxesMod.F90
D       clm/src/clm4_5/biogeophys/UrbanInputMod.F90
D       clm/src/clm4_5/biogeophys/SnowHydrologyMod.F90
D       clm/src/clm4_5/biogeophys/Biogeophysics1Mod.F90
D       clm/src/clm4_5/biogeophys/FrictionVelocityMod.F90
D       clm/src/clm4_5/biogeophys/TridiagonalMod.F90
D       clm/src/clm4_5/biogeophys/SLakeHydrologyMod.F90
D       clm/src/clm4_5/biogeophys/Hydrology1Mod.F90
D       clm/src/clm4_5/biogeophys/BiogeophysRestMod.F90
D       clm/src/clm4_5/biogeophys/UrbanMod.F90
D       clm/src/clm4_5/biogeophys/QSatMod.F90
D       clm/src/clm4_5/biogeophys/ActiveLayerMod.F90
D       clm/src/clm4_5/biogeophys/SurfaceResistanceMod.F90
D       clm/src/clm4_5/biogeophys/clm_driverInitMod.F90
D       clm/src/clm4_5/biogeophys/CLMVICMapMod.F90
D       clm/src/clm4_5/biogeophys/SLakeTemperatureMod.F90
D       clm/src/clm4_5/biogeophys/SNICARMod.F90
D       clm/src/clm4_5/biogeophys/BareGroundFluxesMod.F90
D       clm/src/clm4_5/biogeophys/CMakeLists.txt
D       clm/src/clm4_5/biogeophys/CanopyFluxesMod.F90
D       clm/src/clm4_5/biogeophys/RootBiophysMod.F90
D       clm/src/clm4_5/biogeophys/test
D       clm/src/clm4_5/biogeophys/test/CMakeLists.txt
D       clm/src/clm4_5/biogeophys/test/Daylength_test
D       clm/src/clm4_5/biogeophys/test/Daylength_test/test_daylength.pf
D       clm/src/clm4_5/biogeophys/test/Daylength_test/CMakeLists.txt
D       clm/src/clm4_5/biogeophys/SurfaceRadiationMod.F90
D       clm/src/clm4_5/biogeophys/SoilWaterMovementMod.F90
D       clm/src/clm4_5/biogeophys/H2OSfcMod.F90
D       clm/src/clm4_5/biogeophys/SoilMoistStressMod.F90
D       clm/src/clm4_5/biogeophys/Biogeophysics2Mod.F90
D       clm/src/clm4_5/biogeophys/SoiWatRetCurveParMod.F90
D       clm/src/clm4_5/biogeophys/ED
D       clm/src/clm4_5/biogeophys/ED/EDAccumulateFluxesMod.F90
D       clm/src/clm4_5/biogeophys/ED/EDSurfaceAlbedoMod.F90
D       clm/src/clm4_5/biogeophys/ED/EDPhotosynthesisMod.F90
D       clm/src/clm4_5/biogeophys/ED/EDBtranMod.F90
D       clm/src/clm4_5/biogeophys/FracWetMod.F90
D       clm/src/clm4_5/biogeophys/UrbanInitMod.F90
D       clm/src/clm4_5/biogeophys/SLakeRestMod.F90
D       clm/src/clm4_5/biogeophys/SurfaceAlbedoMod.F90
D       clm/src/clm4_5/biogeophys/SLakeCon.F90
D       clm/src/clm4_5/biogeophys/Hydrology2Mod.F90
D       clm/src/clm4_5/biogeophys/BandDiagonalMod.F90
D       clm/src/clm4_5/biogeophys/SoilHydrologyMod.F90
D       clm/src/clm4_5/biogeophys/DaylengthMod.F90
	
D       clm/src/clm4_5/dyn_subgrid
D       clm/src/clm4_5/dyn_subgrid/test
D       clm/src/clm4_5/dyn_subgrid/test/dynLandunitArea_test
D       clm/src/clm4_5/dyn_subgrid/test/dynLandunitArea_test/test_update_landunit_weights_one_gcell.pf
D       clm/src/clm4_5/dyn_subgrid/test/dynLandunitArea_test/test_update_landunit_weights.pf
D       clm/src/clm4_5/dyn_subgrid/test/dynLandunitArea_test/CMakeLists.txt
D       clm/src/clm4_5/dyn_subgrid/test/dynVar_test
D       clm/src/clm4_5/dyn_subgrid/test/dynVar_test/test_dynVarShared.F90
D       clm/src/clm4_5/dyn_subgrid/test/dynVar_test/test_dynVarTimeInterp.pf
D       clm/src/clm4_5/dyn_subgrid/test/dynVar_test/test_dynVarTimeUninterp.pf
D       clm/src/clm4_5/dyn_subgrid/test/dynVar_test/CMakeLists.txt
D       clm/src/clm4_5/dyn_subgrid/test/dynTimeInfo_test
D       clm/src/clm4_5/dyn_subgrid/test/dynTimeInfo_test/test_dynTimeInfo.pf
D       clm/src/clm4_5/dyn_subgrid/test/dynTimeInfo_test/CMakeLists.txt
D       clm/src/clm4_5/dyn_subgrid/test/CMakeLists.txt
D       clm/src/clm4_5/dyn_subgrid/test/dynInitColumns_test
D       clm/src/clm4_5/dyn_subgrid/test/dynInitColumns_test/test_init_columns.pf
D       clm/src/clm4_5/dyn_subgrid/test/dynInitColumns_test/CMakeLists.txt
D       clm/src/clm4_5/dyn_subgrid/dynLandunitAreaMod.F90
D       clm/src/clm4_5/dyn_subgrid/dynTimeInfoMod.F90
D       clm/src/clm4_5/dyn_subgrid/dynSubgridDriverMod.F90
D       clm/src/clm4_5/dyn_subgrid/dynHarvestMod.F90
D       clm/src/clm4_5/dyn_subgrid/dynFileMod.F90
D       clm/src/clm4_5/dyn_subgrid/dynConsBiogeochemMod.F90
D       clm/src/clm4_5/dyn_subgrid/dynPriorWeightsMod.F90
D       clm/src/clm4_5/dyn_subgrid/dynVarMod.F90
D       clm/src/clm4_5/dyn_subgrid/dynEDMod.F90
D       clm/src/clm4_5/dyn_subgrid/dynVarTimeInterpMod.F90
D       clm/src/clm4_5/dyn_subgrid/dynpftFileMod.F90
D       clm/src/clm4_5/dyn_subgrid/dynCNDVMod.F90
D       clm/src/clm4_5/dyn_subgrid/dynConsBiogeophysMod.F90
D       clm/src/clm4_5/dyn_subgrid/dynVarTimeUninterpMod.F90
D       clm/src/clm4_5/dyn_subgrid/dynVarMod.F90.in
D       clm/src/clm4_5/dyn_subgrid/dynVarTimeInterpMod.F90.in
D       clm/src/clm4_5/dyn_subgrid/dynVarTimeUninterpMod.F90.in
D       clm/src/clm4_5/dyn_subgrid/do_genf90
D       clm/src/clm4_5/dyn_subgrid/dynInitColumnsMod.F90
D       clm/src/clm4_5/dyn_subgrid/CMakeLists.txt
	
D       clm/src/util_share
D       clm/src/util_share/organicFileMod.F90
D       clm/src/util_share/spmdGathScatMod.F90
D       clm/src/util_share/clm_time_manager.F90
D       clm/src/util_share/clm_nlUtilsMod.F90
D       clm/src/util_share/clm_varorb.F90
D       clm/src/util_share/abortutils.F90
D       clm/src/util_share/accumulMod.F90
D       clm/src/util_share/getdatetime.F90
D       clm/src/util_share/fileutils.F90
D       clm/src/util_share/dtypes.h
D       clm/src/util_share/ncdio_pio.F90
D       clm/src/util_share/SimpleMathMod.F90
D       clm/src/util_share/spmdMod.F90
D       clm/src/util_share/domainMod.F90
D       clm/src/util_share/ncdio_pio.F90.in
D       clm/src/util_share/restUtilMod.F90
D       clm/src/util_share/quadraticMod.F90
D       clm/src/util_share/restUtilMod.F90.in
D       clm/src/util_share/CMakeLists.txt
D       clm/src/util_share/GetGlobalValuesMod.F90
	
D       clm/src/clm4_0
D       clm/src/clm4_0/biogeochem
D       clm/src/clm4_0/biogeochem/CNCStateUpdate2Mod.F90
D       clm/src/clm4_0/biogeochem/CNC13StateUpdate2Mod.F90
D       clm/src/clm4_0/biogeochem/CNGapMortalityMod.F90
D       clm/src/clm4_0/biogeochem/CropRestMod.F90
D       clm/src/clm4_0/biogeochem/CNGRespMod.F90
D       clm/src/clm4_0/biogeochem/CNNStateUpdate1Mod.F90
D       clm/src/clm4_0/biogeochem/CNBalanceCheckMod.F90
D       clm/src/clm4_0/biogeochem/CNNStateUpdate3Mod.F90
D       clm/src/clm4_0/biogeochem/CNFireMod.F90
D       clm/src/clm4_0/biogeochem/CNMRespMod.F90
D       clm/src/clm4_0/biogeochem/MEGANFactorsMod.F90
D       clm/src/clm4_0/biogeochem/CNPrecisionControlMod.F90
D       clm/src/clm4_0/biogeochem/CNWoodProductsMod.F90
D       clm/src/clm4_0/biogeochem/CNSummaryMod.F90
D       clm/src/clm4_0/biogeochem/DUSTMod.F90
D       clm/src/clm4_0/biogeochem/CNDVLightMod.F90
D       clm/src/clm4_0/biogeochem/CNPhenologyMod.F90
D       clm/src/clm4_0/biogeochem/CNCStateUpdate1Mod.F90
D       clm/src/clm4_0/biogeochem/CNDecompMod.F90
D       clm/src/clm4_0/biogeochem/STATICEcosysDynMod.F90
D       clm/src/clm4_0/biogeochem/CNCStateUpdate3Mod.F90
D       clm/src/clm4_0/biogeochem/CNDVMod.F90
D       clm/src/clm4_0/biogeochem/CNC13StateUpdate1Mod.F90
D       clm/src/clm4_0/biogeochem/CNrestMod.F90
D       clm/src/clm4_0/biogeochem/CNC13StateUpdate3Mod.F90
D       clm/src/clm4_0/biogeochem/VOCEmissionMod.F90
D       clm/src/clm4_0/biogeochem/CNDVEcosystemDynIniMod.F90
D       clm/src/clm4_0/biogeochem/CNAnnualUpdateMod.F90
D       clm/src/clm4_0/biogeochem/CNNStateUpdate2Mod.F90
D       clm/src/clm4_0/biogeochem/C13SummaryMod.F90
D       clm/src/clm4_0/biogeochem/DryDepVelocity.F90
D       clm/src/clm4_0/biogeochem/CNC13FluxMod.F90
D       clm/src/clm4_0/biogeochem/CNAllocationMod.F90
D       clm/src/clm4_0/biogeochem/CNNDynamicsMod.F90
D       clm/src/clm4_0/biogeochem/CNEcosystemDynMod.F90
D       clm/src/clm4_0/biogeochem/CNSetValueMod.F90
D       clm/src/clm4_0/biogeochem/CNVegStructUpdateMod.F90
D       clm/src/clm4_0/biogeochem/CNDVEstablishmentMod.F90
	
D       clm/src/clm4_0/main
D       clm/src/clm4_0/main/clm_varcon.F90
D       clm/src/clm4_0/main/clm_varpar.F90
D       clm/src/clm4_0/main/CNiniTimeVar.F90
D       clm/src/clm4_0/main/dynlandMod.F90
D       clm/src/clm4_0/main/decompInitMod.F90
D       clm/src/clm4_0/main/clm_initializeMod.F90
D       clm/src/clm4_0/main/subgridRestMod.F90
D       clm/src/clm4_0/main/clm_glclnd.F90
D       clm/src/clm4_0/main/accFldsMod.F90
D       clm/src/clm4_0/main/subgridMod.F90
D       clm/src/clm4_0/main/clmtypeInitMod.F90
D       clm/src/clm4_0/main/ndepStreamMod.F90
D       clm/src/clm4_0/main/pftdynMod.F90
D       clm/src/clm4_0/main/iniTimeConst.F90
D       clm/src/clm4_0/main/histFileMod.F90
D       clm/src/clm4_0/main/pft2colMod.F90
D       clm/src/clm4_0/main/clm_atmlnd.F90
D       clm/src/clm4_0/main/findHistFields.pl
D       clm/src/clm4_0/main/restFileMod.F90
D       clm/src/clm4_0/main/clm_varsur.F90
D       clm/src/clm4_0/main/controlMod.F90
D       clm/src/clm4_0/main/initSurfAlbMod.F90
D       clm/src/clm4_0/main/filterMod.F90
D       clm/src/clm4_0/main/clm_driver.F90
D       clm/src/clm4_0/main/clm_varctl.F90
D       clm/src/clm4_0/main/subgridAveMod.F90
D       clm/src/clm4_0/main/initGridCellsMod.F90
D       clm/src/clm4_0/main/CNiniSpecial.F90
D       clm/src/clm4_0/main/pftvarcon.F90
D       clm/src/clm4_0/main/surfrdMod.F90
D       clm/src/clm4_0/main/decompMod.F90
D       clm/src/clm4_0/main/clmtype.F90
D       clm/src/clm4_0/main/histFldsMod.F90
D       clm/src/clm4_0/main/mkarbinitMod.F90
D       clm/src/clm4_0/biogeophys
D       clm/src/clm4_0/biogeophys/BalanceCheckMod.F90
D       clm/src/clm4_0/biogeophys/SurfaceRadiationMod.F90
D       clm/src/clm4_0/biogeophys/SoilTemperatureMod.F90
D       clm/src/clm4_0/biogeophys/SnowHydrologyMod.F90
D       clm/src/clm4_0/biogeophys/UrbanInputMod.F90
D       clm/src/clm4_0/biogeophys/Biogeophysics1Mod.F90
D       clm/src/clm4_0/biogeophys/Biogeophysics2Mod.F90
D       clm/src/clm4_0/biogeophys/FracWetMod.F90
D       clm/src/clm4_0/biogeophys/UrbanInitMod.F90
D       clm/src/clm4_0/biogeophys/FrictionVelocityMod.F90
D       clm/src/clm4_0/biogeophys/TridiagonalMod.F90
D       clm/src/clm4_0/biogeophys/SurfaceAlbedoMod.F90
D       clm/src/clm4_0/biogeophys/Hydrology1Mod.F90
D       clm/src/clm4_0/biogeophys/Hydrology2Mod.F90
D       clm/src/clm4_0/biogeophys/BiogeophysicsLakeMod.F90
D       clm/src/clm4_0/biogeophys/BiogeophysRestMod.F90
D       clm/src/clm4_0/biogeophys/UrbanMod.F90
D       clm/src/clm4_0/biogeophys/SoilHydrologyMod.F90
D       clm/src/clm4_0/biogeophys/QSatMod.F90
D       clm/src/clm4_0/biogeophys/clm_driverInitMod.F90
D       clm/src/clm4_0/biogeophys/HydrologyLakeMod.F90
D       clm/src/clm4_0/biogeophys/BareGroundFluxesMod.F90
D       clm/src/clm4_0/biogeophys/SNICARMod.F90
D       clm/src/clm4_0/biogeophys/CanopyFluxesMod.F90
	
List all files added and what they do:

A       clm/src_clm40
A       clm/src_clm40/biogeochem
A       clm/src_clm40/biogeochem/CNCStateUpdate2Mod.F90
A       clm/src_clm40/biogeochem/CNC13StateUpdate2Mod.F90
A       clm/src_clm40/biogeochem/CNGRespMod.F90
A       clm/src_clm40/biogeochem/CNBalanceCheckMod.F90
A       clm/src_clm40/biogeochem/CNNStateUpdate3Mod.F90
A       clm/src_clm40/biogeochem/CNSummaryMod.F90
A       clm/src_clm40/biogeochem/CNPhenologyMod.F90
A       clm/src_clm40/biogeochem/STATICEcosysDynMod.F90
A       clm/src_clm40/biogeochem/CNCStateUpdate1Mod.F90
A       clm/src_clm40/biogeochem/CNC13StateUpdate1Mod.F90
A       clm/src_clm40/biogeochem/CNrestMod.F90
A       clm/src_clm40/biogeochem/VOCEmissionMod.F90
A       clm/src_clm40/biogeochem/CNAnnualUpdateMod.F90
A       clm/src_clm40/biogeochem/CNNStateUpdate2Mod.F90
A       clm/src_clm40/biogeochem/C13SummaryMod.F90
A       clm/src_clm40/biogeochem/CNAllocationMod.F90
A       clm/src_clm40/biogeochem/DryDepVelocity.F90
A       clm/src_clm40/biogeochem/CNNDynamicsMod.F90
A       clm/src_clm40/biogeochem/CNSetValueMod.F90
A       clm/src_clm40/biogeochem/CNGapMortalityMod.F90
A       clm/src_clm40/biogeochem/CropRestMod.F90
A       clm/src_clm40/biogeochem/CNNStateUpdate1Mod.F90
A       clm/src_clm40/biogeochem/CNFireMod.F90
A       clm/src_clm40/biogeochem/CNMRespMod.F90
A       clm/src_clm40/biogeochem/MEGANFactorsMod.F90
A       clm/src_clm40/biogeochem/CNWoodProductsMod.F90
A       clm/src_clm40/biogeochem/CNPrecisionControlMod.F90
A       clm/src_clm40/biogeochem/DUSTMod.F90
A       clm/src_clm40/biogeochem/CNDVLightMod.F90
A       clm/src_clm40/biogeochem/CNDecompMod.F90
A       clm/src_clm40/biogeochem/CNDVMod.F90
A       clm/src_clm40/biogeochem/CNCStateUpdate3Mod.F90
A       clm/src_clm40/biogeochem/CNC13StateUpdate3Mod.F90
A       clm/src_clm40/biogeochem/CNDVEcosystemDynIniMod.F90
A       clm/src_clm40/biogeochem/CNC13FluxMod.F90
A       clm/src_clm40/biogeochem/CNEcosystemDynMod.F90
A       clm/src_clm40/biogeochem/CNVegStructUpdateMod.F90
A       clm/src_clm40/biogeochem/CNDVEstablishmentMod.F90
	
A       clm/src_clm40/main
A       clm/src_clm40/main/spmdGathScatMod.F90
A       clm/src_clm40/main/organicFileMod.F90
A       clm/src_clm40/main/clm_varcon.F90
A       clm/src_clm40/main/clm_varpar.F90
A       clm/src_clm40/main/CNiniTimeVar.F90
A       clm/src_clm40/main/abortutils.F90
A       clm/src_clm40/main/accumulMod.F90
A       clm/src_clm40/main/decompInitMod.F90
A       clm/src_clm40/main/clm_glclnd.F90
A       clm/src_clm40/main/accFldsMod.F90
A       clm/src_clm40/main/subgridMod.F90
A       clm/src_clm40/main/pftdynMod.F90
A       clm/src_clm40/main/pft2colMod.F90
A       clm/src_clm40/main/clm_atmlnd.F90
A       clm/src_clm40/main/quadraticMod.F90
A       clm/src_clm40/main/GetGlobalValuesMod.F90
A       clm/src_clm40/main/clm_time_manager.F90
A       clm/src_clm40/main/filterMod.F90
A       clm/src_clm40/main/clm_varctl.F90
A       clm/src_clm40/main/subgridAveMod.F90
A       clm/src_clm40/main/dtypes.h
A       clm/src_clm40/main/CNiniSpecial.F90
A       clm/src_clm40/main/surfrdMod.F90
A       clm/src_clm40/main/domainMod.F90
A       clm/src_clm40/main/lnd_import_export.F90
A       clm/src_clm40/main/restUtilMod.F90
A       clm/src_clm40/main/clmtype.F90
A       clm/src_clm40/main/mkarbinitMod.F90
A       clm/src_clm40/main/restUtilMod.F90.in
A       clm/src_clm40/main/dynlandMod.F90
A       clm/src_clm40/main/getdatetime.F90
A       clm/src_clm40/main/clm_initializeMod.F90
A       clm/src_clm40/main/subgridRestMod.F90
A       clm/src_clm40/main/fileutils.F90
A       clm/src_clm40/main/clmtypeInitMod.F90
A       clm/src_clm40/main/ndepStreamMod.F90
A       clm/src_clm40/main/SimpleMathMod.F90
A       clm/src_clm40/main/iniTimeConst.F90
A       clm/src_clm40/main/lnd_comp_esmf.F90
A       clm/src_clm40/main/histFileMod.F90
A       clm/src_clm40/main/clm_cpl_indices.F90
A       clm/src_clm40/main/findHistFields.pl
A       clm/src_clm40/main/restFileMod.F90
A       clm/src_clm40/main/clm_varsur.F90
A       clm/src_clm40/main/controlMod.F90
A       clm/src_clm40/main/CMakeLists.txt
A       clm/src_clm40/main/initSurfAlbMod.F90
A       clm/src_clm40/main/clm_nlUtilsMod.F90
A       clm/src_clm40/main/clm_driver.F90
A       clm/src_clm40/main/clm_varorb.F90
A       clm/src_clm40/main/initGridCellsMod.F90
A       clm/src_clm40/main/lnd_comp_mct.F90
A       clm/src_clm40/main/pftvarcon.F90
A       clm/src_clm40/main/ncdio_pio.F90
A       clm/src_clm40/main/spmdMod.F90
A       clm/src_clm40/main/decompMod.F90
A       clm/src_clm40/main/ncdio_pio.F90.in
A       clm/src_clm40/main/histFldsMod.F90
	
A       clm/src_clm40/biogeophys
A       clm/src_clm40/biogeophys/BalanceCheckMod.F90
A       clm/src_clm40/biogeophys/SoilTemperatureMod.F90
A       clm/src_clm40/biogeophys/UrbanInputMod.F90
A       clm/src_clm40/biogeophys/SnowHydrologyMod.F90
A       clm/src_clm40/biogeophys/Biogeophysics1Mod.F90
A       clm/src_clm40/biogeophys/FrictionVelocityMod.F90
A       clm/src_clm40/biogeophys/TridiagonalMod.F90
A       clm/src_clm40/biogeophys/Hydrology1Mod.F90
A       clm/src_clm40/biogeophys/BiogeophysRestMod.F90
A       clm/src_clm40/biogeophys/UrbanMod.F90
A       clm/src_clm40/biogeophys/QSatMod.F90
A       clm/src_clm40/biogeophys/clm_driverInitMod.F90
A       clm/src_clm40/biogeophys/HydrologyLakeMod.F90
A       clm/src_clm40/biogeophys/BareGroundFluxesMod.F90
A       clm/src_clm40/biogeophys/SNICARMod.F90
A       clm/src_clm40/biogeophys/CanopyFluxesMod.F90
A       clm/src_clm40/biogeophys/SurfaceRadiationMod.F90
A       clm/src_clm40/biogeophys/Biogeophysics2Mod.F90
A       clm/src_clm40/biogeophys/UrbanInitMod.F90
A       clm/src_clm40/biogeophys/FracWetMod.F90
A       clm/src_clm40/biogeophys/SurfaceAlbedoMod.F90
A       clm/src_clm40/biogeophys/Hydrology2Mod.F90
A       clm/src_clm40/biogeophys/BiogeophysicsLakeMod.F90
A       clm/src_clm40/biogeophys/SoilHydrologyMod.F90
	
A       clm/src/main
A       clm/src/main/organicFileMod.F90
A       clm/src/main/clm_varcon.F90
A       clm/src/main/initInterp.F90
A       clm/src/main/landunit_varcon.F90
A       clm/src/main/clm_varpar.F90
A       clm/src/main/abortutils.F90
A       clm/src/main/accumulMod.F90
A       clm/src/main/subgridWeightsMod.F90
A       clm/src/main/decompInitMod.F90
A       clm/src/main/subgridMod.F90
A       clm/src/main/atm2lndType.F90
A       clm/src/main/lnd2atmType.F90
A       clm/src/main/column_varcon.F90
A       clm/src/main/EcophysConType.F90
A       clm/src/main/GetGlobalValuesMod.F90
A       clm/src/main/initSubgridMod.F90
A       clm/src/main/lnd2glcMod.F90
A       clm/src/main/glc2lndMod.F90
A       clm/src/main/filterMod.F90
A       clm/src/main/surfrdUtilsMod.F90
A       clm/src/main/clm_varctl.F90
A       clm/src/main/subgridAveMod.F90
A       clm/src/main/initVerticalMod.F90
A       clm/src/main/glcDiagnosticsMod.F90
A       clm/src/main/lnd2atmMod.F90
A       clm/src/main/atm2lndMod.F90
A       clm/src/main/surfrdMod.F90
A       clm/src/main/FuncPedotransferMod.F90
A       clm/src/main/readParamsMod.F90
A       clm/src/main/clm_initializeMod.F90
A       clm/src/main/subgridRestMod.F90
A       clm/src/main/paramUtilMod.F90
A       clm/src/main/ColumnType.F90
A       clm/src/main/PatchType.F90
A       clm/src/main/ndepStreamMod.F90
A       clm/src/main/init_hydrology.F90
A       clm/src/main/histFileMod.F90
A       clm/src/main/findHistFields.pl
A       clm/src/main/restFileMod.F90
A       clm/src/main/clm_varsur.F90
A       clm/src/main/controlMod.F90
A       clm/src/main/LandunitType.F90
A       clm/src/main/CMakeLists.txt
A       clm/src/main/test
A       clm/src/main/test/subgridWeights_test
A       clm/src/main/test/subgridWeights_test/test_subgridWeights.pf
A       clm/src/main/test/subgridWeights_test/CMakeLists.txt
A       clm/src/main/test/clm_glclnd_test
A       clm/src/main/test/clm_glclnd_test/test_clm_glclnd.pf
A       clm/src/main/test/clm_glclnd_test/CMakeLists.txt
A       clm/src/main/test/CMakeLists.txt
A       clm/src/main/clm_driver.F90
A       clm/src/main/GridcellType.F90
A       clm/src/main/initGridCellsMod.F90
A       clm/src/main/pftvarcon.F90
A       clm/src/main/ncdio_pio.F90
A       clm/src/main/decompMod.F90
A       clm/src/main/ncdio_pio.F90.in
A       clm/src/main/reweightMod.F90

A       clm/src/ED
A       clm/src/ED/biogeochem
A       clm/src/ED/biogeochem/EDCanopyStructureMod.F90
A       clm/src/ED/biogeochem/EDGrowthFunctionsMod.F90
A       clm/src/ED/biogeochem/EDPhysiologyMod.F90
A       clm/src/ED/biogeochem/EDCohortDynamicsMod.F90
A       clm/src/ED/biogeochem/EDPatchDynamicsMod.F90
A       clm/src/ED/main
A       clm/src/ED/main/EDBioType.F90
A       clm/src/ED/main/EDEcophysConType.F90
A       clm/src/ED/main/EDParamsMod.F90
A       clm/src/ED/main/EDMainMod.F90
A       clm/src/ED/main/EDCLMLinkMod.F90
A       clm/src/ED/main/EDVecCohortType.F90
A       clm/src/ED/main/EDVecPatchType.F90
A       clm/src/ED/main/EDRestVectorMod.F90
A       clm/src/ED/main/EDPftvarcon.F90
A       clm/src/ED/main/EDInitMod.F90
A       clm/src/ED/main/EDTypesMod.F90
A       clm/src/ED/fire
A       clm/src/ED/fire/SFParamsMod.F90
A       clm/src/ED/fire/SFMainMod.F90
A       clm/src/ED/biogeophys
A       clm/src/ED/biogeophys/EDAccumulateFluxesMod.F90
A       clm/src/ED/biogeophys/EDSurfaceAlbedoMod.F90
A       clm/src/ED/biogeophys/EDPhotosynthesisMod.F90
A       clm/src/ED/biogeophys/EDBtranMod.F90
A       clm/src/Notes
M       clm/src/unit_test_shr/unittestSubgridMod.F90

A       clm/src/utils
A       clm/src/utils/spmdGathScatMod.F90
A       clm/src/utils/clm_time_manager.F90
A       clm/src/utils/clm_nlUtilsMod.F90
A       clm/src/utils/clm_varorb.F90
A       clm/src/utils/accumulMod.F90
A       clm/src/utils/getdatetime.F90
A       clm/src/utils/fileutils.F90
A       clm/src/utils/dtypes.h
A       clm/src/utils/spmdMod.F90
A       clm/src/utils/SimpleMathMod.F90
A       clm/src/utils/domainMod.F90
A       clm/src/utils/restUtilMod.F90
A       clm/src/utils/quadraticMod.F90
A       clm/src/utils/CMakeLists.txt
A       clm/src/utils/restUtilMod.F90.in

A       clm/src/biogeochem
A       clm/src/biogeochem/CNCStateUpdate2Mod.F90
A       clm/src/biogeochem/CNDecompCascadeConType.F90
A       clm/src/biogeochem/CNNitrifDenitrifMod.F90
A       clm/src/biogeochem/CNGRespMod.F90
A       clm/src/biogeochem/CNBalanceCheckMod.F90
A       clm/src/biogeochem/CNNStateUpdate3Mod.F90
A       clm/src/biogeochem/CNDVDriverMod.F90
A       clm/src/biogeochem/SatellitePhenologyMod.F90
A       clm/src/biogeochem/CNPhenologyMod.F90
A       clm/src/biogeochem/CNCarbonFluxType.F90
A       clm/src/biogeochem/CNCarbonStateType.F90
A       clm/src/biogeochem/CNCStateUpdate1Mod.F90
A       clm/src/biogeochem/VOCEmissionMod.F90
A       clm/src/biogeochem/CNAnnualUpdateMod.F90
A       clm/src/biogeochem/CNNStateUpdate2Mod.F90
A       clm/src/biogeochem/CropType.F90
A       clm/src/biogeochem/CNAllocationMod.F90
A       clm/src/biogeochem/CNNDynamicsMod.F90
A       clm/src/biogeochem/DryDepVelocity.F90
A       clm/src/biogeochem/CNDecompCascadeBGCMod.F90
A       clm/src/biogeochem/CNSoilLittVertTranspMod.F90
A       clm/src/biogeochem/CNDecompCascadeCNMod.F90
A       clm/src/biogeochem/CNC14DecayMod.F90
A       clm/src/biogeochem/CNGapMortalityMod.F90
A       clm/src/biogeochem/CNNStateUpdate1Mod.F90
A       clm/src/biogeochem/CNFireMod.F90
A       clm/src/biogeochem/CNNitrogenFluxType.F90
A       clm/src/biogeochem/CNMRespMod.F90
A       clm/src/biogeochem/MEGANFactorsMod.F90
A       clm/src/biogeochem/CNVerticalProfileMod.F90
A       clm/src/biogeochem/CNCIsoFluxMod.F90
A       clm/src/biogeochem/CNWoodProductsMod.F90
A       clm/src/biogeochem/CNPrecisionControlMod.F90
A       clm/src/biogeochem/ch4Mod.F90
A       clm/src/biogeochem/DUSTMod.F90
A       clm/src/biogeochem/CNDVLightMod.F90
A       clm/src/biogeochem/ch4varcon.F90
A       clm/src/biogeochem/CNDecompMod.F90
A       clm/src/biogeochem/CNCStateUpdate3Mod.F90
A       clm/src/biogeochem/CNSharedParamsMod.F90
A       clm/src/biogeochem/CNDVType.F90
A       clm/src/biogeochem/CNStateType.F90
A       clm/src/biogeochem/CNEcosystemDynMod.F90
A       clm/src/biogeochem/CNNitrogenStateType.F90
A       clm/src/biogeochem/CNVegStructUpdateMod.F90
A       clm/src/biogeochem/CNDVEstablishmentMod.F90
	
A       clm/src/biogeophys
A       clm/src/biogeophys/SnowSnicarMod.F90
A       clm/src/biogeophys/SnowHydrologyMod.F90
A       clm/src/biogeophys/TridiagonalMod.F90
A       clm/src/biogeophys/FrictionVelocityType.F90
A       clm/src/biogeophys/LakeFluxesMod.F90
A       clm/src/biogeophys/PhotosynthesisMod.F90
A       clm/src/biogeophys/AerosolType.F90
A       clm/src/biogeophys/ActiveLayerMod.F90
A       clm/src/biogeophys/QSatMod.F90
A       clm/src/biogeophys/SoilHydrologyType.F90
A       clm/src/biogeophys/HydrologyDrainageMod.F90
A       clm/src/biogeophys/LakeStateType.F90
A       clm/src/biogeophys/BareGroundFluxesMod.F90
A       clm/src/biogeophys/SolarAbsorbedType.F90
A       clm/src/biogeophys/CanopyHydrologyMod.F90
A       clm/src/biogeophys/UrbanFluxesMod.F90
A       clm/src/biogeophys/SurfaceAlbedoMod.F90
A       clm/src/biogeophys/UrbanRadiationMod.F90
A       clm/src/biogeophys/PhotosynthesisType.F90
A       clm/src/biogeophys/CanopyTemperatureMod.F90
A       clm/src/biogeophys/HydrologyNoDrainageMod.F90
A       clm/src/biogeophys/DaylengthMod.F90
A       clm/src/biogeophys/WaterfluxType.F90
A       clm/src/biogeophys/BalanceCheckMod.F90
A       clm/src/biogeophys/SoilTemperatureMod.F90
A       clm/src/biogeophys/WaterStateType.F90
A       clm/src/biogeophys/LakeTemperatureMod.F90
A       clm/src/biogeophys/FrictionVelocityMod.F90
A       clm/src/biogeophys/SoilFluxesMod.F90
A       clm/src/biogeophys/TemperatureType.F90
A       clm/src/biogeophys/SurfaceAlbedoType.F90
A       clm/src/biogeophys/AerosolMod.F90
A       clm/src/biogeophys/SoilStateType.F90
A       clm/src/biogeophys/SurfaceResistanceMod.F90
A       clm/src/biogeophys/UrbanAlbedoMod.F90
A       clm/src/biogeophys/CanopyFluxesMod.F90
A       clm/src/biogeophys/CMakeLists.txt
A       clm/src/biogeophys/RootBiophysMod.F90
A       clm/src/biogeophys/test
A       clm/src/biogeophys/test/CMakeLists.txt
A       clm/src/biogeophys/test/Daylength_test
A       clm/src/biogeophys/test/Daylength_test/test_daylength.pf
A       clm/src/biogeophys/test/Daylength_test/CMakeLists.txt
A       clm/src/biogeophys/SurfaceRadiationMod.F90
A       clm/src/biogeophys/SoilWaterMovementMod.F90
A       clm/src/biogeophys/SoilMoistStressMod.F90
A       clm/src/biogeophys/SoiWatRetCurveParMod.F90
A       clm/src/biogeophys/EnergyFluxType.F90
A       clm/src/biogeophys/CanopyStateType.F90
A       clm/src/biogeophys/BandDiagonalMod.F90
A       clm/src/biogeophys/SoilHydrologyMod.F90
A       clm/src/biogeophys/LakeCon.F90
A       clm/src/biogeophys/LakeHydrologyMod.F90
A       clm/src/biogeophys/UrbanParamsType.F90
A       clm/src/dyn_subgrid
A       clm/src/dyn_subgrid/dynLandunitAreaMod.F90
A       clm/src/dyn_subgrid/dynTimeInfoMod.F90
A       clm/src/dyn_subgrid/dynSubgridDriverMod.F90
A       clm/src/dyn_subgrid/dynFileMod.F90
A       clm/src/dyn_subgrid/dynConsBiogeochemMod.F90
A       clm/src/dyn_subgrid/dynEDMod.F90
A       clm/src/dyn_subgrid/dynVarMod.F90
A       clm/src/dyn_subgrid/dynVarTimeUninterpMod.F90
A       clm/src/dyn_subgrid/dynVarMod.F90.in
A       clm/src/dyn_subgrid/dynVarTimeInterpMod.F90.in
A       clm/src/dyn_subgrid/dynVarTimeUninterpMod.F90.in
A       clm/src/dyn_subgrid/do_genf90
A       clm/src/dyn_subgrid/CMakeLists.txt
A       clm/src/dyn_subgrid/test
A       clm/src/dyn_subgrid/test/dynLandunitArea_test
A       clm/src/dyn_subgrid/test/dynLandunitArea_test/test_update_landunit_weights_one_gcell.pf
A       clm/src/dyn_subgrid/test/dynLandunitArea_test/CMakeLists.txt
A       clm/src/dyn_subgrid/test/dynLandunitArea_test/test_update_landunit_weights.pf
A       clm/src/dyn_subgrid/test/dynVar_test
A       clm/src/dyn_subgrid/test/dynVar_test/test_dynVarShared.F90
A       clm/src/dyn_subgrid/test/dynVar_test/test_dynVarTimeInterp.pf
A       clm/src/dyn_subgrid/test/dynVar_test/test_dynVarTimeUninterp.pf
A       clm/src/dyn_subgrid/test/dynVar_test/CMakeLists.txt
A       clm/src/dyn_subgrid/test/dynTimeInfo_test
A       clm/src/dyn_subgrid/test/dynTimeInfo_test/test_dynTimeInfo.pf
A       clm/src/dyn_subgrid/test/dynTimeInfo_test/CMakeLists.txt
A       clm/src/dyn_subgrid/test/CMakeLists.txt
A       clm/src/dyn_subgrid/test/dynInitColumns_test
A       clm/src/dyn_subgrid/test/dynInitColumns_test/test_init_columns.pf
A       clm/src/dyn_subgrid/test/dynInitColumns_test/CMakeLists.txt
A       clm/src/dyn_subgrid/dynHarvestMod.F90
A       clm/src/dyn_subgrid/dynPriorWeightsMod.F90
A       clm/src/dyn_subgrid/dynpftFileMod.F90
A       clm/src/dyn_subgrid/dynVarTimeInterpMod.F90
A       clm/src/dyn_subgrid/dynCNDVMod.F90
A       clm/src/dyn_subgrid/dynConsBiogeophysMod.F90
A       clm/src/dyn_subgrid/dynInitColumnsMod.F90
A       clm/src/unit_test_mocks/util_share/restUtilMod_mock.F90
A       clm/src/unit_test_mocks/util_share/restUtilMod_mock.F90.in
	
List all existing files that have been modified, and describe the changes:
	ALL files have been modified - see the general description for an
	overview of what was done - the following files have not had their directories
	changed - so the summary is below

M       clm/bld/configure
	- needed to account for change in filepath

M       clm/bld/CLMBuildNamelist.pm
M       clm/bld/namelist_files/namelist_definition_clm4_5.xml
	- see namelist changes mentioned above

M       clm/src/unit_test_mocks/util_share/clm_time_manager_mock.F90
M       clm/src/unit_test_mocks/util_share/ncdio_var.F90
M       clm/src/unit_test_mocks/util_share/ncdio_pio_mock.F90
M       clm/src/unit_test_mocks/util_share/do_genf90
M       clm/src/unit_test_mocks/util_share/CMakeLists.txt
M       clm/src/unit_test_mocks/util_share/ncdio_pio_mock.F90.in
M       clm/src/unit_test_mocks/main/histFileMod_mock.F90
M       clm/src/CMakeLists.txt
	- unit test changes needed to account for introduction of new data types and
	directory structure

M       clm/src/cpl/lnd_comp_esmf.F90
M       clm/src/cpl/lnd_import_export.F90
M       clm/src/cpl/lnd_comp_mct.F90
	- coupling interface changes needed to account for introduction of new data types

CLM testing:

  build-namelist tests:

    yellowstone yes
    goldbach yes

  regular tests (aux_clm40, aux_clm45, with '-model_gen_comp clm2'):

    yellowstone_intel yes
    yellowstone_pgi   yes
    yellowstone_gnu   yes
    goldbach_nag      yes
    goldbach_intel    yes
    goldbach_pgi      yes

    NOTE for goldbach_nag - four ED compare_hist tests fail with small bit for bit differences. 
    In fact - looking more closely, these tests are also run for pgi and intel on goldbach - and
    values for 	LITTER_IN and LITTER_OUT are 0. for those compilers but non-zero for nag.
    With the refactoring code - those fields are again 0. for intel and pgi - but totally different
    and non-zero for nag. Apparently, this is known problem that will get resolved in when new ED changes
    are brount in

    ERS_D_Mmpi-serial.1x1_brazil.ICLM45CNED.goldbach_nag.clm-edTest
    ERS_D_Mmpi-serial.1x1_brazil.ICLM45CNED.goldbach_nag.clm-edTest
    SMS_D_Mmpi-serial.5x5_amazon.ICLM45CNED.goldbach_nag.clm-edTest
    SMS_D_Mmpi-serial.5x5_amazon.ICLM45CNED.goldbach_nag.clm-edTest


  short tests (aux_clm_short) (generally these are NOT used when making a tag): N/A

  tools testing: N/A

CLM tag used for the baseline comparisons: clm4_5_1_r080

Changes answers relative to baseline: No - BFB

===============================================================
===============================================================
Tag name:  clm4_5_1_r080
Originator(s):  erik (Erik)
Date: Sat Aug 16 15:01:35 MDT 2014
One-line Summary: Update externals to CESM trunk versions, allow eighth degree as a valid resolution

Purpose of changes:

Update all the externals to the very latest CESM trunk versions (based off of current
cesm1_3_alpha13a).

Requirements for tag: Get working with trunk externals

Test level of tag: regular

Bugs fixed (include bugzilla ID):

   2012 Problem with mksurfdata_map for eighth degree grid...
  Scripts issues as follows:
   2024 nlcompareonly option to create_test not working correctly for reporting
   2019 ERH tests don't save the base env_run.xml, so have trouble when resubmitted...
   2018 Failed tests in cesm1_3_beta11 needed for CLM
   2005 Remove untested named compsets and grids
   1999 T85_g16 has inconsistent land domain and surface datasets

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: 
   Archiving updated in support of time series generation
   Running test suite now builds some shared libraries built only once

Describe any changes made to the namelist: 
   Resolve env and xml vars used in user_nl_*

   Default for drv_in profile_timer changed from 4 to 1
   Some PE layours change: f10_f10 change from 15x1 to 30x1

List any changes to the defaults for the boundary datasets: Add 0.125x0.125 mapping files

Describe any substantial timing or memory changes: None

Code reviewed by: self

List any svn externals directories updated (csm_share, mct, etc.): Update to cesm1_3_alpha13a externals

    scripts      to scripts4_140814a
    scripts/doc  to doc_140519
    Machines     to Machines_140811
    CMake        to CMake_Fortran_utils_140715
    drv          to drvseq5_0_15
    cism         to cism1_140602
    timing       to timing_140416
    pio          to pio1_8_12
    cprnc        to cprnc_140625
    mapping      to mapping_140702b       (note: gen_domain changes answers)
    unit_testing to unit_testing_0_07

    PTCLM        to PTCLM2_140816

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

   M    models/lnd/clm/tools/clm4_5/mksurfdata_map/src/mkgridmapMod.F90 -- decrease tolerance
   M    models/lnd/clm/tools/shared/ncl_scripts/getregional_datasets.ncl - Loop over variables
           and then cat the files together at the end. This makes the process possible for
           high resolution and speeds up lower resolution sub-setting as well.
   M    models/lnd/clm/tools/clm4_0/mksurfdata_map/src/mkgridmapMod.F90 -- decrease tolerance
   M    models/lnd/clm/tools/shared/mkmapdata/README --------------------- Fix/update documentation
   M    models/lnd/clm/bld/unit_testers/build-namelist_test.pl ----------- Correct test count
   M    models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_5.xml --- Add 0.125x0.125
           mapping files
   M    models/lnd/clm/bld/namelist_files/namelist_definition_clm4_5.xml - Add 0.125x0.125
           as a valid resolution
   M    models/lnd/clm/bld/namelist_files/createMapEntry.pl --- Correct path, get working again

CLM testing:

  build-namelist tests:

    yellowstone yes

  regular tests (aux_clm40, aux_clm45, with '-model_gen_comp clm2'):

    yellowstone_intel   yes
    yellowstone_pgi     yes
    yellowstone_gnu     yes
    goldbach_nag        yes
    goldbach_intel      yes
    goldbach_pgi        yes

  short tests (aux_clm_short) (generally these are NOT used when making a tag):

    yellowstone_intel   yes
    yellowstone_pgi     yes
    goldbach_nag        yes

  tools testing:

    yellowstone interactive  yes

CLM tag used for the baseline comparisons:  clm4_5_1_r079

Changes answers relative to baseline: Yes! (PE layouts that change)

  Summarize any changes to answers, i.e.,
    - what code configurations: non single-point configurations, where PE layout
        changes (f10_f10)
    - what platforms/compilers: all
    - nature of change (roundoff)
       x2l_Flrr_volr changes to roundoff

===============================================================
===============================================================
Tag name:  clm4_5_1_r079
Originator(s):  andre (Benjamin Andre,LAWRENCE BERKELEY NATIONAL LABORATORY,510-486-4617)
Date:  Thu Jul 31 17:09:57 MDT 2014
One-line Summary: G. Bisht (LBL) soil temperature refactor; machines update for goldbach-intel

Purpose of changes: Refactor soil temperature module to break the construction of the linear system LHS matrix and RHS vector into small physics based routines. Update machines external to fix compiling with goldbach-intel.

Requirements for tag: regular

Test level of tag: regular

Bugs fixed (include bugzilla ID): N/A

Known bugs (include bugzilla ID): N/A
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: N/A

Describe any changes made to the namelist: N/A

List any changes to the defaults for the boundary datasets: N/A

Describe any substantial timing or memory changes: N/A

Code reviewed by: gbisht, self, muszala

List any svn externals directories updated (csm_share, mct, etc.): Machines

List all files eliminated: N/A

List all files added and what they do: N/A

List all existing files that have been modified, and describe the changes:

M models/lnd/clm/src/clm4_5/biogeophys/SoilTemperatureMod.F90 - break creation of linear system into small physics based routines.


CLM testing: regular

  build-namelist tests: N/A

  regular tests (aux_clm40, aux_clm45, with '-model_gen_comp clm2'):

    yellowstone_intel - 4.0 ok, 4.5 ok
    yellowstone_pgi - 4.0 ok, 4.5 ok
    goldbach_nag - 4.0 ok, 4.5 ok (see note below)
    goldbach_intel - 4.0 ok, 4.5 ok
    goldbach_pgi - 4.0 ok, 4.5 ok

    NOTE for goldbach_nag - four ED compare_hist tests fail with small non bit for bit differences. This is the same issue described in clm4_5_1_r078 tag notes.

    ERS_D_Mmpi-serial.1x1_brazil.ICLM45CNED.goldbach_nag.clm-edTest
    ERS_D_Mmpi-serial.1x1_brazil.ICLM45CNED.goldbach_nag.clm-edTest
    SMS_D_Mmpi-serial.5x5_amazon.ICLM45CNED.goldbach_nag.clm-edTest
    SMS_D_Mmpi-serial.5x5_amazon.ICLM45CNED.goldbach_nag.clm-edTest

  tools testing: N/A

CLM tag used for the baseline comparisons: clm4_5_1_r078

Changes answers relative to baseline: No, bit for bit


===============================================================
===============================================================
Tag name:  clm4_5_1_r078
Originator(s):  muszala (Stefan Muszala)
Date: Wed Jul 23 20:42:00 MDT 2014
One-line Summary: Add lai stream capability and the ability to run with V5 cruncep data.  Code written by swenson, 
modified and tested by muszala.

Purpose of changes: Add lai stream capability with use_lai_streams namelist variable.  Also add a datm_mode option
s.t. we can use cruncep V5 data if a user wants.  Move anomaly focing code out of CLM and into DATM.

Requirements for tag: N/A

Test level of tag: regular

Bugs fixed (include bugzilla ID):

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: N/A

Describe any changes made to the namelist: add setup_logic_lai_streams which controls use_lai_streams namelist variable 

List any changes to the defaults for the boundary datasets: added option to use V5 cruncep data sets.  V4 is default.

Describe any substantial timing or memory changes: N/A

Code reviewed by: kluzek, swenson, self

List any svn externals directories updated (csm_share, mct, etc.):

-scripts  https://svn-ccsm-models.cgd.ucar.edu/scripts/branch_tags/addclm50_tags/addclm50_n06_ED_scripts_015_140305_rev
+scripts  https://svn-ccsm-models.cgd.ucar.edu/scripts/branch_tags/addclm50_tags/addclm50_n09_ED_scripts_015_140305_rev

-models/atm/datm                 https://svn-ccsm-models.cgd.ucar.edu/datm7/trunk_tags/datm8_140312
+models/atm/datm                 https://svn-ccsm-models.cgd.ucar.edu/datm7/trunk_tags/datm8_140723

-models/csm_share                https://svn-ccsm-models.cgd.ucar.edu/csm_share/trunk_tags/share3_140418
+models/csm_share                https://svn-ccsm-models.cgd.ucar.edu/csm_share/trunk_tags/share3_140723

List all files eliminated: N/A

List all files added and what they do: N/A

List all existing files that have been modified, and describe the changes:

! add setup_logic_lai_streams function
M       models/lnd/clm/bld/CLMBuildNamelist.pm
! add entries for: stream_year_first_lai, stream_year_last_lai, model_year_align_lai, stream_fldfilename_lai, lai_mapalgo
M       models/lnd/clm/bld/namelist_files/namelist_definition_clm4_5.xml
! add default values for items added in namelist_definition_clm4_5.xml
M       models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_5.xml
! add use_lai_streams code.   lai_init, lai_interp
M       models/lnd/clm/src/clm4_5/biogeochem/SatellitePhenologyMod.F90
! some comment clean up.  add use_lai_streams logical
M       models/lnd/clm/src/clm4_5/main/clm_varctl.F90
! add use_lai_streams namelist handling and mpi_bcast call
M       models/lnd/clm/src/clm4_5/main/controlMod.F90
! remove snomaly forcing streams since they are now in the datm
M       models/lnd/clm/src/cpl/clm_cpl_indices.F90
! remove anomaly forcing code since it is now in datm
M       models/lnd/clm/src/cpl/lnd_import_export.F90

CLM testing:

  build-namelist tests:

  yellowstone - failed  20 tests of 537.  This is expected due to the addition of the use_lai_streams namelist variable.

  regular tests (aux_clm40, aux_clm45, with '-model_gen_comp clm2'):

   -- nlcomp tests for 45 will fail --

    yellowstone_intel - 40 OK  - 45 OK
    yellowstone_pgi   - 40 OK  - 45 OK

    goldbach_nag      - 40 OK  - 45 OK 
    goldbach_intel    - 40 OK  - 45 OK
    goldbach_pgi      - 40 OK  - 45 OK

Both NAG tests on goldbach for ED compsets failed BFB.  All other compilers and machines pass.  Error probably related to a non-BFB error that I (spm) see with varying numbers of
time-steps on an ERS test and am currently trying to fix.

FAIL  ERS_D_Mmpi-serial.1x1_brazil.ICLM45CNED.goldbach_nag.clm-edTest.GC.again_45_nag.compare_hist.clm4_5_1_r077_redo 
FAIL ERS_D_Mmpi-serial.1x1_brazil.ICLM45CNED.goldbach_nag.clm-edTest.GC.again_45_nag.clm2.h0.compare_hist.clm4_5_1_r077_redo 
FAIL  SMS_D_Mmpi-serial.5x5_amazon.ICLM45CNED.goldbach_nag.clm-edTest.GC.again_45_nag.compare_hist.clm4_5_1_r077_redo 
FAIL SMS_D_Mmpi-serial.5x5_amazon.ICLM45CNED.goldbach_nag.clm-edTest.GC.again_45_nag.clm2.h0.compare_hist.clm4_5_1_r077_redo 
CLM tag used for the baseline comparisons:  clm4_5_1_r077

Changes answers relative to baseline: No

===============================================================
===============================================================
Tag name:  clm4_5_1_r077
Originator(s):  andre (Benjamin Andre,LAWRENCE BERKELEY NATIONAL LABORATORY,510-486-4617)
Date: Thu Jul 10 21:55:11 MDT 2014
One-line Summary: Refactor from Jinyun Tang (LBL) to make hydrology more modular and eventually allow runtime selection of different physics implementations.

Purpose of changes: Refactor a number of routines in clm45 hydrology to move duplicate code into reusable routines, make the code more modular for eventual unit testing and run time selection of different physics.

Requirements for tag: bit for bit, regular testing

Test level of tag: regular

Bugs fixed (include bugzilla ID):

Known bugs (include bugzilla ID):
	http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: self, clm-cmt

List any svn externals directories updated (csm_share, mct, etc.): none

List all files eliminated: none

List all files added and what they do:

  models/lnd/clm/src/util_share/SimpleMathMod.F90 - reuseable array functions
  models/lnd/clm/src/clm4_5/main/init_hydrology.F90 - initialize different hydrology submodules.
  models/lnd/clm/src/clm4_5/main/FuncPedotransferMod.F90 - modularize
  models/lnd/clm/src/clm4_5/biogeophys/SurfaceResistanceMod.F90 - modularize
  models/lnd/clm/src/clm4_5/biogeophys/RootBiophysMod.F90 - modularize
  models/lnd/clm/src/clm4_5/biogeophys/SoilWaterMovementMod.F90 - modularize
  models/lnd/clm/src/clm4_5/biogeophys/SoilMoistStressMod.F90 - modularize
  models/lnd/clm/src/clm4_5/biogeophys/SoiWatRetCurveParMod.F90 - modularize


List all existing files that have been modified, and describe the changes:

  models/lnd/clm/bld/query-xFail - check python version and provide an error message of it is too old.
  models/lnd/clm/src/clm4_5/biogeochem/CNC14DecayMod.F90 - remove unused min/max variables that conflict with intrinsics with gfortran.


  models/lnd/clm/src/clm4_5/main/initTimeConstMod.F90 - modularize
  models/lnd/clm/src/clm4_5/main/clmtypeInitMod.F90 - allocate new variable, fix bounds on porosity
  models/lnd/clm/src/clm4_5/main/controlMod.F90 - initialize new hydrology modules
  models/lnd/clm/src/clm4_5/main/clmtype.F90 - add new variable
  models/lnd/clm/src/clm4_5/biogeophys/Biogeophysics1Mod.F90 - modularize
  models/lnd/clm/src/clm4_5/biogeophys/BareGroundFluxesMod.F90 - modularize
  models/lnd/clm/src/clm4_5/biogeophys/CanopyFluxesMod.F90 - modularize
  models/lnd/clm/src/clm4_5/biogeophys/Hydrology2Mod.F90 - modularize
  models/lnd/clm/src/clm4_5/biogeophys/SoilHydrologyMod.F90 - modularize

CLM testing: regular

  build-namelist tests:

    yellowstone - n/a

  regular tests (aux_clm40, aux_clm45, with '-model_gen_comp clm2'):

    yellowstone_intel - OK clm40, OK clm45
    yellowstone_pgi - OK clm40, OK clm45
    goldbach_nag - OK clm40, OK clm45
    goldbach_intel - OK clm40, OK clm45
    goldbach_pgi - OK clm40, OK clm45

  short tests (aux_clm_short) (generally these are NOT used when making a tag):

    yellowstone_intel - n/a
    yellowstone_pgi - n/a
    goldbach_nag - n/a

  tools testing:

    yellowstone interactive - n/a
    goldbach interactive - n/a

CLM tag used for the baseline comparisons: clm4_5_1_r076

Changes answers relative to baseline: No, bit for bit

  Note: SMS_D_Mmpi-serial.5x5_amazon.ICLM45CNED.goldbach_nag.clm-edTest is not bit for bit. This is the same test Stef had problems with in clm4_5_75. He has looked at it and given the ok make the tag as is.

===============================================================
===============================================================
Tag name:  clm4_5_1_r076
Originator(s):  erik (Erik)
Date: Mon Jul  7 14:24:07 MDT 2014
Orig Date: Wed Jun 25 13:49:49 MDT 2014 (Date of what was tagged as clm4_6_0, before we changed naming convention)
One-line Summary: Answer changes for fire code from Fang Li

Purpose of changes:

Several changes to CN Fire model. Some fixes for non-transient, as well as limiting of fire for high tropical
forest coverage. Change some units from per time-step to per second. Change Lightning input dataset from just
cloud to ground to total lightning. Some fire parameters were also changed and re-tuned for Qian forcing.
Some more documentation on fire fields was added.

When -ed_mode is sent to CLM build-namelist, a particular ED params dataset is used over the default. Make
a simple change that allows ED to run when CN is off. Add a 1850 and transient 20thC and rcp=8.5 datasets
for 1x1_brazil.

Requirements for tag: Fix bugs 1805 and 1719, lower fire amount in amazon

Test level of tag: regular

Bugs fixed (include bugzilla ID):
    1996 -- change cloud to ground lightning dataset to total lightning
    1995 -- change units from per time-step to per second
    1805 -- fire fix for non-transient
    1719 -- remove double counting of baf in fire area
    1992 -- allow ED to run when use_cn=.false.
    1988 -- Add ED params dataset.
    1991 -- transient datasets for 1x1_brazil

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: None

Describe any changes made to the namelist: None

List any changes to the defaults for the boundary datasets:
  specific rparams file for ED
  add 1850 and 20thC, rcp8.5 datasets for 1x1_brazil
  use lightning file that is total lightning not just cloud-to-ground

Describe any substantial timing or memory changes: 
    The test SMS.f19_g16.IRCP45CN.yellowstone_pgi showed a memory increase

Code reviewed by: self, lifang

List any svn externals directories updated (csm_share, mct, etc.): scripts
    scripts to addclm50_n06_ED_scripts_015_140305_rev

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

       M models/lnd/clm/bld/unit_testers/build-namelist_test.pl --------- Add some ED tests
       M models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_5.xml - Different
             params file for ED, and add 1850 and 20thC, rcp8.5 datasets for 1x1_brazil
             and use lightning file that is total lightning not just cloud-to-ground
       M models/lnd/clm/bld/CLMBuildNamelist.pm ------------------------- Pass use_ed
             when getting paramfile
       M models/lnd/clm/src/clm4_5/biogeochem/CNFireMod.F90 ------------- Revisions from
             Fang Li (2014), change parameters, add documentation, tropical forests will
             only burn if > 60% coverage, change some fields units to per second rather than
             per time-step, 
       M models/lnd/clm/src/clm4_5/biogeochem/CNInitMod.F90 ------------- change units
             for nfire, and farea_burned
       M models/lnd/clm/src/clm4_5/main/clmtype.F90 --------------------- Change units
             for nfire, lfc, lfc2, baf_crop, baf_peatf, fbac, fbac1, farea_burned
       M models/lnd/clm/src/clm4_5/main/histFldsMod.F90 ----------------- Change units for:
             LFC2, NFIRE, FAREA_BURNED, BAF_CROP, BAF_PEATF
       M models/lnd/clm/src/clm4_5/biogeophys/ED/EDPhotosynthesisMod.F90  Allow to work
             when use_cn is .false., use c3psn+1 in finding index for dr array.

CLM testing:

 build-namelist tests:  yes

    NOTE: 191 of the 537 compare tests fail, compared to clm4_5_75, because of changes in the namelist.

    yellowstone        yes

  regular tests (aux_clm40, aux_clm45, with '-model_gen_comp clm2'):

    yellowstone_intel  yes
    yellowstone_pgi    yes
    goldbach_nag       yes
    goldbach_intel     yes
    goldbach_pgi       yes

CLM tag used for the baseline comparisons:  clm4_5_75

Changes answers relative to baseline:

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: CN and BGC with CLM4.5 physics
          CLM4.0 for all modes, and CLM4.5 with SP or ED should be identical
    - what platforms/compilers: All
    - nature of change: new climate

   Fang Li, ran simulations with Qian forcing on yellowstone and tuned fire parameters to that forcing.
   However, her simulations had a minor bug in the conversion of total lightning to just cloud-to-ground
   (latitude in degree's was used for a cosine, rather than latitude in radians -- see bug 1996).

===============================================================
===============================================================
Tag name:  clm4_5_75
Originator(s):  muszala (Stefan Muszala,UCAR/TSS,303-497-1320)
Date: Fri May 30 11:18:35 MDT 2014
One-line Summary: update externals to rtm1_0_38 and esmf_wrf_timemgr_140529

Purpose of changes: update externals to rtm1_0_38 and esmf_wrf_timemgr_140529.  These modifications
are based on valgrind errors that orginated in src/riverroute.  Tested in clm4_5_72 to make sure
everything was still BFB (at least w.r.t. CLM testing).  Retested (results below) against clm4_5_73.  

Requirements for tag: N/A

Test level of tag: regular

Bugs fixed (include bugzilla ID):N/A

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: N/A

Describe any changes made to the namelist: N/A

List any changes to the defaults for the boundary datasets: N/A

Describe any substantial timing or memory changes: N/A

Code reviewed by: self

List any svn externals directories updated (csm_share, mct, etc.): 

-models/rof/rtm                  https://svn-ccsm-models.cgd.ucar.edu/rivrtm/trunk_tags/rtm1_0_37
+models/rof/rtm                  https://svn-ccsm-models.cgd.ucar.edu/rivrtm/trunk_tags/rtm1_0_38

-models/utils/esmf_wrf_timemgr   https://svn-ccsm-models.cgd.ucar.edu/esmf_wrf_timemgr/trunk_tags/esmf_wrf_timemgr_130213
+models/utils/esmf_wrf_timemgr   https://svn-ccsm-models.cgd.ucar.edu/esmf_wrf_timemgr/trunk_tags/esmf_wrf_timemgr_140529

List all files eliminated: N/A

List all files added and what they do: N/A

List all existing files that have been modified, and describe the changes: N/A

CLM testing:

in addition to other clm tests I updated the rtm and esmf externals in cesm1_3_alpha09c and
ran two B cases.

Note:  There is one ED test (SMS_D_Mmpi-serial.5x5_amazon.ICLM45CNED.goldbach_nag.clm-edTestGb) that failed for me in my
testing but passed for Bill with the same checkout.  We will keep an eye on this, but it's not super-critical at the moment.
Differences are very small in cpl. voc fields (largest RMS difference is 1e-13).

>>more TestStatus
PASS  ERS_PT.T31_g37.B1850CN.yellowstone_gnu 
PASS  ERS_PT.T31_g37.B1850CN.yellowstone_gnu.memleak

>>more TestStatus
PASS  ERS.ne30_g16.B1850C5CN.yellowstone_intel 
PASS  ERS.ne30_g16.B1850C5CN.yellowstone_intel.memleak

  build-namelist tests: N/A

  regular tests (aux_clm40, aux_clm45, with '-model_gen_comp clm2'):

    yellowstone_intel - 40 OK - 45 OK - component gen comp - OK
    yellowstone_pgi   - 40 OK - 45 OK - component gen comp - OK

    goldbach_nag      - 40 OK - 45 OK
    goldbach_intel    - 40 OK - 45 OK
    goldbach_pgi      - 40 OK - 45 OK

CLM tag used for the baseline comparisons: clm4_5_73

Changes answers relative to baseline: No

===============================================================
===============================================================
Tag name:  clm4_5_74
Originator(s):  sacks (sacks)
Date: Wed May 28 16:05:36 MDT 2014
One-line Summary: misc. bfb changes - see detailed summary below

Purpose of changes:

  (1) Rename fpftdyn to flanduse_timeseries, and make related changes to names
      throughout the code. This rename is in preparation for an upcoming tag
      where this file will take on more general uses (e.g., transient crop
      areas).

  (2) Decrease thresholds for water, snow and energy balance checks (these were
      too permissive)

  (3) Move stuff out of clm_varcon into landunit_varcon (for constants specific
      to CLM's landunits) and column_varcon (for constants specific to CLM's
      columns) - analogous to the existing pftvarcon

  (4) Move some routines out of initGridCellsMod into a new initSubgridMod

  (5) Make time_info a public member of dyn_file_type, which allows removing a
      bunch of delegation methods. And rename some things in time_info_type for
      clarity.

  (6) Rework metadata for the description of landunit, column and pft types
      on the history and restart files, to centralize these descriptions to the
      appropriate place in the code.

  (7) Add general-purpose functionality for setting up subgrid structure for
      unit tests

  (8) Move unit tests into source tree, rather than being in
      test/unit_testers. Now the top-level script is in models/lnd/clm/src.

  (9) Fix baseline comparisons for PTCLM tests

Requirements for tag: N/A

Test level of tag: regular

Bugs fixed (include bugzilla ID):
  - 1928 (create landunit_varcon.F90 and column_varcon.F90 from parts of clm_varcon.F90)

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: None

Describe any changes made to the namelist: fpftdyn renamed to flanduse_timeseries

List any changes to the defaults for the boundary datasets: None

Describe any substantial timing or memory changes: None

Code reviewed by: self

List any svn externals directories updated (csm_share, mct, etc.):

   scripts: addclm50_n03_ED_scripts_015_140305_rev -> addclm50_n04_ED_scripts_015_140305_rev
     - Rename CLM's fpftdyn to flanduse_timeseries in tests; update perl5lib

   tools/unit_testing: unit_testing_0_04 -> unit_testing_0_05
     - the major change here is allowing rebuilds with intel without needing to
       specify --clean

   models/lnd/clm/tools/PTCLM: PTCLM2_140423 -> PTCLM2_140521
     - rename fpftdyn -> flanduse_timeseries, and other related renames

List all files eliminated:

========= Renamed
D       models/lnd/clm/tools/clm4_5/mksurfdata_map/pftdyn_hist_simyr1850-2005.txt
D       models/lnd/clm/tools/clm4_0/mksurfdata_map/pftdyn_hist_simyr1850-2005.txt

========= Move unit tests into source tree
D       models/lnd/clm/test/unit_testers/clm4_5/biogeophys/CMakeLists.txt
D       models/lnd/clm/test/unit_testers/clm4_5/biogeophys/Daylength_test/test_daylength.pf
D       models/lnd/clm/test/unit_testers/clm4_5/biogeophys/Daylength_test/CMakeLists.txt
D       models/lnd/clm/test/unit_testers/clm4_5/biogeophys/Daylength_test
D       models/lnd/clm/test/unit_testers/clm4_5/biogeophys
D       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/dynLandunitArea_test/test_update_landunit_weights_one_gcell.pf
D       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/dynLandunitArea_test/CMakeLists.txt
D       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/dynLandunitArea_test/test_update_landunit_weights.pf
D       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/dynLandunitArea_test
D       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/dynVar_test/test_dynVarShared.F90
D       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/dynVar_test/test_dynVarTimeInterp.pf
D       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/dynVar_test/test_dynVarTimeUninterp.pf
D       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/dynVar_test/CMakeLists.txt
D       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/dynVar_test
D       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/dynTimeInfo_test/test_dynTimeInfo.pf
D       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/dynTimeInfo_test/CMakeLists.txt
D       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/dynTimeInfo_test
D       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/CMakeLists.txt
D       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/dynInitColumns_test/test_init_columns.pf
D       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/dynInitColumns_test/CMakeLists.txt
D       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/dynInitColumns_test
D       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid
D       models/lnd/clm/test/unit_testers/clm4_5/mock/util_share/ncdio_var.F90
D       models/lnd/clm/test/unit_testers/clm4_5/mock/util_share/GetGlobalValuesMod_mock.F90
D       models/lnd/clm/test/unit_testers/clm4_5/mock/util_share/ncdio_var.F90.in
D       models/lnd/clm/test/unit_testers/clm4_5/mock/util_share/clm_time_manager_mock.F90
D       models/lnd/clm/test/unit_testers/clm4_5/mock/util_share/ncdio_pio_mock.F90
D       models/lnd/clm/test/unit_testers/clm4_5/mock/util_share/spmdMod_mock.F90
D       models/lnd/clm/test/unit_testers/clm4_5/mock/util_share/do_genf90
D       models/lnd/clm/test/unit_testers/clm4_5/mock/util_share/CMakeLists.txt
D       models/lnd/clm/test/unit_testers/clm4_5/mock/util_share/ncdio_pio_mock.F90.in
D       models/lnd/clm/test/unit_testers/clm4_5/mock/util_share
D       models/lnd/clm/test/unit_testers/clm4_5/mock/csm_share/shr_sys_mod_mock.F90
D       models/lnd/clm/test/unit_testers/clm4_5/mock/csm_share/mct_mod_mock.F90
D       models/lnd/clm/test/unit_testers/clm4_5/mock/csm_share/CMakeLists.txt
D       models/lnd/clm/test/unit_testers/clm4_5/mock/csm_share
D       models/lnd/clm/test/unit_testers/clm4_5/mock/main/CMakeLists.txt
D       models/lnd/clm/test/unit_testers/clm4_5/mock/main/histFileMod_mock.F90
D       models/lnd/clm/test/unit_testers/clm4_5/mock/main
D       models/lnd/clm/test/unit_testers/clm4_5/mock/dyn_subgrid/dynFileMod_mock.F90
D       models/lnd/clm/test/unit_testers/clm4_5/mock/dyn_subgrid/CMakeLists.txt
D       models/lnd/clm/test/unit_testers/clm4_5/mock/dyn_subgrid
D       models/lnd/clm/test/unit_testers/clm4_5/mock/CMakeLists.txt
D       models/lnd/clm/test/unit_testers/clm4_5/mock
D       models/lnd/clm/test/unit_testers/clm4_5/CMakeLists.txt
D       models/lnd/clm/test/unit_testers/clm4_5/README
D       models/lnd/clm/test/unit_testers/clm4_5
D       models/lnd/clm/test/unit_testers


List all files added and what they do:

========= Renamed
A       models/lnd/clm/tools/clm4_5/mksurfdata_map/landuse_timeseries_hist_simyr1850-2005.txt
A       models/lnd/clm/tools/clm4_0/mksurfdata_map/landuse_timeseries_hist_simyr1850-2005.txt

========= Move stuff out of clm_varcon into landunit_varcon (for constants
          specific to CLM's landunits) and column_varcon (for constants specific
          to CLM's columns) - analogous to the existing pftvarcon.
A       models/lnd/clm/src/clm4_5/main/landunit_varcon.F90
A       models/lnd/clm/src/clm4_5/main/column_varcon.F90


========= Move some routines out of initGridCellsMod - these are lower-level
          routines that can also be used by unit test code. So initGridCellsMod
          contains higher-level stuff that is specific to how the subgrid
          structure is set up in a production run; and initSubgridMod contains
          lower-level stuff that doesn't know or care how things are actually
          set up, conceptually.
A       models/lnd/clm/src/clm4_5/main/initSubgridMod.F90

========= Add general-purpose functionality for setting up subgrid structure for unit tests
A       models/lnd/clm/src/unit_test_shr/unittestSubgridMod.F90
A       models/lnd/clm/src/unit_test_shr/CMakeLists.txt
A       models/lnd/clm/src/unit_test_shr


========= Move unit tests into source tree; also modify some unit tests to take
          advantage of the new unittestSubgridMod; also add tests of
          subgridWeightsMod and clm_glclnd
A       models/lnd/clm/src/clm4_5/main/test/subgridWeights_test/CMakeLists.txt
A       models/lnd/clm/src/clm4_5/main/test/subgridWeights_test/test_subgridWeights.pf
A       models/lnd/clm/src/clm4_5/main/test/subgridWeights_test
A       models/lnd/clm/src/clm4_5/main/test/CMakeLists.txt
A       models/lnd/clm/src/clm4_5/main/test/clm_glclnd_test/test_clm_glclnd.pf
A       models/lnd/clm/src/clm4_5/main/test/clm_glclnd_test/CMakeLists.txt
A       models/lnd/clm/src/clm4_5/main/test/clm_glclnd_test
A       models/lnd/clm/src/clm4_5/main/test
A       models/lnd/clm/src/clm4_5/biogeophys/test/CMakeLists.txt
A       models/lnd/clm/src/clm4_5/biogeophys/test/Daylength_test/test_daylength.pf
A       models/lnd/clm/src/clm4_5/biogeophys/test/Daylength_test/CMakeLists.txt
A       models/lnd/clm/src/clm4_5/biogeophys/test/Daylength_test
A       models/lnd/clm/src/clm4_5/biogeophys/test
A       models/lnd/clm/src/clm4_5/dyn_subgrid/test/dynLandunitArea_test/test_update_landunit_weights_one_gcell.pf
A       models/lnd/clm/src/clm4_5/dyn_subgrid/test/dynLandunitArea_test/CMakeLists.txt
A       models/lnd/clm/src/clm4_5/dyn_subgrid/test/dynLandunitArea_test/test_update_landunit_weights.pf
A       models/lnd/clm/src/clm4_5/dyn_subgrid/test/dynLandunitArea_test
A       models/lnd/clm/src/clm4_5/dyn_subgrid/test/dynVar_test/test_dynVarShared.F90
A       models/lnd/clm/src/clm4_5/dyn_subgrid/test/dynVar_test/test_dynVarTimeInterp.pf
A       models/lnd/clm/src/clm4_5/dyn_subgrid/test/dynVar_test/test_dynVarTimeUninterp.pf
A       models/lnd/clm/src/clm4_5/dyn_subgrid/test/dynVar_test/CMakeLists.txt
A       models/lnd/clm/src/clm4_5/dyn_subgrid/test/dynVar_test
A       models/lnd/clm/src/clm4_5/dyn_subgrid/test/dynTimeInfo_test/test_dynTimeInfo.pf
A       models/lnd/clm/src/clm4_5/dyn_subgrid/test/dynTimeInfo_test/CMakeLists.txt
A       models/lnd/clm/src/clm4_5/dyn_subgrid/test/dynTimeInfo_test
A       models/lnd/clm/src/clm4_5/dyn_subgrid/test/CMakeLists.txt
A       models/lnd/clm/src/clm4_5/dyn_subgrid/test/dynInitColumns_test/test_init_columns.pf
A       models/lnd/clm/src/clm4_5/dyn_subgrid/test/dynInitColumns_test/CMakeLists.txt
A       models/lnd/clm/src/clm4_5/dyn_subgrid/test/dynInitColumns_test
A       models/lnd/clm/src/clm4_5/dyn_subgrid/test
A       models/lnd/clm/src/README.unit_testing
A       models/lnd/clm/src/unit_test_mocks/util_share/ncdio_var.F90
A       models/lnd/clm/src/unit_test_mocks/util_share/GetGlobalValuesMod_mock.F90
A       models/lnd/clm/src/unit_test_mocks/util_share/ncdio_var.F90.in
A       models/lnd/clm/src/unit_test_mocks/util_share/clm_time_manager_mock.F90
        - also add a routine to this mock, needed because of refactor of
          dyn_file_type / dyn_time_inof
A       models/lnd/clm/src/unit_test_mocks/util_share/ncdio_pio_mock.F90
A       models/lnd/clm/src/unit_test_mocks/util_share/spmdMod_mock.F90
A       models/lnd/clm/src/unit_test_mocks/util_share/do_genf90
A       models/lnd/clm/src/unit_test_mocks/util_share/CMakeLists.txt
A       models/lnd/clm/src/unit_test_mocks/util_share/ncdio_pio_mock.F90.in
A       models/lnd/clm/src/unit_test_mocks/util_share
A       models/lnd/clm/src/unit_test_mocks/csm_share/shr_sys_mod_mock.F90
A       models/lnd/clm/src/unit_test_mocks/csm_share/mct_mod_mock.F90
A       models/lnd/clm/src/unit_test_mocks/csm_share/CMakeLists.txt
A       models/lnd/clm/src/unit_test_mocks/csm_share
A       models/lnd/clm/src/unit_test_mocks/main/CMakeLists.txt
A       models/lnd/clm/src/unit_test_mocks/main/histFileMod_mock.F90
A       models/lnd/clm/src/unit_test_mocks/main
A       models/lnd/clm/src/unit_test_mocks/dyn_subgrid/dynFileMod_mock.F90
A       models/lnd/clm/src/unit_test_mocks/dyn_subgrid/CMakeLists.txt
A       models/lnd/clm/src/unit_test_mocks/dyn_subgrid
A       models/lnd/clm/src/unit_test_mocks/CMakeLists.txt
A       models/lnd/clm/src/unit_test_mocks
A       models/lnd/clm/src/CMakeLists.txt

List all existing files that have been modified, and describe the changes:

========= Renamed fpftdyn -> flanduse_timeseries, and other related changes to
          variable names
          (NOTE: Some source files are listed both here and elsewhere in the
          ChangeLog entry)
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/mksurfdata_map.namelist
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/mksurfdata.pl
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/README
M       models/lnd/clm/tools/shared/ncl_scripts/sample_inlist
M       models/lnd/clm/tools/shared/ncl_scripts/sample_outlist
M       models/lnd/clm/tools/clm4_0/mksurfdata_map/src/clm_varctl.F90
M       models/lnd/clm/tools/clm4_0/mksurfdata_map/mksurfdata_map.namelist
M       models/lnd/clm/tools/clm4_0/mksurfdata_map/mksurfdata.pl
M       models/lnd/clm/tools/clm4_0/mksurfdata_map/README
M       models/lnd/clm/bld/CLMBuildNamelist.pm
M       models/lnd/clm/bld/unit_testers/build-namelist_test.pl
M       models/lnd/clm/bld/test_build_namelist/t/input/namelist_defaults_clm4_5_test.xml
M       models/lnd/clm/bld/test_build_namelist/t/input/namelist_definition_clm4_5_test.xml
M       models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_0.xml
M       models/lnd/clm/bld/namelist_files/namelist_definition_clm4_0.xml
M       models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_5.xml
M       models/lnd/clm/bld/namelist_files/namelist_definition_clm4_5.xml
M       models/lnd/clm/bld/namelist_files/use_cases/20thC_glacierMEC_transient.xml
M       models/lnd/clm/bld/namelist_files/use_cases/2000-2100_rcp8.5_transient.xml
M       models/lnd/clm/bld/namelist_files/use_cases/1850-2100_rcp2.6_transient.xml
M       models/lnd/clm/bld/namelist_files/use_cases/1850-2100_rcp6_transient.xml
M       models/lnd/clm/bld/namelist_files/use_cases/1850-2100_rcp4.5_transient.xml
M       models/lnd/clm/bld/namelist_files/use_cases/1850-2100_rcp8.5_transient.xml
M       models/lnd/clm/bld/namelist_files/use_cases/20thC_transient.xml
M       models/lnd/clm/bld/namelist_files/use_cases/1850-2100_rcp2.6_glacierMEC_transient.xml
M       models/lnd/clm/bld/namelist_files/use_cases/1850-2100_rcp6_glacierMEC_transient.xml
M       models/lnd/clm/bld/namelist_files/use_cases/1850-2100_rcp4.5_glacierMEC_transient.xml
M       models/lnd/clm/bld/namelist_files/use_cases/1850-2100_rcp8.5_glacierMEC_transient.xml
M       models/lnd/clm/bld/namelist_files/namelist_defaults_usr_files.xml
M       models/lnd/clm/doc/UsersGuide/trouble_shooting.xml
M       models/lnd/clm/doc/UsersGuide/single_point.xml
M       models/lnd/clm/doc/UsersGuide/tools.xml
M       models/lnd/clm/doc/UsersGuide/adding_files.xml
M       models/lnd/clm/doc/UsersGuide/custom.xml
M       models/lnd/clm/doc/UsersGuide/ptclm.xml
M       models/lnd/clm/src/clm4_5/biogeochem/CNFireMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNEcosystemDynMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_varpar.F90
M       models/lnd/clm/src/clm4_5/main/subgridRestMod.F90
M       models/lnd/clm/src/clm4_5/main/restFileMod.F90
M       models/lnd/clm/src/clm4_5/main/controlMod.F90
M       models/lnd/clm/src/clm4_5/main/surfrdUtilsMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_varctl.F90
M       models/lnd/clm/src/clm4_5/biogeophys/BiogeophysRestMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynSubgridDriverMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynHarvestMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynpftFileMod.F90
M       models/lnd/clm/src/clm4_0/biogeochem/CNEcosystemDynMod.F90
M       models/lnd/clm/src/clm4_0/main/clm_initializeMod.F90
M       models/lnd/clm/src/clm4_0/main/pftdynMod.F90
M       models/lnd/clm/src/clm4_0/main/controlMod.F90
M       models/lnd/clm/src/clm4_0/main/clm_varctl.F90
M       models/lnd/clm/src/clm4_0/main/clm_driver.F90
M       models/lnd/clm/src/clm4_0/biogeophys/BiogeophysRestMod.F90

========= Updated PTCLM external to rename fpftdyn -> flanduse_timeseries
M       models/lnd/clm/tools/SVN_EXTERNAL_DIRECTORIES

========= Decrease threshold for water & snow balance checks by 3 orders of
          magnitude; decrease threshold for energy balance checks by 2 orders of
          magnitude
M       models/lnd/clm/src/clm4_5/biogeophys/BalanceCheckMod.F90

========= Separate clm_varcon into clm_varcon, column_varcon and landunit_varcon
M       models/lnd/clm/src/clm4_5/main/clm_varcon.F90
M       models/lnd/clm/src/clm4_5/main/CMakeLists.txt

========= Move some routines out of initGridCellsMod, into a new initSubgridMod
          (see detailed notes above)
M       models/lnd/clm/src/clm4_5/main/initGridCellsMod.F90

========= Make time_info a public member of dyn_file_type. This allows us to
          remove all methods from dyn_file_type (which were just delegating
          responsibility to time_info_type). Also rename some methods and
          variables in time_info_type.
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynFileMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynTimeInfoMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynHarvestMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynpftFileMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynVarMod.F90.in
         - also change intent(in) to intent(inout), fixing a gfortran problem
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynVarMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynVarTimeUninterpMod.F90.in
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynVarTimeUninterpMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynVarTimeInterpMod.F90.in
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynVarTimeInterpMod.F90

========= Rework metadata for the description of landunit, column and pft types
          on the history and restart files. Point is to centralize the
          definition of these different types as much as possible (rather than,
          e.g., having restFileMod know about the translation between landunit
          indices and names). For the history file, I am removing the metadata
          from the PCT_LANDUNIT long name, instead putting it in global
          metadata, as is done for the restart file.
M       models/lnd/clm/src/clm4_5/main/subgridWeightsMod.F90
M       models/lnd/clm/src/clm4_5/main/histFileMod.F90
M       models/lnd/clm/src/clm4_5/main/restFileMod.F90
M       models/lnd/clm/src/clm4_5/main/pftvarcon.F90

========= Change 'use' statements based on my split of clm_varcon into
          clm_varcon, landunit_varcon and column_varcon
M       models/lnd/clm/src/clm4_5/biogeochem/CNWoodProductsMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/DUSTMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNInitMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/ch4InitMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNAllocationMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/DryDepVelocity.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNDVEstablishmentMod.F90
M       models/lnd/clm/src/clm4_5/main/initTimeConstMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_initializeMod.F90
M       models/lnd/clm/src/clm4_5/main/subgridRestMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_glclnd.F90
M       models/lnd/clm/src/clm4_5/main/subgridMod.F90
M       models/lnd/clm/src/clm4_5/main/clmtypeInitMod.F90
M       models/lnd/clm/src/clm4_5/main/initColdMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_atmlnd.F90
M       models/lnd/clm/src/clm4_5/main/filterMod.F90
M       models/lnd/clm/src/clm4_5/main/ED/EDCLMLinkMod.F90
M       models/lnd/clm/src/clm4_5/main/subgridAveMod.F90
M       models/lnd/clm/src/clm4_5/main/surfrdMod.F90
M       models/lnd/clm/src/clm4_5/main/clmtype.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SLakeInitMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SoilTemperatureMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SnowHydrologyMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/UrbanInputMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/Biogeophysics1Mod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/TridiagonalMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/Hydrology1Mod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/BiogeophysRestMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/UrbanMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/clm_driverInitMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/BareGroundFluxesMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SurfaceRadiationMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/H2OSfcMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/Biogeophysics2Mod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/UrbanInitMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SurfaceAlbedoMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/Hydrology2Mod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SoilHydrologyMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynLandunitAreaMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynConsBiogeochemMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynEDMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynCNDVMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynConsBiogeophysMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynInitColumnsMod.F90

========= Fix baseline comparisons for PTCLM tests
M       models/lnd/clm/test/tools/TSMscript_tools.sh
M       models/lnd/clm/test/tools/TBLscript_tools.sh

========= Just changes in whitespace
M       models/lnd/clm/src/clm4_5/dyn_subgrid/CMakeLists.txt
M       models/lnd/clm/src/clm4_5/biogeophys/CMakeLists.txt


CLM testing:

  Most testing done on dynlu_crops_n01_addclm50bld_n06_clm4_5_72; PTCLM and
  tools testing done on dynlu_crops_n03_addclm50bld_n06_clm4_5_72

  Note that the branch was up-to-date with addclm50bld_n06_clm4_5_72; this is
  identical to clm4_5_73 except for a fix to the build-namelist tests (see below)

  build-namelist tests:

    yellowstone: ok
      compared against addclm50bld_n06_clm4_5_72 (essentially clm4_5_73)
      expected diffs for transient cases

      The following tests also failed when comparing the baseline against
      itself (NOTE: this is apparently fixed in clm4_5_73):

      466/497 < FAIL> <Test Id: 466> <Desc: compare file lnd_in DNE for phys-crop.clm4_5 and -res+1.9x2.5+-irrig+.true.+-crop+-bgc+cn++-envxml_dir+.>  
      467/497 < FAIL> <Test Id: 467> <Desc: compare file temp_file.txt DNE for phys-crop.clm4_5 and -res+1.9x2.5+-irrig+.true.+-crop+-bgc+cn++-envxml_dir+.>  
      496/497 < FAIL> <Test Id: 496> <Desc: compare file lnd_in DNE for phys-crop.clm5_0 and -res+1.9x2.5+-irrig+.true.+-crop+-bgc+cn++-envxml_dir+.>  
      497/497 < FAIL> <Test Id: 497> <Desc: compare file temp_file.txt DNE for phys-crop.clm5_0 and -res+1.9x2.5+-irrig+.true.+-crop+-bgc+cn++-envxml_dir+.>  

  regular tests (aux_clm40, aux_clm45, with '-model_gen_comp clm2'):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    goldbach_nag: ok
    goldbach_intel: ok
    goldbach_pgi: ok

      Most comparisons were done against clm4_5_72.

      These comparisons failed due to a problem with component_gen_comp and the
      SSP test; manual comparisons show these to be identical to Erik's tests (for
      clm4_5_73):

        FAIL SSP.f19_g16.I1850CLM45BGC.yellowstone_pgi.clm-default.GC.0520-2021.45.p.clm2.h0.compare_hist.clm4_5_72 
        FAIL SSP.f19_g16.I1850CLM45BGC.yellowstone_pgi.clm-default.GC.0520-2021.45.p.clm2.h1.compare_hist.clm4_5_72     

      For new tests added in Erik's upcoming tag (clm4_5_73), I did manual
      comparisons against Erik's baselines (cpl & clm hist for the yellowstone
      tests, just cpl for goldbach tests) - all PASS.

      Note that CLM hist files were NOT compared for any goldbach tests, because
      there were no CLM hist file baselines for clm4_5_72.

  tools testing:

    yellowstone interactive: ok

      Compared against addclm50bld_n06_clm4_5_72 (essentially clm4_5_73)

      Failures in the following baseline comparisons, due to changed name of output
      file (surfdata.pftdyn -> landuse.timeseries). Manual comparisons showed the
      output files to be identical in all cases:

      010 bl754 TBLtools.sh clm4_0 mksurfdata_map tools__s namelist ...................................\c
       rc=7 FAIL
      012 blg54 TBLtools.sh clm4_5 mksurfdata_map tools__s namelist ...................................\c
       rc=7 FAIL
      018 bl974 TBLscript_tools.sh clm4_0 mksurfdata_map mksurfdata.pl mksrfdt_1x1_brazil_1850-2000^tools_\c
       rc=7 FAIL
      030 bli74 TBLscript_tools.sh clm4_5 mksurfdata_map mksurfdata.pl mksrfdt_1x1_brazil_1850-2000^tools_\c
       rc=7 FAIL
      040 blfg4 TBLscript_tools.sh shared PTCLM PTCLMmkdata PTCLM_USUMB_Global_clm4_5^buildtools ......\c
       rc=7 FAIL

       Other than that, all tests & baseline comparisons passed

CLM tag used for the baseline comparisons: clm4_5_72, except where noted above

Changes answers relative to baseline: NO - bfb
	
===============================================================
===============================================================
Tag name:  clm4_5_73
Originator(s):  erik (Erik Kluzek,UCAR/TSS,303-497-1326)
Date: Wed May 28 15:33:10 MDT 2014
One-line Summary: Add the stub ability for clm5_0 physics to CLM build system

Purpose of changes:

Add phys=clm5_0 as an option to the build. Currently, nothing is different in the code, this just
adds the capability to do clm5_0 as a seperate configuration. The one thing that is different between
clm4_5 and clm5_0 is the setting of urban_hac.

Fix several issues needed for CAM: problem in DryDeposition (reoccurance of bug 1883, that was fixed and then
unfixed in clm4_5_48), fix for internal compiler errors. CAM has been using the branch version of this
since: cam5_3_29.

Work on updates for PTCLM. Add some new sites for Rosie and Jinyun. Correct the call to mkmapdata.sh.
Have CLM1PT forcing directory to use DIN_LOC_ROOT_CLMFORC so you can point it to a location seperate
from DIN_LOC_ROOT. Add a new support script to PTCLM to submit a list of sites to batch: PTCLMsublist.
Also allow release_tags in version find. Get buildtools to work on edison/hopper.

Get tools to work on hopper and edison, and update mapping to use ESMF6.3.0.

Fix various bugs: internal compiler error on janus, trigger an error if user_datm.streams.txt file is 
                  readonly (rather than hang). Use DIN_LOC_ROOT_CLMFORC for CLM1PT.

Requirements for tag: Fix bug 1883 and 1985 for Cheryl and CAM, fix PTCLM, add clm5_0, tools on hopper/edison

Test level of tag: regular

Bugs fixed (include bugzilla ID):

   1985  Internal compiler error on yellowstone with CLM in CAM standalone build
   1965	 Internal compiler error on janus with CLM on janus
   1938  Upgrade mkmapdata to ESMF6.3.0 
   1937  Using a read-only user_datm.streams.txt file causes cesm_setup to hang 
   1936  CLM1PT forcing directory needs to use DIN_LOC_ROOT_CLMFORC
   1935  Changes needed to get tools to build on hopper... 
   1933  Correct call to mkmapdata.sh in PTCLM 
   1925  Add more sites to PTCLM 
   1904  check for LSF_PJL_TYPE in regridbatch.sh doesn't work correctly 
   1883	 uninitialized variable in DryDepVelocity.F90

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: Add clm5_0 as a new supported physics type

Describe any changes made to the namelist: Set urban_hac according to physics
    clm5_0=ON_WASTEHEAT, and clm4_5=ON

List any changes to the defaults for the boundary datasets: N/A

Describe any substantial timing or memory changes: N/A

Code reviewed by: self (clm_phys perl object reviewed by team: bandre, muszala, sacks)

List any svn externals directories updated (csm_share, mct, etc.): scripts, datm
   scripts       to addclm50_n03_ED_scripts_015_140305_rev
   datm          to datm8_140312
   csm_share     to share3_140418        Use trunk version rather than branch
   tools/mapping to mapping_131217a 
   PTCLM         to PTCLM2_140423

List all files eliminated:

 D    models/lnd/clm/bld/unit_testers/env_run.xml -- This file is now built dynamically when the tester is run.

List all files added and what they do:

 A    models/lnd/clm/bld/query-xFail --- Add a script from Ben Andre to read and report on expected fails.
 A    models/lnd/clm/bld/env_run.xml --- envxml_dir option is now required, so this provides a env_*.xml
            file that can be read by default, when build-namelist is called outside of CESM for testing.
 A    models/lnd/clm/bld/config_files/clm_phys_vers.pm - Enter physics version as a string i.e.: clm4_0
            and then have the ability to interpret it as different types so you can do logical operations
            on physics versions

List all existing files that have been modified, and describe the changes:

  M    models/lnd/clm/tools/shared/mkmapdata/regridbatch.sh ------- Add ability to run on hopper
  M    models/lnd/clm/tools/shared/mkmapdata/mkmapdata.sh --------- Add ability to run on hopper/edison
            remove jaguarpf, and upgrade to ESMF6.3.0
  M    models/lnd/clm/tools/shared/ncl_scripts/getregional_datasets.ncl - New version of NCL requires
            load before "begin" statement

  M    models/lnd/clm/bld/configure ------------- Allow phys=clm5_0 and add in new clm_phys_vers object
  M    models/lnd/clm/bld/README ---------------- Update info on files
  M    models/lnd/clm/bld/CLMBuildNamelist.pm --- Put list of required options at top of help, and make envxml_dir
           a required option. Add in use of clm_phys_vers object. Make sure use_ed_spitfire is only on if use_ed is
           on.  If CLM_UPDATE_GLC_AREAS=TRUE and phys=clm4_0 trigger an error
  M    models/lnd/clm/bld/config_files/config_definition_clm4_5.xml - Add all three physics version options
  M    models/lnd/clm/bld/config_files/config_definition_clm4_0.xml - Add info. about clm4_5/clm5_0 options

  M    models/lnd/clm/bld/unit_testers/build-namelist_test.pl - Add use of clm_phys_vers, and create env_run.xml
            on the fly. Also add new tests for glacier update areas, and ED: usespitfireButNOTED, useEDclm40, useEDContradict2
            useEDContradict, clm40andUpdateGlc, clm40andUpdateGlc, UpdateGlcContradict, UpdateGlcNoGLCMe, and tests
            for clm5_0

  M    models/lnd/clm/bld/test_build_namelist/t/test_vichydro.pm ----- Needs to use clm_phys_vers object
  M    models/lnd/clm/bld/test_build_namelist/test_build_namelist.pl - Needs to use clm_phys_vers object

  M    models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_5.xml - urban_hac depends on clm4_5/clm5_0
  
-------------- Add phys=clm5_0 for all use-cases that test on phys
  M    models/lnd/clm/bld/namelist_files/use_cases/2000_control.xml
  M    models/lnd/clm/bld/namelist_files/use_cases/20thC_glacierMEC_transient.xml
  M    models/lnd/clm/bld/namelist_files/use_cases/2000-2100_rcp8.5_transient.xml
  M    models/lnd/clm/bld/namelist_files/use_cases/2000_glacierMEC_control.xml
  M    models/lnd/clm/bld/namelist_files/use_cases/1850_control.xml
  M    models/lnd/clm/bld/namelist_files/use_cases/1850-2100_rcp2.6_transient.xml
  M    models/lnd/clm/bld/namelist_files/use_cases/1850-2100_rcp6_transient.xml
  M    models/lnd/clm/bld/namelist_files/use_cases/1850-2100_rcp4.5_transient.xml
  M    models/lnd/clm/bld/namelist_files/use_cases/1850-2100_rcp8.5_transient.xml
  M    models/lnd/clm/bld/namelist_files/use_cases/20thC_transient.xml
  M    models/lnd/clm/bld/namelist_files/use_cases/1850_glacierMEC_control.xml
  M    models/lnd/clm/bld/namelist_files/use_cases/1850-2100_rcp2.6_glacierMEC_transient.xml
  M    models/lnd/clm/bld/namelist_files/use_cases/1850-2100_rcp6_glacierMEC_transient.xml
  M    models/lnd/clm/bld/namelist_files/use_cases/1850-2100_rcp4.5_glacierMEC_transient.xml
  M    models/lnd/clm/bld/namelist_files/use_cases/1850-2100_rcp8.5_glacierMEC_transient.xml

------------- Fix bugs 1883 (rs over lake) and 1983 (CAM internal compiler error) and 1965 
-------------  (janus internal compiler error)
  M    models/lnd/clm/src/clm4_5/biogeochem/DryDepVelocity.F90 ----- Set rs over lake
  M    models/lnd/clm/src/clm4_5/main/clm_initializeMod.F90 -------- Add use only for ncd_pio
  M    models/lnd/clm/src/clm4_5/main/restFileMod.F90 -------------- Add use only for ncd_pio
  M    models/lnd/clm/src/clm4_5/main/surfrdMod.F90 ---------------- Add use only for ncd_pio
  M    models/lnd/clm/src/clm4_5/biogeophys/UrbanInputMod.F90 ------ Add use only for ncd_pio
  M    models/lnd/clm/src/clm4_5/biogeophys/BiogeophysRestMod.F90 -- Add use only for ncd_pio
  M    models/lnd/clm/src/clm4_5/dyn_subgrid/dynHarvestMod.F90 ----- Add use only for clmtype and dynVarTimeUninterpMod
           fixes internal compiler error on janus (1965)
  M    models/lnd/clm/src/clm4_0/biogeochem/DryDepVelocity.F90 ----- Set rs over lake
  M    models/lnd/clm/src/clm4_0/main/clm_initializeMod.F90 -------- Add use only for ncd_pio
  M    models/lnd/clm/src/clm4_0/main/subgridRestMod.F90 ----------- Add use only for ncd_pio
  M    models/lnd/clm/src/clm4_0/main/pftdynMod.F90 ---------------- Add use only for ncd_pio
  M    models/lnd/clm/src/clm4_0/main/iniTimeConst.F90 ------------- Add use only for ncd_pio
  M    models/lnd/clm/src/clm4_0/main/restFileMod.F90 -------------- Add use only for ncd_pio
  M    models/lnd/clm/src/clm4_0/main/surfrdMod.F90 ---------------- Add use only for ncd_pio
  M    models/lnd/clm/src/clm4_0/biogeophys/UrbanInputMod.F90 ------ Add use only for ncd_pio
  M    models/lnd/clm/src/clm4_0/biogeophys/BiogeophysRestMod.F90 -- Add use only for ncd_pio

CLM testing:

    a) regular
    b) build_namelist
    c) tools

  build-namelist tests:

    yellowstone    yes

  regular tests (aux_clm40, aux_clm45, with '-model_gen_comp clm2'):

    yellowstone_intel yes
    yellowstone_pgi   yes
    goldbach_nag      yes
    goldbach_intel    yes
    goldbach_pgi      yes

  tools testing:

    yellowstone interactive   yes

CLM tag used for the baseline comparisons:  clm4_5_72

Changes answers relative to baseline: No (bit-for-bit)

===============================================================
===============================================================
Tag name:  clm4_5_72
Originator(s):  muszala (Stefan Muszala)
Date: Mon May  5 17:47:52 MDT 2014
One-line Summary: Introduce code for Ecosystem Demography (CLM(ED)) Model

Purpose of changes: Introduce code for Ecosystem Demography (CLM(ED)) Model - first functional tag.

A large chunk of this code was written and re-written by Rosie Fisher.

"Introduce code for Ecosystem Demography (CLM(ED)) Model.  Adds capability to allow plant functional
types to compete for light, to represent recovery from disturbance, and to allow disturbances
(i.e. fire) to only afflict some fraction of the canopy, and to represent vegetation at the scale
of cohorts of trees. Note that this is a large change and includes:

1. Significant alterations to canopy albedo and surface radiation calculations
2. New photosynthesis scheme, based on existing science but to allow for more complex canopy structure
3. Introduction of a new allocation and growth scheme, (no consistent with that in CLM(CN)
4. Removal, for now, of Nitrogen limitation capabilities
5. Introduction of the SPITFIRE fire model, which interacts with ED via it's representation of
   size-structured mortality and removal of litter pools. 
6. Introduction of a simple seed bank model to allow persistence of vegetation through fire events.
7. For ED compsets there exists a cohort dimension on the restart files.

Cold starts and restarts work for the following.  The 1x1_brazil is the most heavily tested case both from 
science and SE standpoint:

1x1_brazil.ICLM45CNED.yellowstone_[intel | pgi]
5x5_amazon.ICLM45CNED.yellowstone_[intel | pgi]
1x1_brazil.ICLM45CNED.goldbach_[nag | intel | pgi ]
5x5_amazon.ICLM45CNED.goldbach_[nag | intel | pgi ]

Cold starts work for:

f10_f10.ICLM45CNED.yellowstone_[intel | pgi].
f19_g16.ICLM45CNED.yellowstone_[intel | pgi]

Code Origins:

The ED code in CLM is originally based on code by Moorcroft (www.oeb.harvard.edu/faculty/moorcroft/code_and_data/index.html)
and has been heavily modified in regards to both scientific implementation and assumptions.  Fom a software engineering
perspective, ED was rewritten from C into F2003 and the structure of the code has been significantly altered to fit into
the CESM/CLM framework.

The SPITFIRE code is based on (http://www.biogeosciences.net/7/1991/2010/bg-7-1991-2010.pdf) and has been significantly 
altered and extended to fit into the CESM/CLM framework.

Other points:
   1. removed many unused variables and module uses as reported by nag
	2. changing text wrapping on comments so they end at 139 characters
   3. changed many text based logical operators (.ne., .lt., .ge.) with their math. equivlanet (/=, > , <=)

Requirements for tag: N/A

Test level of tag: regular

Bugs fixed (include bugzilla ID): N/A

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system:  ED functionality brought in.  Does not change existing
configurations.  For ED, there are now a CNED and BGCED compset.  Use CNED until BGC issues are worked
out.

Describe any changes made to the namelist: ED functionality brought in.  Does not change existing
configurations.  For ED compsets, there are two new namelist variables.  They are:

use_ed = .true.
use_ed_spit_fire = .true.

use_ed_spit_fire is set to true by default if use_ed is on.  Unless you are running our ED tests, you will
have to change your user_nl_clm to something like:

paramfile ='/glade/p/cesmdata/cseg/inputdata/lnd/clm2/edParams/CLMPARAMS_ED_011514.nc'
finidat = ''
hist_mfilt             = 365
hist_nhtfrq            = -24

hist_empty_htapes = .true.

hist_fincl1='NPP','GPP','BTRAN','TOTVEGC','H2OSOI','TLAI','LITTER_IN','LITTER_OUT',
'STORVEGC','FIRE_AREA','SCORCH_HEIGHT','FIRE_INTENSITY','FIRE_TFC_ROS','fire_fuel_mef',
'LITTERC','fire_fuel_bulkd','fire_fuel_sav','FIRE_NESTEROV_INDEX','PFTbiomass',
'PFTleafbiomass','FIRE_ROS','WIND','TFC_ROS','DISPVEGC','AREA_TREES','AREA_PLANT' 

If on goldbach, use:

paramfile ='/fs/cgd/csm/inputdata/lnd/clm2/edParams/CLMPARAMS_ED_011514.nc'

List any changes to the defaults for the boundary datasets: N/A.  

Describe any substantial timing or memory changes:

Code reviewed by: Stefan Muszala and Rosie Fisher. Detailed code review by Bill Sacks, Mariana Vertenstein,
Ben Andre, and Erik Kluzek. Discussion of code review included Dave Lawrence, Forrest Hoffmann
and Ryan Knox.

List any svn externals directories updated (csm_share, mct, etc.): 

Changed externals to a branch_tag that supports ED compsets.  We are using branch_tags because trunk
scripts does not work with all of the current CLM tests:

-scripts https://svn-ccsm-models.cgd.ucar.edu/scripts/branch_tags/add_dynlu_tests_tags/add_dynlu_tests_n03_scripts4_140305
+scripts https://svn-ccsm-models.cgd.ucar.edu/scripts/branch_tags/ED_scripts_tags/ED_scripts_015_140305_rev

List all files eliminated: N/A

List all files added and what they do:

### SPITFIRE code
# new SPITEFIRE directory
A  +    models/lnd/clm/src/clm4_5/main/spitfireSF
# main SPITFIRE code
A  +    models/lnd/clm/src/clm4_5/main/spitfireSF/SFParamsMod.F90
# handle SPITFIRE parameters
A  +    models/lnd/clm/src/clm4_5/main/spitfireSF/SFMainMod.F90

# pull out, move to a shared location, place in own module
A  +    models/lnd/clm/src/util_share/quadraticMod.F90 

### new source and directories for ED
## ED code required for biogeophysics
# ED directory in biogeophys
A  +    models/lnd/clm/src/clm4_5/biogeophys/ED
# Calculates daily carbon flux drivers from hourly calculations. 
A  +    models/lnd/clm/src/clm4_5/biogeophys/ED/EDAccumulateFluxesMod.F90
# Calculates absorbed, reflected and transmitted radiation in diffuse and direct streams for
# each of the canopy layer x PFT x leaf layer three-dimensional matrix.  Uses iterative Norman
# radiation transfer scheme.
A  +    models/lnd/clm/src/clm4_5/biogeophys/ED/EDSurfaceAlbedoMod.F90
# Main photosynthesis model. Calculates leaf level fluxes on a canopy layer x PFT x leaf layer
# three-dimensional matrix. Sums to canopy to produce overall canopy conductance. Unpacks leaf-
# level fluxes into cohort level fluxes.   Uses same scientific assumptions as CLM4.5. 
A  +    models/lnd/clm/src/clm4_5/biogeophys/ED/EDPhotosynthesisMod.F90
# Generates PFT specific BTRAN vector for each ED patch. Includes option for SPA-like calculations. 
A  +    models/lnd/clm/src/clm4_5/biogeophys/ED/EDBtranMod.F90

## ED code required for biogeochemistry
# ED directory in biogeochem
A  +    models/lnd/clm/src/clm4_5/biogeochem/ED
# Determines which cohorts are in the upper and lower canopy layers. Sets leaf area index inputs to biogeophysics calculations.
A  +    models/lnd/clm/src/clm4_5/biogeochem/ED/EDCanopyStructureMod.F90
# Initializes some ED-specific variables to zero at startup.
A  +    models/lnd/clm/src/clm4_5/biogeochem/ED/EDSetValuesMod.F90
# Contains allometric relationships between vegetation properties (height, dbh, LAI, dead biomass, live biomass, crown area) biogeochem/ED/EDPatchDynamicsMod.F90 : Creates patches, fuses similar patches, controls disturbance and generation of area. 
A  +    models/lnd/clm/src/clm4_5/biogeochem/ED/EDGrowthFunctionsMod.F90
# Creates, fuses, terminates, sorts, counts and copies cohort structures. 
A  +    models/lnd/clm/src/clm4_5/biogeochem/ED/EDCohortDynamicsMod.F90
# Contains all calculations of derivatives of biomass, litter and seed pools.  Also includes phenology model, seed and litter production and decay models, and canopy optimization model. 
A  +    models/lnd/clm/src/clm4_5/biogeochem/ED/EDPhysiologyMod.F90
# Creates, fuses, terminates, sorts, counts and copies patch structures. 
A  +    models/lnd/clm/src/clm4_5/biogeochem/ED/EDPatchDynamicsMod.F90

## ED core functionality and types that interact with CLM (generally not science)
# ED directory in main
A  +    models/lnd/clm/src/clm4_5/main/ED
# Transmits required information for CLM (tlai, htop, tile weights). Updates ED-specific history field variables. 
A  +    models/lnd/clm/src/clm4_5/main/ED/EDCLMLinkMod.F90
#  Initializes ED PFT parameter structure. 
A  +    models/lnd/clm/src/clm4_5/main/ED/EDInitTimeConst.F90
# Contains ED-specific variables for CLM
A  +    models/lnd/clm/src/clm4_5/main/ED/EDClmType.F90
# Adds history field variables specific to ED to history file. 
A  +    models/lnd/clm/src/clm4_5/main/ED/EDHistFldsMod.F90
#  Prints out and reads in ED state vector to/from history files. 
A  +    models/lnd/clm/src/clm4_5/main/ED/EDRestVectorMod.F90
# Initializes ED-specific variables for CLM 
A  +    models/lnd/clm/src/clm4_5/main/ED/EDClmTypeInitMod.F90
# Allocates ED PFT specific variables.
A  +    models/lnd/clm/src/clm4_5/main/ED/EDPftvarcon.F90
# Initializes ED site, patch and cohort structures, either to restarting or bare ground values. 
A  +    models/lnd/clm/src/clm4_5/main/ED/EDInitMod.F90
# Allocates and initializes ED parameters (that are not PFT specific). 
A  +    models/lnd/clm/src/clm4_5/main/ED/EDParamsMod.F90
# Main ED model routine. Calls all other daily ED dynamics, integrates variables, checks carbon balance.
A  +    models/lnd/clm/src/clm4_5/main/ED/EDMainMod.F90
# Contains ED type structures (cohort, site, patch) and static values.
A  +    models/lnd/clm/src/clm4_5/main/ED/EDTypesMod.F90

# utility routine to help in reading parameter files
A  +    models/lnd/clm/src/clm4_5/main/paramUtilMod.F90
# transfers weights calculated internally by ED into wtcol.
A  +    models/lnd/clm/src/clm4_5/dyn_subgrid/dynEDMod.F90

List all existing files that have been modified, and describe the changes:

### build modifications
# add ED source directories for build
M       models/lnd/clm/bld/configure
# build namelist additions for ED
M       models/lnd/clm/bld/namelist_files/namelist_definition_clm4_5.xml
# setup_cmdl_ed_mode addition.  sets namelist vars
M       models/lnd/clm/bld/CLMBuildNamelist.pm

### util_share modifications
# add function is_beg_curr_day()
M       models/lnd/clm/src/util_share/clm_time_manager.F90
# modify get_proc_bounds to include beg, end cohort
M       models/lnd/clm/src/util_share/accumulMod.F90
# change text based logical with math style (.gt. to >, .ne. to /=)
M       models/lnd/clm/src/util_share/ncdio_pio.F90
# change text based logical with math style (.gt. to >, .ne. to /=)
M       models/lnd/clm/src/util_share/ncdio_pio.F90.in

### 4_5 Modifications
# change text based logical with math style (.gt. to >, .ne. to /=)
# modify get_proc_bounds to include beg, end cohort
M       models/lnd/clm/src/clm4_5/biogeochem/CNRestMod.F90
# change text based logical with math style (.gt. to >, .ne. to /=)
M       models/lnd/clm/src/clm4_5/biogeochem/CNNitrifDenitrifMod.F90
# change text based logical with math style (.gt. to >, .ne. to /=)
M       models/lnd/clm/src/clm4_5/biogeochem/CNNStateUpdate1Mod.F90
# add use_ed logical(s)
M       models/lnd/clm/src/clm4_5/biogeochem/CNBalanceCheckMod.F90
# change text based logical with math style (.gt. to >, .ne. to /=)
M       models/lnd/clm/src/clm4_5/biogeochem/CNFireMod.F90
# add use_ed logical(s)
M       models/lnd/clm/src/clm4_5/biogeochem/CNMRespMod.F90
# change text based logical with math style (.gt. to >, .ne. to /=)
M       models/lnd/clm/src/clm4_5/biogeochem/CNVerticalProfileMod.F90
# change text based logical with math style (.gt. to >, .ne. to /=)
M       models/lnd/clm/src/clm4_5/biogeochem/CNPrecisionControlMod.F90
# change text based logical with math style (.gt. to >, .ne. to /=)
M       models/lnd/clm/src/clm4_5/biogeochem/CNSummaryMod.F90
# change text based logical with math style (.gt. to >, .ne. to /=)
M       models/lnd/clm/src/clm4_5/biogeochem/ch4Mod.F90
# change text based logical with math style (.gt. to >, .ne. to /=)
M       models/lnd/clm/src/clm4_5/biogeochem/CNInitMod.F90
# change text based logical with math style (.gt. to >, .ne. to /=)
M       models/lnd/clm/src/clm4_5/biogeochem/CNCStateUpdate1Mod.F90
# change text based logical with math style (.gt. to >, .ne. to /=)
M       models/lnd/clm/src/clm4_5/biogeochem/CNDecompMod.F90
# change text based logical with math style (.gt. to >, .ne. to /=)
M       models/lnd/clm/src/clm4_5/biogeochem/CNAnnualUpdateMod.F90
# change text based logical with math style (.gt. to >, .ne. to /=)
M       models/lnd/clm/src/clm4_5/biogeochem/CNNDynamicsMod.F90
# change text based logical with math style (.gt. to >, .ne. to /=)
M       models/lnd/clm/src/clm4_5/biogeochem/CNAllocationMod.F90
# change text based logical with math style (.gt. to >, .ne. to /=)
M       models/lnd/clm/src/clm4_5/biogeochem/DryDepVelocity.F90
# add use_ed logical(s) 
M       models/lnd/clm/src/clm4_5/biogeochem/CNEcosystemDynMod.F90
# move some variables from stack to heap.  
# change text based logical with math style (.gt. to >, .ne. to /=)
M       models/lnd/clm/src/clm4_5/biogeochem/CNDecompCascadeBGCMod.F90
# add use_ed logical(s)
M       models/lnd/clm/src/clm4_5/biogeochem/CNSetValueMod.F90
# change text based logical with math style (.gt. to >, .ne. to /=)
# change spacing, text wrapping
M       models/lnd/clm/src/clm4_5/biogeochem/CNSoilLittVertTranspMod.F90
# change text based logical with math style (.gt. to >, .ne. to /=)
M       models/lnd/clm/src/clm4_5/biogeochem/CNDecompCascadeCNMod.F90
# change text based logical with math style (.gt. to >, .ne. to /=)
M       models/lnd/clm/src/clm4_5/biogeochem/CNC14DecayMod.F90

# change text based logical with math style (.gt. to >, .ne. to /=)
M       models/lnd/clm/src/clm4_5/main/initInterp.F90
# change spacing, text wrapping
M       models/lnd/clm/src/clm4_5/main/clm_varpar.F90
# add call to call EDInitTimeConst 
# change text based logical with math style (.gt. to >, .ne. to /=)
M       models/lnd/clm/src/clm4_5/main/initTimeConstMod.F90
# add decomposition for cohort dimension
M       models/lnd/clm/src/clm4_5/main/decompInitMod.F90
# add call for ed_init
M       models/lnd/clm/src/clm4_5/main/clm_initializeMod.F90
# add use_ed logical(s)
M       models/lnd/clm/src/clm4_5/main/subgridRestMod.F90
# add code for cohort dimension
M       models/lnd/clm/src/clm4_5/main/subgridMod.F90
# add use_ed logical(s)
M       models/lnd/clm/src/clm4_5/main/accFldsMod.F90
# add use_ed logical(s)
M       models/lnd/clm/src/clm4_5/main/clmtypeInitMod.F90
# change text based logical with math style (.gt. to >, .ne. to /=)
M       models/lnd/clm/src/clm4_5/main/initColdMod.F90
# change get_proc_global to support cohort dimension
M       models/lnd/clm/src/clm4_5/main/histFileMod.F90
# add use_ed logical to support cohort dimension
M       models/lnd/clm/src/clm4_5/main/restFileMod.F90
# broadcast ed namelist variables
M       models/lnd/clm/src/clm4_5/main/controlMod.F90
# use_ed logical to call edmodel
M       models/lnd/clm/src/clm4_5/main/clm_driver.F90
# change spacing, text wrapping
M       models/lnd/clm/src/clm4_5/main/clm_varctl.F90
# clean up unsued variables from nag compiler warnings
M       models/lnd/clm/src/clm4_5/main/subgridAveMod.F90
# add routine set_cohort_decomp
# add use_ed logical(s)
M       models/lnd/clm/src/clm4_5/main/initGridCellsMod.F90
# change text based logical with math style (.gt. to >, .ne. to /=)
M       models/lnd/clm/src/clm4_5/main/initSoilParVICMod.F90
# change spacing, text wrapping
# add use_ed logical(s)
M       models/lnd/clm/src/clm4_5/main/pftvarcon.F90
# add support for cohort dimension
M       models/lnd/clm/src/clm4_5/main/decompMod.F90
# change spacing, text wrapping
M       models/lnd/clm/src/clm4_5/main/clmtype.F90
# add call to read ED and SPITFIRE params
R  +    models/lnd/clm/src/clm4_5/main/readParamsMod.F90
# add routine set_cohort_decomp
# add use_ed logical(s)
M       models/lnd/clm/src/clm4_5/main/histFldsMod.F90

# change text based logical with math style (.gt. to >, .ne. to /=)
M       models/lnd/clm/src/clm4_5/biogeophys/SLakeInitMod.F90
# change text based logical with math style (.gt. to >, .ne. to /=)
M       models/lnd/clm/src/clm4_5/biogeophys/BalanceCheckMod.F90
# change text based logical with math style (.gt. to >, .ne. to /=)
M       models/lnd/clm/src/clm4_5/biogeophys/UrbanInputMod.F90
# change text based logical with math style (.gt. to >, .ne. to /=)
M       models/lnd/clm/src/clm4_5/biogeophys/Biogeophysics1Mod.F90
# change text based logical with math style (.gt. to >, .ne. to /=)
M       models/lnd/clm/src/clm4_5/biogeophys/FrictionVelocityMod.F90
# change text based logical with math style (.gt. to >, .ne. to /=)
M       models/lnd/clm/src/clm4_5/biogeophys/Hydrology1Mod.F90
# change get_proc_global to support cohort dimension
M       models/lnd/clm/src/clm4_5/biogeophys/BiogeophysRestMod.F90
# change get_proc_global to support cohort dimension
M       models/lnd/clm/src/clm4_5/biogeophys/UrbanMod.F90
# change get_proc_global to support cohort dimension
M       models/lnd/clm/src/clm4_5/biogeophys/ActiveLayerMod.F90
# change get_proc_global to support cohort dimension
M       models/lnd/clm/src/clm4_5/biogeophys/BareGroundFluxesMod.F90
# change spacing, text wrapping
# add use_ed logical(s)
# calculate ed root fractionation
M       models/lnd/clm/src/clm4_5/biogeophys/CanopyFluxesMod.F90
# add use_ed logical(s) for forc_solai and parsun
# use_ed  reporting
M       models/lnd/clm/src/clm4_5/biogeophys/SurfaceRadiationMod.F90
# add use_ed logical(s) for norman_radiation
# change spacing
M       models/lnd/clm/src/clm4_5/biogeophys/SurfaceAlbedoMod.F90
# remove unused variable
M       models/lnd/clm/src/clm4_5/biogeophys/SLakeCon.F90
# change text based logical with math style (.gt. to >, .ne. to /=)
M       models/lnd/clm/src/clm4_5/biogeophys/Hydrology2Mod.F90
# change text based logical with math style (.gt. to >, .ne. to /=)
M       models/lnd/clm/src/clm4_5/biogeophys/SoilHydrologyMod.F90
# add use_ed logical(s) for call dyn_ED
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynSubgridDriverMod.F90

### 4_0 Modifications
# add optional cohort argument for new ED dimension to get_proc_global and
# get_proc_bounds_old for 40 backward compatibility
M       models/lnd/clm/src/clm4_0/main/decompMod.F90

CLM testing:

--SNICARFRC - moved ERI_D.T31_g37.ICLM45.goldbach_nag.clm-SNICARFRC to goldbach and nag.  This is a BFAIL.

--Testing for new ED compsets.  All compare hist portions were BFAIL's since this is the first time
the tests are being put in place.

--ED and yellowstone [ intel | pgi ]
  PASS  ERS_D_Mmpi-serial.1x1_brazil.ICLM45CNED.yellowstone_[intel | pgi].clm-edTest 
  PASS  SMS.f10_f10.ICLM45CNED.yellowstone_[intel | pgi].clm-edTest
  PASS  SMS.f19_g16.ICLM45CNED.yellowstone_[intel | pgi].clm-edTest
  PASS  SMS_D_Mmpi-serial.5x5_amazon.ICLM45CNED.yellowstone_[intel | pgi].clm-edTest

--ED and goldbach [nag | intel | pgi ]
  PASS  ERS_D_Mmpi-serial.1x1_brazil.ICLM45CNED.goldbach_[nag | intel | pgi ].clm-edTestGb
  PASS  SMS_D_Mmpi-serial.5x5_amazon.ICLM45CNED.goldbach_[nag | intel | pgi ].clm-edTestGb

--CLM history file comparison:

yellowstone [intel | pgi] - OK

I ran without the -model_gen_comp option, but ran component_gen_comp and summarize_cprnc_diffs
by hand for both yellowstone_intel and yellowstone_pgi.  These are both OK

--Regular tests (aux_clm testlist)

    yellowstone_intel - OK
    yellowstone_pgi   - OK
    goldbach_nag      - OK
    goldbach_intel    - OK
    goldbach_pgi      - OK

CLM tag used for the baseline comparisons:  clm4_5_71

Changes answers relative to baseline: No.  Existing compsets do not change.
If you run with an *ED* compset, then results will differ, but that is expected.

===============================================================
===============================================================
Tag name:  clm4_5_71
Originator(s):  Bill Sacks & Jeremy Fyke
Date: Fri May  2 13:00:10 MDT 2014
One-line Summary: 2-way feedbacks for glacier, veg columns compute glacier SMB, and related changes

Purpose of changes:

  (1) Bring in two-way feedbacks for glacier when coupled to CISM, via dynamic
      landunits, so that CLM's glacier area remains consistent with CISM's
      glacier area. Also update CLM's glacier topography to be consistent with
      CISM. 

  (2) Add an elevation class "0", which provides surface mass balance over the
      vegetated portion of the grid cell. This is used to achieve glacial
      inception in CISM. Along with this change, also (a) set the topographic
      height of non-glacier areas based on bare land topography from CISM, and
      (b) change the downscaling of atmospheric fields so that they are also
      downscaled over vegetated columns within CISM's ice mask, to achieve
      greater consistency between what's happening in the glacier and vegetated
      portions of CISM's domain. (Note that, because longwave radiation is
      normalized, downscaling it over the vegetated column also changes answers
      over glacier columns.) These changes were primarily from Jeremy Fyke.

  (3) Rework some consistency checks to play nicely with dynamic landunits.

  (4) Rework unit test build to use libraries for the clm source and csm_share source

  (5) Misc. other changes, as noted below.

Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID):
  - 1969 (incorrect values for QSNWCPICE_NODYNLNDUSE)
  - 1929 (dynFileMod breaks with gfortran 4.8)
  - 1832 (logic for weights error check differs between clm4.0 and clm4.5)

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system:

Describe any changes made to the namelist:

List any changes to the defaults for the boundary datasets:

Describe any substantial timing or memory changes:

Code reviewed by:

List any svn externals directories updated (csm_share, mct, etc.):

========= Add tests
-scripts                         https://svn-ccsm-models.cgd.ucar.edu/scripts/trunk_tags/scripts4_140305
+scripts                         https://svn-ccsm-models.cgd.ucar.edu/scripts/branch_tags/add_dynlu_tests_tags/add_dynlu_tests_n03_scripts4_140305

========= Pull in Machines_140318, needed for goldbach
-scripts/ccsm_utils/Machines     https://svn-ccsm-models.cgd.ucar.edu/Machines/branch_tags/arfs_tags/arfs_01_mach140218
+scripts/ccsm_utils/Machines     https://svn-ccsm-models.cgd.ucar.edu/Machines/branch_tags/arfs_tags/arfs_02_mach140218

========= Changes needed for elevation class 0, etc.
-models/drv                      https://svn-ccsm-models.cgd.ucar.edu/drv/seq_mct/trunk_tags/drvseq5_0_07
+models/drv                      https://svn-ccsm-models.cgd.ucar.edu/drv/seq_mct/trunk_tags/drvseq5_0_10
-models/glc/cism                 https://svn-ccsm-models.cgd.ucar.edu/glc/trunk_tags/cism1_140416
+models/glc/cism                 https://svn-ccsm-models.cgd.ucar.edu/glc/trunk_tags/cism1_140501


List all files eliminated:

========= Point to real decompMod rather than mock
D       models/lnd/clm/test/unit_testers/clm4_5/mock/main/decompMod_boundsTypeDecl.F90

List all files added and what they do:

========= Most of reweightMod.F90 moved here; also includes the following changes:
            (1) renames some subroutines
            (2) adds some diagnostic fields that are written to the history file
            (3) adds some utility routines such as get_landunit_weight
A       models/lnd/clm/src/clm4_5/main/subgridWeightsMod.F90

========= Add code to initialize newly-active columns
A       models/lnd/clm/src/clm4_5/dyn_subgrid/dynInitColumnsMod.F90

========= New unit tests
A       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/dynInitColumns_test/test_init_columns.pf
A       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/dynInitColumns_test/CMakeLists.txt
A       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/dynInitColumns_test

========= Need new mocks and new real files now that we use the real decompMod, and also because of endrun calls
A       models/lnd/clm/test/unit_testers/clm4_5/mock/util_share/GetGlobalValuesMod_mock.F90
A       models/lnd/clm/test/unit_testers/clm4_5/mock/csm_share/mct_mod_mock.F90
A       models/lnd/clm/src/util_share/CMakeLists.txt

========= Need stub histFileMod now that many modules include calls to hist_addfld
A       models/lnd/clm/test/unit_testers/clm4_5/mock/main/CMakeLists.txt
A       models/lnd/clm/test/unit_testers/clm4_5/mock/main/histFileMod_mock.F90

List all existing files that have been modified, and describe the changes:

========= Update glacier cover and topographic heights based on values from CISM; rework
          code to accommodate icemask and elevation class 0
M       models/lnd/clm/src/clm4_5/main/clm_glclnd.F90
M       models/lnd/clm/src/cpl/clm_cpl_indices.F90
M       models/lnd/clm/src/cpl/lnd_import_export.F90

========= Change to be consistent with clm4_5 version, adding elevation class 0 and
          x2s%icemask (neither of which are used in the clm4_0 version)
M       models/lnd/clm/src/clm4_0/main/clm_glclnd.F90

========= Add glc_do_dynglacier namelist option, which triggers off of
          CLM_UPDATE_GLC_AREAS; rename glc_dyntopo to glc_dyn_runoff_routing and make it
          also trigger off of CLM_UPDATE_GLC_AREAS; add glc_snow_persistence_max_days; add
          dynpft_consistency_checks and finidat_consistency_checks groups
M       models/lnd/clm/bld/user_nl_clm
M       models/lnd/clm/bld/CLMBuildNamelist.pm
M       models/lnd/clm/bld/namelist_files/namelist_definition_clm4_5.xml
M       models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_5.xml
M       models/lnd/clm/bld/unit_testers/build-namelist_test.pl
M       models/lnd/clm/bld/unit_testers/env_run.xml
M       models/lnd/clm/src/clm4_5/main/controlMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_varctl.F90
          - also use parameter for file name length, so that other modules can
            ensure consistency of char length

========= Add functions to convert between col%itype and icemec class; also add
          landunit_names vector
M       models/lnd/clm/src/clm4_5/main/clm_varcon.F90

========= Add functions add_landunit, add_column, add_patch (cleans up this code, and will
          assist with setting up unit tests) and use new functions from clm_varcon
M       models/lnd/clm/src/clm4_5/main/initGridCellsMod.F90

========= Use new functions from initGridCellsMod
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynLandunitAreaMod.F90

========= Remove old consistency checks for restart file, add new ones (these changes are
          needed so that consistency checks work right with dynamic landunits, and we're
          adding some new consistency checks that weren't in place before)
M       models/lnd/clm/src/util_share/clm_time_manager.F90
M       models/lnd/clm/src/util_share/ncdio_pio.F90
M       models/lnd/clm/src/util_share/ncdio_pio.F90.in
M       models/lnd/clm/src/clm4_5/main/restFileMod.F90
M       models/lnd/clm/src/clm4_5/main/subgridRestMod.F90
          - also read all subgrid weights and glc topo on restart
            (some of these used to be read in BiogeophysRestMod;
            we need all of them with dynamic landunits)
          - also remove redundant mcdate, mcsec
          - also add icemask restart variable
M       models/lnd/clm/src/clm4_5/biogeophys/BiogeophysRestMod.F90
          - also remove redundant PFT_WTGCELL, PFT_WTLUNIT, PFT_WTCOL
            (equivalent variables are already output by subgridRestMod)
          - also add snow_persistence

========= Remove old consistency checks for pftdyn file, add new ones
          (these changes are needed so that consistency checks work right with dynamic landunits)
M       models/lnd/clm/src/clm4_5/main/clm_initializeMod.F90
          - also call init_subgrid_weights_mod, put call to update_clm_s2x in
            loop over clumps, and move deallocation of topo_glc_mec to later
M       models/lnd/clm/src/clm4_5/main/clm_varsur.F90
M       models/lnd/clm/src/clm4_5/main/surfrdMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynpftFileMod.F90

========= Add new dimensions for multi-level fields - for subgrid weight diagnostics; add
          a dimension to accommodate fields dimensioned by glc_nec+1
M       models/lnd/clm/src/clm4_5/main/histFileMod.F90

========= Call new routines (update_clm_x2s, set_subgrid_diagnostic_fields, initialize_new_columns)
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynSubgridDriverMod.F90

========= Make various code operate over veg as well as icemec columns
M       models/lnd/clm/src/clm4_5/main/filterMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_atmlnd.F90
M       models/lnd/clm/src/clm4_5/main/clm_driver.F90
          - also put call to update_clm_s2x in a loop over clumps
M       models/lnd/clm/src/clm4_5/biogeophys/BalanceCheckMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SoilTemperatureMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/clm_driverInitMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/Hydrology2Mod.F90
          - also compute snow_persistence, and rework some code for clarity

========= Add initialization of icemask & snow_persistence; change
          initialization of glc_topo and h2osno
M       models/lnd/clm/src/clm4_5/main/initColdMod.F90

========= Add l2g_scale_type = natveg
M       models/lnd/clm/src/clm4_5/main/subgridAveMod.F90

========= Fix QSNWCPICE_NODYNLNDUSE, add l2g_scale_type for QICE & related fields, add
          SNOW_PERSISTENCE and ICE_MASK, change _FORC fields to include elevation class 0
M       models/lnd/clm/src/clm4_5/main/histFldsMod.F90

========= Get rid of associate statement that caused problems with some compilers
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynFileMod.F90

========= Track old col%active values, needed for initializing new columns
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynPriorWeightsMod.F90

========= Moved most functionality to subgridWeightsMod.F90 (now just a small
          wrapper to some of the stuff in subgridWeightsMod, whose main purpose
          is to avoid a dependency of subgridWeightsMod on filterMod)
M       models/lnd/clm/src/clm4_5/main/reweightMod.F90

========= Changes for unit tests:
            (1) Update unit tests to use libraries for the clm source and csm_share source
            (2) New unit test
            (3) Make unit tests work with latest CLM trunk
            (4) Point to real decompMod rather than mock
M       models/lnd/clm/test/unit_testers/clm4_5/biogeophys/Daylength_test/CMakeLists.txt
M       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/dynLandunitArea_test/CMakeLists.txt
M       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/dynVar_test/CMakeLists.txt
M       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/dynTimeInfo_test/CMakeLists.txt
M       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/CMakeLists.txt
M       models/lnd/clm/test/unit_testers/clm4_5/mock/util_share/ncdio_var.F90
M       models/lnd/clm/test/unit_testers/clm4_5/mock/util_share/ncdio_var.F90.in
M       models/lnd/clm/test/unit_testers/clm4_5/mock/util_share/spmdMod_mock.F90
M       models/lnd/clm/test/unit_testers/clm4_5/mock/util_share/CMakeLists.txt
M       models/lnd/clm/test/unit_testers/clm4_5/mock/csm_share/shr_sys_mod_mock.F90
M       models/lnd/clm/test/unit_testers/clm4_5/mock/csm_share/CMakeLists.txt
M       models/lnd/clm/test/unit_testers/clm4_5/mock/main/CMakeLists.txt
M       models/lnd/clm/test/unit_testers/clm4_5/mock/CMakeLists.txt
M       models/lnd/clm/test/unit_testers/clm4_5/CMakeLists.txt
M       models/lnd/clm/src/clm4_5/main/CMakeLists.txt
M       models/lnd/clm/src/clm4_5/dyn_subgrid/CMakeLists.txt

========= Add icemask & snow_persistence; remove unused glc_frac, glc_rofi & glc_rofl
M       models/lnd/clm/src/clm4_5/main/clmtype.F90
M       models/lnd/clm/src/clm4_5/main/clmtypeInitMod.F90

========= Minor changes to 'use' statements for the sake of breaking dependencies for unit tests
M       models/lnd/clm/src/util_share/GetGlobalValuesMod.F90
M       models/lnd/clm/src/clm4_5/main/decompMod.F90

========= Changes to comments only
M       models/lnd/clm/src/clm4_5/biogeochem/CNGapMortalityMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNFireMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNVerticalProfileMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNCIsoFluxMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/ch4Mod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNPhenologyMod.F90
M       models/lnd/clm/src/clm4_5/main/filterMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/Biogeophysics1Mod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/Biogeophysics2Mod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SoilHydrologyMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynHarvestMod.F90
M       models/lnd/clm/src/util_share/domainMod.F90

========= Remove no-longer-failing test, change failType of a test (it was RUN
          rather than FAIL at least as far back as clm4_5_69)
M       models/lnd/clm/bld/unit_testers/xFail/expectedClmTestFails.xml


CLM testing:

  build-namelist tests:

    yellowstone: ok

  regular tests

    NOTE: Most tests were done on bare_land_smb_n15_clm4_5_70, which did NOT
    include r59820 (add a comma in histFileMod to fix a syntax error caught by
    nag). After r59820, reran all goldbach_nag tests, plus one goldbach_pgi and
    one goldbach_intel.

    yellowstone_intel: ok
    yellowstone_pgi: ok
    goldbach_nag: ok
    goldbach_intel: ok
    goldbach_pgi: ok

  component_gen_comp on yellowstone_intel & yellowstone_pgi: ok

CLM tag used for the baseline comparisons: clm4_5_69 (clm4_5_68 for a few tests
   with missing baselines in clm4_5_69)

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: All IG compsets (i.e., GLC compsets)
    - what platforms/compilers: All
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
         New Climate

   Changes are:

     (1) All IG compsets (clm4.0 & clm4.5) change due to new CISM external

     (2) In addition, IG compsets with CLM4.5 change further due to:
         (a) 2-way feedbacks (CLM updated to match CISM)
         (b) downscaling done over vegetated landunits within the icemask

     (3) Also, the QSNWCPICE_NODYNLNDUSE history diagnostic field changes for
         ALL CLM4.5 runs, due to fixing bug 1969.

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	
===============================================================
===============================================================
Tag name:  clm4_5_70
Originator(s):  muszala (Stefan Muszala)
Date:  Fri Apr 18 08:24:44 MDT 2014
One-line Summary: bring in SHR_ASSERT macros

Purpose of changes: bring in SHR_ASSERT macros for Santos.

Add: #include "shr_assert.h" to source files
Remove: use shr_assert_mod    , only : shr_assert

then replace "call shr_assert" with SHR_ASSERT_ALL when asserting more than one dim

-    call shr_assert((ubound(carr) == (/bounds%endc/)), errMsg(__FILE__, __LINE__))
+    SHR_ASSERT_ALL((ubound(parr) == (/bounds%endp/)), errMsg(__FILE__, __LINE__))

and use SHR_ASSERT when asserting one dimen

-    call shr_assert(bounds%level == BOUNDS_LEVEL_CLUMP, errMsg(__FILE__, __LINE__))
+    SHR_ASSERT(bounds%level == BOUNDS_LEVEL_CLUMP, errMsg(__FILE__, __LINE__))

Requirements for tag: N/A

Test level of tag: regular

Bugs fixed (include bugzilla ID): N/A

Known bugs (include bugzilla ID): N/A
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: N/A

Describe any changes made to the namelist: N/A

List any changes to the defaults for the boundary datasets: N/A

Describe any substantial timing or memory changes: N/A

Code reviewed by: Self, Santos, Sacks

List any svn externals directories updated (csm_share, mct, etc.):

-scripts/ccsm_utils/Machines     https://svn-ccsm-models.cgd.ucar.edu/Machines/trunk_tags/Machines_140218
+scripts/ccsm_utils/Machines     https://svn-ccsm-models.cgd.ucar.edu/Machines/branch_tags/arfs_tags/arfs_01_mach140218

-scripts/ccsm_utils/CMake        https://github.com/quantheory/CMake_Fortran_utils/tags/CMake_Fortran_utils_140109
+scripts/ccsm_utils/CMake        https://github.com/quantheory/CMake_Fortran_utils/tags/CMake_Fortran_utils_140403

-models/rof/rtm                  https://svn-ccsm-models.cgd.ucar.edu/rivrtm/trunk_tags/rtm1_0_34
+models/rof/rtm                  https://svn-ccsm-models.cgd.ucar.edu/rivrtm/trunk_tags/rtm1_0_37

-models/glc/cism                 https://svn-ccsm-models.cgd.ucar.edu/glc/trunk_tags/cism1_140303
+models/glc/cism                 https://svn-ccsm-models.cgd.ucar.edu/glc/trunk_tags/cism1_140416

-models/csm_share                https://svn-ccsm-models.cgd.ucar.edu/csm_share/trunk_tags/share3_131231
+models/csm_share                https://svn-ccsm-models.cgd.ucar.edu/csm_share/branch_tags/shr_assert_macro_tags/shr_assert_macro_n04_share3_140115

-models/utils/mct                https://github.com/quantheory/MCT/tags/compiler_fixes_n03_MCT_2.8.3
+models/utils/mct                https://github.com/quantheory/MCT/tags/compiler_fixes_n04_MCT_2.8.3

-models/utils/pio                http://parallelio.googlecode.com/svn/trunk_tags/pio1_8_9/pio
+models/utils/pio                http://parallelio.googlecode.com/svn/trunk_tags/pio1_8_11/pio

List all files eliminated: N/A

List all files added and what they do:  N/A

List all existing files that have been modified, and describe the changes:

M       models/lnd/clm/src/clm4_5/biogeochem/ch4Mod.F90
M       models/lnd/clm/src/clm4_5/main/clm_atmlnd.F90
M       models/lnd/clm/src/clm4_5/main/filterMod.F90
M       models/lnd/clm/src/clm4_5/main/subgridAveMod.F90
M       models/lnd/clm/src/clm4_5/main/histFileMod.F90
M       models/lnd/clm/src/clm4_5/main/initGridCellsMod.F90
M       models/lnd/clm/src/clm4_5/main/reweightMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/TridiagonalMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SurfaceAlbedoMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/DaylengthMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SoilTemperatureMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/FrictionVelocityMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/UrbanMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SLakeTemperatureMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SNICARMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/CanopyFluxesMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/H2OSfcMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/BandDiagonalMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynLandunitAreaMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynTimeInfoMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynSubgridDriverMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynVarMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynVarTimeUninterpMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynVarMod.F90.in
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynVarTimeInterpMod.F90.in
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynVarTimeUninterpMod.F90.in
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynHarvestMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynPriorWeightsMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynVarTimeInterpMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynpftFileMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynConsBiogeophysMod.F90

M       SVN_EXTERNAL_DIRECTORIES

CLM testing:

Tested with two sets of externals because:

The old scripts do not allow any PGI tests to run while the new scripts have various issues
with ERI tests and selected PGI tests plus nag debug runs (fixed in a more recent machines tag).

By running with two sets of externals, I am confident that the source mods for SHR_ASSERT are
working correctly.  When CLM gets updates in scripts and machines, these will be updated in 
later tags.

I) Those included in this tag
II) Those that are a part of cesm1_3_alpha09b (only tested clm45).

  build-namelist tests: N/A

  regular tests: for (I) above:

    yellowstone_intel - OK - component_comp_gen - OK
    goldbach_nag      - OK
    goldbach_intel    - OK

  regular tests: for (II) above:

1) Yellowstone + Intel :  all ERI tests are completing ref1 and ref2 but die a silent death in the base case.  Erik looks like you changed Testlists, so the two VIC tests might be expected.

>>./cs.status.70Intel.yellowstone | grep -v CLM50 | grep -v PASS | grep -v tputcomp | grep -v ERI_D.ne30_g16.ICLM45BGC.yellowstone_intel.clm-vrtlay | grep -v ERS_D.f09_g16.ICLM45VIC.yellowstone_intel.clm-vrtlay | grep -v ERS_Ld211_D_P112x1.f10_f10.ICNCROP
RUN   ERI.f09_g16.ICLM45BGC.yellowstone_intel.GC.70Intel
-- ref1 and ref2 run, then no output in non-ref run
RUN   ERI.f10_f10.ICLM45BGC.yellowstone_intel.GC.70Intel
-- ref1 and ref2 run, then no output in non-ref run
RUN   ERI.f19_g16.ICLM45BGC.yellowstone_intel.GC.70Intel
-- ref1 and ref2 run, then no output in non-ref run
RUN   ERI_D.T31_g37.ICLM45.yellowstone_intel.clm-SNICARFRC.GC.70Intel
-- ref1 and ref2 run, then no output in non-ref run
RUN   ERI_D.f09_g16.ICLM45BGC.yellowstone_intel.GC.70Intel
-- ref1 and ref2 run, then no output in non-ref run
RUN   ERI_D.f10_f10.ICLM45BGC.yellowstone_intel.GC.70Intel
-- ref1 and ref2 run, then no output in non-ref run
RUN   ERI_D.f19_g16.ICLM45BGC.yellowstone_intel.GC.70Intel
-- ref1 and ref2 run, then no output in non-ref run
RUN   ERI_D.ne30_g16.ICLM45BGC.yellowstone_intel.GC.70Intel
-- ref1 and ref2 run, then no output in non-ref run
RUN   ERI_N2.f19_g16.ICRUCLM45BGCCROP.yellowstone_intel.GC.70Intel
-- ref1 and ref2 run, then no output in non-ref run
RUN   ERI_N2.f19_g16.ICRUCLM45BGCCROP.yellowstone_intel.clm-default.GC.70Intel
-- ref1 and ref2 run, then no output in non-ref run
FAIL  ERS_D.f10_f10.ICLM45VIC.yellowstone_intel.clm-vrtlay.GC.70Intel.compare_hist.clm4_5_69
 69 Comparing hist file with baseline hist file, /glade/scratch/muszala/ERS_D.f10_f10.ICLM45VIC.yellowstone_intel.clm-vrtlay.GC.70Intel/run/ERS_D.f10_f10.ICLM45VIC.yellowstone_intel.clm-vrtlay.GC.70Intel.cpl.hi.0001-01-12-00000    .nc /glade/p/cesmdata/cseg/ccsm_baselines/clm4_5_69/ERS_D.f10_f10.ICLM45VIC.yellowstone_intel.clm-vrtlay/cpl.hi.nc
 70 ncdump1 done
 71 ncdump2 done
 72 comparing split files x[a-z][a-z]
 73 xaa
 74 6979,6981c6979,6981 < 0.983149585541109, 0.972017300931466, 0.972017300784614, < 0.972017300929172, 0.964088275988772, 0.971373805810303, < 0.977583443108289, 0.983149585551217, 0.983149585568791, ---
 75 FAIL
 76 hist file comparison is FAIL
FAIL  SMS.f19_g16.ICLM45VIC.yellowstone_intel.clm-default.GC.70Intel.compare_hist.clm4_5_69
 60 /glade/u/spooldir/1397689222.575650.shell:  Storing new baseline in /glade/p/cesmdata/cseg/ccsm_baselines/clm4_5_70/SMS.f19_g16.ICLM45VIC.yellowstone_intel.clm-default
 61 Comparing hist file with baseline hist file, /glade/scratch/muszala/SMS.f19_g16.ICLM45VIC.yellowstone_intel.clm-default.GC.70Intel/run/SMS.f19_g16.ICLM45VIC.yellowstone_intel.clm-   default.GC.70Intel.cpl.hi.0001-01-06-00000.n    c /glade/p/cesmdata/cseg/ccsm_baselines/clm4_5_69/SMS.f19_g16.ICLM45VIC.yellowstone_intel.clm-default/cpl.hi.nc
 62 ncdump1 done
 63 ncdump2 done
 64 comparing split files x[a-z][a-z]
 65 xad
 66 18300c18300 < 0.983410370293909, 0.984052369383093, 0.979227772964994, --- > 0.983410370293909, 0.984052369383093, 0.979228345951215, 18341,18350c18341,18350
 67 FAIL
 68 hist file comparison is FAIL

2) Goldbach + NAG seems to have passed OK, _D runs have failed as expected.  The reporting is messed up...ie., TestStatus.out look OK, but TestStatus does not.

>> ./cs.status.70nag.goldbach | grep -v CLM50 | grep -v PASS | grep -v tputcomp | grep -v _D
FAIL  ERI.f10_f10.ICLM45BGC.goldbach_nag.clm-reduceOutput.GC.70nag
--look at /scratch/cluster/muszala/tests/ERI.f10_f10.ICLM45BGC.goldbach_nag.clm-reduceOutput.GC.70nag/TestStatus.out and there is no FAIL
FAIL  ERI.f19_g16.ICLM45BGC.goldbach_nag.clm-reduceOutput.GC.70nag
--/scratch/cluster/muszala/tests/ERI.f19_g16.ICLM45BGC.goldbach_nag.clm-reduceOutput.GC.70nag and there is no FAIL

3) Goldbach + Intel - these look all like passes to me:  see /scratch/cluster/muszala/tests/*/TestStatus.out

>> ./cs.status.70intel.goldbach | grep -v CLM50 | grep -v PASS | grep -v tputcomp
FAIL  ERI.f10_f10.ICLM45BGC.goldbach_intel.clm-reduceOutput.GC.70intel
-- Shows FAIL but PASSes in TestStatus.out
FAIL  ERI.f19_g16.ICLM45BGC.goldbach_intel.clm-reduceOutput.GC.70intel
-- Shows FAIL but PASSes in TestStatus.out
FAIL  ERI_D.T31_g37.I1850CLM45.goldbach_intel.clm-reduceOutput.GC.70intel
-- Shows FAIL but PASSes in TestStatus.out
FAIL  ERI_D.f10_f10.ICLM45BGC.goldbach_intel.clm-reduceOutput.GC.70intel
-- Shows FAIL but PASSes in TestStatus.out
FAIL  ERI_D.f19_g16.ICLM45BGC.goldbach_intel.clm-reduceOutput.GC.70intel
-- Shows FAIL but PASSes in TestStatus.out

4) Goldbach + PGI - some are indicating FAIL with TestStatus.out shows PASSes, others are straight out FAILs

./cs.status.70pgi.goldbach | grep -v CLM50 | grep -v PASS | grep -v tputcomp | grep -v SMS_Ly1.f19_g16.ICLM45BGCCROP.frankfurt_pgi
FAIL  ERI.f10_f10.ICLM45BGC.goldbach_pgi.clm-reduceOutput.GC.70pgi
-- Shows FAIL but PASSes in TestStatus.out
FAIL  ERI.f19_g16.ICLM45BGC.goldbach_pgi.clm-reduceOutput.GC.70pgi
-- ref1 fail:
 22    g005.cgd.ucar.edu - daemon did not report back when launched
 23    g006.cgd.ucar.edu - daemon did not report back when launched
 24    g009.cgd.ucar.edu - daemon did not report back when launched
 25 /usr/mpi/pgi/openmpi-1.4.3-qlc/bin/orted: error while loading shared libraries: libpgc.so: cannot open shared object file: No such file or directory
FAIL  ERI_D.f10_f10.ICLM45BGC.goldbach_pgi.clm-reduceOutput.GC.70pgi
-- Shows FAIL but PASSes in TestStatus.out
FAIL  ERI_D.f19_g16.ICLM45.goldbach_pgi.clm-reduceOutput.GC.70pgi
-- ref1 fail:
  1 /usr/mpi/pgi/openmpi-1.4.3-qlc/bin/orted: error while loading shared libraries: libpgc.so: cannot open shared object file: No such file or directory
  2 /usr/mpi/pgi/openmpi-1.4.3-qlc/bin/orted: error while loading shared libraries: libpgc.so: cannot open shared object file: No such file or directory
  3 /usr/mpi/pgi/openmpi-1.4.3-qlc/bin/orted: error while loading shared libraries: libpgc.so: cannot open shared object file: No such file or directory
  4 --------------------------------------------------------------------------
  5 A daemon (pid 29755) died unexpectedly with status 127 while attempting
FAIL  ERI_D.f19_g16.ICLM45BGC.goldbach_pgi.clm-reduceOutput.GC.70pgi
-- ref1 fail:
 23    g021.cgd.ucar.edu - daemon did not report back when launched
 24    g022.cgd.ucar.edu - daemon did not report back when launched
 25    g023.cgd.ucar.edu - daemon did not report back when launched
 26 /usr/mpi/pgi/openmpi-1.4.3-qlc/bin/orted: error while loading shared libraries: libpgc.so: cannot open shared object file: No such file or directory
FAIL  SMS_Ld5.f19_g16.IRCP45CLM45BGC.goldbach_pgi.clm-decStart.GC.70pgi
-- ERROR in /var/spool/torque/mom_priv/jobs/19500.goldbach.cgd.ucar.edu.SC: file /fs/cgd/csm/ccsm_baselines/clm4_5_69/SMS_Ld5.f19_g16.IRCP45CLM45BGC.goldbach_pgi.clm-decStart/cpl.hi.nc does not exist

CLM tag used for the baseline comparisons:  clm4_5_69

Changes answers relative to baseline: No

===============================================================
===============================================================
Tag name:  clm4_5_69
Originator(s):  andre (Benjamin Andre,LAWRENCE BERKELEY NATIONAL LABORATORY,510-486-4617)
Date: Tue Mar 18 21:12:34 MDT 2014
One-line Summary: start unit testing build-namelist

Purpose of changes: start doing unit testing on construction of the clm namelist.
This involved moving the contents of build-namelist into CLMBuildNamelist.pm and
bringing in perl infrastructure to supplement Test::More. Initial test suites are
implented for several name list variables.

Requirements for tag: N/A

Test level of tag: regular, build_namelist

Bugs fixed (include bugzilla ID): N/A

Known bugs (include bugzilla ID): N/A
	http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: N/A

Describe any changes made to the namelist: N/A

List any changes to the defaults for the boundary datasets: N/A

Describe any substantial timing or memory changes: N/A

Code reviewed by: self, clm-cmt

List any svn externals directories updated (csm_share, mct, etc.): N/A

List all files eliminated: N/A

List all files added and what they do:

  models/lnd/clm/bld:
    CLMBuildNamelist.pm - contents of build-namelist
    test_build_namelist/perl5lib/* - CPAN modules needed for unit testing
    test_build_namelist/t/input/* - mock input files for build-namelist tests
    test_build_namelist/t/template_test_XXX.pm - template for new tests
    test_build_namelist/t/test_*.pm - unit tests
    test_build_namelist/test_build_namelist.pl - unit test driver
    test_build_namelist/README

List all existing files that have been modified, and describe the changes:

  models/lnd/clm/bld:
    build-namelist - moved contents into CLMBuildNamelist.pm, now just a driver calling main function.


CLM testing:

  build-namelist tests:

    yellowstone - OK new and existing generate tests
    goldbach - OK new and existing generate tests

  regular tests (aux_clm):

    yellowstone_intel - OK
    yellowstone_pgi - OK
    goldbach_nag - OK

  history file comparison with component_gen_comp and summarize_cprnc_diffs: N/A

  short tests (aux_clm_short):

    yellowstone_intel - OK
    yellowstone_pgi - OK

  tools testing: N/A

CLM tag used for the baseline comparisons: clm4_5_68

Changes answers relative to baseline: No


===============================================================
===============================================================
Tag name:  clm4_5_68
Originator(s):  erik (Erik)
Date: Fri Mar  7 16:43:23 MST 2014
One-line Summary: Update scripts to version that turns on transient CO2 streams for 
                  transient compsets, and update CISM (changes answers)

Purpose of changes:

Bring in the scripts version that by default had transient CO2 for any transient 
compsets. You can still turn it off by setting DATM_CO2_TSERIES=FALSE in env_run.xml. 
Also bring in the latest CISM version that has answer changes for any IG compsets.
It fixes fields sent from CISM to the coupler (fixes an exact restart problem).

Requirements for tag:
   update scripts and CISM, transient and IG compsets have different answers

Test level of tag: regular

Bugs fixed (include bugzilla ID): 979 (adding CO2 streams)

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: None

Describe any changes made to the namelist: None

List any changes to the defaults for the boundary datasets: None

Describe any substantial timing or memory changes: None

Code reviewed by: self

List any svn externals directories updated (csm_share, mct, etc.):
    scripts to scripts4_140305
    cism    to cism1_140303

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes: None

CLM testing:

  build-namelist tests:

    yellowstone yes

  regular tests (aux_clm):

    yellowstone_intel yes
    yellowstone_pgi   yes
    goldbach_nag      yes
    goldbach_pgi      yes
    goldbach_intel    yes

  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    yellowstone_intel  yes
    yellowstone_pgi    yes

  tools testing: None

CLM tag used for the baseline comparisons:  clm4_5_67

Changes answers relative to baseline: Yes!

  Summarize any changes to answers:
    - what code configurations: transient and IG compsets
    - what platforms/compilers: all
    - nature of change: larger than roundoff

===============================================================
===============================================================
Tag name: clm4_5_67
Originator(s): mvertens
Date: Thu Mar  6 16:53:23 MST 2014
One-line Summary: removed initSurfAlb as part of the initialization

Purpose of changes: removed the call to initSurfAlb as well as part of
	the initialization and also removed the routine from the clm4.5
	code base

Requirements for tag: N/A

Test level of tag: regular

Bugs fixed (include bugzilla ID): None

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

 1147 (mkgriddata can't straddle over Greenwich)
 1025 (SCM mode can NOT use a global finidat file)
 1017 (SCM mode can NOT restart)
  896 (T62 mode does not work)
  701 (svn keyword)
  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: None 

M       bld/namelist_files/namelist_defaults_clm4_5.xml
	- clmi.ICRUCLM45BGCCROPmp24.0241-01-01.10x15_USGS_simyr2000_c140111.nc had not
	in fact been created - this effected the PEM test in the goldbach clm45 test suite
	- the default namelist has not been backed up to the original 
	clmi.ICRUCLM45BGCCROPmp24.0241-01-01.10x15_USGS_simyr2000_c131028.nc
	for now

Describe any changes made to the namelist: None

List any changes to the defaults for the boundary datasets: None

Describe any substantial timing or memory changes:  None

Code reviewed by: mvertens

List any svn externals directories updated (csm_share, mct, etc.): None

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

M       src/clm4_5/biogeochem/ch4InitMod.F90
	- removal of code block that is no longer needed due to removal of initSurfAlb
	(this had already been commented out in clm4_5_66)

M       src/clm4_5/main/initInterp.F90
	- minor bug fix the turn off spval by default for nonactive points

D       src/clm4_5/main/initSurfAlbMod.F90
M       src/clm4_5/main/clm_initializeMod.F90
        - removal of call initSurfAlb (main purpose of this tag)
	- removal of code to upgrade old initial data files to have new metadata	 
          a new scheme should be put in place with a namelist option to take clm4.5
          restart datasets that have been created prior to the introduction of initInterp
          and introduce the new metadata at run time

M       src/clm4_5/main/initColdMod.F90
	- had to introduce setting values for the following variables in order to remove 
	call to initSurfAlb
            cps%albgrd_pur(bounds%begc:bounds%endc,:) = 0.2_r8
    	    cps%albgri_pur(bounds%begc:bounds%endc,:) = 0.2_r8
    	    cps%albgrd_bc(bounds%begc:bounds%endc,:)  = 0.2_r8
    	    cps%albgri_bc(bounds%begc:bounds%endc,:)  = 0.2_r8
    	    cps%albgrd_oc(bounds%begc:bounds%endc,:)  = 0.2_r8
    	    cps%albgri_oc(bounds%begc:bounds%endc,:)  = 0.2_r8
    	    cps%albgrd_dst(bounds%begc:bounds%endc,:) = 0.2_r8
    	    cps%albgri_dst(bounds%begc:bounds%endc,:) = 0.2_r8

M       src/clm4_5/main/clm_driver.F90
	- just comments

CLM testing:

  regular tests (aux_clm): OK means only failures were expected
	
    yellowstone_intel	: OK 
    yellowstone_pgi	: OK
    goldbach_nag	: OK

  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    yellowstone_intel: OK
    yellowstone_pgi  : OK

CLM tag used for the baseline comparisons: clm4_5_66

Changes answers relative to baseline: some - for all compsets where 
    finidat is set to blank, then answers will change relative to baseline

  for all compsets wehre finidat is pointing to a dataset, answers will be bfb
  compared to baseline 
	
===============================================================
===============================================================
Tag name: clm4_5_66
Originator(s): mvertens
Date: Mon Mar  3 10:50:24 MST 2014
One-line Summary: refactoring of initialization and introduction of run-time finidat interpolation

Purpose of changes: refactoring of initialization and introduction of run-time finidat interpolation

Completely rewrote clm_initialize to leverage new initialization scheme
In the new scheme, cold start initialization is ALWAYS called and values
are overwritten by either an appropriate finidat file OR by calling 
finidat_interp to interplate finidat to the output resolution/mask.

Requirements for tag:

Test level of tag: regular, short, tools, build_namelist, doc

Bugs fixed (include bugzilla ID):

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:

   1930 (MEGAN does not work correctly with prognostic crops on)
   1147 (mkgriddata can't straddle over Greenwich)
   1025 (SCM mode can NOT use a global finidat file)
   1017 (SCM mode can NOT restart)
    896 (T62 mode does not work)
    701 (svn keyword)
    452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system:

    NONE	 

Describe any changes made to the namelist:

   - ALL clm4.5 finidat files have been updated to contain new metadata that will enable the
     online interpinic to operate on them. The time stamp on all new files has the date c140111.
     The files have been created so that they are bit-for-bit compatible with the code base.
   - The following new namelist variables have been added to the namelist_definition_clm4_5.xml file
       - finidat_interp_source 
         if non-blank, then interpinic will be called to interpolate finidat_interp_source and 
         create output file specified by finidat_interp_dest.
       - finidat_interp_dest  
         if finidat_interp_source is set to non-blank, then interpinic will be called 
         to interpolate finidat_interp_source and create output file finidat_interp_dest

List any changes to the defaults for the boundary datasets:

     None

Describe any substantial timing or memory changes:

     None	 
	 
Code reviewed by: 

     mvertens, sacks

List any svn externals directories updated (csm_share, mct, etc.):

     None

List all files eliminated:

        The following file pairs were renamed and subsequently extensively modfified
        Summaries of the modifications are below:

        ------- New module initColdMod.F90 contains calls to initialize the cold start for
        ------- the entire model. The cold start values are then overwritten with either
        ------- an finidat file or an interpolation file using finidat_interp_source. 
D       models/lnd/clm/src/clm4_5/main/mkarbinitMod.F90
A       models/lnd/clm/src/clm4_5/main/initColdMod.F90

        ------- Renamed file 
D       models/lnd/clm/src/clm4_5/biogeochem/STATICEcosysDynMod.F90
A       models/lnd/clm/src/clm4_5/biogeochem/SatellitePhenologyMod.F90

        ------- Renamed file 
D       models/lnd/clm/src/clm4_5/biogeochem/CNDVEcosystemDynIniMod.F90
A       models/lnd/clm/src/clm4_5/biogeochem/CNDVInitMod.F90

        ------- Renamed file, removed initch4, merged routines initTimeConst_ch4 and makearbinit_ch4
        --------into new routine initColdCH4.Also removed almost all associate statements
        ------- (but kept the intput/output documentation) and used the explicit clmtype definition.	 
D       models/lnd/clm/src/clm4_5/biogeochem/initch4Mod.F90
A       models/lnd/clm/src/clm4_5/biogeochem/ch4InitMod.F90

        ------- Renamed and combined files
        ------- Migrated all CN cold start initialization for both soil and
        ------- special landuntis into new routine initColdCN in new module biogeochem/CNInitMod.
D       models/lnd/clm/src/clm4_5/main/CNiniSpecial.F90
D       models/lnd/clm/src/clm4_5/main/CNiniTimeVar.F90
A       models/lnd/clm/src/clm4_5/biogeochem/CNInitMod.F90

        ------- Renamed file and merged routines makearbinit and snow_depth2Lake
        ------- into one new routine initColdSlake. Also removed almost all associate
        ------- statements (but kept the intput/output documentation) and used the explict
        ------- clmtype definition.	 
A       models/lnd/clm/src/clm4_5/biogeophys/SLakeInitMod.F90
D       models/lnd/clm/src/clm4_5/biogeophys/initSlakeMod.F90

        ------- Renamed iniTimeConst, removed associate statements but kept
        ------- the documentation of input/output and also explictly listed 
        ------- full clmtype variables
D       models/lnd/clm/src/clm4_5/main/iniTimeConst.F90
A       models/lnd/clm/src/clm4_5/main/initTimeConstMod.F90

List all files added and what they do:

        ------- New run-time interpolation of input finidat to target resolution/mask
        ------- using the new namelist variables finidat_interp_source and finidat_interp_dest
A       models/lnd/clm/src/clm4_5/main/initInterp.F90

        ------- Obtain/write global index space value for target point at given clmlevel
A       models/lnd/clm/src/util_share/GetGlobalValuesMod.F90

List all existing files that have been modified, and describe the changes:

        ------- In all files, unless otherwise noted added call to errMsg(__FILE__,__LINE__) 
        ------- and in some cases optional arguments of decomp_index and clmlevel also added

        ------- See documentation for namelist changes above
M       models/lnd/clm/bld/namelist_files/namelist_definition_clm4_5.xml
M       models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_5.xml

        ------  Overloaded endrun subroutine to also print out global index infromation by 
        ------ 	calling new GetGlobalWrite routine if optional arguments decomp_index and
        ------ 	clm_level are passed in
M       models/lnd/clm/src/util_share/abortutils.F90 

        ------- Replaced missing value setting of huge(1) with ispval 
M       models/lnd/clm/src/util_share/accumulMod.F90

        ------- Replaced endrun with call to shr_sys_abort
M       models/lnd/clm/src/util_share/domainMod.F90
	
        ------- Added in missing values and special values for variable metadata - this
        ------- is needed needed by initInterp
M       models/lnd/clm/src/util_share/restUtilMod.F90
M       models/lnd/clm/src/util_share/restUtilMod.F90.in

        ------- Completely rewrote clm_initialize to leverage new initialization scheme
        ------- In the new scheme, cold start initialization is ALWAYS called and values
        -------	are overwritten by either an appropriate finidat file OR by calling 
        -------	finidat_interp to interplate finidat to the output resolution/mask.
M       models/lnd/clm/src/clm4_5/main/clm_initializeMod.F90

        -------	Added new metadata and variables - include global indices for parent subgrid
        -------	level(s) (i.e. column, landunit and gridcell for pfts)
M       models/lnd/clm/src/clm4_5/main/subgridRestMod.F90

        ------- Moved view_factor routine and associated variable from a separate routine
        ------- in UrbanMod to part of the initTimeConstUrban subroutine in UrbanInitMod
M       models/lnd/clm/src/clm4_5/biogeophys/UrbanInitMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/UrbanMod.F90

        ------- Removed vf_xx variables from restart file and also 
        ------- removed do_initsurfalb variable
M       models/lnd/clm/src/clm4_5/biogeophys/BiogeophysRestMod.F90

        ------- In all files, unless otherwise noted added call to errMsg(__FILE__,__LINE__) 
        ------- and in some cases optional arguments of decomp_index and clmlevel also added
M       models/lnd/clm/src/util_share/ncdio_pio.F90
M       models/lnd/clm/src/util_share/ncdio_pio.F90.in
M       models/lnd/clm/src/clm4_5/biogeochem/CNCStateUpdate2Mod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNGapMortalityMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNRestMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNNitrifDenitrifMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CropRestMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNBalanceCheckMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNFireMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNMRespMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/MEGANFactorsMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNVerticalProfileMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/ch4RestMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNCIsoFluxMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNPrecisionControlMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/ch4Mod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNSummaryMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/DUSTMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNPhenologyMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/ch4varcon.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNDecompMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNCStateUpdate1Mod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNDVMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNCStateUpdate3Mod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNSharedParamsMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/VOCEmissionMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNNDynamicsMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNAllocationMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/DryDepVelocity.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNEcosystemDynMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNDecompCascadeBGCMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNSoilLittVertTranspMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNDVEstablishmentMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNDecompCascadeCNMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNC14DecayMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_varpar.F90
M       models/lnd/clm/src/clm4_5/main/decompInitMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_glclnd.F90
M       models/lnd/clm/src/clm4_5/main/accFldsMod.F90
M       models/lnd/clm/src/clm4_5/main/ndepStreamMod.F90
M       models/lnd/clm/src/clm4_5/main/histFileMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_atmlnd.F90
M       models/lnd/clm/src/clm4_5/main/restFileMod.F90
M       models/lnd/clm/src/clm4_5/main/controlMod.F90
M       models/lnd/clm/src/clm4_5/main/initSurfAlbMod.F90
M       models/lnd/clm/src/clm4_5/main/filterMod.F90
M       models/lnd/clm/src/clm4_5/main/surfrdUtilsMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_varctl.F90
M       models/lnd/clm/src/clm4_5/main/clm_driver.F90
M       models/lnd/clm/src/clm4_5/main/subgridAveMod.F90
M       models/lnd/clm/src/clm4_5/main/initGridCellsMod.F90
M       models/lnd/clm/src/clm4_5/main/initSoilParVICMod.F90
M       models/lnd/clm/src/clm4_5/main/pftvarcon.F90
M       models/lnd/clm/src/clm4_5/main/surfrdMod.F90
M       models/lnd/clm/src/clm4_5/main/decompMod.F90
M       models/lnd/clm/src/clm4_5/main/clmtype.F90
M       models/lnd/clm/src/clm4_5/main/reweightMod.F90
M       models/lnd/clm/src/clm4_5/main/histFldsMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/BalanceCheckMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/UrbanInputMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SnowHydrologyMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/Hydrology1Mod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/CLMVICMapMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SNICARMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/CanopyFluxesMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SurfaceRadiationMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SurfaceAlbedoMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SoilHydrologyMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynLandunitAreaMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynTimeInfoMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynHarvestMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynFileMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynConsBiogeochemMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynPriorWeightsMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynVarMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynpftFileMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynVarMod.F90.in

CLM testing:

  regular tests (aux_clm):

    NOTE1: that all namelists compares where finidat was not blank will fail - since
    new finidat files are used that have new metadata - BUT - the results are still bfb

    yellowstone_intel  - OK
       expected failures:
    ERI_D.ne30_g16.ICLM45BGC.yellowstone_intel.clm-vrtlay
    ERS_D.f09_g16.ICLM45VIC.yellowstone_intel.clm-vrtlay

    yellowstone_pgi - OK
       expected failures:
    ERH_D.f19_g16.I1850CLM45CN.yellowstone_pgi.clm-default
    ERS.f09_g16.ICLM45VIC.yellowstone_pgi.clm-vrtlay

    goldbach_nag   - OK

    goldbach_intel - OK

    goldbach_pgi   - OK

  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    NOTE1: all .h1 tests fail since there are new meta data fields for 
           cols1d_active, pfts1d_active - and FILLDIFF is different

    yellowstone_intel    OK
    yellowstone_pgi      OK

CLM tag used for the baseline comparisons: clm4_5_65

Changes answers relative to baseline: No - bit-for-bit

===============================================================
===============================================================
Tag name:  clm4_5_65
Originator(s):  mvertens (Mariana Vertenstein,UCAR/CSEG,303-497-1349)
Date: Tue Feb 25 13:45:38 MST 2014
One-line Summary: Turn off MEGAN vocs when crops is running

Purpose of changes:

MEGAN does not currently work with prognostic crops. It needs a table of pft-specific values, and that this table has only been created for the 16 "standard" (non-crop) pfts.

Requirements for tag: N/A

Test level of tag: regular

Bugs fixed (include bugzilla ID): N/A

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
		                 1930 (MEGAN does not work correctly with prognostic crops on)
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: N/A

Describe any changes made to the namelist: N/A

List any changes to the defaults for the boundary datasets: N/A

Describe any substantial timing or memory changes: N/A

Code reviewed by: self, mvertens

List any svn externals directories updated (csm_share, mct, etc.):s

scripts4_140214a -> scripts4_140220
Machines_140214  -> Machines_140218

List all files eliminated: N/A

List all files added and what they do: N/A

List all existing files that have been modified, and describe the changes:

========
	Add a new logical variable - use_voc - that is true by default but
	is set to false if prognostic cop is activated 
========

M       src/clm4_5/main/clm_initializeMod.F90
M       src/clm4_5/main/clm_atmlnd.F90
M       src/clm4_5/main/controlMod.F90
M       src/clm4_5/main/clm_varctl.F90
M       src/clm4_5/main/clm_driver.F90
M       src/clm4_5/main/histFldsMod.F90
M       src/clm4_0/main/clm_varctl.F90
M       src/cpl/clm_cpl_indices.F90
	
	
CLM testing:

  build-namelist tests: N/A

  regular tests (aux_clm): 

    yellowstone_intel  - OK
 	expected failures
      ERI_D.ne30_g16.ICLM45BGC.yellowstone_intel.clm-vrtlay
      ERS_D.f09_g16.ICLM45VIC.yellowstone_intel.clm-vrtlay
	expected non-bfb failures due to VIC/CROP changes
      ERI_N2.f19_g16.ICRUCLM45BGCCROP.yellowstone_intel.clm-default
      ERI_N2.f19_g16.ICRUCLM45BGCCROP.yellowstone_intel
      SMS_Ly1.f19_g16.ICLM45BGCCROP.yellowstone_intel
	
    yellowstone_pgi    - OK
	expected failures
      ERH_D.f19_g16.I1850CLM45CN.yellowstone_pgi.clm-default
      ERS.f09_g16.ICLM45VIC.yellowstone_pgi.clm-vrtlay
	
    goldbach_nag      - OK
	expected non-bfb failures due to VIC/CROP changes
      ERS_D.f10_f10.ICLM45BGCCROP.goldbach_nag.clm-allActive
      ERS_Lm3.1x1_numaIA.ICLM45BGCCROP.goldbach_nag
	
    goldbach_intel    - OK
	expected non-bfb failures due to VIC/CROP changes
      ERS_Ly20.1x1_numaIA.ICLM45BGCDVCROP.goldbach_intel.clm-crop
      PEM.f10_f10.ICLM45BGCCROP.goldbach_intel.clm-crop

    goldbach_pgi      - OK 
	
  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    yellowstone_intel - OK - 
    yellowstone_pgi -  OK

CLM tag used for the baseline comparisons: clm4_5_64

Changes answers relative to baseline: No - except for VOC fields when
	prognostic crop is on (this is a diagnostic only and does not impact
	the answers)

===============================================================
===============================================================
Tag name:  clm4_5_64
Originator(s):  muszala (Stefan Muszala,UCAR/TSS,303-497-1320)
Date: Wed Feb 19 09:19:40 MST 2014
One-line Summary: fix and clean ncdio_pio.F90.in.  clean clm_time_manager.  update externals.

Purpose of changes:

Note 1: This is the last tag that is tested on frankfurt; new tests are on goldbach.

Note 2: Pts. mode is being deprecated for science use as of this tag.  Use PTCLM.  Pts. mode
   remains in place in our test system.

Note 3: There is an unresolved problem with higher resolutions when dov2xy is .false. and we are
   using pnetcdf.  Please see bug 1730.

ncdio_pio.F90.in - fix initialization problem where count and start are sometimes used without
   being set.
clm_time_manager - clean out unused variables
update externals to support ED compsets, move pts. mode tests to testmods.  Update Machines and
   pio to address bug 1730.

Requirements for tag: N/A

Test level of tag: regular

Bugs fixed (include bugzilla ID): N/A

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: N/A

Describe any changes made to the namelist: N/A

List any changes to the defaults for the boundary datasets: N/A

Describe any substantial timing or memory changes: N/A

Code reviewed by: self, mvertens

List any svn externals directories updated (csm_share, mct, etc.):s

scripts4_140209 -> scripts4_140214a
Machines_140213 -> Machines_140214
pio1_8_8        -> pio1_8_9

List all files eliminated: N/A

List all files added and what they do: N/A

List all existing files that have been modified, and describe the changes:

M       models/lnd/clm/src/util_share/clm_time_manager.F90
M       models/lnd/clm/src/util_share/ncdio_pio.F90
M       models/lnd/clm/src/util_share/ncdio_pio.F90.in

CLM testing:

  build-namelist tests: N/A

  regular tests (aux_clm):

    yellowstone_intel  - OK
       Expected due to change in pts. mode:
          BFAIL SMS.f45_f45.I.yellowstone_intel.clm-ptsRLA.GC.64Intel.compare_hist.clm4_5_63 
          BFAIL SMS.f45_f45.I.yellowstone_intel.clm-ptsROA.GC.64Intel.compare_hist.clm4_5_63 
          BFAIL SMS_D_Mmpi-serial.f45_f45.ICLM45.yellowstone_intel.clm-ptsRLA.GC.64Intel.compare_hist.clm4_5_63 
          BFAIL SMS_Mmpi-serial.f45_f45.ICLM45.yellowstone_intel.clm-ptsRLA.GC.64Intel.compare_hist.clm4_5_63 
       Expected due to change in pio_buffer_size_limit
          FAIL ERI.f09_g16.ICLM45BGC.yellowstone_intel.GC.64Intel.nlcomp
          FAIL ERI_D.f09_g16.ICLM45BGC.yellowstone_intel.GC.64Intel.nlcomp
       New Failure for VIC but due to dov2xy problem
          ERS_D.f09_g16.ICLM45VIC.yellowstone_intel.clm-vrtlay

    yellowstone_pgi    - OK
       Expected due to change in pts. mode:
          BFAIL SMS.f45_f45.I.yellowstone_pgi.clm-ptsRLB.GC.64Pgi.compare_hist.clm4_5_63 
          BFAIL SMS_D_Mmpi-serial.f45_f45.ICLM45.yellowstone_pgi.clm-ptsRLA.GC.64Pgi.compare_hist.clm4_5_63 
          BFAIL SMS_Mmpi-serial.f45_f45.ICLM45.yellowstone_pgi.clm-ptsRLA.GC.64Pgi.compare_hist.clm4_5_63
       Expected due to change in pio_buffer_size_limit
          FAIL ERI.f09_g16.I1850CRUCLM45BGC.yellowstone_pgi.GC.64Pgi.nlcomp
          FAIL ERI.f09_g16.ICLM45BGC.yellowstone_pgi.GC.64Pgi.nlcomp
          FAIL ERI_D.f09_g16.ICLM45BGC.yellowstone_pgi.GC.64Pgi.nlcomp
          FAIL ERS_D.hcru_hcru.ICRUCLM45BGC.yellowstone_pgi.GC.64Pgi.nlcomp
          FAIL ERS_D.hcru_hcru.ICRUCN.yellowstone_pgi.GC.64Pgi.nlcomp
       New Failure for VIC but due to dov2xy problem
          ERS.f09_g16.ICLM45VIC.yellowstone_pgi.clm-vrtlay

    frankfurt_nag      - OK
       Expected due to change in pts. mode:
          BFAIL SMS_D_Mmpi-serial.f45_f45.ICLM45.frankfurt_nag.clm-ptsRLA.GC.64Nag.compare_hist.clm4_5_63 
          BFAIL SMS_Mmpi-serial.f45_f45.ICLM45.frankfurt_nag.clm-ptsRLA.GC.64Nag.compare_hist.clm4_5_63 
          BFAIL SMS_Mmpich.f45_f45.ICLM45.frankfurt_nag.clm-ptsRLA.GC.64Nag.compare_hist.clm4_5_63 

    frankfurt_intel    - OK

    frankfurt_pgi      - OK 
       Expected due to change in pts. mode:
          BFAIL SMS.f45_f45.ICLM45.frankfurt_pgi.clm-ptsRLB.GC.64Pgi.compare_hist.clm4_5_63 
          BFAIL SMS.f45_f45.ICLM45.frankfurt_pgi.clm-ptsROA.GC.64Pgi.compare_hist.clm4_5_63 

  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    yellowstone_intel - OK

CLM tag used for the baseline comparisons: clm4_5_63

Changes answers relative to baseline: No

===============================================================
===============================================================
Tag name:  clm4_5_63
Originator(s):  sacks (sacks)
Date: Fri Feb 14 07:22:37 MST 2014
One-line Summary: add some code needed for dynamic landunits; activate 0-weight veg landunit sometimes

Purpose of changes:

(1) Add grc%landunit_indices(:,:), so you can find a given l index if you have
    the g index (this will be needed in a few places for dynamic landunits)

(2) Add code to update landunit weights; currently has no effect because
    landunit areas don't change yet

(3) Refactor logic in the is_active_X routines, and add logic to activate a
    virtual vegetated landunit under some conditions (needed for coupling with
    CISM, and helpful for dynamic landunits). Specifically, we activate a
    virtual (0-weight) vegetated landunit for any grid cell that is NOT 100%
    istice (i.e., standard glacier) (we exclude grid cells that are 100% istice
    to avoid the performance penalty, because these aren't used for coupling
    with CISM, and the only way this glacier can retreat is if another landunit,
    like crop, increases there, which will rarely happen).

Requirements for tag: N/A

Test level of tag: regular

Bugs fixed (include bugzilla ID):

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes:

   Performance about 6% worse for clm4.5 IG runs at f09 (i.e., with glcmec),
   because of the new virtual vegetated columns. Not investigated for f19 or
   T31, but probably a similar performance hit.

   There were also a few memcomp failures

Code reviewed by: quick review by mvertens

List any svn externals directories updated (csm_share, mct, etc.):

   Machines: Machines_140207a -> Machines_140213  (to fix pgi on yellowstone)

List all files eliminated:

========= Remove "IN_PROGRESS"
D       models/lnd/clm/src/clm4_5/dyn_subgrid/dynLandunitAreaMod.F90.IN_PROGRESS

List all files added and what they do:

========= Add code to update landunit weights; currently has no effect because
          landunit areas don't change yet
A       models/lnd/clm/src/clm4_5/dyn_subgrid/dynLandunitAreaMod.F90

========= Add unit tests for dynLandunitAreaMod
A       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/dynLandunitArea_test
A       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/dynLandunitArea_test/test_update_landunit_weights_one_gcell.pf
A       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/dynLandunitArea_test/CMakeLists.txt
A       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/dynLandunitArea_test/test_update_landunit_weights.pf

List all existing files that have been modified, and describe the changes:

========= Add grc%landunit_indices(:,:), so you can find a given l index if you
          have the g index (this will be needed in a few places for dynamic
          landunits)
M       models/lnd/clm/src/clm4_5/main/clmtype.F90
M       models/lnd/clm/src/clm4_5/main/clmtypeInitMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_varcon.F90
           - just add a comment
M       models/lnd/clm/src/clm4_5/main/initGridCellsMod.F90

========= Call new code in dynLandunitAreaMod
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynSubgridDriverMod.F90

========= Refactor logic in the is_active_X routines, and add logic to activate
          a virtual vegetated landunit under some conditions (needed for
          coupling with CISM, and helpful for dynamic landunits)
M       models/lnd/clm/src/clm4_5/main/reweightMod.F90

========= Add unit tests for dynLandunitAreaMod
M       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/CMakeLists.txt
M       models/lnd/clm/src/clm4_5/dyn_subgrid/CMakeLists.txt
M       models/lnd/clm/src/clm4_5/main/CMakeLists.txt


CLM testing:

  regular tests (aux_clm):

    NOTE: frankfurt intel & pgi ran on a slightly older version of the branch
    (dynlu_weight_updates_glacier_n05_clm4_5_62, which did not include some
    final minor refactoring to reweightMod); frankfurt nag & yellowstone
    intel/pgi ran on the final version

    yellowstone_intel: ok
    yellowstone_pgi: ok
    frankfurt_intel: ok
    frankfurt_pgi: ok
    frankfurt_nag: ok

  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    yellowstone_intel: ok
    yellowstone_pgi: ok

    A bunch of expected failures in h1 (1-d) hist files, due to the newly-active
    points.


  Also: Did a manual test to show that answers are the same for virtual
  vegetated columns as they would be if the column had non-zero weight (to
  ensure there are no dependencies on whether a column's weight is non-zero).

CLM tag used for the baseline comparisons: clm4_5_62 for yellowstone (but
clm4_5_61 for component_gen_comp); clm4_5_61 for frankfurt

Changes answers relative to baseline: NO

   However, note diffs in 1-d hist files due to newly-active points.
	
===============================================================
===============================================================
Tag name:  clm4_5_62
Originator(s):  erik (Erik)
Date: Mon Feb 10 04:16:07 MST 2014
One-line Summary: Get PTCLM working robustly, US-UMB test working, add CO2 streams to datm, add more 
                  consistency testing between compsets and user settings

Purpose of changes:

US-UMB fix in scripts and datm update. Fix so build-namelist will abort if there is an inconsistency with CLM_BLDNML_OPTS 
and user_nl_clm. Add CO2 streams as a built-in option to datm. Turn CO2 streams on with the DATM_CO2_TSERIES env_run.xml
variable. Can be set to: none,20tr,rcp2.6,rcp4.5,rcp6.0,rcp8.5, by default is none.

Requirements for tag:

   datm -- CO2 update, streams improvements
   Fix build-namelist consistency issues
   Fix bug 1847 -- end1d in hist for clm4_0
   Add envxml_dir
   check that cndv and fpftdyn aren't on the same time
   Add PTCLM tests to test_Driver
   Add PTCLM test system in
   Make PTCLM more robust

Test level of tag: regular, tools, build_namelist

Bugs fixed (include bugzilla ID):
     1918 -- sort options in build-namelist
     1917 -- remove WRF resolutions
     1903 -- buildtools fails for PTCLM
     1900 -- Remove BUILDHEAT and Qanth from output for CLM testing
     1896 -- CLM build-namelist should abort if use_cndv AND fpftdyn are set.
     1881 -- Add envxml_casedir option to CLM build-namelist
     1879 -- need error triggered when use_crop and CLM_BLDNL_OPTS are not consistent 
     1847 -- 'histfilemod_mp_hist_restart_ncd_$END1D' is being used without being defined 

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: frankfurt switched out for goldbach

Describe any changes made to the namelist: CLM build-namelist changed to ensure user changes don't conflict with
    command-line options

List any changes to the defaults for the boundary datasets: remove WRF datasets

Describe any substantial timing or memory changes: None

Code reviewed by: self

List any svn externals directories updated (csm_share, mct, etc.):

     scripts    to scripts4_140209
     Machines   to Machines_140207a
     datm       to datm8_140114
     pio        to pio1_8_8
     cprnc      to cprnc_140203

     PTCLM      to PTCLM2_140204

List all files eliminated: move frankfurt to goldbach

D       models/lnd/clm/test/tools/tests_posttag_frankfurt_nompi
 
List all files added and what they do: goldbach, and add PTCLM tools testing

A  +    models/lnd/clm/test/tools/tests_posttag_goldbach_nompi
A       models/lnd/clm/test/tools/TCBscripttools.sh ------------ Add script to run buildtools for PTCLM
A       models/lnd/clm/test/tools/config_files/PTCLM__s -------- Config for PTCLM
A       models/lnd/clm/test/tools/nl_files/PTCLM_USUMB_clm4_0
A       models/lnd/clm/test/tools/nl_files/PTCLM_USUMB_clm4_5
A       models/lnd/clm/test/tools/nl_files/PTCLM_USUMB_Cycle_clm4_5
A       models/lnd/clm/test/tools/nl_files/PTCLM_USUMB_Global_clm4_5
A       models/lnd/clm/bld/unit_testers/myuser_nl_clm --- New build-namelist tests
A       models/lnd/clm/bld/unit_testers/env_run.xm 


List all existing files that have been modified, and describe the changes:

    M    models/lnd/clm/bld/build-namelist ----- Sort options, add -envxml_dir option, check that user hasn't contradicted themself
             with CLM_BLDNML_OPTS and user_nl_clm, remove options: -noio, -nofire, -snicar_frc, -vsoilc, -exlaklayers, -clm4me
             use Cwd::abs_path and remove home-grown absolute_path, add some more docmentation and comments, redo some ordering and names
    M    models/lnd/clm/bld/clm.buildnml.csh --- add -envxml_dir so will use env_*.xml files to expand env variables
    M    models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_0.xml --- Add irrig setting, remove WRF files
    M    models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_5.xml --- Add irrig, bgc_spinup, and bgc_mode
    M    models/lnd/clm/bld/namelist_files/namelist_defaults_overall.xml -- Remove WRF resolutions: us20, wus12
    M    models/lnd/clm/bld/namelist_files/namelist_definition_clm4_0.xml - Remove WRF resolutions
    M    models/lnd/clm/bld/namelist_files/namelist_definition_clm4_5.xml - Remove WRF resolutions, add bgc_mode
    M    models/lnd/clm/bld/unit_testers/build-namelist_test.pl ----------- Add a bunch of new tests
    M    models/lnd/clm/bld/user_nl_clm ----- make note of variables that should be done by command-line build-namelist options

    M    models/lnd/clm/src/clm4_0/main/histFileMod.F90 --- Fix bug 1847

------------ Add PTCLM testing
    M    models/lnd/clm/test/tools/README.testnames
    M    models/lnd/clm/test/tools/test_driver.sh ------ Remove bluefire, lynx, mirage, jaguarpf -- switch frankfurt for goldbach
    M    models/lnd/clm/test/tools/TBLscript_tools.sh
    M    models/lnd/clm/test/tools/TSMscript_tools.sh
    M    models/lnd/clm/test/tools/input_tests_master
    M    models/lnd/clm/test/tools/tests_posttag_nompi_regression
    M    models/lnd/clm/test/tools/tests_posttag_yong
    M    models/lnd/clm/test/tools/tests_pretag_yellowstone_nompi

------------ Don't die if debug and files were not created.
    M    models/lnd/clm/tools/clm4_0/mksurfdata_map/mksurfdata.pl
    M    models/lnd/clm/tools/clm4_5/mksurfdata_map/mksurfdata.pl

CLM testing: regular, build-namelist, tools

  build-namelist tests:

    yellowstone

  regular tests (aux_clm):

    yellowstone_intel
    yellowstone_pgi
    goldbach_nag
    edison_intel

  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    yellowstone_intel
    yellowstone_pgi

  tools testing:

    yellowstone interactive
    goldbach interactive

CLM tag used for the baseline comparisons:  clm4_5_61

Changes answers relative to baseline: None, bit-for-bit

===============================================================
===============================================================
Tag name:  clm4_5_61
Originator(s):  sacks (Bill Sacks,UCAR/CSEG,303-497-1762)
Date: Tue Feb  4 09:45:43 MST 2014
One-line Summary: add 3-d snow history fields; continue harvest past end of pftdyn timeseries

Purpose of changes:

   There are two separate sets of changes in this tag; both apply just to CLM4.5:

   (1) Addition of 3-d snow history fields: These history fields (inactive by
       default) provide diagnostics for each layer of the snow pack. This
       involved adding some additional history file infrastructure to handle
       the variable number of snow pack layers. See the new section in the
       user's guide (custom.xml) for a description of how these new history
       fields work, and how to interpret them.

   (2) Change the harvest logic for transient runs that extend past the end of
       the pftdyn dataset: Until now, harvest was set to 0 when you passed the
       end of the pftdyn dataset. With this tag, this behavior is changed, so
       that for all years past the end of the pftdyn dataset, harvest rates
       remain fixed at the last year's value.

Requirements for tag: N/A

Test level of tag: regular

Bugs fixed (include bugzilla ID):

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes:

   Memory use increases slightly, as observed by memcomp failures for a few
   tests. This is presumably due to new fields in clmtype.

Code reviewed by: Erik reviewed changes for the 3-d snow history fields.

List any svn externals directories updated (csm_share, mct, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Add 3-d snow history fields
M       models/lnd/clm/src/clm4_5/main/clmtypeInitMod.F90
M       models/lnd/clm/src/clm4_5/main/histFileMod.F90
M       models/lnd/clm/src/clm4_5/main/clmtype.F90
M       models/lnd/clm/src/clm4_5/main/histFldsMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SoilTemperatureMod.F90
M       models/lnd/clm/doc/UsersGuide/custom.xml

========= Add a new snow diagnostic, sub_surf_abs_SW
M       models/lnd/clm/src/clm4_5/biogeophys/SurfaceRadiationMod.F90

========= Continue harvest past end of pftdyn time series
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynTimeInfoMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynHarvestMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynFileMod.F90
M       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/dynTimeInfo_test/test_dynTimeInfo.pf


CLM testing:

  regular tests (aux_clm):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    frankfurt_intel: ok
    frankfurt_pgi: ok
    frankfurt_nag: ok

  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    yellowstone_intel: ok
    yellowstone_pgi: ok

    Only failures are these expected failures (see notes on answer changes
    below):

    FAIL   SMS_Ly3.1x1_tropicAtl.I20TRCLM45BGC.yellowstone_intel.clm-tropicAtl_subsetLate.compare_hist.clm4_5_60.clm2.h0 
    FAIL   SMS_Ly5.1x1_tropicAtl.I20TRCLM45BGC.yellowstone_intel.clm-tropicAtl_subsetMid.compare_hist.clm4_5_60.clm2.h0 
    FAIL   SMS_Ly8.1x1_tropicAtl.I20TRCLM45BGC.yellowstone_intel.clm-tropicAtl_subsetEarly.compare_hist.clm4_5_60.clm2.h0 
 
CLM tag used for the baseline comparisons: clm4_5_60

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM45 transient runs that continue past the end of the pftdyn dataset
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 

      New climate: Harvest rates are now continued past the end of the pftdyn
      dataset (staying fixed at their value from the last year), for the
      remainder of the simulation. This leads to potentially large answer
      changes for transient runs that continue past the end of the pftdyn
      dataset.

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	
===============================================================
===============================================================
Tag name:  clm4_5_60
Originator(s):  andre (Benjamin Andre,LAWRENCE BERKELEY NATIONAL LABORATORY,510-486-4617)
Date: Thu Jan 30 18:27:03 MST 2014
One-line Summary: refactor build-namelist

Purpose of changes: : break build-namelist into small unit-testable functions
    instead of a single massive script. Use output functions to standardize
    screen output for errors, warnings and messages so that results can be
    automatically searched by scripts.

Requirements for tag: N/A

Test level of tag: regular

Bugs fixed (include bugzilla ID):

Known bugs (include bugzilla ID):
	http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: None

Describe any changes made to the namelist: None

List any changes to the defaults for the boundary datasets: None

Describe any substantial timing or memory changes: None

Code reviewed by: self, Erik

List any svn externals directories updated (csm_share, mct, etc.): None

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

  M models/lnd/clm/bld/build-namelist - major refactor described above
  M models/lnd/clm/bld/namelist_files/namelist_defaults_overall.xml - fix incorrect comments
  M models/lnd/clm/bld/unit_testers/build-namelist_test.pl - minor updates to check new output style

CLM testing:

  build-namelist tests:

    yellowstone - pass compare and generate with only xfails
    frankfurt - not tested, CLM-CMT believes tests may be broken.

  regular tests (aux_clm):

    yellowstone_intel - ok
    yellowstone_pgi - ok
    frankfurt_intel - ok
    frankfurt_pgi - ok
    frankfurt_nag - ok

  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    yellowstone_intel - ok
    yellowstone_pgi - ok

  short tests (aux_clm_short):

    yellowstone_intel - ok

  tools testing: N/A

CLM tag used for the baseline comparisons: clm4_5_59

Changes answers relative to baseline: none, bit for bit


===============================================================
===============================================================
Tag name:  clm4_5_59
Originator(s):  sacks (Bill Sacks,UCAR/CSEG,303-497-1762)
Date: Wed Jan 22 15:04:12 MST 2014
One-line Summary: use new get_curr_yearfrac function in clm_time_manager

Purpose of changes:

   Use the new get_curr_yearfrac function in clm_time_manager in place of
   dyn_time_weights. The reason is that, as Erik pointed out, dyn_time_weights
   was out of place in dynUtilsMod, and really this functionality belongs in the
   clm_time_manager module.

Requirements for tag: N/A

Test level of tag: regular

Bugs fixed (include bugzilla ID): none

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: self

List any svn externals directories updated (csm_share, mct, etc.): none

List all files eliminated:

========= Made obsolete by get_curr_yearfrac in clm_time_manager
D       models/lnd/clm/src/clm4_5/dyn_subgrid/dynUtilsMod.F90
D       models/lnd/clm/test/unit_testers/clm4_5/mock/dyn_subgrid/dynUtilsMod_mock.F90

List all files added and what they do:

========= Mock out get_curr_yearfrac: return a fixed fraction
A       models/lnd/clm/test/unit_testers/clm4_5/mock/util_share/clm_time_manager_mock.F90

List all existing files that have been modified, and describe the changes:

========= Fix get_curr_yearfrac to be real rather than integer
M       models/lnd/clm/src/util_share/clm_time_manager.F90

========= Use get_curr_yearfrac instead of dyn_time_weights
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynVarTimeInterpMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynCNDVMod.F90
M       models/lnd/clm/src/clm4_5/dyn_subgrid/dynVarTimeInterpMod.F90.in

========= Update unit tests to pull in clm_time_manager (mock) rather than dynUtilsMod (mock)
M       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/dynVar_test/CMakeLists.txt
M       models/lnd/clm/test/unit_testers/clm4_5/mock/util_share/CMakeLists.txt
M       models/lnd/clm/test/unit_testers/clm4_5/mock/dyn_subgrid/CMakeLists.txt


CLM testing:

  regular tests (aux_clm):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    frankfurt_intel: ok
    frankfurt_pgi: ok
    frankfurt_nag: ok

  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    yellowstone_intel: ok
    yellowstone_pgi: ok

CLM tag used for the baseline comparisons: clm4_5_58

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM45, either transient or with DV
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      roundoff

   If bitwise differences were observed, how did you show they were no worse
   than roundoff?

     Ran testing on an intermediate tag, where I computed the time weights in
     both the old and new ways. I confirmed that the difference in time weights
     (which is the only change in this tag) is always less than 1e-13. Actually,
     this difference is always less than 2e-16, double-precision roundoff.

     Also examined cpl hist diffs for a few select tests. Diffs are generally
     ~ 1e-6 after 5 days.

===============================================================
===============================================================
Tag name:  clm4_5_58
Originator(s):  sacks (Bill Sacks,UCAR/CSEG,303-497-1762)
Date: Wed Jan 22 14:11:30 MST 2014
One-line Summary: major refactor of transient pft code, in prep for dynamic landunits

Purpose of changes: 

Major refactor of transient pft code, in prep for dynamic landunits.

Requirements for tag: N/A

Test level of tag: regular

Bugs fixed (include bugzilla ID): 
   1899 (harvest rates remain non-zero even after the end of the pftdyn dataset)

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: Erik; design reviewed by CLM-CMT

List any svn externals directories updated (csm_share, mct, etc.):

   scripts: scripts4_140102 -> scripts4_140114
   Machines: Machines_131206b -> Machines_140107
   csm_share: share3_131226 -> share3_131231
   pio: pio1_8_3 -> pio1_8_6
   
   CMake: New external added

List all files eliminated:

========= renamed to dynConsBiogeophysMod.F90
D       models/lnd/clm/src/clm4_5/main/dynlandMod.F90

========= renamed to dynpftFileMod.F90; much of the stuff in here moved to other
          files in the dyn_subgrid directory
D       models/lnd/clm/src/clm4_5/main/pftdynMod.F90

========= renamed
D       models/lnd/clm/test/unit

List all files added and what they do:

========= Rename test/unit to test/unit_testers, and add unit tests for some of
          the stuff in dyn_subgrid. This also involved adding some mocks -
          particularly of ncdio_pio.
A       models/lnd/clm/test/unit_testers/clm4_5/biogeophys/CMakeLists.txt
A       models/lnd/clm/test/unit_testers/clm4_5/biogeophys/Daylength_test/test_daylength.pf
A       models/lnd/clm/test/unit_testers/clm4_5/biogeophys/Daylength_test/CMakeLists.txt
A       models/lnd/clm/test/unit_testers/clm4_5/biogeophys/Daylength_test
A       models/lnd/clm/test/unit_testers/clm4_5/biogeophys
A       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/dynVar_test/test_dynVarShared.F90
A       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/dynVar_test/test_dynVarTimeInterp.pf
A       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/dynVar_test/test_dynVarTimeUninterp.pf
A       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/dynVar_test/CMakeLists.txt
A       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/dynVar_test
A       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/dynTimeInfo_test/test_dynTimeInfo.pf
A       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/dynTimeInfo_test/CMakeLists.txt
A       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/dynTimeInfo_test
A       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid/CMakeLists.txt
A       models/lnd/clm/test/unit_testers/clm4_5/dyn_subgrid
A       models/lnd/clm/test/unit_testers/clm4_5/mock/util_share/ncdio_var.F90
A       models/lnd/clm/test/unit_testers/clm4_5/mock/util_share/ncdio_var.F90.in
A       models/lnd/clm/test/unit_testers/clm4_5/mock/util_share/ncdio_pio_mock.F90
A       models/lnd/clm/test/unit_testers/clm4_5/mock/util_share/spmdMod_mock.F90
A       models/lnd/clm/test/unit_testers/clm4_5/mock/util_share/do_genf90
A       models/lnd/clm/test/unit_testers/clm4_5/mock/util_share/CMakeLists.txt
A       models/lnd/clm/test/unit_testers/clm4_5/mock/util_share/ncdio_pio_mock.F90.in
A       models/lnd/clm/test/unit_testers/clm4_5/mock/util_share
A       models/lnd/clm/test/unit_testers/clm4_5/mock/csm_share/shr_sys_mod_mock.F90
A       models/lnd/clm/test/unit_testers/clm4_5/mock/csm_share/CMakeLists.txt
A       models/lnd/clm/test/unit_testers/clm4_5/mock/csm_share
A       models/lnd/clm/test/unit_testers/clm4_5/mock/main/decompMod_boundsTypeDecl.F90
A       models/lnd/clm/test/unit_testers/clm4_5/mock/main/CMakeLists.txt
A       models/lnd/clm/test/unit_testers/clm4_5/mock/main
A       models/lnd/clm/test/unit_testers/clm4_5/mock/dyn_subgrid/dynFileMod_mock.F90
A       models/lnd/clm/test/unit_testers/clm4_5/mock/dyn_subgrid/dynUtilsMod_mock.F90
A       models/lnd/clm/test/unit_testers/clm4_5/mock/dyn_subgrid/CMakeLists.txt
A       models/lnd/clm/test/unit_testers/clm4_5/mock/dyn_subgrid
A       models/lnd/clm/test/unit_testers/clm4_5/mock/CMakeLists.txt
A       models/lnd/clm/test/unit_testers/clm4_5/mock
A       models/lnd/clm/test/unit_testers/clm4_5/CMakeLists.txt
A       models/lnd/clm/test/unit_testers/clm4_5/README
A       models/lnd/clm/test/unit_testers/clm4_5
A       models/lnd/clm/test/unit_testers

========= Make a new directory to hold all of the stuff related to dynamic
          subgrid weights. Currently this means transient PFTs, but soon it will
          also mean dynamic landunits. This includes stuff that used to be in
          pftdynMod and dynlandMod, as well as a bit from clm_driver. I have
          added a new driver for the dyn_subgrid stuff (dynSubgridDriverMod),
          and pulled out much of the shared, lower-level functionality into new
          modules (dynTimeInfoMod, dynFileMod, dynVarMod, dynVarTimeInterpMod,
          dynVarTimeUninterpMod, dynUtilsMod [which will soon go away]). In
          addition, I have separated the many routines in pftdynMod into
          separate modules, each with a single, better-defined function.
A       models/lnd/clm/src/clm4_5/dyn_subgrid/dynTimeInfoMod.F90
A       models/lnd/clm/src/clm4_5/dyn_subgrid/dynSubgridDriverMod.F90
A       models/lnd/clm/src/clm4_5/dyn_subgrid/dynHarvestMod.F90
A       models/lnd/clm/src/clm4_5/dyn_subgrid/dynFileMod.F90
A       models/lnd/clm/src/clm4_5/dyn_subgrid/dynConsBiogeochemMod.F90
A       models/lnd/clm/src/clm4_5/dyn_subgrid/dynPriorWeightsMod.F90
A       models/lnd/clm/src/clm4_5/dyn_subgrid/dynVarMod.F90
A       models/lnd/clm/src/clm4_5/dyn_subgrid/dynpftFileMod.F90
A       models/lnd/clm/src/clm4_5/dyn_subgrid/dynVarTimeInterpMod.F90
A       models/lnd/clm/src/clm4_5/dyn_subgrid/dynCNDVMod.F90
A       models/lnd/clm/src/clm4_5/dyn_subgrid/dynConsBiogeophysMod.F90
A       models/lnd/clm/src/clm4_5/dyn_subgrid/dynVarTimeUninterpMod.F90
A       models/lnd/clm/src/clm4_5/dyn_subgrid/dynVarMod.F90.in
A       models/lnd/clm/src/clm4_5/dyn_subgrid/dynVarTimeInterpMod.F90.in
A       models/lnd/clm/src/clm4_5/dyn_subgrid/dynLandunitAreaMod.F90.IN_PROGRESS
A       models/lnd/clm/src/clm4_5/dyn_subgrid/dynUtilsMod.F90
A       models/lnd/clm/src/clm4_5/dyn_subgrid/dynVarTimeUninterpMod.F90.in
A       models/lnd/clm/src/clm4_5/dyn_subgrid/CMakeLists.txt
A       models/lnd/clm/src/clm4_5/dyn_subgrid

========= script to generate files from their .in files using genf90
A       models/lnd/clm/src/clm4_5/dyn_subgrid/do_genf90


========= move check_sums_equal_1 to a new module, partly to reduce dependencies
          of unit tests, and partly because it is cleaner design to have it
          outside of surfrdMod
A       models/lnd/clm/src/clm4_5/main/surfrdUtilsMod.F90

List all existing files that have been modified, and describe the changes:

========= Add dyn_subgrid directory
M       models/lnd/clm/bld/configure

========= Add get_curr_yearfrac function (currently broken, will be fixed in
          next tag)
M       models/lnd/clm/src/util_share/clm_time_manager.F90

========= Change type(file_desc_t) to class(file_desc_t); add 'only' clause to
          use statements to allow compilation with pgi
M       models/lnd/clm/src/util_share/ncdio_pio.F90
M       models/lnd/clm/src/util_share/ncdio_pio.F90.in

========= Change 'use statement' for reworked dyn_subgrid code
M       models/lnd/clm/src/clm4_5/biogeochem/CNEcosystemDynMod.F90

========= Move surfrd_check_urban and surfrd_check_sums_equal_1 to more
          appropriate places
M       models/lnd/clm/src/clm4_5/main/surfrdMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/UrbanInputMod.F90

========= Move some code into dynSubgridDriverMod
M       models/lnd/clm/src/clm4_5/main/clm_initializeMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_driver.F90
           - also remove incorrect header comment

========= Add compute_higher_order_weights routine
M       models/lnd/clm/src/clm4_5/main/initGridCellsMod.F90
M       models/lnd/clm/src/clm4_5/main/reweightMod.F90

========= Add unit testing support
M       models/lnd/clm/src/clm4_5/main/CMakeLists.txt


========= Frankfurt-PGI tests now pass!
M       models/lnd/clm/bld/unit_testers/xFail/expectedClmTestFails.xml

CLM testing:

  build-namelist tests:

    yellowstone: ok

  regular tests (aux_clm):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    frankfurt_intel: ok
    frankfurt_pgi: ok
    frankfurt_nag: ok

  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    yellowstone_intel: ok
    yellowstone_pgi: ok

CLM tag used for the baseline comparisons: clm4_5_57

Changes answers relative to baseline: YES (very limited; see below)

  Can change answers due to the following:

  (1) Changes answers for harvest when a run starts inside the pftdyn timeseries
  but extends beyond it, without an intervening restart (see bug 1899)

  (2) Could theoretically change answers for yellowstone-pgi or hopper-pgi due
  to machines updates, but no changes showed up in the yellowstone test suite
	
===============================================================
===============================================================
Tag name:  clm4_5_57
Originator(s):  sacks (Bill Sacks,UCAR/CSEG,303-497-1762)
Date: Tue Jan  7 14:17:04 MST 2014
One-line Summary: change CNDV water conservation to use the pftdyn method

Purpose of changes:

   For my dynamic landunit work, I was trying to reconcile what's going on with
   prescribed transient PFTs (pftdyn) vs CNDV. The reason is that I'm trying to
   set up an overall control flow for dynamic landunits, and you need to be able
   to run either of these in conjunction with dynamic landunits.

   In doing this, I noticed that water conservation is handled differently for
   pftdyn vs CNDV:

   For pftdyn, water conservation is done as described in section 21.2 of the
   CLM4.5 tech note: water contents are summed before and after transition, and
   the difference is put in the runoff term

   CNDV appears not to use this before & after difference. Instead, it does a
   correction for canopy water in pftdynMod: pftdyn_wbal.

   For dynamic landunits, we're planning to use an approach like what is
   currently done for pftdyn. I think it's going to be messy and confusing to
   try to maintain the current CNDV approach when it's possible to have CNDV in
   conjunction with dynamic landunits.

   Thus, I am changing CNDV to use the pftdyn approach to water conservation,
   whether or not you are running with dynamic landunits. This will change
   answers for CNDV/BGCDV cases in CLM4.5, though I expect the effects to be
   small.

Requirements for tag: N/A

Test level of tag: regular

Bugs fixed (include bugzilla ID):

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: erik; concept approved by Sam Levis

List any svn externals directories updated (csm_share, mct, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Main changes are here; also minor (somewhat related) cleanup: fix some
          section heading comments, add a timer (ndep_interp) - pulling out some
          stuff that used to be (inappropriately) in the pftdynwts timer section
M       models/lnd/clm/src/clm4_5/main/clm_driver.F90

========= Remove a bunch of now-unneeded code, especially from pftdynMod
M       models/lnd/clm/src/clm4_5/main/pftdynMod.F90
M       models/lnd/clm/src/clm4_5/main/clmtypeInitMod.F90
M       models/lnd/clm/src/clm4_5/main/clmtype.F90
M       models/lnd/clm/src/clm4_5/biogeophys/Hydrology1Mod.F90


CLM testing:

  NOTE: Most testing was done from tag cndv_water_conservation_n01_clm4_5_55 -
  up-to-date with clm4_5_55, NOT clm4_5_56. I then updated to clm4_5_56 and
  reran just the three tests that were run for that tag (see its ChangeLog
  entry, below), with comparison to clm4_5_56.

  regular tests (aux_clm):

    yellowstone_intel: OK
    yellowstone_pgi: OK
    frankfurt_intel: OK
    frankfurt_pgi: OK
    frankfurt_nag: OK

  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    yellowstone_intel: OK
    yellowstone_pgi: OK

CLM tag used for the baseline comparisons: clm4_5_55 for most tests, clm4_5_56
for three tests (see above note)

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM45 with DV (CNDV / BGCDV)
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      
      Not investigated, but expected to be larger than roundoff/same climate

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	
===============================================================
===============================================================
Tag name:  clm4_5_56
Originator(s):  sacks (Bill Sacks,UCAR/CSEG,303-497-1762)
Date: Thu Jan  2 09:06:32 MST 2014
One-line Summary: update scripts external to fix I20TRCLM45BGC compset

Purpose of changes: update scripts external to fix I20TRCLM45BGC compset

Requirements for tag: fix bug 1869

Test level of tag: limited (see below)

Bugs fixed (include bugzilla ID): 1869 (I20TRCLM45BGC compset improperly defined)

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: self

List any svn externals directories updated (csm_share, mct, etc.):

   scripts: scripts4_131203 -> scripts4_140102

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes: none

CLM testing:

   ONLY TESTED THE 3 AFFECTED TESTS from the yellowstone & frankfurt aux_clm test suites:

   PASS  PET_P15x2_Lm13.f10_f10.I20TRCLM45BGC.yellowstone_pgi.clm-reduceOutput.GC.140102-060037 
   PASS  ERS_D.f10_f10.I20TRCLM45BGC.frankfurt_pgi.clm-decStart.GC.140102-060448 
   PASS  ERS_Mmpich.f10_f10.I20TRCLM45BGC.frankfurt_nag.clm-decStart.GC.140102-060608 

CLM tag used for the baseline comparisons: clm4_5_55

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: Only I20TRCLM45BGC compsets
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
       
       New climate for this compset: correctly uses CLM4.5 instead of CLM4.0 code.

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	
===============================================================
===============================================================
Tag name:  clm4_5_55
Originator(s):  sacks (Bill Sacks,UCAR/CSEG,303-497-1762)
Date: Fri Dec 27 16:21:45 MST 2013
One-line Summary: add hooks to Sean Santos's unit test framework, and begin to add CLM unit tests

Purpose of changes:

   (1) add hooks to Sean Santos's unit test framework

   (2) begin to add CLM unit tests

   Note: this tag currently does NOT have the CMake utilities that are needed to
   run the unit tests. Instead, the instructions show how to point to a version
   of these in my directory. That's because, as of the time I submitted this tag
   for testing, the necessary working version of the CMake utilities was not yet
   tagged. In the near future, another external could be added to pull in these
   CMake utilities in the CLM directory tree.

Requirements for tag: N/A

Test level of tag: regular

Bugs fixed (include bugzilla ID):

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: self, santos

List any svn externals directories updated (csm_share, mct, etc.):

   tools/unit_testing: added external
   models/csm_share: share3_131101 -> share3_131226 (to get changes needed for building unit tests)

List all files eliminated: None

List all files added and what they do:

========= Set up unit test directories & CMakeLists.txt files, and add unit
          tests for DaylengthMod. Note that the tests themselves are in
          Daylength_test/test_daylength.pf. See the README file for how to run
          the tests
A       models/lnd/clm/test/unit
A       models/lnd/clm/test/unit/clm4_5
A       models/lnd/clm/test/unit/clm4_5/README
A       models/lnd/clm/test/unit/clm4_5/CMakeLists.txt
A       models/lnd/clm/test/unit/clm4_5/mock
A       models/lnd/clm/test/unit/clm4_5/mock/decompMod_boundsTypeDecl.F90
A       models/lnd/clm/test/unit/clm4_5/mock/CMakeLists.txt
A       models/lnd/clm/test/unit/clm4_5/Daylength_test
A       models/lnd/clm/test/unit/clm4_5/Daylength_test/test_daylength.pf
A       models/lnd/clm/test/unit/clm4_5/Daylength_test/CMakeLists.txt

========= Add CMakeLists.txt files that are needed to build unit tests
A       models/lnd/clm/src/clm4_5/main/CMakeLists.txt
A       models/lnd/clm/src/clm4_5/biogeophys/CMakeLists.txt

List all existing files that have been modified, and describe the changes:

========= Remove unneeded 'use' statement, to prevent pulling in more than is
          necessary for the unit test build
M       models/lnd/clm/src/clm4_5/main/clmtype.F90

========= Externals updated - see above
M       SVN_EXTERNAL_DIRECTORIES


CLM testing:

  regular tests (aux_clm):

    yellowstone_intel: OK
    yellowstone_pgi: OK
    frankfurt_intel: OK
    frankfurt_pgi: OK
    frankfurt_nag: OK

  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    yellowstone_intel: OK
    yellowstone_pgi: OK

  Also ran the new unit tests, as per the instructions in
  models/lnd/clm/test/unit/clm4_5/README - all PASS

CLM tag used for the baseline comparisons: clm4_5_54

Changes answers relative to baseline: No

===============================================================
===============================================================
Tag name:  clm4_5_54
Originator(s):  sacks (Bill Sacks,UCAR/CSEG,303-497-1762)
Date: Fri Dec 27 15:55:05 MST 2013
One-line Summary: update externals to cesm1_3_beta06

Purpose of changes:

   Update externals to cesm1_3_beta06 versions.

   However, do NOT update RTM, because the latest version of RTM results in
   failures for ERI _N2 tests.

Requirements for tag: N/A

Test level of tag: regular

Bugs fixed (include bugzilla ID): none

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: not investigated

Code reviewed by: self

List any svn externals directories updated (csm_share, mct, etc.):

   Index: SVN_EXTERNAL_DIRECTORIES
   ===================================================================
   --- SVN_EXTERNAL_DIRECTORIES	(.../trunk_tags/clm4_5_53)	(revision 56268)
   +++ SVN_EXTERNAL_DIRECTORIES	(.../branch_tags/clm_update_externals_cesm1_3_beta06_tags/clm_update_externals_cesm1_3_beta06_n02_clm4_5_53)	(revision 56268)
   @@ -1,25 +1,25 @@
    # CESM scripts, machines and driver
   -scripts                         https://svn-ccsm-models.cgd.ucar.edu/scripts/trunk_tags/scripts4_131126a
   -scripts/ccsm_utils/Machines     https://svn-ccsm-models.cgd.ucar.edu/Machines/trunk_tags/Machines_130930b
   -models/drv                      https://svn-ccsm-models.cgd.ucar.edu/drv/seq_mct/trunk_tags/drvseq5_0_02
   +scripts                         https://svn-ccsm-models.cgd.ucar.edu/scripts/trunk_tags/scripts4_131203
   +scripts/ccsm_utils/Machines     https://svn-ccsm-models.cgd.ucar.edu/Machines/trunk_tags/Machines_131206b
   +models/drv                      https://svn-ccsm-models.cgd.ucar.edu/drv/seq_mct/trunk_tags/drvseq5_0_07
    
    # Model components: Data atmosphere, and stub components as well as land-ice model
   -models/atm/datm                 https://svn-ccsm-models.cgd.ucar.edu/datm7/trunk_tags/datm8_131116
   -models/ocn/socn                 https://svn-ccsm-models.cgd.ucar.edu/stubs/trunk_tags/stubs1_4_03/socn
   -models/ice/sice                 https://svn-ccsm-models.cgd.ucar.edu/stubs/trunk_tags/stubs1_4_03/sice
   -models/glc/sglc                 https://svn-ccsm-models.cgd.ucar.edu/stubs/trunk_tags/stubs1_4_03/sglc
   -models/wav/swav                 https://svn-ccsm-models.cgd.ucar.edu/stubs/trunk_tags/stubs1_4_03/swav
   -models/rof/rtm                  https://svn-ccsm-models.cgd.ucar.edu/rivrtm/trunk_tags/rtm1_0_34 
   -models/glc/cism                 https://svn-ccsm-models.cgd.ucar.edu/glc/trunk_tags/cism1_130924 
   +models/atm/datm                 https://svn-ccsm-models.cgd.ucar.edu/datm7/trunk_tags/datm8_131201
   +models/ocn/socn                 https://svn-ccsm-models.cgd.ucar.edu/stubs/trunk_tags/stubs1_4_04/socn
   +models/ice/sice                 https://svn-ccsm-models.cgd.ucar.edu/stubs/trunk_tags/stubs1_4_04/sice
   +models/glc/sglc                 https://svn-ccsm-models.cgd.ucar.edu/stubs/trunk_tags/stubs1_4_04/sglc
   +models/wav/swav                 https://svn-ccsm-models.cgd.ucar.edu/stubs/trunk_tags/stubs1_4_04/swav
   +models/rof/rtm                  https://svn-ccsm-models.cgd.ucar.edu/rivrtm/trunk_tags/rtm1_0_34
   +models/glc/cism                 https://svn-ccsm-models.cgd.ucar.edu/glc/trunk_tags/cism1_131008
    
    # Utilities: csm_share, esmf, timing, MCT, PIO
   -models/csm_share                https://svn-ccsm-models.cgd.ucar.edu/csm_share/trunk_tags/share3_130918
   +models/csm_share                https://svn-ccsm-models.cgd.ucar.edu/csm_share/trunk_tags/share3_131101
    models/utils/esmf_wrf_timemgr   https://svn-ccsm-models.cgd.ucar.edu/esmf_wrf_timemgr/trunk_tags/esmf_wrf_timemgr_130213
   -models/utils/timing             https://svn-ccsm-models.cgd.ucar.edu/timing/trunk_tags/timing_130506
   +models/utils/timing             https://svn-ccsm-models.cgd.ucar.edu/timing/trunk_tags/timing_131108
    models/utils/mct                https://github.com/quantheory/MCT/tags/compiler_fixes_n03_MCT_2.8.3
   -models/utils/pio                http://parallelio.googlecode.com/svn/trunk_tags/pio1_7_2/pio
   +models/utils/pio                http://parallelio.googlecode.com/svn/trunk_tags/pio1_8_3/pio
    
    # Mapping tools:
   -tools/cprnc                            https://svn-ccsm-models.cgd.ucar.edu/tools/cprnc/trunk_tags/cprnc_130529
   +tools/cprnc                            https://svn-ccsm-models.cgd.ucar.edu/tools/cprnc/trunk_tags/cprnc_131120
    tools/mapping                          https://svn-ccsm-models.cgd.ucar.edu/tools/mapping/trunk_tags/mapping_130716
    models/lnd/clm/tools/shared/gen_domain https://svn-ccsm-models.cgd.ucar.edu/tools/mapping/trunk_tags/mapping_130716/gen_domain_files


List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= NCK tests no longer fail; change fail type of
          ERS_D.f19_g16.IGRCP26CN.frankfurt_pgi from CFAIL to RUN
M       models/lnd/clm/bld/unit_testers/xFail/expectedClmTestFails.xml

CLM testing:

  build-namelist tests:

    yellowstone: OK

  regular tests (aux_clm):

    yellowstone_intel: OK
    yellowstone_pgi: OK
    frankfurt_intel: OK
    frankfurt_pgi: OK
    frankfurt_nag: OK

  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    yellowstone_intel: OK
    yellowstone_pgi: generate only (no baselines from clm4_5_53)

CLM tag used for the baseline comparisons: clm4_5_53

Changes answers relative to baseline: YES, but only for multi-instance

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: Multi-instance
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
        Not investigated, but suspected to be new climate

   Note that NCK tests newly pass (they had been failing), so this answer change
   for multi-instance tests is expected.

   These answer changes show up in the following tests:

   FAIL  CME_N2.f10_f10.I1850CLM45BGC.yellowstone_intel.clm-default.GC.131227-063851.compare_hist.clm4_5_53 
   FAIL  ERI_N2.f19_g16.ICRUCLM45BGCCROP.yellowstone_intel.GC.131227-063851.compare_hist.clm4_5_53 
   FAIL  ERI_N2.f19_g16.ICRUCLM45BGCCROP.yellowstone_intel.clm-default.GC.131227-063851.compare_hist.clm4_5_53 

   FAIL   CME_N2.f10_f10.I1850CLM45BGC.yellowstone_intel.clm-default.compare_hist.clm4_5_53.clm2.h0 
   FAIL   ERI_N2.f19_g16.ICRUCLM45BGCCROP.yellowstone_intel.clm-default.compare_hist.clm4_5_53.clm2.h0 

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	
===============================================================
===============================================================
Tag name:  clm4_5_53
Originator(s):  muszala (Stefan Muszala,UCAR/TSS,303-497-1320)
Date: Thu Dec 19 07:59:56 MST 2013
One-line Summary: refactor restart interfaces

Purpose of changes: Refactor restart interfaces.  Most work done by mvertens.

1) Add two *.F90.in files that use genf90.pl go generate source.  This saves time
   in dev. and maintenence.  If you modify only the *.F90 file, your changes will
   be lost.  Instead modify the *F90.in file, then run genf90.pl on that file.  
   If you have questions, ask a clm developer for help.
2) Restart capability has now been encapsulated in a subroutine call that uses
   Fortran 2003 interfaces over type and dimension.  For example:

-    if (flag == 'define') then
-       call ncd_defvar(ncid=ncid, varname='grainc_storage_to_xfer', xtype=ncd_double,  &
-            dim1name='pft',long_name='grain C shift storage to transfer',units='gC/m2/s')
-    else if (flag == 'read' .or. flag == 'write') then
-       call ncd_io(varname='grainc_storage_to_xfer', data=pcf%grainc_storage_to_xfer, &
-            dim1name=namep, ncid=ncid, flag=flag, readvar=readvar) 
-       if (flag=='read' .and. .not. readvar) then
-           if (is_restart()) call endrun
-       end if       
-    end if
+    call restartvar(ncid=ncid, flag=flag,  varname='grainc_storage_to_xfer', xtype=ncd_double,  &
+         dim1name='pft', &
+         long_name='grain C shift storage to transfer', units='gC/m2/s', &
+         interpinic_flag='interp', readvar=readvar, data=pcf%grainc_storage_to_xfer)

Requirements for tag: N/A

Test level of tag: regular

Bugs fixed (include bugzilla ID): N/A

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: N/A

Describe any changes made to the namelist: N/A

List any changes to the defaults for the boundary data sets: N/A

Describe any substantial timing or memory changes: N/A

Code reviewed by: self, mvertens

List any svn externals directories updated (csm_share, mct, etc.): N/A

List all files eliminated:

! renamed for consistency
D       models/lnd/clm/src/clm4_5/biogeochem/CNrestMod.F90

List all files added and what they do:

A       models/lnd/clm/src/util_share/dtypes.h
A       models/lnd/clm/src/util_share/ncdio_pio.F90.in
A       models/lnd/clm/src/util_share/restUtilMod.F90
A       models/lnd/clm/src/util_share/restUtilMod.F90.in
A       models/lnd/clm/src/clm4_5/biogeochem/CNRestMod.F90

List all existing files that have been modified, and describe the changes:

M       models/lnd/clm/src/util_share/clm_time_manager.F90
M       models/lnd/clm/src/util_share/accumulMod.F90
M       models/lnd/clm/src/util_share/ncdio_pio.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CropRestMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/ch4RestMod.F90
M       models/lnd/clm/src/clm4_5/main/subgridRestMod.F90
M       models/lnd/clm/src/clm4_5/main/histFileMod.F90
M       models/lnd/clm/src/clm4_5/main/restFileMod.F90
M       models/lnd/clm/src/clm4_5/main/initGridCellsMod.F90
M       models/lnd/clm/src/clm4_5/main/clmtype.F90
M       models/lnd/clm/src/clm4_5/biogeophys/BiogeophysRestMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SLakeRestMod.F90

CLM testing:

  regular tests (aux_clm):

    yellowstone_intel - OK
    yellowstone_pgi - OK
    frankfurt_intel - OK
    frankfurt_pgi - OK
    frankfurt_nag - OK

  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    yellowstone_intel - OK

CLM tag used for the baseline comparisons: clm4_5_52

Changes answers relative to baseline: No

===============================================================
===============================================================
Tag name:  clm4_5_52
Originator(s):  sacks (Bill Sacks,UCAR/CSEG,303-497-1762)
Date: Tue Nov 26 22:07:32 MST 2013
One-line Summary: turn on longwave radiation downscaling for glc_mec by default

Purpose of changes: Turn on longwave radiation downscaling for glc_mec by default


Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID):

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: set glcmec_downscale_longwave to true
by default

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: self

List any svn externals directories updated (csm_share, mct, etc.):

   scripts: updated to scripts4_131126a, to get tweaked test list

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Change glcmec_downscale_longwave to true by default
M       models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_5.xml
M       models/lnd/clm/bld/namelist_files/namelist_definition_clm4_5.xml
M       models/lnd/clm/src/clm4_5/main/clm_varctl.F90

========= Remove build-namelist tests that are no longer xFails
M       models/lnd/clm/bld/unit_testers/xFail/expectedClmTestFails.xml

========= Update scripts to scripts4_131126a, to get tweaked test list
M       SVN_EXTERNAL_DIRECTORIES


CLM testing:

  build-namelist tests:

    yellowstone: ok
    frankfurt

  regular tests (aux_clm):

    yellowstone_intel: ok
    yellowstone_pgi: ok
    frankfurt_intel: ok
    frankfurt_pgi: ok
    frankfurt_nag: ok

Expected baseline failures:
FAIL  ERI.f19_g16.IG1850CLM45.yellowstone_pgi.GC.131126-131812.compare_hist.clm4_5_51 
FAIL ERI.f19_g16.IG1850CLM45.yellowstone_pgi.GC.131126-131812.nlcomp

Two BFAILs due to changed tests; I reran them as their old versions and confirmed that answers changed, as expected:
BFAIL ERS_D.f19_g16.ICLM45GLCMEC.yellowstone_intel.clm-glcMEC_changeFlags.GC.131126-131807.compare_hist.clm4_5_51 
BFAIL PEM_D.f19_g16.IG1850CLM45.yellowstone_pgi.clm-glcMEC.GC.131126-214346.compare_hist.clm4_5_51 


  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    yellowstone_intel: ok
    yellowstone_pgi: ok

CLM tag used for the baseline comparisons: clm4_5_51

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM45 with glc_mec (IG compsets)
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
	larger than roundoff; not investigated whether it is same climate or new climate

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	
===============================================================
===============================================================
Tag name:  clm4_5_51
Originator(s):  sacks (sacks)
Date: Tue Nov 26 05:46:29 MST 2013
One-line Summary: rework downscaling of atm fields for glc_mec

Purpose of changes:

A number of changes related to downscaling atm -> clm fields for glc_mec
landunits:

(1) Add new options to downscale precip (division into rain/snow) and longwave
    radiation (developed by Bill Lipscomb). Both are currently off by default.

(2) Move downscaling code out of clm_driverInit into clm_atmlnd.F90 - this is a
    more appropriate module, and is a step towards modularity, because the code
    to deal with the atmospheric forcing fields lives in the same module as the
    definition of these atmospheric forcing fields.

(3) Ensure that all code uses the downscaled, column-level fields where
    possible. Previously, some code (which did not operate over glc_mec
    landunits) used the non-downscaled, gridcell-level version of fields such as
    forc_t. This was a problem because (a) it was confusing and error-prone, and
    (b) we will soon be bringing in code to do downscaling over other landunits
    as well as glc_mec landunits.

(4) To support (3), and make it harder for someone to accidentally use the
    gridcell-level version of a field when they should be using the downscaled,
    column-level version: Broke clm_a2l into two pieces - one containing fields
    that aren't downscaled, and one containing fields that are downscaled. For
    fields that are downscaled, clearly distinguished the non-downscaled
    versions so they couldn't be used by accident.


Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID):

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: None

Describe any changes made to the namelist: For glc_mec runs, added two new
namelist options: glcmec_downscale_rain_snow_convert and
glcmec_downscale_longwave.

List any changes to the defaults for the boundary datasets: None

Describe any substantial timing or memory changes: None

Code reviewed by: erik; portions reviewed by Bill Lipscomb, Mariana, Stefan

List any svn externals directories updated (csm_share, mct, etc.): None

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

========= Significant changes: includes stuff that used to be in
          clm_driverInitMod; added new downscaling code for precip & lwrad;
          split atm2lnd type into two types; reworked initialization interfaces;
          removed unused field rainf, because it currently isn't used and could
          theoretically become inconsistent with the downscaled rain/snow
M       models/lnd/clm/src/clm4_5/main/clm_atmlnd.F90

========= Removed downscaling code from here
M       models/lnd/clm/src/clm4_5/biogeophys/clm_driverInitMod.F90

========= Added call to downscale_forcings
M       models/lnd/clm/src/clm4_5/main/clm_driver.F90

========= Changed interface to init_atm2lnd: previously, clm_initialize used
          clm_a2l from clm_atmlnd and passed it to init_atm2lnd_type (also in
          clm_atmlnd) - there was no reason for this, it was confusing, and to
          some extent broke modularity
M       models/lnd/clm/src/clm4_5/main/clm_initializeMod.F90

========= New parameter
M       models/lnd/clm/src/clm4_5/main/clm_varcon.F90

========= Removed some variables
M       models/lnd/clm/src/clm4_5/main/clmtype.F90
M       models/lnd/clm/src/clm4_5/main/clmtypeInitMod.F90

========= New namelist control variables
M       models/lnd/clm/src/clm4_5/main/clm_varctl.F90
M       models/lnd/clm/src/clm4_5/main/controlMod.F90
M       models/lnd/clm/bld/build-namelist
M       models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_5.xml
M       models/lnd/clm/bld/namelist_files/namelist_definition_clm4_5.xml

========= Removed unused rainf, added pointer to allow lnd_import_export to
          remain identical between clm4_0 and clm4_5 code
M       models/lnd/clm/src/clm4_0/main/clm_atmlnd.F90

========= Fixed test ids for failing build-namelist tests
M       models/lnd/clm/bld/unit_testers/xFail/expectedClmTestFails.xml

========= Minor changes in lots of places to (a) use fields from
          a2l_downscaled_col instead of clm_a2l, and (b) index those fields by
          column rather than by gridcell
M       models/lnd/clm/src/clm4_5/biogeochem/CNFireMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/ch4Mod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/DUSTMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/VOCEmissionMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/DryDepVelocity.F90
M       models/lnd/clm/src/clm4_5/main/clm_glclnd.F90
M       models/lnd/clm/src/clm4_5/main/accFldsMod.F90
M       models/lnd/clm/src/clm4_5/main/filterMod.F90
M       models/lnd/clm/src/clm4_5/main/histFldsMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/BalanceCheckMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SoilTemperatureMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SLakeFluxesMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/Biogeophysics1Mod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SLakeHydrologyMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/Hydrology1Mod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/UrbanMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SLakeTemperatureMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/BareGroundFluxesMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/CanopyFluxesMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/Biogeophysics2Mod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/Hydrology2Mod.F90
M       models/lnd/clm/src/cpl/lnd_comp_esmf.F90
M       models/lnd/clm/src/cpl/lnd_import_export.F90
M       models/lnd/clm/src/cpl/lnd_comp_mct.F90


CLM testing:

  build-namelist tests:

    yellowstone: OK

  regular tests (aux_clm):

    yellowstone_intel: OK
    yellowstone_pgi: OK
    frankfurt_intel: OK
    frankfurt_pgi: OK
    frankfurt_nag: OK

    Note the following expected nlcomp failures:
    FAIL ERS_D.f19_g16.ICLM45GLCMEC.yellowstone_intel.clm-glcMEC.GC.131125-104703.nlcomp
    FAIL ERI.f19_g16.IG1850CLM45.yellowstone_pgi.GC.131125-104751.nlcomp
    FAIL PEM_D.f19_g16.IG1850CLM45.yellowstone_pgi.GC.131125-104751.nlcomp

    Also, there were BFAILs for the following, implying that the baselines
    didn't exist; I'm not too concerned because baseline comparisons passed for
    similar tests:
    BFAIL SMS_Ly1_Mmpich.f19_g16.ICLM45BGCCROP.frankfurt_nag.clm-reduceOutput.GC.131125-104832.compare_hist.clm4_5_50 
    BFAIL ERS_Ly5.f10_f10.I20TRCRUCLM45BGC.yellowstone_intel.clm-monthly_noinitial.GC.131125-104703.compare_hist.clm4_5_50 

  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    yellowstone_intel: OK
    yellowstone_pgi: OK

    As above, baselines were missing for this test:
    BFAIL2 ERS_Ly5.f10_f10.I20TRCRUCLM45BGC.yellowstone_intel.clm-monthly_noinitial.compare_hist.clm4_5_50.clm2.h0 (baseline history file does not exist)
    BFAIL2 ERS_Ly5.f10_f10.I20TRCRUCLM45BGC.yellowstone_intel.clm-monthly_noinitial.compare_hist.clm4_5_50.clm2.h1 (baseline history file does not exist)


CLM tag used for the baseline comparisons: clm4_5_50

Changes answers relative to baseline: NO

===============================================================
===============================================================
Tag name:  clm4_5_50
Originator(s):  erik (Erik)
Date: Sun Nov 24 18:51:11 MST 2013
One-line Summary: Bring in a crop of b4b bugfixes, fix getregional script,
                   start move of PTCLM to PTCLMmkdata tool

Purpose of changes:

Bring in a crop of bit-for-bit bug-fixes to the trunk for November.
Fix the getregional_datasets script and initial move of PTCLM to just
be a CLM tool under models/lnd/clm/tools/shared to create single-point
datasets.

New option to create_newcase "-user_mods_dir" for a directory with
user chagnes such as user_nl_* namelist modification files, xmlchange_cmnds
file with xmlchanges to make, and SourceMods/src.*/* files.

Requirements for tag: bit-for-bit bug-fixes and work on PTCLM

Test level of tag: regular

Bugs fixed (include bugzilla ID):
   1868 (Add user_mods_dir to create_newcase)
   1854 (Remove fndepdat no longer used)
   1842 (Remove unused variables from gridcell type) (Bill)
   1835 (Add write statement to pftdyn so you can see what it is doing)
   1828 (Clarify modulo used in irrigation code) (Bill)
   1770 (Remove sitespf_pt valid_values list for clm4_0)
   1724 (getregional script does NOT work)
   1625 (Problem setting finidat in CLM for RUN_TYPE=hybrid/branch)
   1543 (large-file format does NOT work in latest clm)
   1481 (Provide a more direct way to set a user provided finidat file)
   1437 (problems with link_dirtree -- no longer needed)

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: SourceMods directory on create_newcase

   New -user_mods_dir option to create_newcase that will copy SourceMods/src.*/*
   files to the new case. Also copies user_nl_* files and xmlchange_cmnds

Describe any changes made to the namelist: remove outnc_large_files
   Remove outnc_large_files -- wasn't functional 
   (now always use 64-bit format)
   Remove fndepdat from namelist_definition/defaults no longer used.

List any changes to the defaults for the boundary datasets: None

Describe any substantial timing or memory changes: None

Code reviewed by: self, sacks (fixes for 1842 and 1828)

List any svn externals directories updated (csm_share, mct, etc.): scripts
   scripts updated to scripts4_131119

List all files eliminated: None

List all files added and what they do:

------ Add externals for tools so PTCLM shows up in tool directory
------ Add same files and a README file for getregional
A       models/lnd/clm/tools/SVN_EXTERNAL_DIRECTORIES
A       models/lnd/clm/tools/shared/ncl_scripts/sample_inlist
A       models/lnd/clm/tools/shared/ncl_scripts/sample_outlist
A       models/lnd/clm/tools/shared/ncl_scripts/README.getregional

List all existing files that have been modified, and describe the changes:

------ Get getregional_datasets script working again. Now operates on
------ lists of files.
M       models/lnd/clm/tools/shared/ncl_scripts/getregional_datasets.pl
M       models/lnd/clm/tools/shared/ncl_scripts/getregional_datasets.ncl
M       models/lnd/clm/test/tools/TSMscript_tools.sh --- Copy sample_*list files
M       models/lnd/clm/test/tools/nl_files/getregional - change arguments

------ 
M       models/lnd/clm/tools/clm4_0/interpinic/src/interpinic.F90

------ Remove clm_startfile option and outnc_large_files
M       models/lnd/clm/bld/config_files/config_definition_clm4_0.xml --
          Remove valid_values from sitespf_pt so can be anything.
M       models/lnd/clm/bld/unit_testers/build-namelist_test.pl -- Remove
          clm_startfile option and move some clm4_5 configure options
          to build-namelist
M       models/lnd/clm/bld/build-namelist --- Remove clm_startfile option
          and outnc_large_files
M       models/lnd/clm/bld/clm.buildnml.csh - Remove clm_startfile option
          set finidat/nrevsn like how is done in CAM

------ Remove fndepdat and outnc_large_files
M       models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_0.xml
M       models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_0_tools.xml
M       models/lnd/clm/bld/namelist_files/namelist_definition_clm4_0.xml
M       models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_5.xml
M       models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_5_tools.xml
M       models/lnd/clm/bld/namelist_files/namelist_definition_clm4_5.xml

M       models/lnd/clm/src/clm4_5/main/clmtypeInitMod.F90 -------- Remove
         some gridcell variables not sued
M       models/lnd/clm/src/clm4_5/main/pftdynMod.F90 ------------- write
         on what's going on
M       models/lnd/clm/src/clm4_5/main/controlMod.F90 ------------ Remove
         outnc_large_files
M       models/lnd/clm/src/clm4_5/main/clmtype.F90 --------------- Remove
         a bunch of gridcell variables not needed
M       models/lnd/clm/src/clm4_5/biogeophys/CanopyFluxesMod.F90 - Add
         seconds_since_irrig_start_time temporary to clarify

------ 
M       models/lnd/clm/src/clm4_0/main/pftdynMod.F90 --- add some writes statements
M       models/lnd/clm/src/clm4_0/main/controlMod.F90 -- remove outnc_large_files

CLM testing:

  build-namelist tests:

    yellowstone yes
    frankfurt   no

  NOTE: there were some tests that were passing but in the xFail list
        from before clm4_5_49 that I marked as working.

  regular tests (aux_clm):

    yellowstone_intel yes
    yellowstone_pgi   yes
    frankfurt_intel   yes
    frankfurt_pgi     yes
    frankfurt_nag     yes

  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    yellowstone_intel yes
    yellowstone_pgi   yes

  tools testing:

    yellowstone interactive yes

CLM tag used for the baseline comparisons:  clm4_5_49

Changes answers relative to baseline: no bit-for-bit

===============================================================
===============================================================
Tag name:  clm4_5_49
Originator(s):  muszala (Stefan Muszala)
Date: Sat Nov 16 07:51:27 MST 2013
One-line Summary: Swenson anomaly forcing - Part 1

purpose of changes:
   add additional data streams to modify existing
   data streams for purposes such as bias correction or specifying 
   future changes relative to baseline data streams, e.g. specifying
   future atmospheric forcing anomalies when running CLM with data atmosphere. 
   Paired with datm8_131115.

   For what to set in user_nl_cpl, user_nl_datm, see testing section.

   This is part 1 of 2.  Part 2 will address a general way to handle
   streams in the DATM that is triggered off of an AF compset.

Requirements for tag: N/A

Test level of tag: regular

Bugs fixed (include bugzilla ID): N/A

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: N/A

Describe any changes made to the namelist: N/A

List any changes to the defaults for the boundary datasets: N/A

Describe any substantial timing or memory changes: N/A

Code reviewed by: swenson, kluzek, self

List any svn externals directories updated (csm_share, mct, etc.): update to datm8_131116

List all files eliminated:  N/A

List all files added and what they do: N/A

List all existing files that have been modified, and describe the changes:

M       models/lnd/clm/src/clm4_5/main/clm_atmlnd.F90
M       models/lnd/clm/src/clm4_0/main/clm_atmlnd.F90
M       models/lnd/clm/src/cpl/clm_cpl_indices.F90
M       models/lnd/clm/src/cpl/lnd_import_export.F90
M       SVN_EXTERNAL_DIRECTORIES

CLM testing:

Testing for features of this tag: f09_g16, ICRUCLM45

anomaly forcing namelists
   user_nl_cpl: cplflds_custom = 'Sa_prec_af->a2x', 'Sa_prec_af->x2l','Sa_tbot_af->a2x',
           'Sa_tbot_af->x2l','Sa_pbot_af->a2x', 'Sa_pbot_af->x2l','Sa_shum_af->a2x',
           'Sa_shum_af->x2l','Sa_u_af->a2x', 'Sa_u_af->x2 l','Sa_v_af->a2x',
           'Sa_v_af->x2l','Sa_swdn_af->a2x', 'Sa_swdn_af->x2l','Sa_lwdn_af->a2x',
           'Sa_lwdn_af->x2l'
   user_nl_datm: anomaly_forcing = 'Anomaly.Forcing.Precip','Anomaly.Forcing.Temperature',
            'Anomaly.Forcing.Pressure','Anomaly.Forcing.Humidity','Anomaly.Forcing.Uwind',
            'Anomaly.Forcing.Vwind','Anomaly.Forcing.Shortwave','Anomaly.Forcing.Longwave'
bias correction namelists
   user_nl_cpl: cplflds_custom = 'Sa_precsf->a2x', 'Sa_precsf->x2l'
   user_nl_datm: bias_correct = 'BC.CRUNCEP.GPCP.Precip' 

  build-namelist tests: N/A

  regular tests (aux_clm):

    yellowstone_intel - OK 
    yellowstone_pgi - OK 
    frankfurt_intel - OK
    frankfurt_pgi - OK
    frankfurt_nag - OK

  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    yellowstone_intel - OK

CLM tag used for the baseline comparisons:  clm4_5_48

Changes answers relative to baseline: No

===============================================================
===============================================================
Tag name:  clm4_5_48
Originator(s):  muszala (Stefan Muszala)
Date: Thu Nov 14 08:28:31 MST 2013
One-line Summary: bug fixes for CLM dry deposition and MEGAN VOC emissions

Purpose of changes: Bring in bug fixes from fvitt for CLM dry deposition and MEGAN VOC emissions.  Any changes
   to answers are limited to rare circumstances.

Requirements for tag: N/A

Test level of tag: regular

Bugs fixed (include bugzilla ID): N/A

Known bugs (include bugzilla ID): N/A
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: N/A

Describe any changes made to the namelist: N/A

List any changes to the defaults for the boundary datasets: N/A

Describe any substantial timing or memory changes: N/A

Code reviewed by: fvitt, self

List any svn externals directories updated (csm_share, mct, etc.): N/A

List all files eliminated: N/A

List all files added and what they do: N/A

List all existing files that have been modified, and describe the changes:

M       models/lnd/clm/src/clm4_5/biogeochem/VOCEmissionMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/DryDepVelocity.F90
M       models/lnd/clm/src/clm4_0/biogeochem/VOCEmissionMod.F90
M       models/lnd/clm/src/clm4_0/biogeochem/DryDepVelocity.F90

CLM testing:

  build-namelist tests: N/A

  regular tests (aux_clm):

    yellowstone_intel - OK
    yellowstone_pgi - OK
    frankfurt_intel - OK
    frankfurt_pgi - OK
    frankfurt_nag - OK

  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    yellowstone_intel - OK

CLM tag used for the baseline comparisons:  clm4_5_47

Changes answers relative to baseline:  Answers change for some of the chemistry configurations, but 
   these changes will not be see in the CLM standalone tests.

===============================================================
===============================================================
Tag name:  clm4_5_47
Originator(s):  muszala (Stefan Muszala)
Date: Tue Nov 12 09:26:20 MST 2013
One-line Summary: fix Bug 1858 - AGDD now reset annually

Purpose of changes: Fix bug 1858.  AGDD is now reset annually.  Replace -99999_r8 with a 
   parameter in accumulMod.F90 which is used in accFldsMod.F90

Requirements for tag: N/A

Test level of tag: regular

Bugs fixed (include bugzilla ID): 1858

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: N/A

Describe any changes made to the namelist: N/A

List any changes to the defaults for the boundary datasets: N/A

Describe any substantial timing or memory changes: N/A

Code reviewed by: slevis, sacks, muszala

List any svn externals directories updated (csm_share, mct, etc.): N/A

List all files eliminated: N/A

List all files added and what they do: N/A

List all existing files that have been modified, and describe the changes:

M       models/lnd/clm/src/util_share/accumulMod.F90
M       models/lnd/clm/src/clm4_5/main/accFldsMod.F90

CLM testing:

  build-namelist tests: N/A

  regular tests (aux_clm):

    yellowstone_intel - OK
    yellowstone_pgi - OK
    frankfurt_intel - OK
    frankfurt_pgi - OK
    frankfurt_nag - OK

  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    yellowstone_intel - OK

CLM tag used for the baseline comparisons:  clm4_5_46

Changes answers relative to baseline: Generally, No.  There may be changes
  in DV compsets over very long simulation times and at very high resolutions.

===============================================================
===============================================================
Tag name:  clm4_5_46
Originator(s):  sacks (sacks)
Date: Fri Nov  8 17:26:02 MST 2013
One-line Summary: remove zeroing out of slope for special landunits

Purpose of changes:

   Previously, there was code to zero out slope for grid cells with 100% special
   landunits. However, there were a number of problems with this:

   (1) With dynamic landunits, this is problematic, because a grid cell could
   start as 100% special landunits, then later become < 100% special landunits
   (e.g., due to retreating glaciers)

   (2) Moreover, why should the slope of a special landunit depend on whether
   the grid cell has 100% special landunits. This seems to be saying that, e.g.,
   the slope of a glacier landunit depends on whether the grid cell is entirely
   glacier or part glacier and part natural veg.

   (3) And I guess moreover, why is the slope zeroed out for special landunits
   in the first place?


   From talking with Erik, we decided thish code was probably a relic from a
   time when the surface dataset had some bad values (e.g., over Greenland /
   Antarctica). This is no longer the case, so this code is no longer needed.

Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID):

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: erik

List any svn externals directories updated (csm_share, mct, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

M       models/lnd/clm/src/clm4_5/main/iniTimeConst.F90

CLM testing:

  regular tests (aux_clm):

    yellowstone_intel: OK
    yellowstone_pgi: OK
    frankfurt_intel: OK
    frankfurt_pgi: OK
    frankfurt_nag: OK

    Following are the baseline failures, which are expected (see below):

FAIL  SMS_D.1x1_mexicocityMEX.ICLM45.frankfurt_intel.clm-default.GC.131107-223431.compare_hist.clm4_5_45 
FAIL  SMS_D.1x1_vancouverCAN.ICLM45.frankfurt_pgi.clm-default.GC.131107-223435.compare_hist.clm4_5_45 
FAIL  ERS_Mmpi-serial.1x1_mexicocityMEX.I1PTCLM45.frankfurt_nag.clm-default.GC.131107-223439.compare_hist.clm4_5_45 
FAIL  SMS_D_Mmpi-serial.1x1_vancouverCAN.I1PTCLM45.frankfurt_nag.clm-default.GC.131107-223439.compare_hist.clm4_5_45 
FAIL  ERI.f09_g16.ICLM45BGC.yellowstone_intel.GC.131107-223256.compare_hist.clm4_5_45 
FAIL  ERI_D.f09_g16.ICLM45BGC.yellowstone_intel.GC.131107-223256.compare_hist.clm4_5_45 
FAIL  ERI_D.ne30_g16.ICLM45BGC.yellowstone_intel.GC.131107-223256.compare_hist.clm4_5_45 
FAIL  ERS_Lm3.1x1_vancouverCAN.I1PTCLM45.yellowstone_intel.clm-default.GC.131107-223256.compare_hist.clm4_5_45 
FAIL  SMS.1x1_mexicocityMEX.I1PTCLM45.yellowstone_intel.clm-default.GC.131107-223256.compare_hist.clm4_5_45 
FAIL  ERI.f09_g16.I1850CRUCLM45BGC.yellowstone_pgi.GC.131107-223301.compare_hist.clm4_5_45 
FAIL  ERI.f09_g16.ICLM45BGC.yellowstone_pgi.GC.131107-223301.compare_hist.clm4_5_45 
FAIL  ERI_D.f09_g16.ICLM45BGC.yellowstone_pgi.GC.131107-223301.compare_hist.clm4_5_45 


  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    yellowstone_intel: OK
    yellowstone_pgi: OK

    Following are the baseline failures, which are expected:

FAIL   ERS_Lm3.1x1_vancouverCAN.I1PTCLM45.yellowstone_intel.clm-default.compare_hist.clm4_5_45.clm2.h0 
FAIL   ERS_Lm3.1x1_vancouverCAN.I1PTCLM45.yellowstone_intel.clm-default.compare_hist.clm4_5_45.clm2.h1 
FAIL   SMS.1x1_mexicocityMEX.I1PTCLM45.yellowstone_intel.clm-default.compare_hist.clm4_5_45.clm2.h0 
FAIL   SMS.1x1_mexicocityMEX.I1PTCLM45.yellowstone_intel.clm-default.compare_hist.clm4_5_45.clm2.h1 


CLM tag used for the baseline comparisons: clm4_5_45

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: Any configuration that includes a grid cell that
      has 100% special landunits, including at least some urban
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 

      Not investigated carefully, but expected to be larger than roundoff/same
      climate - since this only affects a very small number of grid cells, and
      (I believe) only the urban pervious road in those grid cells

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	
===============================================================
===============================================================
Tag name:  clm4_5_45
Originator(s):  sacks (sacks)
Date: Fri Nov  8 16:10:22 MST 2013
One-line Summary: refactor daylength calculation, and other minor changes

Purpose of changes:

   (1) Compute daylength in a single place, and compute necessary variables at
   initialization rather than having them on the restart file

   (2) Compute daylength-related variables at initialization rather than having
   them on the restart file, both to clean things up and to fix some daylength
   bugs at initialization (these bugs were fixed in a kludgey way in clm4_5_44,
   and now are fixed robustly)

   (3) Fix daylength calculation at the poles (previously blew up due to
   roundoff errors) (doesn't change behavior currently, but could change
   behavior / answers if there were a vegetated landunit at the pole)

   (4) Fix sminn on restart, so that crop restarts can be bfb (bug 1846)

   (5) Add all_active namelist variable that makes even 0-weight points active,
   for testing purposes

Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID):

   - 1846 (crop restarts aren't exact due to sminn field)

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: add all_active namelist variable

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: (1) & (2) reviewed by erik, (3) by self

List any svn externals directories updated (csm_share, mct, etc.):

   scripts: update from scripts4_131030 -> scripts4_131107a

List all files eliminated: none

List all files added and what they do:

========= Compute daylength in a single place
A       models/lnd/clm/src/clm4_5/biogeophys/DaylengthMod.F90

List all existing files that have been modified, and describe the changes:

========= Refactor daylength calculation to just compute daylength in a single,
          central place, and compute necessary variables at initialization
          rather than having them on the restart file
M       models/lnd/clm/src/clm4_5/biogeochem/CNPhenologyMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNrestMod.F90
           - also fix sminn on restart (bug 1846)
M       models/lnd/clm/src/clm4_5/biogeochem/CNSetValueMod.F90
M       models/lnd/clm/src/clm4_5/main/CNiniTimeVar.F90
M       models/lnd/clm/src/clm4_5/main/clm_initializeMod.F90
M       models/lnd/clm/src/clm4_5/main/clmtypeInitMod.F90
M       models/lnd/clm/src/clm4_5/main/iniTimeConst.F90
M       models/lnd/clm/src/clm4_5/main/initSurfAlbMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_driver.F90
M       models/lnd/clm/src/clm4_5/main/clmtype.F90
M       models/lnd/clm/src/clm4_5/main/histFldsMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/CanopyFluxesMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SurfaceAlbedoMod.F90

========= Add all_active namelist variable that makes even 0-weight points
          active, for testing purposes
M       models/lnd/clm/bld/namelist_files/namelist_definition_clm4_5.xml
M       models/lnd/clm/src/clm4_5/main/clm_varctl.F90
M       models/lnd/clm/src/clm4_5/main/controlMod.F90
M       models/lnd/clm/src/clm4_5/main/reweightMod.F90


========= Add & remove tests from xFail list
M       models/lnd/clm/bld/unit_testers/xFail/expectedClmTestFails.xml

*** No longer tested (replaced by CME_Ly4)
-               <entry testId="CME_Ly5.f10_f10.I1850CLM45BGC.yellowstone_intel.clm-default" failType="RUN">Runs out of time. CME_Ly4.f10_f10.I1850CLM45BGC.yellowstone_intel.clm-monthly passes</entry>

*** Now passes
-               <entry testId="ERS_Ly5.f10_f10.ICLM45BGCCROP.yellowstone_intel.clm-irrigOn_reduceOutput" failType="FAIL" bugz="1846" >restarts not exact due to bug 1846: crop restarts are not exact due to sminn field</entry>

+               <entry testId="NCK.f10_f10.ICRUCLM45.yellowstone_intel"                    failType="FAIL"  bugz="1860">Diffs in cpl log files in rofl, rofi and volr</entry>
+               <entry testId="NCK.f10_f10.I.yellowstone_pgi"                              failType="FAIL"  bugz="1860">Diffs in cpl log files in rofl, rofi and volr</entry>


CLM testing:

  build-namelist tests:

    yellowstone: OK

  regular tests (aux_clm):

    yellowstone_intel: OK
    yellowstone_pgi: OK
    frankfurt_intel: OK
    frankfurt_pgi: OK
    frankfurt_nag: OK

    Note that we get the following failures in compare_hist:

    FAIL  PET_P15x2_Lm25.f10_f10.ICLM45BGCDVCROP.yellowstone_intel.clm-reduceOutput.GC.131107-214732.compare_hist.clm4_5_44 
    FAIL  PET_P15x2_Ly3.f10_f10.ICLM45BGCCROP.yellowstone_intel.clm-irrigOn_reduceOutput.GC.131107-214732.compare_hist.clm4_5_44 

    However, I think that's expected due to the oddities in the clm4_5_44 tag
    with openmp - see notes in the ChangeLog for clm4_5_44 for details. Note
    that this one is identical to clm4_5_43, suggesting that clm4_5_45 undoes
    the problem introduced in clm4_5_44:

    PASS   PET_P15x2_Lm25.f10_f10.ICLM45BGCDVCROP.yellowstone_intel.clm-reduceOutput.compare_hist.clm4_5_43.cpl.hi 


  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    yellowstone_intel: OK
    yellowstone_pgi: OK

    In particular, note that the clm hist comparison passes for the two above
    tests that had unexpected cpl diffs:

    PASS   PET_P15x2_Lm25.f10_f10.ICLM45BGCDVCROP.yellowstone_intel.clm-reduceOutput.compare_hist.clm4_5_44.clm2.h0 
    PASS   PET_P15x2_Ly3.f10_f10.ICLM45BGCCROP.yellowstone_intel.clm-irrigOn_reduceOutput.compare_hist.clm4_5_44.clm2.h0 


CLM tag used for the baseline comparisons: clm4_5_44

Changes answers relative to baseline: NO

===============================================================
===============================================================
Tag name:  clm4_5_44
Originator(s):  sacks (sacks)
Date: Fri Nov  8 08:19:56 MST 2013
One-line Summary: temporary hack to daylength initialization to provide baselines for the next tag

Purpose of changes:

   The next tag (clm4_5_45) involves a major refactor to the daylength
   calculation. That refactor is bfb in most respects, but gives differences in
   the first time step in a few situations.

   This tag (clm4_5_44) does the minimal changes needed to get the same results
   as clm4_5_45, in order to have more confidence when testing clm4_5_45. 

   Note that the changes here are a kludge that will be reverted in clm4_5_45.

Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID):

   1850 (incorrect daylength in first timestep of some runs)

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: self

List any svn externals directories updated (csm_share, mct, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

M       models/lnd/clm/src/clm4_5/main/clm_initializeMod.F90

CLM testing:

  build-namelist tests:

    yellowstone: OK

  regular tests (aux_clm):

    yellowstone_intel: OK
    yellowstone_pgi: OK
    frankfurt_intel: OK
    frankfurt_pgi: OK
    frankfurt_nag: OK

    There were a number of expected compare_hist failures, as described below.

    There was one unexpected compare_hist failure:
    FAIL  PET_P15x2_Lm25.f10_f10.ICLM45BGCDVCROP.yellowstone_intel.clm-reduceOutput.GC.145424.compare_hist.clm4_5_43 

    Diffs are just in voc cpl fields. CLM hist files are identical at the end of
    the run. An SMS version of this test passes. Interestingly, the kludgey code
    that I have added for clm4_5_44 isn't even executed in this test... so the
    only diffs should be in variable declarations and 'use' statements. And
    clm4_5_45 (which I will tag soon) gives identical cpl hist files to
    clm4_5_43. So there may just be a compiler fluke in the compilation of this
    tag with openmp enabled. Because clm4_5_45 will give identical results to
    clm4_5_43, I'm not worrying about this.


  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    yellowstone_intel: OK
    yellowstone_pgi: OK

    A number of expected compare_hist failures, as described below.

CLM tag used for the baseline comparisons: clm4_5_43

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM45 with BGC (and probably CN), involving
      either (a) initial conditions interpolated from a different resolution, or
      (b) a change in start date relative to the ref date of an initial file
      (which shows up in ERI tests) - see bug 1850
    - what platforms/compilers: ALL
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
        Not investigated carefully, but almost certainly larger than
        roundoff/same climate, since this code mod just changes things in the
        first timestep.

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	
===============================================================
===============================================================
Tag name:  clm4_5_43
Originator(s):  sacks (Bill Sacks,UCAR/CSEG,303-497-1762)
Date: Wed Nov  6 09:21:25 MST 2013
One-line Summary: allocate memory for most landunits in every grid cell (needed for dynamic landunits)

Purpose of changes:

   Main change is to allocate memory for most landunits in every grid cell, to
   support dynamic landunits. Note that we ALWAYS do this extra memory
   allocation, so that the user isn't required to do interpinic between a
   non-dynamic run and a dynamic landunit run. (If we eventually change the
   restart file format / processing so that you can add / remove 0-weight points
   at will, then we could potentially add some logic to only do this extra
   allocation if we're using dynamic landunits.)

   Supporting changes are (1) determining which grid cells have enough parameter
   data to support urban landunits, (2) new initial conditions files, (3) in
   mksurfdata_map, don't set soil parameters to 0 under glacier, and set urban
   parameters even if urban cover is 0%

   Other changes are:

   (1) only do snow balance check over active columns

   (2) fix interpinic bug (bug 1839)

   (3) newer files for testing interpinic


   NOTE: All CLM4.5 initial conditions will need to be interpinic'ed to be
   usable in this tag (this has been done for all out-of-the-box initial
   conditions)

Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID):

   - 1839 (interpinic uses wrong column when there are 0-weight columns in the
     input file)

   - 1840 (snow balance check is executed over inactive columns)

   - 1825 (surface datasets need urban parameters even when pcturb is 0
     everywhere): partial fix - still waiting on new USUMB dataset

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: new initial conditions for CLM4.5

List any changes to the defaults for the boundary datasets: new initial
conditions for CLM4.5

Describe any substantial timing or memory changes:

   Significant memory increases for all CLM4.5 configurations - memory is now
   allocated for all natural veg landunits, all crop landunits (if using
   create_crop_landunit), and most urban landunits.

   Also, significant performance decrease (~ 10%) associated with the above
   change, which I believe is mainly due to decreased cache friendliness.

Code reviewed by: self

List any svn externals directories updated (csm_share, mct, etc.): none

List all files eliminated:

========= Change files used for testing interpinic, in order to use files that
          are up-to-date with the current version of CLM, for a more accurate test
D       models/lnd/clm/tools/clm4_5/interpinic/clmi.I2000CLM45BGC.2000-01-01.10x15_simyr2000_c130607.nc

List all files added and what they do:

========= Change files used for testing interpinic, in order to use files that
          are up-to-date with the current version of CLM, for a more accurate test
A       models/lnd/clm/tools/clm4_5/interpinic/clmi.I2000CLM45BGC.2000-01-01.10x15_simyr2000_c131104.nc

List all existing files that have been modified, and describe the changes:

========= Determine which grid cells should have urban landunits
M       models/lnd/clm/src/clm4_5/main/clm_initializeMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_varsur.F90
M       models/lnd/clm/src/clm4_5/main/surfrdMod.F90

========= Create a natural veg landunit and crop landunit in all grid cells;
          create an urban landunit in all grid cells for which we have
          determined that urban is "valid"
M       models/lnd/clm/src/clm4_5/main/subgridMod.F90

========= Change a comment
M       models/lnd/clm/src/clm4_5/biogeophys/BiogeophysRestMod.F90

========= Only do snow balance check over active columns (fixes bug 1840)
M       models/lnd/clm/src/clm4_5/biogeophys/BalanceCheckMod.F90

========= Use new initial conditions files that are consistent with the expanded
          1-d memory structures
M       models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_5.xml

========= Don't set soil parameters to 0 under glacier; set urban parameters
          even if urban cover is 0%
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/mksoilMod.F90
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/mksurfdat.F90

========= Fix interpinic bug (bug 1839)
M       models/lnd/clm/tools/clm4_5/interpinic/src/interpinic.F90

========= Change files used for testing interpinic, in order to use files that
          are up-to-date with the current version of CLM, for a more accurate test
M       models/lnd/clm/tools/clm4_5/interpinic/interpinic.runoptions


========= Add two tests to the xFail list
M       models/lnd/clm/bld/unit_testers/xFail/expectedClmTestFails.xml

+               <entry testId="CME_Ly5.f10_f10.I1850CLM45BGC.yellowstone_intel.clm-default" failType="RUN">Runs out of time. CME_Ly4.f10_f10.I1850CLM45BGC.yellowstone_intel.clm-monthly passes</entry>
+               <entry testId="SMS_D_Lm1_Mmpi-serial.CLM_USRDAT.I1PTCLM45.yellowstone_pgi.clm-USUMB" failType="FAIL" bugz="1825"> Needs new surface dataset</entry>


CLM testing:

NOTE: main tests were done with
dynlu_allocate_memory_n11_fix_cndv_time_averages_n01_clm4_5_41; tools tests with
dynlu_allocate_memory_n12_clm4_5_42; build-namelist tests with a slightly older
tag

  build-namelist tests:

    yellowstone: OK. However, the "correct" comparisons are spurious, because I
    think the build-namelist test is broken

  regular tests (aux_clm):

    yellowstone_intel: OK
    yellowstone_pgi: OK
    frankfurt_intel: OK
    frankfurt_pgi: OK
    frankfurt_nag: OK

  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    yellowstone_intel: OK
    yellowstone_pgi: OK

  tools testing:

    yellowstone interactive: OK

   *** Expected failures
   027 smiS4 TSMscript_tools.sh shared ncl_scripts getregional_datasets.pl getregional .............\c
    rc=6 FAIL
   028 bliS4 TBLscript_tools.sh shared ncl_scripts getregional_datasets.pl getregional .............\c
    rc=4 FAIL


   *** Expected baseline failure (uses new input & output file, and there is a non-bfb change in interpinic)
   016 blh54 TBLtools.sh clm4_5 interpinic tools__ds runoptions ....................................\c
    rc=7 FAIL

   *** Expected diffs in PCT_SAND, PCT_CLAY, SOIL_COLOR
   012 blg54 TBLtools.sh clm4_5 mksurfdata_map tools__s namelist ...................................\c
    rc=7 FAIL
   020 bli24 TBLscript_tools.sh clm4_5 mksurfdata_map mksurfdata.pl mksrfdt_T31_crpglc_2000^tools__ds \c
    rc=7 FAIL
   022 bli53 TBLscript_tools.sh clm4_5 mksurfdata_map mksurfdata.pl mksrfdt_10x15_1850^tools__o ....\c
    rc=7 FAIL
   024 bli54 TBLscript_tools.sh clm4_5 mksurfdata_map mksurfdata.pl mksrfdt_10x15_1850^tools__ds ...\c
    rc=7 FAIL
   026 bli57 TBLscript_tools.sh clm4_5 mksurfdata_map mksurfdata.pl mksrfdt_10x15_1850^tools__do ...\c
    rc=7 FAIL

   *** Expected diffs in urban fields
   030 bli74 TBLscript_tools.sh clm4_5 mksurfdata_map mksurfdata.pl mksrfdt_1x1_brazil_1850-2000^tools_\c
    rc=7 FAIL
   032 bliT4 TBLscript_tools.sh clm4_5 mksurfdata_map mksurfdata.pl mksrfdt_1x1_numaIA_mp24_2000^tools_\c
    rc=7 FAIL


CLM tag used for the baseline comparisons: clm4_5_42

Changes answers relative to baseline: NO - but see note below:

   NOTE: This tag has the potential to change answers for cases using initial
   conditions that were interpinic'ed using the out-of-the-box interpinic,
   because of bugs in interpinic. This applies to CLM4.5 cases @ ne30 and hcru
   resolutions, as well as CLM4.5 cases using DV @ f09. However, no diffs showed
   up in the test suite, so it's possible that this isn't a problem.

===============================================================
===============================================================
Tag name:  clm4_5_42
Originator(s):  sacks (Bill Sacks,UCAR/CSEG,303-497-1762)
Date: Mon Nov  4 09:45:36 MST 2013
One-line Summary: fix bug 1857 for CLM4.5 - CNDV running temperature means are incorrect

Purpose of changes:

   Fix bug 1857 for CLM4.5 (not yet fixed for CLM4.0!). From the bugzilla entry:

   In this code in CNDVMod:

       do p = bounds%begp, bounds%endp
          g = pft%gridcell(p)
          if (kyr == 2) then ! slevis: add ".and. start_type==arb_ic" here?
             tmomin20(g) = t_mo_min(p) ! NO, b/c want to be able to start dgvm
             agdd20(g) = agdd(p)       ! w/ clmi file from non-dgvm simulation
          end if
          tmomin20(g) = (19._r8 * tmomin20(g) + t_mo_min(p)) / 20._r8
          agdd20(g)   = (19._r8 * agdd20(g)   + agdd(p)    ) / 20._r8
       end do

   Notice that this is a loop over p, but it's updating gridcell-level variables.
   This means that the running temperature means aren't at all what they purport
   to be. e.g., in a grid cell with the 17 natural PFTs and nothing else, the grid
   cell-level values will get the 17 pft values averaged in each year, rather than
   getting a single pft value per year. This means that these temperature
   variables are closer to a single year's value than to a running mean.

   The fix here should be simple: just change tmomin20 & agdd20 to pft-level
   variables.

   
   WARNING: USE CAUTION WHEN USING THIS TAG WITH AN OLDER RESTART FILE FROM A
   CLM4.5 DV CASE (this is not a problem for any out-of-the-box initial
   conditions files, but could apply if you have your own initial file from a DV
   run): In this case, the two DV-related variables AGDD20 and TMOMIN20 will be
   reset to their arbitrary initial conditions.


Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID): 
   1857 - partial fix (still open for clm4.5)

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: self

List any svn externals directories updated (csm_share, mct, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

M       models/lnd/clm/src/clm4_5/biogeochem/CNDVMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNrestMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNDVEcosystemDynIniMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNDVEstablishmentMod.F90
M       models/lnd/clm/src/clm4_5/main/clmtypeInitMod.F90
M       models/lnd/clm/src/clm4_5/main/clmtype.F90

========= Remove SSP compare_hist BFAIL from xFAIL list (Ben fixed this in the last tag)
M       models/lnd/clm/bld/unit_testers/xFail/expectedClmTestFails.xml

CLM testing:

  regular tests (aux_clm):

    yellowstone_intel: OK
    yellowstone_pgi: OK
    frankfurt_intel: OK
    frankfurt_pgi: OK
    frankfurt_nag: OK

    All baseline comparisons pass except the following expected failure:
	FAIL  PET_P15x2_Lm25.f10_f10.ICLM45BGCDVCROP.yellowstone_intel.clm-reduceOutput.GC.104252.compare_hist.clm4_5_41 

  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    yellowstone_intel: OK
    yellowstone_pgi: OK

    All baseline comparisons pass except the following expected failure:
       FAIL   PET_P15x2_Lm25.f10_f10.ICLM45BGCDVCROP.yellowstone_intel.clm-reduceOutput.compare_hist.clm4_5_41.clm2.h0 

CLM tag used for the baseline comparisons: clm4_5_41

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM4.5 with DV
    - what platforms/compilers: ALL
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
      
      Definitely larger than roundoff, but not investigated as to whether it's
      same climate or new climate.

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	
===============================================================
===============================================================
Tag name:  clm4_5_41
Originator(s):  andre (Benjamin Andre,LAWRENCE BERKELEY NATIONAL LABORATORY,510-486-4617)
Date: Wed Oct 30 17:33:16 MDT 2013
One-line Summary: update scripts to convert clm4_5 CPP flags to namelist variables.

Purpose of changes: Convert clm4_5 CPP flags in controlMod.F90
	into namelist variables, update scripts infrastructure
	to generate cases with namelist variables for bgc
	(CN, CNDV, methane, vsoilc_centbgc), crop, extra lake layers,
	vic, nofire, noio, sitespf_pt, snicarfrc, maxpatch_pft.

Requirements for tag:

Test level of tag: regular, tools, build_namelist

Bugs fixed (include bugzilla ID): 1728 (scripts4_20131030 tag). 1770 (clm4_5 portion).

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: removed clm4_5 CPP flags:
    NOFIRE, LCH4, NITRIF, VERTSOILC, EXTRALAKELAYERS, VICHYDRO, CENTURY, CN, 
    CNDV, CROP, SNICAR, VANCOUVER, NOIO, MEXICOCITY

Describe any changes made to the namelist: added namelist variables:

    use_nofire, use_lch4, use_nitrif_denitrif, use_vertsoilc, use_extralakelayers,
    use_vichydro, use_century_decomp, use_cn, use_cndv, use_crop, use_snicar_frc,
    use_vancouver, use_mexicocity, use_noio

    All new namelist variables are logicals.

List any changes to the defaults for the boundary datasets: N/A

Describe any substantial timing or memory changes: N/A

Code reviewed by: Erik Kluzek, Bill Sacks

List any svn externals directories updated (csm_share, mct, etc.): scripts4_131030

List all files eliminated:
D       models/lnd/clm/bld/config_files/config_definition.xml - split into clm4_X variants

List all files added and what they do:
A       models/lnd/clm/bld/config_files/config_definition_clm4_5.xml
A       models/lnd/clm/bld/config_files/config_definition_clm4_0.xml

List all existing files that have been modified, and describe the changes:

M       models/lnd/clm/tools/clm4_5/mksurfdata_map/mksurfdata.pl - set crop=off by default to pick up correct defaults.
M       models/lnd/clm/bld/configure - completely remove clm4_5 only cpp flags, add physics dependent logic to clm4_0 flags.
M       models/lnd/clm/bld/queryDefaultNamelist.pl - point to physics specific config_definitions.xml file
M       models/lnd/clm/bld/unit_testers/xFail/expectedClmTestFails.xml - replace xml special characters with alternatives so file can be parsed. Add new build-namelist failures.

M       models/lnd/clm/bld/build-namelist - add logic for all new clm4_5 namelist variables, commandline options, switch defaults to use_N.

M       models/lnd/clm/bld/namelist_files/namelist_definition_clm4_5.xml - add new namelist variables

M       models/lnd/clm/src/clm4_5/biogeochem/CNNDynamicsMod.F90 - add CNNDynamicsInit() and logic to set nfix_timeconst from use_nitrif_denitrif namelist instead of CPP.
M       models/lnd/clm/src/clm4_5/main/clm_varpar.F90 - convert ifdef'd parameters to variables
M       models/lnd/clm/src/clm4_5/main/controlMod.F90 - final conversion of CPP flags to namelist variables

	Switch the following files to use new namelist variables for attributes:
M       models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_5.xml
M       models/lnd/clm/bld/namelist_files/use_cases/2000_control.xml
M       models/lnd/clm/bld/namelist_files/use_cases/20thC_glacierMEC_transient.xml
M       models/lnd/clm/bld/namelist_files/use_cases/2000-2100_rcp8.5_transient.xml
M       models/lnd/clm/bld/namelist_files/use_cases/2000_glacierMEC_control.xml
M       models/lnd/clm/bld/namelist_files/use_cases/1850_control.xml
M       models/lnd/clm/bld/namelist_files/use_cases/1850-2100_rcp2.6_transient.xml
M       models/lnd/clm/bld/namelist_files/use_cases/1850-2100_rcp6_transient.xml
M       models/lnd/clm/bld/namelist_files/use_cases/1850-2100_rcp4.5_transient.xml
M       models/lnd/clm/bld/namelist_files/use_cases/1850-2100_rcp8.5_transient.xml
M       models/lnd/clm/bld/namelist_files/use_cases/20thC_transient.xml
M       models/lnd/clm/bld/namelist_files/use_cases/1850_glacierMEC_control.xml
M       models/lnd/clm/bld/namelist_files/use_cases/1850-2100_rcp2.6_glacierMEC_transient.xml
M       models/lnd/clm/bld/namelist_files/use_cases/1850-2100_rcp6_glacierMEC_transient.xml
M       models/lnd/clm/bld/namelist_files/use_cases/1850-2100_rcp4.5_glacierMEC_transient.xml
M       models/lnd/clm/bld/namelist_files/use_cases/1850-2100_rcp8.5_glacierMEC_transient.xml


CLM testing:

  build-namelist tests:

    yellowstone - most tests will fail, tests need to be updated in future tag
    frankfurt

  regular tests (aux_clm):
    - nlcomp tests fail for all clm4_5 because of the new namelist variables.
    - SSP tests should now be BFAIL, pass on next tag
    - All hist comp are bit for bit.

    yellowstone_intel ok
    yellowstone_pgi ok
    frankfurt_intel ok
    frankfurt_pgi ok
    frankfurt_nag ok

  tools testing:

    yellowstone interactive - smiS4 (getregional) also fails in clm4_5_40
    frankfurt interactive - N/A

CLM tag used for the baseline comparisons: clm4_5_40

Changes answers relative to baseline: None.

===============================================================
===============================================================
Tag name:  clm4_5_40
Originator(s):  muszala (Stefan Muszala,UCAR/TSS,303-497-1320)
Date:  Thu Oct 24 07:54:46 MDT 2013
One-line Summary: fix Bug 1752 - urban conductances depend on weights in an undesirable way

Purpose of changes: 

Three parts to this tag.  Description from Oleson:

1) 
 fix Bug 1752 - modified UrbanMod.F90 to calculate
2) 
 add 2 new diagnostic history fields (FIRE_U, FIRE_R)
 the conductances correctly.  I created new variables to more clearly
 distinguish between scaled and unscaled conductances.
3)
 fix small bug in which the history field output of some of the
 anthropogenic heat flux variables are not bfb on restart when finidat is blank.
 I found this when verifying bfb for the original bug fix.  The cause of this
 is initialization which sets non-urban to special value, instead of zero, which
 is what is desired. On restart, this initialization is not done and the history
 file set_nourb=0 has precedent.  A related issue is that eflx_building_heat is
 not zero for pervious/impervious road when nlevurb /= nlevgrnd.

Requirements for tag: N/A

Test level of tag: regular

Bugs fixed (include bugzilla ID): 1752

    long test with irrigate=.true. (because irrigation likely never took effect
    in the old test).

Requirements for tag:

Test level of tag: regular & build_namelist

Bugs fixed (include bugzilla ID):
   - 1827 / 1830: testmods don't work right for multi-instance tests (fix via
     scripts update)
   - 1829: PCT_SAND, PCT_CLAY and SOIL_COLOR are incorrect for some grid cells
     (fix via new surface datasets)
   - 1831: turning on irrigation leads to death in initialization (fix via a new
     initial conditions file)


Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: see changes in boundary datasets

List any changes to the defaults for the boundary datasets:
  
   - new surface datasets for all resolutions for CLM4.5: same as before except
     for PCT_SAND, PCT_CLAY and SOIL_COLOR: these are no longer zeroed out under
     points that are believed to be 100% glacier ("believed to be" because this
     previously zeroed out some points that ended up having some other special
     landunits, such as lake)

   - new initial conditions file for CLM4.5, irrigate=.true., f10

Describe any substantial timing or memory changes: none

Code reviewed by: self

List any svn externals directories updated (csm_share, mct, etc.):

   scripts: scripts4_131001 -> scripts4_131003

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= new logic for irrigation for finidat
M       models/lnd/clm/bld/build-namelist

========= new surface datasets; distinguish finidat based on value of 'irriagte'
M       models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_5.xml

CLM testing:

  build-namelist tests:

    caldera: OK
       The following failures were expected due to new surface datasets:
          413/439 < FAIL> <Test Id: 413> <Desc: lnd_in file the same as expected for phys45>  
          418/439 < FAIL> <Test Id: 418> <Desc: lnd_in file the same as expected for phys45>  
          423/439 < FAIL> <Test Id: 423> <Desc: lnd_in file the same as expected for phys45>  
          428/439 < FAIL> <Test Id: 428> <Desc: lnd_in file the same as expected for phys45>  
          433/439 < FAIL> <Test Id: 433> <Desc: lnd_in file the same as expected for phys45>  
          438/439 < FAIL> <Test Id: 438> <Desc: lnd_in file the same as expected for phys45-crop>  


  regular tests (aux_clm):

    edison_intel (aux_clm_ys_intel & aux_clm_ys_pgi lists): OK
    frankfurt_intel: OK
    frankfurt_pgi: OK
    frankfurt_nag: OK

  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    edison_intel: aux_clm_ys_intel list: OK
    edison_intel: aux_clm_ys_pgi list: OK

CLM tag used for the baseline comparisons: clm4_5_35

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: All CLM45
    - what platforms/compilers: All
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 

        Not investigated carefully, but probably larger than roundoff/same climate.

        Answer changes are due to new surface datasets. This is due to fixing
        bug 1829 (PCT_SAND, PCT_CLAY and SOIL_COLOR are incorrect for some grid
        cells); it looks like this just affects answers over a small number of
        lake points (e.g., 9 lake points in an f19 run).

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	
===============================================================
===============================================================
Tag name:  clm4_5_35
Originator(s):  sacks (Bill Sacks)
Date: Tue Oct  1 09:47:45 PDT 2013
One-line Summary: get CLM running on edison

Purpose of changes:

   Update scripts and Machines externals to get the CLM test suite running on
   edison; this will be our replacement for yellowstone while yellowstone is
   down.

Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID):

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: N/A

List any svn externals directories updated (csm_share, mct, etc.):

-scripts                         https://svn-ccsm-models.cgd.ucar.edu/scripts/trunk_tags/scripts4_130929
-scripts/ccsm_utils/Machines     https://svn-ccsm-models.cgd.ucar.edu/Machines/trunk_tags/Machines_130927
+scripts                         https://svn-ccsm-models.cgd.ucar.edu/scripts/trunk_tags/scripts4_131001
+scripts/ccsm_utils/Machines     https://svn-ccsm-models.cgd.ucar.edu/Machines/trunk_tags/Machines_130930b

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes: 

========= Remove PEM test that should pass now; add xFails for edison
M       models/lnd/clm/bld/unit_testers/xFail/expectedClmTestFails.xml


CLM testing:

  NOTE: Testing was done on tag port_to_edison_02_clm4_5_34. Since then, scripts
  has been updated from scripts4_130930a to scripts4_131001. However, the only
  difference is the removal of some duplicated tests from the test list.

  regular tests (aux_clm):

    edison_intel (aux_clm_ys_intel & aux_clm_ys_pgi lists): OK
       All pass except:

               <entry testID="ERH_D.f19_g16.I1850CLM45CN.edison_intel.clm-default"               failType="FAIL" >See "ERH_D.f19_g16.I1850CLM45CN.yellowstone_pgi.clm-default</entry>
               <entry testID="SMS_D_Lm1_Mmpi-serial.CLM_USRDAT.I1PTCLM45.edison_intel.clm-USUMB" failType="SFAIL" >Can't find user datasets</entry>
               <entry testID="ERI_D.ne30_g16.ICLM45BGC.edison_intel.clm-vrtlay"                  failType="FAIL" >Seg fault while writing h1 file</entry>
               <entry testID="ERS_Ld211_D_P144x1.f10_f10.ICNCROP.edison_intel.clm-crop"          failType="FAIL" bugz="1696" >See ERS_Ld211_D_P112x1.f10_f10.ICNCROP in yellowstone intel list</entry>

       #1 and #4 have been failing on yellowstone, #2 and #3 are new failures on edison

    frankfurt_intel: OK
    frankfurt_pgi: OK
    frankfurt_nag: OK

  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    NOTE: only generate done here, because no baselines existed

    edison_intel: aux_clm_ys_intel list: OK
    edison_intel: aux_clm_ys_pgi list: OK

CLM tag used for the baseline comparisons: clm4_5_34

   NOTE: Baseline comparisons only done for frankfurt tests; no baseline
   comparisons done with component_gen_comp, because no baselines existed on
   edison.

Changes answers relative to baseline: NO
	
===============================================================
===============================================================
Tag name:  clm4_5_34
Originator(s):  erik (Erik Kluzek)
Date: Mon Sep 30 01:30:25 MDT 2013
One-line Summary: Get PTCLM working, fix a few small bugs

Purpose of changes:

Get PTCLM fully working. Allow PTCLM to work with ALL I compsets including clm4_0 compsets.
Add a new option to PTCLM from Keith Oleson --cycle_forcing to set it up to cycle over the forcing.
Another option is to build datasets in the "-mydatafiles" directory (by default under PTCLM
directory). The datasets now have creation time-stamps in them as well. Rename QIAN_tower_yrs
to -use_tower_yrs and remove QIANforcing (now chosen by compset).
scripts now has four different I1PT compsets two new ones for CLM40CN and CLM45BGC. datm
CLM_USRDAT domain file for CLM1PT forcing points to the ATM_DOMAIN_FILE/PATH. Add some new
datasets to the siteDIR from Keith Oleson. Update documenation, remove unused template dir.
Add a script to rename creation dates for map files, so you don't have to regenerate them
each day.

Fix a few small bugs. Allow clm4_5 to have suplnitro and bgc_spinup to only give a warning
rather than die. Fix a corrupted rawdata PFT file. Fix mkscripgrid.ncl for regional SCRIP
grid creation. Remove some leftover fine-mesh variables that aren't needed anymore. Remove
reference to scaled_harvest in CLM build-namelist which was removed a long time ago.

Remove a mapping file that didn't seem to be needed for clm4_0 mkmapdata (a default
didn't exist for it either). Add -usr_mapdir option to clm4_0 mksurfdata.pl which is needed
for PTCLM for clm4_0 compsets.

Requirements for tag: Update scripts and get PTCLM working

Test level of tag: regular

Bugs fixed (include bugzilla ID):
                                 1826 (allow clm4_5 and suplnitro to be ALL for bgc_spinup)
                                 1818 (two new options to PTCLM)
                                 1762 (Fix corrupted rawdata PFT file)
                                 1757 (Bug in mkscripgrid.ncl for regional/global SCRIP grid creation)
                                 1623 (Remove some leftover fine-mesh variables _a arrays)

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: None

Describe any changes made to the namelist: Allow two options to go without dying

List any changes to the defaults for the boundary datasets: None

Describe any substantial timing or memory changes: None

Code reviewed by: self

List any svn externals directories updated (csm_share, mct, etc.): scripts, Machines, datm, and csm_share
     scripts   to scripts4_130929
     Machines  to Machines_130927
     datm      to datm8_130919
     csm_share to share3_130918

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

   M models/lnd/clm/tools/shared/mkmapdata/mkmapdata.sh ------- Remove 10x10min_IGBPmergeICESatGIS for clm4_0
   M models/lnd/clm/tools/shared/mkmapgrids/mkscripgrid.ncl --- Fix bug 1757 for regional grid creation
   M models/lnd/clm/tools/clm4_0/mksurfdata_map/mksurfdata.pl - Add usr_mapdir option

   M models/lnd/clm/bld/build-namelist - Allow missing clm_usrdat files to continue, remove scaled_harvest (long gone)
                                         allow bgc_spinup and suplnitro to coexist with warning

   M models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_0_tools.xml - Fix corrupted 856 raw PFT file
   M models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_5_tools.xml - Fix corrupted 856 raw PFT file, remove 1000-1004 testyrs

   M models/lnd/clm/src/clm4_5/main/clmtypeInitMod.F90 - Remove finemesh _a variables
   M models/lnd/clm/src/clm4_5/main/clmtype.F90 -------- Remove finemesh _a variables
   M models/lnd/clm/src/clm4_0/main/clmtypeInitMod.F90 - Remove finemesh _a variables
   M models/lnd/clm/src/clm4_0/main/clmtype.F90 -------- Remove finemesh _a variables

CLM testing: regular, build_namelist, tools

  build-namelist tests:

    yellowstone   yes
    frankfurt     yes

  regular tests (aux_clm):

    yellowstone_intel       yes
    yellowstone_pgi         yes
    frankfurt_intel         yes
    frankfurt_pgi           yes
    frankfurt_nag           yes

  tools testing:

    yellowstone interactive yes

CLM tag used for the baseline comparisons:  clm4_5_33

Changes answers relative to baseline: no bit-for-bit

===============================================================
===============================================================
Tag name:  clm4_5_33
Originator(s):  muszala (Stefan Muszala,UCAR/TSS,303-497-1320)
Date: Thu Sep 26 10:42:56 MDT 2013
One-line Summary: clean up from mistakes in previous tag

Purpose of changes: clean up time-stamps and a mistake in clm4_5_32

Requirements for tag: N/A

Test level of tag: N/A

Bugs fixed (include bugzilla ID): N/A

Known bugs (include bugzilla ID): N/A
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: N/A

Describe any changes made to the namelist: N/A

List any changes to the defaults for the boundary datasets: N/A

Describe any substantial timing or memory changes: N/A

Code reviewed by: N/A

List any svn externals directories updated (csm_share, mct, etc.): N/A

List all files eliminated: N/A

List all files added and what they do: N/A

List all existing files that have been modified, and describe the changes: N/A

CLM testing: N/A

CLM tag used for the baseline comparisons: N/A

Changes answers relative to baseline: N/A

===============================================================
===============================================================
Tag name:  clm4_5_32
Originator(s):  muszala (Stefan Muszala,UCAR/TSS,303-497-1320)
Date: Thu Sep 26 10:07:14 MDT 2013
One-line Summary: bug fix tag - 1798, 1810

Purpose of changes: fix bug 1798 and 1810.

http://bugs.cgd.ucar.edu/show_bug.cgi?id=1798
http://bugs.cgd.ucar.edu/show_bug.cgi?id=1810

Requirements for tag: N/A

Test level of tag: regular

Bugs fixed (include bugzilla ID): 1798 and 1810

Known bugs (include bugzilla ID): N/A
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: N/A

Describe any changes made to the namelist: N/A

List any changes to the defaults for the boundary datasets: N/A

Describe any substantial timing or memory changes: N/A

Code reviewed by: self

List any svn externals directories updated (csm_share, mct, etc.): N/A

List all files eliminated: N/A

List all files added and what they do: N/A

List all existing files that have been modified, and describe the changes:

- for bug 1798
M       models/lnd/clm/src/clm4_5/main/pftdynMod.F90
- for bug 1810
M       models/lnd/clm/src/clm4_5/main/controlMod.F90
M       models/lnd/clm/src/clm4_0/main/controlMod.F90

CLM testing:

  regular tests (aux_clm):

    yellowstone_intel - OK
    yellowstone_pgi - OK
    frankfurt_intel - OK
    frankfurt_pgi - OK
    frankfurt_nag - OK

  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    yellowstone_intel - OK

CLM tag used for the baseline comparisons:  clm4_5_31

Changes answers relative to baseline: no

===============================================================
===============================================================
Tag name:  clm4_5_31
Originator(s):  sacks (Bill Sacks,UCAR/CSEG,303-497-1762)
Date: Wed Sep 25 10:12:47 MDT 2013
One-line Summary: fix bug 1820: incomplete conditional in CNSoyfix leads to buggy results and decomposition dependence

Purpose of changes:

   Fix bug 1820: incomplete conditional in CNSoyfix leads to buggy results and
   decomposition dependence. Fix for this is based on analysis of the original
   Agro-IBIS code.

Requirements for tag: fix bug 1820, the following tests should now pass:
             PET_P15x2_Lm25.f10_f10.ICLM45BGCDVCROP.yellowstone_intel
             PET_P15x2_Ly3.f10_f10.ICLM45BGCCROP.yellowstone_intel

Test level of tag: regular

Bugs fixed (include bugzilla ID): 
     1820: incomplete conditional in CNSoyfix leads to buggy results and decomposition dependence

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: Beth Drewniak, Sam Levis

List any svn externals directories updated (csm_share, mct, etc.): none

List all files eliminated: none 

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

M       models/lnd/clm/src/clm4_5/biogeochem/CNNDynamicsMod.F90

========= Remove now-passing PET tests
M       models/lnd/clm/bld/unit_testers/xFail/expectedClmTestFails.xml

CLM testing:

  regular tests (aux_clm):

    yellowstone_intel: OK
    yellowstone_pgi: OK
    frankfurt_intel: OK
    frankfurt_pgi: OK
    frankfurt_nag: OK

  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    yellowstone_intel: OK
    yellowstone_pgi: OK

CLM tag used for the baseline comparisons: clm4_5_30

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM45 with CROP
    - what platforms/compilers: ALL
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
       larger than roundoff, but not investigated in detail

       Note that no changes were observed in the test suite, but this is due to
       a limitation of the test suite (there are very few multi-year crop tests;
       the only global multi-year tests are the newly-passing PET tests, which
       don't have baselines)

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	
===============================================================
===============================================================
Tag name:  clm4_5_30
Originator(s):  sacks (Bill Sacks,UCAR/CSEG,303-497-1762)
Date: Tue Sep 24 13:08:01 MDT 2013
One-line Summary: fix performance bug in decomposition initialization

Purpose of changes:

Fix performance bug in decomposition initialization (bug 1771). Code mods from
Tony Craig.

Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID): 1771 ( Fix for an initialization performance bug)

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes:

   Improves timing of initialization for high resolution casse

Code reviewed by: tcraig

List any svn externals directories updated (csm_share, mct, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

M       models/lnd/clm/src/clm4_5/main/decompInitMod.F90
M       models/lnd/clm/src/clm4_0/main/decompInitMod.F90

CLM testing:

  regular tests (aux_clm):

    yellowstone_intel: OK
    yellowstone_pgi: OK
    frankfurt_intel: OK
    frankfurt_pgi: OK
    frankfurt_nag: OK

  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    yellowstone_intel: OK
    yellowstone_pgi: OK

CLM tag used for the baseline comparisons: clm4_5_29

Changes answers relative to baseline: NO
	
===============================================================
===============================================================
Tag name:  clm4_5_29
Originator(s):  sacks (Bill Sacks,UCAR/CSEG,303-497-1762)
Date: Tue Sep 24 10:55:42 MDT 2013
One-line Summary: fix threading in CLM4.5, and other misc fixes

Purpose of changes:
 
(Mostly) fix threading in CLM4.5. This consisted of:

(1) Rework initGridCellsMod to keep all points in a clump contiguous

(2) Add info in bounds derived type (not necessary, but this allows
for more error checking and simplifies some code)

(3) Fix which bounds are passed to reweightWrapup in initialization

(4) Get rid of syntax like foo(:) = 0, instead using explicit bounds

(5) Rework bounds declarations for subroutine array arguments, both in
caller (explicitly subset argument by bounds) and callee (use
assumed-shape array arguments rather than declaring upper bounds), and
add assertions on array sizes.

See https://wiki.ucar.edu/display/ccsm/Community+Land+Model+Developers+Guide
("Guidelines for passing array arguments to subroutines") for the new
conventions that are implemented here.

(6) Fix crop threading bug, related to nyrs (bug 1598), both in clm4.5 and clm4.0

However, note that there is still a crop threading bug (bug 1820), which will
need to be fixed in a separate tag.


Also, some unrelated changes:

(1) Fix size of a megan variable, both in clm4.5 and clm4.0.

(2) Remove some unused variables from Hydrology2Mod / SoilHydrologyMod

(3) Fix some bugs in histFileMod / histFldsMod

(4) Reorder a loop in SurfaceAlbedo to get better performance (especially with
expanded memory allocation for dynamic landunits, in an upcoming tag)


Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID):

   1598 (crop threading in clm4.0 and clm4.5)

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: 

   Added f10 initial file for CLM4.5 BGCCROP, for testing purposes

Describe any substantial timing or memory changes:

   Timing is currently 5-10% worse, due to calls to shr_log_errMsg, within
   shr_assert calls. This should return to previous timings in non-debug runs
   once shr_assert calls are ifdef'ed out in non-debug runs (this requires a
   csm_share update that Sean Santos is working on).

Code reviewed by: portions reviewed by erik

List any svn externals directories updated (csm_share, mct, etc.):

   scripts4_130912 -> scripts4_130916

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

========= Significant rework to work with multiple clumps per proc
M       models/lnd/clm/src/clm4_5/main/initGridCellsMod.F90

========= Add info in bounds derived type
M       models/lnd/clm/src/clm4_5/main/decompMod.F90
M       models/lnd/clm/src/clm4_5/main/filterMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_driver.F90
          - also fix crop threading bug (1598)
M       models/lnd/clm/src/clm4_5/main/reweightMod.F90
          - also use explicit bounds instead of things like foo(:)

========= Remove some unused variables
M       models/lnd/clm/src/clm4_5/biogeophys/Hydrology2Mod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SoilHydrologyMod.F90
          - also other bounds-related changes as above

========= Change 'bounds' to 'bounds_proc', use clump bounds for call to
          reweightWrapup, get rid of abort if running with openMP
M       models/lnd/clm/src/clm4_5/main/clm_initializeMod.F90

========= Get rid of syntax like foo(:), instead using explicit bounds
M       models/lnd/clm/src/clm4_5/biogeochem/CNVerticalProfileMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/DUSTMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/STATICEcosysDynMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNDecompMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNDVMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_glclnd.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SnowHydrologyMod.F90

========= Rework bounds declarations for subroutine array arguments, both in
          caller (explicitly subset argument by bounds) and callee (use
          assumed-shape array arguments rather than declaring upper bounds), and
          add assertions on array sizes
M       models/lnd/clm/src/clm4_5/biogeochem/CNFireMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/ch4Mod.F90
          - also use explicit bounds instead of things like foo(:)
M       models/lnd/clm/src/clm4_5/biogeochem/CNSummaryMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNAnnualUpdateMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNNDynamicsMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNAllocationMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNSoilLittVertTranspMod.F90
M       models/lnd/clm/src/clm4_5/main/dynlandMod.F90
M       models/lnd/clm/src/clm4_5/main/pftdynMod.F90
          - also use explicit bounds instead of things like foo(:)
M       models/lnd/clm/src/clm4_5/main/pft2colMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_atmlnd.F90
M       models/lnd/clm/src/clm4_5/main/subgridAveMod.F90
          - also use explicit bounds instead of things like foo(:)
M       models/lnd/clm/src/clm4_5/biogeophys/BalanceCheckMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SoilTemperatureMod.F90
          - also use explicit bounds instead of things like foo(:)
M       models/lnd/clm/src/clm4_5/biogeophys/SLakeFluxesMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/FrictionVelocityMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/TridiagonalMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/Hydrology1Mod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/UrbanMod.F90
          - also use explicit bounds instead of things like foo(:)
M       models/lnd/clm/src/clm4_5/biogeophys/SLakeTemperatureMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/BareGroundFluxesMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SNICARMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/CanopyFluxesMod.F90
          - also remove some now-unneeded temporary arrays
          - also use explicit bounds instead of things like foo(:)
M       models/lnd/clm/src/clm4_5/biogeophys/H2OSfcMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/Biogeophysics2Mod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SurfaceAlbedoMod.F90
          - also reorder a loop to get better performance
M       models/lnd/clm/src/clm4_5/biogeophys/BandDiagonalMod.F90

========= Fix crop threading bug (1598), in both clm4.5 and clm4.0, by reworking
          where nyrs is updated
M       models/lnd/clm/src/clm4_5/biogeochem/CNPhenologyMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CropRestMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_driver.F90
M       models/lnd/clm/src/clm4_0/biogeochem/CNPhenologyMod.F90
M       models/lnd/clm/src/clm4_0/biogeochem/CropRestMod.F90
M       models/lnd/clm/src/clm4_0/main/clm_driver.F90

========= Add comments
M       models/lnd/clm/src/clm4_5/biogeochem/CNCIsoFluxMod.F90

========= Fix size of a megan variable
M       models/lnd/clm/src/clm4_5/main/clmtypeInitMod.F90
          - also initialize rootr, as it was in clm4_5_20 and prior
M       models/lnd/clm/src/clm4_0/main/clmtypeInitMod.F90

========= Fix some hist file bugs:
            - increase max number of characters allowed for hist field names
            - when adding a field, make it work to say default='active' --
              previously, explicitly setting default='active' did the same thing
              as setting default='inactive'
            - change ptr_pft to ptr_col for a few column-level history variables
            - remove two duplicate hist_addfld calls
M       models/lnd/clm/src/clm4_5/main/histFileMod.F90
          - also add some bounds to array arguments
M       models/lnd/clm/src/clm4_5/main/histFileMod.F90

========= Add f10 initial file for CLM45 BGCCROP, for testing
M       models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_5.xml

========= Remove some PET tests from the xFail list; note that some PET tests
          still fail due to bug 1820
M       models/lnd/clm/bld/unit_testers/xFail/expectedClmTestFails.xml


CLM testing:

  build-namelist tests:

    yellowstone: OK

  regular tests (aux_clm):

    yellowstone_intel: OK
    yellowstone_pgi: OK   
    frankfurt_intel: OK  
    frankfurt_pgi: OK  
    frankfurt_nag: OK    

  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    yellowstone_intel: OK
    yellowstone_pgi: OK

CLM tag used for the baseline comparisons: clm4_5_28

Changes answers relative to baseline: NO, with the following minor exceptions:

  In general, no answer changes for non-threaded runs (changes answers for
  threaded runs due to significant bug fixes!)

  Changes answers for CLM45 BGC CROP at f10 due to new initial conditions
  (instead of cold start)

===============================================================
===============================================================
Tag name:  clm4_5_28
Originator(s):  sacks (Bill Sacks,UCAR/CSEG,303-497-1762)
Date: Fri Sep 20 21:29:39 MDT 2013
One-line Summary: fix FracH2oSfc bug

Purpose of changes: 

Fix bug 1811: FracH2oSfc is called from within a loop over all points. Sean
Swenson realized that the offending block of code is no longer needed, so we
have removed it.

Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID): 1811 (FracH2oSfc is called from within a loop
over all points)

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: None

Describe any changes made to the namelist: None

List any changes to the defaults for the boundary datasets: None

Describe any substantial timing or memory changes: None

Code reviewed by: Sean Swenson

List any svn externals directories updated (csm_share, mct, etc.): None

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

========= Remove the offending (and no longer needed) block of code
M       models/lnd/clm/src/clm4_5/biogeophys/SoilHydrologyMod.F90

========= Remove a now-unused variable
M       models/lnd/clm/src/clm4_5/main/clmtypeInitMod.F90
M       models/lnd/clm/src/clm4_5/main/clmtype.F90

========= Move xFail test to the right location
M       models/lnd/clm/bld/unit_testers/xFail/expectedClmTestFails.xml


CLM testing:

  regular tests (aux_clm):

    yellowstone_intel: OK
    yellowstone_pgi: OK
    frankfurt_intel: OK
    frankfurt_pgi: OK
    frankfurt_nag: OK

  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    yellowstone_intel: OK
    yellowstone_pgi: OK

      See notes below on answer changes


CLM tag used for the baseline comparisons: clm4_5_27

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: All CLM45 cases
    - what platforms/compilers: All
    - nature of change: larger than roundoff/same climate

   If bitwise differences were observed, how did you show they were no worse
   than roundoff?

   Sean Swenson performed two 20-year runs with and without the fix. His report
   is:

   There are some differences, mainly in runoff, and it looks like at the 1%
   level mostly, with a few scattered points showing up on the significance
   plots.  Other fields like latent heat, soil moisture/temperature, or water
   table show even less differences.

   http://www.cgd.ucar.edu/staff/swensosc/public/diagnostics/test_frach2o-test_no_frach2o/setsIndex.html
	
===============================================================
===============================================================
Tag name:  clm4_5_27
Originator(s):  sacks (Bill Sacks,UCAR/CSEG,303-497-1762)
Date: Fri Sep 20 20:43:16 MDT 2013
One-line Summary: fix crop nyrs bug

Purpose of changes: Fix bug 1815 (nyrs is incorrect at the start of a crop run,
leading to incorrect GDD values for the first 20 years or so of a crop
simulation)

Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID): 
- 1815 (nyrs is incorrect at the start of a crop run, leading to incorrect GDD
values for the first 20 years or so of a crop simulation)

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: None

Describe any changes made to the namelist: None (but see changes to boundary
datasets below)

List any changes to the defaults for the boundary datasets: 

   New crop initial conditions for CLM4.5 BGCCROP @ f19 - same as old dataset,
   but with restyear changed from 1 to 0

Describe any substantial timing or memory changes: None

Code reviewed by: slevis

List any svn externals directories updated (csm_share, mct, etc.): None

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

========= Don't increment nyrs on the first timestep of a startup run, so that
          nyrs is correctly 0 rather than 1 for the first year
M       models/lnd/clm/src/clm4_5/biogeochem/CNPhenologyMod.F90
M       models/lnd/clm/src/clm4_0/biogeochem/CNPhenologyMod.F90

========= New crop initial conditions for CLM4.5 BGCCROP @ f19 - same as old dataset,
          but with restyear changed from 1 to 0
M       models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_5.xml

========= add test that sometimes runs out of time, move test from
          yellowstone_intel to yellowstone_pgi
M       models/lnd/clm/bld/unit_testers/xFail/expectedClmTestFails.xml

CLM testing:

  build-namelist tests:

    yellowstone: OK

  regular tests (aux_clm):

    yellowstone_intel: OK
    yellowstone_pgi: OK
    frankfurt_intel: OK
    frankfurt_pgi: OK
    frankfurt_nag: OK

  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    yellowstone_intel: OK
       - expected diffs in SMS_Ly1.f19_g16.ICLM45BGCCROP.yellowstone_intel
       - baselines messed up for
         ERS_Ly5.f10_f10.I20TRCRUCLM45BGC.yellowstone_intel, so comparison not
         done for that test
    yellowstone_pgi: NO BASELINES, SO COMPARISONS NOT RUN

CLM tag used for the baseline comparisons: clm4_5_27

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: All crop cases (clm4.0 or clm4.5) that either
      use arbitrary initial conditions or use the clm4.5 out-of-the-box initial
      conditions for BGCCROP @ f19
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new
  climate): new climate


   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)

     Sam Levis examined a 3-year run with arbitrary initial conditions, and
     verified that crop LAI is much more realistic in the new simulation
     (previously, crop LAI was near-zero for the first few years)

===============================================================
===============================================================
Tag name:  clm4_5_26
Originator(s):  muszala (Stefan Muszala)
Date: Thu Sep 19 17:07:11 MDT 2013
One-line Summary: water balance and SMS_Ly1.f19_g16.ICLM45BGCCROP fix

Purpose of changes: 1) Fix water balance error in f09_g16 I1850CRUCLM45BGC simulation
                    2) Get all machine/compiler combinations of 
                          SMS_Ly1.f19_g16.ICLM45BGCCROP working
                       - this fix required (1) and a fix to fthresh in RtmFloodInit 
                         - new RTM tag rtm1_0_32 to go along with this
                       - PGI+frankfurt version of this test only work with 16 MPI processes

Requirements for tag: N/A

Test level of tag: regular

Bugs fixed (include bugzilla ID):1808 

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: N/A

Describe any changes made to the namelist: N/A

List any changes to the defaults for the boundary datasets: N/A

Describe any substantial timing or memory changes: N/A

Code reviewed by: S. Swenson, D. Lawrence

List any svn externals directories updated (csm_share, mct, etc.): rtm1_0_32 

List all files eliminated: N/A

List all files added and what they do: N/A

List all existing files that have been modified, and describe the changes:

M       models/lnd/clm/src/clm4_5/biogeophys/SoilHydrologyMod.F90

Index: models/lnd/clm/src/clm4_5/biogeophys/SoilHydrologyMod.F90
===================================================================
--- models/lnd/clm/src/clm4_5/biogeophys/SoilHydrologyMod.F90   (revision 51190)
+++ models/lnd/clm/src/clm4_5/biogeophys/SoilHydrologyMod.F90   (working copy)
@@ -1110,15 +1110,8 @@
        do j = 1, nlevsoi
           if(h2osoi_liq(c,j)<0._r8)then
              qflx_deficit(c) = qflx_deficit(c) - h2osoi_liq(c,j)
-             h2osoi_liq(c,j) = 0._r8
           endif
        enddo
-       !reduce qcharge if necessary
-       !ideally, I can set qflx_deficit as a local variable, but it is helpful
-       !to diagnose the problem associated with the solver for the richards' equation.
-       if(qflx_deficit(c)>0._r8)then
-          qcharge(c) = qcharge(c) - qflx_deficit(c)/dtime
-       endif
     enddo
 
     end associate 
@@ -1892,9 +1885,12 @@
 
     do fc = 1, num_hydrologyc
        c = filter_hydrologyc(fc)
-       xs1(c)          = max(max(h2osoi_liq(c,1),0._r8)-max(0._r8,(pondmx+watsat(c,1)*dzmm(c,1)-h2osoi_ice(c,1))),0._r8)
-       h2osoi_liq(c,1) = min(max(0._r8,pondmx+watsat(c,1)*dzmm(c,1)-h2osoi_ice(c,1)), h2osoi_liq(c,1))
 
+       !scs: watmin addition to fix water balance errors
+       xs1(c)          = max(max(h2osoi_liq(c,1)-watmin,0._r8)- &
+          max(0._r8,(pondmx+watsat(c,1)*dzmm(c,1)-h2osoi_ice(c,1)-watmin)),0._r8)
+       h2osoi_liq(c,1) = h2osoi_liq(c,1) - xs1(c)
+
        if (urbpoi(clandunit(c))) then
           qflx_rsub_sat(c)     = xs1(c) / dtime
        else

CLM testing:

- general note: for clm45 compsets-both clm and cpl history files change

- specfic testing for these bug fixes:

1) Water balance fix-ran a clone of run from Dave Lawrence:
   -- create_newcase -compset I1850CRUCLM45BGC -res f09_g16 -mach yellowstone -case /glade/u/home/dlawren/expts/clm4.5/clm45bgc_1deg4519_1850spin_bd
   -- this ran for over 25 years with no water balance errors.

2) SMS_Ly1.f19_g16.ICLM45BGCCROP

PASS  SMS_Ly1.f19_g16.ICLM45BGCCROP.yellowstone_intel.clm-reduceOutput.115612
PASS  SMS_Ly1.f19_g16.ICLM45BGCCROP.yellowstone_pgi.clm-reduceOutput.115522

PASS  SMS_Ly1.f19_g16.ICLM45BGCCROP.frankfurt_intel.clm-reduceOutput.115217
PASS  SMS_Ly1_Mmpich.f19_g16.ICLM45BGCCROP.frankfurt_nag.clm-reduceOutput.120824
PASS  SMS_Ly1.f19_g16.ICLM45BGCCROP.frankfurt_pgi.clm-reduceOutput.016  -- only with 16 MPI tasks

3) To make sure the RTM refactor did not create any BFB changes, I ran SMS_D.f19_g16.ICLM45BGCCROP.yellowstone_intel 
   with rtm1_0_31 and rivrtm/branch_tags/bcf_tags/bcf_02_rtm1_0_31.
     - With flood_mode='NULL'   - Coupler and land history files were BFB.
     - With flood_mode='ACTIVE' - Coupler, rtm and land history files were BFB.

  build-namelist tests: N/A

  regular tests (aux_clm):

    yellowstone_intel - OK - changes in cpl. hist files expected
    yellowstone_pgi - OK - changes in cpl. hist files expected
    frankfurt_intel - OK - changes in cpl. hist files expected
    frankfurt_pgi - OK - changes in cpl. hist files expected
    frankfurt_nag - OK - changes in cpl. hist files expected

  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    yellowstone_intel - OK - changes in clm fields expected.

CLM tag used for the baseline comparisons:  clm4_5_25

Changes answers relative to baseline: Yes.  For CLM45 compsets.  All changes are from the SoilHydrology mods
as the RTM refactor and fthresh fix are BFB.

Coupler history fields that change:

l2x_Sl_avsdr, l2x_Sl_anidr, l2x_Sl_avsdf, l2x_Sl_anidf, l2x_Sl_tref, l2x_Sl_qref, 
l2x_Sl_t, l2x_Sl_fv, l2x_Sl_ram1, l2x_Sl_snowh, l2x_Sl_u10, l2x_Fall_swnet, 
l2x_Fall_taux, l2x_Fall_tauy, l2x_Fall_lat, l2x_Fall_sen, l2x_Fall_lwup, 
l2x_Fall_evap, l2x_Fall_flxdst1, l2x_Fall_flxdst2, l2x_Fall_flxdst3, l2x_Fall_flxdst4, 
l2x_Flrl_rofl, l2x_Fall_voc001, l2x_Fall_voc002, l2x_Fall_voc003, l2x_Fall_voc004, 
l2x_Fall_voc005, l2x_Fall_voc006, l2x_Fall_voc007, l2x_Fall_voc008, x2l_Flrr_volr, 
r2x_Forr_rofl, r2x_Forr_rofi, r2x_Flrr_volr, x2r_Flrl_rofl

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: CLM45 compsets
    - what platforms/compilers: All

===============================================================
===============================================================
Tag name:  clm4_5_25
Originator(s):  erik (Erik Kluzek)
Date: Fri Sep 13 13:49:45 MDT 2013
One-line Summary: Bring in Tony's changes to kick sno all the way up to the coupler layer, makes all 
                  CESM components more similar to each other

Purpose of changes:
   Bring in Tony's cplupa branch (cplupa_n06_clm4_5_24) to trunk. This branch moves sno
   fields all the way to the top coupler layer rather than being inside of CLM. This makes all
   CESM components more similar to each other.

   There was also some small fixes on the side that allow some more tests to work.

Test level of tag: regular

Bugs fixed (include bugzilla ID): 1789 (fix NoVSNoNI test)
                                  1788 (fix US-UMB test)
                                  1779 (fix RTM multi-instance)
                                  1777 (fix RTM branch cases)

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: Add new CPP token to CLM USE_ESMF_METADATA (with no direct machanism to use)
   We hate CPP tokens (but had to let this go, only needed by ESMF development folks)

Describe any changes made to the namelist: drv namelist changes, no changes to CLM namelist

List any changes to the defaults for the boundary datasets: CLM_USRDAT fsurdat files different directory for clm4_0 than clm4_5
     remove missing ne16np4 fpftdyn file

Describe any substantial timing or memory changes: 

Code reviewed by: self, tcraig

List any svn externals directories updated (csm_share, mct, etc.):, scripts, drv, cism, rtm, csm_share, data and stub models

    scripts             to scripts4_130912
    drv                 to drvseq4_3_03
    datm                to datm8_130424
    socn/sice/sglc/swav to stubs1_4_02
    rtm                 to rtm1_0_31
    cism                to cism1_130905
    csm_share           to share3_130906

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

  M    models/lnd/clm/bld/unit_testers/build-namelist_test.pl ------------ Remove ne16 20thC test
  M    models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_0.xml ---- Remove missing ne16 fpftdyn file
  M    models/lnd/clm/bld/namelist_files/namelist_defaults_usr_files.xml - Different directory for
            clm4_0/clm4_5 surface datasets

  M    models/lnd/clm/src/cpl_share/clm_cpl_indices.F90 - Field names change
  M    models/lnd/clm/src/cpl_mct/lnd_comp_mct.F90 ------ Remove "sno" and "s" fields
  M    models/lnd/clm/src/clm4_5/main/clm_glclnd.F90 ---- Remove rofi/rofl
  M    models/lnd/clm/src/cpl_esmf/lnd_comp_esmf.F90 ---- Remove "sno" and "s" fields, add USE_ESMF_METADATA #ifdef
  M    models/lnd/clm/src/cpl_esmf/lnd_comp_mct.F90 ----- Remove "sno" and "s" fields, add USE_ESMF_METADATA #ifdef
  M    models/lnd/clm/src/clm4_0/main/clm_glclnd.F90 ---- Remove rofi/rofl

CLM testing: regular

  build-namelist tests:

    bluefire  yes
    frankfurt yes

  regular tests (aux_clm):

    yellowstone_intel yes
    yellowstone_pgi   yes
    frankfurt_intel   yes
    frankfurt_pgi     yes
    frankfurt_nag     yes

  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    yellowstone_intel partial (not completed before tag made)
    yellowstone_pgi   partial (not completed before tag made)

CLM tag used for the baseline comparisons:  clm4_5_24

Changes answers relative to baseline: None (bit-for-bit)

    Although my "I compset" testing showed no changes, fully coupled changes
    do show differences. Coupler namelists also change.

===============================================================
===============================================================
Tag name:  clm4_5_24
Originator(s):  sacks (sacks)
Date:  Tue Sep  3 21:36:13 MDT 2013
One-line Summary: update externals to cesm1_3_beta02 or later

Purpose of changes:

Update externals to cesm1_3_beta02 or later


Requirements for tag:

Test level of tag: regular

Bugs fixed (include bugzilla ID): 1722 (Test failure with VIC and more_vertlayers)

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: None

Describe any changes made to the namelist: None

List any changes to the defaults for the boundary datasets: None

Describe any substantial timing or memory changes: Not investigated

Code reviewed by: self

List any svn externals directories updated (csm_share, mct, etc.):

   scripts    : scripts4_130816 -> scripts4_130830a
   Machines   : Machines_130529 -> Machines_130830
   drv        : drvseq4_2_33 -> drvseq4_2_35
   cism       : cism1_130502 -> cism1_130624
   csm_share  : share3_130528 -> share3_130723
   timing     : timing_130417 -> timing_130506
   mct        : compiler_fixes_n01_MCT_2.8.3 -> compiler_fixes_n03_MCT_2.8.3
   mapping    : mapping_130509 -> mapping_130716
   gen_domain : mapping_130509/gen_domain_files -> mapping_130716/gen_domain_files

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

========= Remove trailing whitespace
M       .ChangeLog_template


Index: models/lnd/clm/bld/unit_testers/xFail/expectedClmTestFails.xml
===================================================================
--- models/lnd/clm/bld/unit_testers/xFail/expectedClmTestFails.xml	(revision 50759)
+++ models/lnd/clm/bld/unit_testers/xFail/expectedClmTestFails.xml	(working copy)
@@ -51,17 +51,14 @@
          <yellowstone>
             <INTEL>
                <entry testId="ERS_Ld211_D_P112x1.f10_f10.ICNCROP"                         failType="FAIL"  bugz="1696" >use before define in history.  runs with frankfurt_pgi, yellowstone_intel and yellowstone_pgi</entry>
-               <entry testId="ERS_D.f09_g16.ICLM45VIC.yellowstone_intel.clm-vrtlay"       failType="RUN"   bugz="1722" >floating point exception.  problem with VIC combined with vertical layers</entry>
                <entry testId="PET.f10_f10.ICLM45BGC.yellowstone_intel"                    failType="TFAIL">once threading fixed, this should pass</entry>
                <entry testId="PET_PT.f10_f10.ICLM45BGC.yellowstone_intel"                 failType="TFAIL">once threading fixed, this should pass</entry>
-               <entry testId="ERI_D.ne30_g16.ICLM45BGC.yellowstone_intel.clm-vrtlay"      failType="FAIL" >core dumps in ref1.  Problems with vertical layers.  Run without clm-vrtlay and clm-default and it runs</entry>
                <entry testId="SSP.f19_g16.I1850CLM45BGC.yellowstone_intel.clm-default"    failType="BFAIL" bugz="1728" >starting in clm4_5_07--The cpl.hi.nc file is not being copied on a generate like it should.</entry>
                <entry testId="ERS_D.f10_f10.ICLM45BGC.yellowstone_intel.clm-rootlit"      failType="SFAIL" >Cannot turn clm4me mode on -- without clm4_5 physics! problem in scripts4_130809b </entry>
             </INTEL>
             <PGI>
-               <entry testId="ERB.ne30_g16.I_1948-2004.yellowstone_pgi"                   failType="FAIL" >Problem with scripts and testId string length.  This passes with a long testId</entry>
+               <entry testId="ERB.ne30_g16.I4804.yellowstone_pgi"                         failType="FAIL" >Problem with scripts and testId string length.  This passes with a long testId</entry>
                <entry testId="ERH_D.f19_g16.I1850CLM45CN.yellowstone_pgi.clm-default"     failType="FAIL" >Restart not BFB.  Runs as ERH_D.f19_g16.I1850CLM45CN.yellowstone_pgi</entry>
-               <entry testId="ERS.f09_g16.ICLM45VIC.yellowstone_pgi.clm-vrtlay"           failType="RUN" bugz="1722" >floating point exception.  problem with VIC combined with vertical layers</entry>
                <entry testId="PET.f10_f10.I1850CLM45BGC.yellowstone_pgi.clm-default"      failType="TFAIL" >once threading fixed, this should pass</entry>
                <entry testId="PET_PT_D.f10_f10.I1850CLM45BGC.yellowstone_pgi.clm-ciso"    failType="TFAIL" >once threading fixed, this should pass</entry>
                <entry testId="PET_PT_D.f19_g16.ICLM45BGCDVCROP.yellowstone_pgi.clm-crop"  failType="TFAIL" >once threading fixed, this should pass</entry>
@@ -78,7 +75,7 @@
                <entry testId="SMS_Ly1.f19_g16.ICLM45BGCCROP.frankfurt_nag" failType="RUN"   >Water balance errors followed by "negative conc. in ch4tran", then tries "-10^-12 < smin_nh4 < 0. resetting to zero.", then it exits at approximately 9 months.  This same test passes with yellowstone_intel and frankfurt_intel</entry>
             </NAG>
             <PGI>
-               <entry testId="ERS_D.f19_g16.IGRCP26CN.frankfurt_pgi"                     failType="CFAIL" >CMake 2.8.6 or higher is required.  You are running version 2.6.4</entry>
+               <entry testId="ERS_D.f19_g16.IGRCP26CN.frankfurt_pgi"                     failType="CFAIL" >Problem with cism build</entry>
                <entry testId="ERI_D.f19_g16.ICLM45BGC.frankfurt_pgi"                     failType="FAIL"  >Fails after reading clmforc.Li_2012_hdm_0.5x0.5_AVHRR_simyr1850-2010_c130401.nc.  This same test passes with yellowstone_intel, yellowstone_pgi, frankfurt_intel and frankfurt_nag</entry>
                <entry testId="ERI.f19_g16.ICLM45BGC.frankfurt_pgi"                       failType="FAIL"  >Fails after reading clmforc.Li_2012_hdm_0.5x0.5_AVHRR_simyr1850-2010_c130401.nc.  This same test passes with yellowstone_intel, yellowstone_pgi, frankfurt_intel and frankfurt_nag</entry>
                <entry testId="SMS_Ld5.f19_g16.IRCP45CLM45BGC.frankfurt_pgi.clm-decStart" failType="FAIL"  >Fails after reading clmforc.Li_2012_hdm_0.5x0.5_AVHRR_simyr1850-2010_c130401.nc.  This same test passes with yellowstone_intel</entry>


CLM testing:

  build-namelist tests:

    yellowstone: YES
       All PASS or xFAIL

  regular tests (aux_clm):

    yellowstone_intel: YES
    yellowstone_pgi: YES
    frankfurt_intel: YES
    frankfurt_pgi: YES
    frankfurt_nag: YES

    All PASS or xFAIL        

  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    yellowstone_intel: YES      
       All PASS except for the following newly-passing tests (for
       which these failures are unsurprising):

       BFAIL2 ERI_D.ne30_g16.ICLM45BGC.yellowstone_intel.clm-vrtlay.compare_hist.clm4_5_23.clm2.h0 (baseline history file does not exist)
       BFAIL2 ERI_D.ne30_g16.ICLM45BGC.yellowstone_intel.clm-vrtlay.compare_hist.clm4_5_23.clm2.h1 (baseline history file does not exist)
       FAIL   ERS_D.f09_g16.ICLM45VIC.yellowstone_intel.clm-vrtlay.compare_hist.clm4_5_23.clm2.h0 
       FAIL   ERS_D.f09_g16.ICLM45VIC.yellowstone_intel.clm-vrtlay.compare_hist.clm4_5_23.clm2.h1 

    yellowstone_pgi: YES
       Some answer changes (presumably due to compiler change)

CLM tag used for the baseline comparisons: clm4_5_23
   Note: renamed baselines for frankfurt nag because test names have changed

Changes answers relative to baseline: YES

  If a tag changes answers relative to baseline comparison the
  following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations:
    - what platforms/compilers:
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 

        compsets using cism change answers for g2x gields

        many tests change answers with pgi, both on yellowstone &
        frankfurt, presumably due to new compiler

        nature of change not investigated


   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: N/A

   URL for LMWG diagnostics output used to validate new climate: N/A
	
===============================================================
===============================================================
Tag name:  clm4_5_23
Originator(s):  muszala (Stefan Muszala)
Date: Thu Aug 22 09:42:43 MDT 2013
One-line Summary: refactor to allow CH4 params. to be read from netcdf file and clean up clm4_5_20

Purpose of changes: 
   The second of two tags that brings in parameters that are read from netcdf file (ch4 parameters).  Please 
   see the ChangeLog entry for clm4_5_20.

   - Bring in ch4 parameters
   - Combine fconsts file and fpftcon file.  New file name is paramfile (clm_params.c130821.nc)
   - Refactor so that types, subroutine names and type instances have the names params in them (instead of consts)
   - Remove many ch4 namelist vars. since they are now read from the param file
   - Add new namelist called use_aereoxid_prog to control old aereoxid namelist

   A bulk of this work was completed by Rajendra Paudel.

Requirements for tag: N/A

Test level of tag: regular and build_namelist

Bugs fixed (include bugzilla ID): N/A

Known bugs (include bugzilla ID): N/A
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: N/A

Describe any changes made to the namelist: remove many optional ch4 namelists.
   add new namelist valled use_aereoxid_prog.

List any changes to the defaults for the boundary datasets: N/A

Describe any substantial timing or memory changes: N/A

Code reviewed by: self, dlawren, Rajendra Paudel

List any svn externals directories updated (csm_share, mct, etc.): scripts4_130730 -> scripts4_130816

List all files eliminated:

- these were renamed 
models/lnd/clm/src/clm4_5/biogeochem/CNSharedConstsMod.F90
models/lnd/clm/src/clm4_5/main/readConstantsMod.F90

List all files added and what they do:

- renamed 
models/lnd/clm/src/clm4_5/biogeochem/CNSharedParamsMod.F90
models/lnd/clm/src/clm4_5/main/readParamsMod.F90

List all existing files that have been modified, and describe the changes:

- refactor to remove old namelist vars. for ch4 and add new functionality
M       models/lnd/clm/bld/unit_testers/xFail/expectedClmTestFails.xml
M       models/lnd/clm/bld/build-namelist
M       models/lnd/clm/bld/namelist_files/namelist_definition_clm4_5.xml
M       models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_5.xml

- put in ch4 parameters and refactor const->params names
M       models/lnd/clm/src/clm4_5/biogeochem/CNGapMortalityMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNNitrifDenitrifMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNMRespMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/ch4Mod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNPhenologyMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/ch4varcon.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNDecompMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNDVMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNNDynamicsMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNAllocationMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNDecompCascadeBGCMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNSoilLittVertTranspMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNDecompCascadeCNMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_initializeMod.F90
M       models/lnd/clm/src/clm4_5/main/iniTimeConst.F90
M       models/lnd/clm/src/clm4_5/main/histFileMod.F90
M       models/lnd/clm/src/clm4_5/main/controlMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_varctl.F90
M       models/lnd/clm/src/clm4_5/main/initSoilParVICMod.F90
M       models/lnd/clm/src/clm4_5/main/pftvarcon.F90
M       models/lnd/clm/src/clm4_5/biogeophys/initSLakeMod.F90

CLM testing:

  build-namelist tests:

    yellowstone: OK.  Some changes to phys45 and phys45-crop.  Should be OK in next tag.

  regular tests (aux_clm): A few nlcomp differences that will go away in the next tag.  
     Other than a few expected failures due to new scripts entries, all OK.

    yellowstone_intel  OK        
    yellowstone_pgi    OK        
    frankfurt_intel    OK  
    frankfurt_pgi      OK     
    frankfurt_nag      OK 

  history file comparison with component_gen_comp and summarize_cprnc_diffs:

    yellowstone_intel  OK      
    yellowstone_pgi    OK

CLM tag used for the baseline comparisons:  clm4_5_22

Changes answers relative to baseline: No

===============================================================
===============================================================
Tag name:  clm4_5_22
Originator(s):  muszala (Stefan Muszala)
Date: Tue Jul 30 15:22:51 MDT 2013
One-line Summary: aux_clm testlist reorganization

Purpose of changes: 

    Reorganize all aux_clm tests and fix new failing tests.  As part of
    this, bring in a change from Maoyi for VIC w/vertical layers.
    A few bug fixes to get new tests working. 
    Why did we do this?

       1) better balance between frankfurt, yellowstone and various compilers
		 2) faster turn around time for development
       3) make sure current science functionality is properly tested
       4) removed outdated / irrelevant tests

    Other points:

       1) Introduce regular and short test list.  Testing now can consist of:

		    a) regular (must be run before handing off a tag to SEs and must be run
		       before committing a tag)
			 b) build_namelist (if namelists and/or build_system changed))
		    c) tools (only if tools are modified and no CLM source is modified)
			 d) short (for use during development and in rare cases where only a small
			       change with known behavior is added ... eg. a minor bug fix)
			 e) doc (no source testing required)

       2) PET tests will fail until threading is fixed in CLM

Requirements for tag: N/A

Test level of tag: regular.  ran tests with old testlists to double check any new mods.

Bugs fixed (include bugzilla ID): N/A

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: add no-vert:no-nitrif option to configure

Describe any changes made to the namelist: N/A

List any changes to the defaults for the boundary datasets: N/A

Describe any substantial timing or memory changes: N/A

Code reviewed by: self.  Extensive discussion regaring list content with Lawrence,
   Sacks, Kluzek and Andre.

List any svn externals directories updated (csm_share, mct, etc.): new scripts

List all files eliminated: N/A

List all files added and what they do: N/A

List all existing files that have been modified, and describe the changes: 

- add no-vert:no-nitrif option
M       models/lnd/clm/bld/configure
M       models/lnd/clm/bld/config_files/config_definition.xml
- Update expected failures
M       models/lnd/clm/bld/unit_testers/xFail/expectedClmTestFails.xml
- Maoyi VIC+vertical layers fix 
M       models/lnd/clm/src/clm4_5/main/clm_varcon.F90
M       models/lnd/clm/src/clm4_5/main/clm_varpar.F90
M       models/lnd/clm/src/clm4_5/main/iniTimeConst.F90
M       models/lnd/clm/src/clm4_5/biogeophys/Hydrology2Mod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SoilHydrologyMod.F90
- Update change log template
M       .ChangeLog_template
- Change intent out to inout for ciso_flux
M       models/lnd/clm/src/clm4_5/biogeochem/CNCIsoFluxMod.F90
- Remove crop_prog check to get rid of unassociated pointer with NAG
M       models/lnd/clm/src/clm4_5/main/clmtypeInitMod.F90
- Fix bounds type error (should be intent=in)
M       models/lnd/clm/src/clm4_5/main/histFileMod.F90

Machines testing ran on:  (Tests in priority order)

  Note:

     1) All PET tests will fail until openMP is fixed.
     2) All IG compsets fail with the NAG compiler due to non-compliant f77 code.
     3) If one combination fails, it's backed up with a another combination that passes.
          There are one or two exceptions to this.

   I) aux_clm tests with old testlists:

    yellowstone/aux_clm     intel - OK  
    yellowstone/aux_clm     pgi   - OK
    frankfurt/aux_clm       intel - OK 
    frankfurt/aux_clm       pgi   - OK 
    frankfurt/aux_clm       nag   - OK  

  CESM history file comparison:

    yellowstone/aux_clm     intel - OK

   II) aux_clm tests with new testlists:

    yellowstone/aux_clm     intel - OK
    yellowstone/aux_clm     pgi   - OK    
    frankfurt/aux_clm       intel - OK   
    frankfurt/aux_clm       pgi   - OK    
    frankfurt/aux_clm       nag   - OK   

   III) aux_clm_short tests with new testlists:

    yellowstone/aux_clm     intel - OK
    yellowstone/aux_clm     pgi   - OK    
    frankfurt/aux_clm       intel - OK   
    frankfurt/aux_clm       pgi   - OK    
    frankfurt/aux_clm       nag   - OK   

  CESM history file comparison: Not run since no baseline comparisons.

CLM tag used for the baseline comparison tests if applicable: CLM4_5_21 with old testlist.  Only ran generate with new testlists.

Changes answers relative to baseline: Only for VIC with vertical layers.

===============================================================
===============================================================
Tag name:  clm4_5_21
Originator(s):  muszala (Stefan Muszala)
Date: Wed Jul 24 14:23:19 MDT 2013
One-line Summary: ifdef and bounds refactor

Purpose of changes:  
- Almost all implementation by Mvertens
- Refactor ifdef use so that a majority are now in controlMod.F90.  This is the 
first step to removing them competely.
- Introduction of bounds_type and clump_type
- Refactor interfaces to support bounds_type and clump_type
- Bug fix from Sacks

Also: Changed layout of landunit, column and pft-level arrays: Previously, all
points for a given grid cell were grouped together. Now, all points for a given
landunit type are grouped together. This improves performance of loops over
filters, because it leads to more memory locality  this will be especially true
when we add more 0-weight points to arrays for the purpose of dynamic
landunits. For example, if a processor has 2 grid cells and there are 3 landunit
types:

Old layout in memory: (G1L1, G1L2, G1L3, G2L1, G2L2, G2L3)
New layout in memory: (G1L1, G2L1, G1L2, G2L2, G1L3, G2L3)


Requirements for tag: N/A

Test level of tag: standard

Bugs fixed (include bugzilla ID): N/A

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: N/A

Describe any changes made to the namelist: N/A

List any changes to the defaults for the boundary datasets: N/A

Describe any substantial timing or memory changes: N/A

Code reviewed by: mvertens, sacks, self

List any svn externals directories updated (csm_share, mct, etc.): N/A

List all files eliminated:

D       models/lnd/clm/src/util_share/decompInitMod.F90
D       models/lnd/clm/src/util_share/ndepStreamMod.F90
D       models/lnd/clm/src/util_share/decompMod.F90
D       models/lnd/clm/src/clm4_5/main/initParametersMod.F90

List all files added and what they do:

A  +    models/lnd/clm/src/clm4_5/main/decompInitMod.F90
A  +    models/lnd/clm/src/clm4_5/main/ndepStreamMod.F90
A  +    models/lnd/clm/src/clm4_5/main/decompMod.F90
A  +    models/lnd/clm/src/clm4_0/main/decompInitMod.F90
A  +    models/lnd/clm/src/clm4_0/main/ndepStreamMod.F90
A  +    models/lnd/clm/src/clm4_0/main/decompMod.F90

List all existing files that have been modified, and describe the changes:

M       models/lnd/clm/doc/ChangeLog
M       models/lnd/clm/doc/ChangeSum
M       models/lnd/clm/src/cpl_share/clm_cpl_indices.F90
M       models/lnd/clm/src/cpl_mct/lnd_comp_mct.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNCStateUpdate2Mod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNGapMortalityMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNNitrifDenitrifMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNGRespMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CropRestMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/initch4Mod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNNStateUpdate1Mod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNBalanceCheckMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNNStateUpdate3Mod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNFireMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNMRespMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/MEGANFactorsMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNVerticalProfileMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/ch4RestMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNWoodProductsMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNCIsoFluxMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNPrecisionControlMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/ch4Mod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNSummaryMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/DUSTMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNDVLightMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNPhenologyMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/ch4varcon.F90
M       models/lnd/clm/src/clm4_5/biogeochem/STATICEcosysDynMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNDecompMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNCStateUpdate1Mod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNDVMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNCStateUpdate3Mod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/VOCEmissionMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNrestMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNDVEcosystemDynIniMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNAnnualUpdateMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNNStateUpdate2Mod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNNDynamicsMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNAllocationMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/DryDepVelocity.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNEcosystemDynMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNDecompCascadeBGCMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNSetValueMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNVegStructUpdateMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNSoilLittVertTranspMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNDVEstablishmentMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNDecompCascadeCNMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNC14DecayMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNSharedConstsMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_varcon.F90
M       models/lnd/clm/src/clm4_5/main/clm_varpar.F90
M       models/lnd/clm/src/clm4_5/main/CNiniTimeVar.F90
M       models/lnd/clm/src/clm4_5/main/dynlandMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_initializeMod.F90
M       models/lnd/clm/src/clm4_5/main/subgridRestMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_glclnd.F90
M       models/lnd/clm/src/clm4_5/main/accFldsMod.F90
M       models/lnd/clm/src/clm4_5/main/subgridMod.F90
M       models/lnd/clm/src/clm4_5/main/clmtypeInitMod.F90
M       models/lnd/clm/src/clm4_5/main/pftdynMod.F90
M       models/lnd/clm/src/clm4_5/main/iniTimeConst.F90
M       models/lnd/clm/src/clm4_5/main/histFileMod.F90
M       models/lnd/clm/src/clm4_5/main/pft2colMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_atmlnd.F90
M       models/lnd/clm/src/clm4_5/main/clm_varsur.F90
M       models/lnd/clm/src/clm4_5/main/restFileMod.F90
M       models/lnd/clm/src/clm4_5/main/controlMod.F90
M       models/lnd/clm/src/clm4_5/main/initSurfAlbMod.F90
M       models/lnd/clm/src/clm4_5/main/filterMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_varctl.F90
M       models/lnd/clm/src/clm4_5/main/clm_driver.F90
M       models/lnd/clm/src/clm4_5/main/subgridAveMod.F90
M       models/lnd/clm/src/clm4_5/main/initGridCellsMod.F90
M       models/lnd/clm/src/clm4_5/main/initSoilParVICMod.F90
M       models/lnd/clm/src/clm4_5/main/CNiniSpecial.F90
M       models/lnd/clm/src/clm4_5/main/pftvarcon.F90
M       models/lnd/clm/src/clm4_5/main/surfrdMod.F90
M       models/lnd/clm/src/clm4_5/main/readConstantsMod.F90
M       models/lnd/clm/src/clm4_5/main/clmtype.F90
M       models/lnd/clm/src/clm4_5/main/reweightMod.F90
M       models/lnd/clm/src/clm4_5/main/mkarbinitMod.F90
M       models/lnd/clm/src/clm4_5/main/histFldsMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/BalanceCheckMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SoilTemperatureMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SLakeFluxesMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/UrbanInputMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SnowHydrologyMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/Biogeophysics1Mod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/FrictionVelocityMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/TridiagonalMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SLakeHydrologyMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/Hydrology1Mod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/BiogeophysRestMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/UrbanMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/ActiveLayerMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/QSatMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/clm_driverInitMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/CLMVICMapMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SLakeTemperatureMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SNICARMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/BareGroundFluxesMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/CanopyFluxesMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/initSLakeMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SurfaceRadiationMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/H2OSfcMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/Biogeophysics2Mod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/UrbanInitMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/FracWetMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SLakeRestMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SurfaceAlbedoMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/Hydrology2Mod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/BandDiagonalMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SoilHydrologyMod.F90
M       models/lnd/clm/src/cpl_esmf/lnd_comp_esmf.F90
M       models/lnd/clm/src/clm4_0/main/clm_initializeMod.F90
M       models/lnd/clm/src/clm4_0/main/clm_glclnd.F90
M       models/lnd/clm/src/clm4_0/main/clm_atmlnd.F90
M       models/lnd/clm/src/clm4_0/main/controlMod.F90
M       models/lnd/clm/src/clm4_0/main/clm_varctl.F90
M       models/lnd/clm/src/clm4_0/main/clm_driver.F90

Machines testing ran on:  (Tests in priority order)

  build-namelist unit tester:   Not run

  CESM test lists:

    yellowstone/aux_clm     intel       BFB
    yellowstone/aux_clm     pgi         BFB 
    frankfurt/aux_clm       intel       BFB 
    frankfurt/aux_clm       pgi         BFB 
    frankfurt/aux_clm       nag         BFB 

  CESM history file comparison:

    yellowstone/aux_clm     intel       BFB

CLM tag used for the baseline comparison tests if applicable: clm4_5_20

Changes answers relative to baseline: No

===============================================================
===============================================================
Tag name:  clm4_5_20
Originator(s):  muszala (Stefan Muszala,UCAR/CGD,303-497-1320)
Date: Sat Jul 20 10:54:43 MDT 2013
One-line Summary: refactor to allow CN and BGC params. to be read from netcdf file

Purpose of changes:

The first of two tags that allows all parameters to be read from a netcdf file to
provide sensitivity analysis capability, to increase modularity of code and to
remove "magic numbers" from code.  This tag introduces a new namelist variable
"fconsts" which points to a netcdf file of CN and BGC parameters.  In a future
tag, this netcdf file will be combined with CH4 parameters and PFT parameters.

Values are read in readConstantsMod.F90.  Each module that requires
a parameter provides a read subroutine.  That read subroutine is called 
from readConstantsMod.F90 and places parameters into a private type 
for that module.  For example, CNDecompMod.F90 provides readCNDecompConsts which 
is called from readConstantsMod and populates the type instance CNConstShareInst.
CHConstShareInst is then used in CNDecompMod as:

+ sminn_to_denit_decomp_cascade_vr(c,j,k) = -CNDecompConstInst%dnp * pmnf_decomp_cascade(c,j,k

which replaces:

- dnp = 0.01_r8
...
- sminn_to_denit_decomp_cascade_vr(c,j,k) = -dnp * pmnf_decomp_cascade(c,j,k)

A bulk of this work was completed by Rajendra Paudel.

Requirements for tag: N/A

Test level of tag: standard

Bugs fixed (include bugzilla ID): N/A

Known bugs (include bugzilla ID): N/A
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: N/A

Describe any changes made to the namelist: new namelist variable called fconsts.

List any changes to the defaults for the boundary datasets: N/A

Describe any substantial timing or memory changes: N/A

Code reviewed by: self, D. Lawrence, R. Paudel.  (for design: discussion w/ mvertens, sacks, kluzek)

List any svn externals directories updated (csm_share, mct, etc.): N/A

List all files eliminated:

Renamed
D       models/lnd/clm/src/clm4_5/biogeochem/CNDecompCascadeMod_BGC.F90
D       models/lnd/clm/src/clm4_5/biogeochem/CNDecompCascadeMod_CENTURY.F90

List all files added and what they do:

Rename of Deleted files
A  +    models/lnd/clm/src/clm4_5/biogeochem/CNDecompCascadeBGCMod.F90
A  +    models/lnd/clm/src/clm4_5/biogeochem/CNDecompCascadeCNMod.F90

Module to read parameters shared by multiple modules
A  +    models/lnd/clm/src/clm4_5/biogeochem/CNSharedConstsMod.F90

Module that reads shared an private parameters
A  +    models/lnd/clm/src/clm4_5/main/readConstantsMod.F90

List all existing files that have been modified, and describe the changes:

Add fconsts namelist variable
M       models/lnd/clm/bld/build-namelist
M       models/lnd/clm/bld/namelist_files/namelist_definition_clm4_5.xml
M       models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_5.xml

Add in functionality to read parameters off of netcdf file
M       models/lnd/clm/src/clm4_5/biogeochem/CNGapMortalityMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNNitrifDenitrifMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNMRespMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/ch4Mod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNPhenologyMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNDecompMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNNDynamicsMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNAllocationMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNSoilLittVertTranspMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_initializeMod.F90
M       models/lnd/clm/src/clm4_5/main/iniTimeConst.F90
M       models/lnd/clm/src/clm4_5/main/controlMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_varctl.F90

Machines testing ran on:  (Tests in priority order)

  build-namelist unit tester:   OK.  These FAILs should pass next round:

  418/444 < FAIL> <Test Id: 418> <Desc: lnd_in file the same as expected for phys45>  
  423/444 < FAIL> <Test Id: 423> <Desc: lnd_in file the same as expected for phys45>  
  428/444 < FAIL> <Test Id: 428> <Desc: lnd_in file the same as expected for phys45>  
  433/444 < FAIL> <Test Id: 433> <Desc: lnd_in file the same as expected for phys45>  
  438/444 < FAIL> <Test Id: 438> <Desc: lnd_in file the same as expected for phys45>  
  443/444 < FAIL> <Test Id: 443> <Desc: lnd_in file the same as expected for phys45-crop> 

  CESM test lists:

CLM45 compsets have failures for nlcomp due to the introduction of fconsts namelist variable.
For example:

FAIL ERI.f19_g16.IG1850CLM45.yellowstone_pgi.GC.test20Pgi.nlcomp
FAIL ERH_D.f19_g16.I1850CLM45CN.yellowstone_intel.GC.test20Intel.nlcomp

    yellowstone/aux_clm     intel    OK   
    yellowstone/aux_clm     pgi      OK  
    frankfurt/aux_clm       intel    OK   
    frankfurt/aux_clm       pgi      OK 
    frankfurt/aux_clm       nag      OK

  CLM history file comparison:

    yellowstone/aux_clm     intel    OK

CLM tag used for the baseline comparison tests if applicable: clm4_5_19

Changes answers relative to baseline: No

===============================================================
===============================================================
Tag name:  clm4_5_19
Originator(s):  sacks (Bill Sacks,UCAR/CGD,303-497-1762)
Date: Wed Jul 17 14:29:32 MDT 2013
One-line Summary: fix setting of bd in iniTimeConst

Purpose of changes:

In iniTimeConst, bd (bulk density) was being set incorrectly, so that,
for a given processor, the same value was being put in all (c,j)
locations. In addition to being incorrect, this meant that results
differed depending on processor count. This tag fixes this problem.

This only affects CLM4.5 BGC runs, because the bd array is only used
in CNNitrifDenitrifMod.F90. (However, as a side note: This array
SHOULD be used in DUSTMod and initSLakeMod, which currently recompute
bd.)


Requirements for tag:

Test level of tag: 

Bugs fixed (include bugzilla ID):
   1736 (bd set incorrectly in iniTimeConst, leads to results that depend on processor count)

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: mvertens

List any svn externals directories updated (csm_share, mct, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

M       models/lnd/clm/src/clm4_5/main/iniTimeConst.F90


Machines testing ran on:  (Tests in priority order)

  build-namelist unit tester:   NO

  CESM test lists:

    yellowstone/aux_clm     intel       yes ***
       All PASS or xFAIL
    yellowstone/aux_clm     pgi         yes
       All PASS
    frankfurt/aux_clm       intel       yes **
       All PASS
    frankfurt/aux_clm       pgi         yes
       All PASS
    frankfurt/aux_clm       nag         yes
       All PASS

  CESM history file comparison:
  (ccsm_utils/Tools/component_gen_comp -compare $oldtag -generate $newtag -testid $testid -baselineroot $CESMDATAROOT/ccsm_baselines/ -model clm2)

    yellowstone/aux_clm     intel       yes **
       All PASS or BFAIL1 except CLM45BGC comparisons

  test_driver.sh tools testing:

    yellowstone interactive:    no
    frankfurt interactive:      no

  yellowstone/PTCLM:            no

CLM tag used for the baseline comparison tests if applicable: clm4_5_18

Changes answers relative to baseline: YES

IF tag changes answers relative to baseline comparison the
following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: All CLM45BGC
    - what platforms/compilers: All
    - nature of change (roundoff; larger than roundoff/same climate; new climate): 
        Larger than roundoff; still to be determined if this gives new
        climate (Dave Lawrence will run a simulation to determine this)

   If bitwise differences were observed, how did you show they were no worse
   than roundoff? N/A

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)
       - casename: (Not yet done)

   URL for LMWG diagnostics output used to validate new climate: (Not
   yet done)
	
===============================================================
===============================================================
Tag name:  clm4_5_18
Originator(s):  sacks (Bill Sacks,UCAR/CGD,303-497-1762)
Date: Tue Jul  9 10:07:08 MDT 2013
One-line Summary: rework urban indexing

Purpose of changes:

Change urban derived type and local variables in UrbanMod subroutines to go
lbl:ubl rather than 1:num_urbanl. There are a few reasons for this: (1) this
works better when the urban filter can change (with dynamic landunits), (2) more
consistency with the rest of the CLM code, (3) no longer have to remember
whether a given variable should be indexed by fl or l. The downside is that it
leads to slightly greater memory use.

Along with doing this, I also changed a few loops in UrbanMod to be simpler
(which is allowed with the above change).

Also, no longer run over 0-weight urban columns - we don't have to do this any
more now that I have reworked some loops in UrbanMod.


Requirements for tag:

Test level of tag: standard

Bugs fixed (include bugzilla ID):

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: None

Describe any changes made to the namelist: None

List any changes to the defaults for the boundary datasets: None

Describe any substantial timing or memory changes: 

   Increase in memory use by UrbanMod, which should lead to a small overall
   memory increase - though this doesn't show up in most memcomp tests, showing
   that the increase is pretty small.

Code reviewed by: self

List any svn externals directories updated (csm_share, mct, etc.): None

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

========= Major changes to indexing: local variables now dimensioned lbl:ubl
          rather than 1:num_urbanl. Also, remove canyon_hwr, wtroad_perv,
          ht_roof and wtlunit_roof from urban_params, because there are
          duplicate variables in clmtype.
M       models/lnd/clm/src/clm4_5/biogeophys/UrbanMod.F90

========= No longer make 0-weight urban columns active
M       models/lnd/clm/src/clm4_5/main/reweightMod.F90

========= Remove unused wind_hgt_canyon from clmtype
M       models/lnd/clm/src/clm4_5/main/clmtype.F90
M       models/lnd/clm/src/clm4_5/main/clmtypeInitMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/UrbanInitMod.F90

========= Minor changes for new UrbanMod interfaces
M       models/lnd/clm/src/clm4_5/main/clm_initializeMod.F90
M       models/lnd/clm/src/clm4_5/main/initSurfAlbMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_driver.F90



Machines testing ran on:  (Tests in priority order)
  Standard Tag Pretag ***                    Standard Tag Posttag **

  build-namelist unit tester:   NO

  CESM test lists:

    yellowstone/aux_clm     intel       yes ***
       All PASS or xFAIL
    yellowstone/aux_clm     pgi         yes **
       All PASS
    frankfurt/aux_clm       intel       yes **
       All PASS
    frankfurt/aux_clm       pgi         yes
       All PASS, except the following, which appears to be a system problem:
          FAIL  ERI_D.f19_g16.ICLM45.frankfurt_pgi.GC.214513 
       I will rerun the above test once the system problem is resolved
    frankfurt/aux_clm       nag         yes
       All PASS

  CESM history file comparison:
  (ccsm_utils/Tools/component_gen_comp -compare $oldtag -generate $newtag -testid $testid -baselineroot $CESMDATAROOT/ccsm_baselines/ -model clm2)

    yellowstone/aux_clm     intel       yes **
       All PASS or BFAIL, except the following expected failures:

       *** Expected failures because of failures in the base tests
       FAIL   ERS.f09_g16.ICLM45VIC.yellowstone_intel.clm-vrtlay.compare_hist.clm4_5_17.clm2.h0 
       FAIL   ERS.f09_g16.ICLM45VIC.yellowstone_intel.clm-vrtlay.compare_hist.clm4_5_17.clm2.h1 
       FAIL   ERS_Ld211_D_P112x1.f10_f10.ICNCROP.yellowstone_intel.clm-crop.compare_hist.clm4_5_17.clm2.h0 (no history file in test case)

       *** Expected differences in cols1d_active and pfts1d_active, as well as
           FILLDIFFs, due to making 0-weight urban columns no longer active
       FAIL   ERI_D.f10_f10.ICLM45BGC.yellowstone_intel.clm-vrtlay.compare_hist.clm4_5_17.clm2.h1 
       FAIL   ERS_D.f10_f10.ICLM45BGCNoVS.yellowstone_intel.clm-rootlit.compare_hist.clm4_5_17.clm2.h1 
       FAIL   ERS_D.f10_f10.ICLM45BGC.yellowstone_intel.clm-ch4_set2_ciso.compare_hist.clm4_5_17.clm2.h1 
       FAIL   ERS_D.f10_f10.ICLM45BGC.yellowstone_intel.clm-ch4_set3_pftroot.compare_hist.clm4_5_17.clm2.h1 
       FAIL   ERS_D.f19_g16.ICLM45GLCMEC.yellowstone_intel.clm-glcMEC.compare_hist.clm4_5_17.clm2.h1 
       FAIL   ERS.f19_g16.I1850CLM45BGC.yellowstone_intel.clm-default.compare_hist.clm4_5_17.clm2.h1 
       FAIL   ERS.f19_g16.ICRUCLM45BGCCROP.yellowstone_intel.clm-default.compare_hist.clm4_5_17.clm2.h1 
       FAIL   ERS_Ld3_D_P64x1.ne30_g16.ICLM45CN.yellowstone_intel.clm-default.compare_hist.clm4_5_17.clm2.h1 
       FAIL   SSP.f19_g16.I1850CLM45BGC.yellowstone_intel.clm-default.compare_hist.clm4_5_17.clm2.h1 
       

  test_driver.sh tools testing:

    yellowstone interactive:    no
    frankfurt interactive:      no

  yellowstone/PTCLM:            no

CLM tag used for the baseline comparison tests if applicable: clm4_5_17

Changes answers relative to baseline: NO, except for inconsequential changes in
1-d hist files (cols1d_active, pfts1d_active, and some FILLDIFFS, due to making
0-weight urban columns no longer active)
	
===============================================================
===============================================================
Tag name:  clm4_5_17
Originator(s):  sacks (Bill Sacks,UCAR/CGD,303-497-1762)
Date: Wed Jul  3 10:54:03 MDT 2013
One-line Summary: misc cleanup and bug fixes

Purpose of changes: 

Bit-for-bit cleanup following from tag clm4_5_11. The biggest change is the
removal of maxpatch, npatch_* and some related variables from clm_varpar (these
were maintenance headaches).


Requirements for tag:

Test level of tag: standard + tools

Bugs fixed (include bugzilla ID):

     1747 (need 1x1_tropicAtl datasets)
     1754 (mksurfdata_map problem making CH4 parameters for ne240 CLM4.5 surface dataset)

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: None

Describe any changes made to the namelist: None

List any changes to the defaults for the boundary datasets: New 1x1_tropicAtl datasets

Describe any substantial timing or memory changes: None

Code reviewed by: self

List any svn externals directories updated (csm_share, mct, etc.): None

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

========= Remove maxpatch, npatch_* and a few related variables that are no
          longer needed (these variables were a maintenance headache)
M       models/lnd/clm/src/clm4_5/main/clm_varpar.F90

========= Rework code to not require the variables that were removed from clm_varpar
M       models/lnd/clm/src/clm4_5/biogeophys/Biogeophysics1Mod.F90
M       models/lnd/clm/src/util_share/ncdio_pio.F90

========= Remove unneeded 'use' statements
M       models/lnd/clm/src/clm4_5/main/subgridAveMod.F90

========= Allow roundoff-level errors (needed to make ne240 dataset)
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/mkCH4inversionMod.F90

========= Fix generation of 1x1_tropicAtl datasets
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/mksurfdata.pl

========= New 1x1_tropicAtl datasets
M       models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_5.xml



Machines testing ran on:  (Tests in priority order)
  Standard Tag Pretag ***                    Standard Tag Posttag **

  build-namelist unit tester:   yes
     All PASS or xFAIL

  CESM test lists:

    yellowstone/aux_clm     intel       yes ***
       All PASS or xFAIL
    yellowstone/aux_clm     pgi         yes **
       All PASS
    frankfurt/aux_clm       intel       yes **
       All PASS
    frankfurt/aux_clm       pgi         yes
       All PASS
    frankfurt/aux_clm       nag         yes
       All PASS

    Additional tests (with comparison to clm4_5_16, including
    component_gen_comp; for the FARM test, used a sandbox corresponding to
    cesm1_3_alpha01a for components other than CLM):

       ERS_Ly5.f10_f10.I20TRCRUCLM45BGC.yellowstone_intel.clm-monthly_noinitial
       SMS.T42_T42.FARM95C4.yellowstone_intel.clm-daily 
          [the clm-daily nl dir just sets hist_nhtfrq = -24]
    

  CESM history file comparison:
  (ccsm_utils/Tools/component_gen_comp -compare $oldtag -generate $newtag -testid $testid -baselineroot $CESMDATAROOT/ccsm_baselines/ -model clm2)

    yellowstone/aux_clm     intel       yes **
       All PASS or BFAIL1, except irrelevant failures from this failing test:
       FAIL   ERS.f09_g16.ICLM45VIC.yellowstone_intel.clm-vrtlay.compare_hist.clm4_5_16.clm2.h0 
       FAIL   ERS.f09_g16.ICLM45VIC.yellowstone_intel.clm-vrtlay.compare_hist.clm4_5_16.clm2.h1 

  test_driver.sh tools testing:

    yellowstone interactive:    yes
       All PASS except expected failures:

       027 smiS4 TSMscript_tools.sh shared ncl_scripts getregional_datasets.pl getregional .............\c
        rc=6 FAIL
       028 bliS4 TBLscript_tools.sh shared ncl_scripts getregional_datasets.pl getregional .............\c
        rc=4 FAIL


    frankfurt interactive:      no

  yellowstone/PTCLM:            no

CLM tag used for the baseline comparison tests if applicable: clm4_5_16

Changes answers relative to baseline: NO

===============================================================
===============================================================
Tag name:  clm4_5_16
Originator(s):  sacks (Bill Sacks,UCAR/CGD,303-497-1762)
Date: Tue Jul  2 09:22:41 MDT 2013
One-line Summary: only run filters over 'active' points

Purpose of changes:

In preparation for dynamic landunits, we only want to run most filters over
'active' points. This required changing landunit and column-level filters to
only run over active points. In addition, I changed the nourbanp filter to only
run over active points (in contrast to other pft-level filters, this filter had
previously operated over non-active points, too).

In addition, this tag includes some related changes, most of which were required
to get the code to run correctly in light of the above changes. Some of these
changes - in particular, the changes to reweightMod, filterMod, and the use of
the new filter_inactive_and_active in some places - effectively undid that
general filter change for select landunits (urban) or subroutine calls.


Requirements for tag:

Test level of tag: standard

Bugs fixed (include bugzilla ID):

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: none

Describe any changes made to the namelist: none

List any changes to the defaults for the boundary datasets: none

Describe any substantial timing or memory changes: none

Code reviewed by: changes to filterMod reviewed by erik, mvertens,
                  stefan, dave lawrence & ben andre; other changes
                  only by self

List any svn externals directories updated (csm_share, mct, etc.): none

List all files eliminated: none

List all files added and what they do: none

List all existing files that have been modified, and describe the changes:

========= Change main filters to just run over active points; add new filters
          that include inactive as well as active points; refactor subroutines
          to avoid code duplication now that we have two groups of filters
M       models/lnd/clm/src/clm4_5/main/filterMod.F90

========= Change filter to just run over active points
M       models/lnd/clm/src/clm4_5/main/pft2colMod.F90

========= Change urban columns & pfts to be active whenever their landunit is
          active (to avoid making urban code messier)
M       models/lnd/clm/src/clm4_5/main/reweightMod.F90

========= Get rid of wt > 0 checks, which are no longer appropriate in the code
          (checks of the active flags should be done instead - and these have
          been folded in to the filters)
M       models/lnd/clm/src/clm4_5/biogeophys/UrbanMod.F90

========= Make a loop more consistent in its use of a filter; remove undesirable
          pactive check (because decomp_vertprofiles now sometimes operates on
          inactive as well as active points)
M       models/lnd/clm/src/clm4_5/biogeochem/CNVerticalProfileMod.F90

========= Use filters that include inactive points in call to
          decomp_vertprofiles (this is needed because of the unusual placement
          of this routine in the driver sequence)
M       models/lnd/clm/src/clm4_5/main/clm_driver.F90

========= Use filters that include inactive points in calls to SurfaceAlbedo and
          UrbanAlbedo. For SurfaceAlbedo, this is necessary to avoid floating
          point exceptions in transient cases; for UrbanAlbedo, this probably
          isn't necessary now, but likely will be needed when we have dynamic
          landunits, for the same reason that we need it for SurfaceAlbedo.
M       models/lnd/clm/src/clm4_5/main/initSurfAlbMod.F90

========= Remove pactive check in setting up vegsol / novegsol filters - as far
          as I can tell, this check is now unnecessary, and it led to the odd
          result that novegsol included all inactive points (e.g., even inactive
          istsoil points). Also add some comments and remove some obsolete
          comments.
M       models/lnd/clm/src/clm4_5/biogeophys/SurfaceAlbedoMod.F90

========= Remove pactive checks that are unnecessary now that the nourbanp
          definition has changed
M       models/lnd/clm/src/clm4_5/biogeophys/SurfaceRadiationMod.F90

========= Only check errsoi_col on active columns (to prevent NaN-related
          problems in crop runs)
M       models/lnd/clm/src/clm4_5/biogeophys/BalanceCheckMod.F90

========= Add comments
M       models/lnd/clm/src/clm4_5/main/CNiniSpecial.F90
M       models/lnd/clm/src/clm4_5/biogeophys/ActiveLayerMod.F90




Machines testing ran on:  (Tests in priority order)

  build-namelist unit tester:   yes
     All PASS or xFAIL

  CESM test lists:

    yellowstone/aux_clm     intel       yes
       All PASS or xFail

       Also ran the following, which PASSes (also PASSes cpl & clm
       hist comparisons, except for expected failures in .h1 file
       comparisons, as below):
       ERS_Ly5.f10_f10.I20TRCRUCLM45BGC.yellowstone_intel.clm-monthly_noinitial

    yellowstone/aux_clm     pgi         yes
       All PASS

    frankfurt/aux_clm       intel       yes
       All PASS
    frankfurt/aux_clm       pgi         yes
       All PASS
    frankfurt/aux_clm       nag         yes
       All PASS

  CESM history file comparison:
  (ccsm_utils/Tools/component_gen_comp -compare $oldtag -generate $newtag -testid $testid -baselineroot $CESMDATAROOT/ccsm_baselines/ -model clm2)

    yellowstone/aux_clm     intel       yes
       All PASS, except:
       *** Irrelevant, because this test fails
       FAIL   ERS.f09_g16.ICLM45VIC.yellowstone_intel.clm-vrtlay.compare_hist.clm4_5_15.clm2.h0 
       FAIL   ERS.f09_g16.ICLM45VIC.yellowstone_intel.clm-vrtlay.compare_hist.clm4_5_15.clm2.h1 

       *** Expected diffs in h1 files: differences in cols1d_active,
           pfts1d_active, and related FILLDIFFs in a number of variables
       FAIL   ERI_D.f10_f10.ICLM45BGC.yellowstone_intel.clm-vrtlay.compare_hist.clm4_5_15.clm2.h1 
       FAIL   ERS_D.f10_f10.ICLM45BGCNoVS.yellowstone_intel.clm-rootlit.compare_hist.clm4_5_15.clm2.h1 
       FAIL   ERS_D.f10_f10.ICLM45BGC.yellowstone_intel.clm-ch4_set2_ciso.compare_hist.clm4_5_15.clm2.h1 
       FAIL   ERS_D.f10_f10.ICLM45BGC.yellowstone_intel.clm-ch4_set3_pftroot.compare_hist.clm4_5_15.clm2.h1 
       FAIL   ERS_D.f19_g16.ICLM45GLCMEC.yellowstone_intel.clm-glcMEC.compare_hist.clm4_5_15.clm2.h1 
       FAIL   ERS.f19_g16.I1850CLM45BGC.yellowstone_intel.clm-default.compare_hist.clm4_5_15.clm2.h1 
       FAIL   ERS.f19_g16.ICRUCLM45BGCCROP.yellowstone_intel.clm-default.compare_hist.clm4_5_15.clm2.h1 
       FAIL   ERS_Ld3_D_P64x1.ne30_g16.ICLM45CN.yellowstone_intel.clm-default.compare_hist.clm4_5_15.clm2.h1 
       FAIL   SSP.f19_g16.I1850CLM45BGC.yellowstone_intel.clm-default.compare_hist.clm4_5_15.clm2.h1 

  test_driver.sh tools testing:

    yellowstone interactive:    no
    frankfurt interactive:      no

  yellowstone/PTCLM:            no

CLM tag used for the baseline comparison tests if applicable: clm4_5_15

Changes answers relative to baseline: NO, except for changes in fill
patterns & active flags in 1-d hist files, as noted above

===============================================================
===============================================================
Tag name:  clm4_5_15
Originator(s):  muszala (Stefan Muszala)
Date: Mon Jul  1 10:44:05 MDT 2013
One-line Summary: complete associate refactor for pointers in clm4_5 source

Purpose of changes:  Refactor all clm4_5 source so that pointers assignements are
   placed in associate blocks at the start of a subroutine.  This allows us to 
   get rid of pointer declarations, makes the code easier to modify, makes the
   code more robust and sets us up for future interface refactorings.  The refactor is
   explained in more detail in models/lnd/clm/tools/clm4_5/refactorTools/README.

-    real(r8), pointer :: fdry(:)           ! fraction of foliage that is green and dry [-] (new)
-    fdry => pps%fdry
+   associate(& 
+   fdry               => pps%fdry             & ! Output: [real(r8) (:)]  fraction of foliage that is green and dry [-] (new)
+   )
 ...
-  end subroutine FracWet
+    end associate 
+   end subroutine FracWet

Requirements for tag: N/A

Test level of tag: standard

Bugs fixed (include bugzilla ID): N/A

Known bugs (include bugzilla ID): N/A
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: N/A

Describe any changes made to the namelist: N/A

List any changes to the defaults for the boundary datasets: N/A

Describe any substantial timing or memory changes:  BGC compsets will see increases
   in memory (highwater) use.  This can be seen in memcomp portions of testing with
   one specific example.  Something to keep track of.

      FAIL  ERS.f19_g16.I1850CLM45BGC.yellowstone_intel.clm-default.GC.4515preIntel.memcomp.clm4_5_14 
         - highwater goes from 166 MB in clm4_5_14 to 236 MB in clm4_5_15
      FAIL  ERS.f19_g16.I1850CLM45BGC.yellowstone_intel.rtm-rtmOff.GC.4515preIntel.memcomp.clm4_5_14 
      FAIL  ERS.f19_g16.I1850CLM45BGC.yellowstone_intel.rtm-rtmOnFloodOnEffvelOff.GC.4515preIntel.memcomp.clm4_5_14 
      FAIL  ERS.f19_g16.I1850CLM45BGC.yellowstone_intel.rtm-rtmOnFloodOnEffvelOn.GC.4515preIntel.memcomp.clm4_5_14 
      FAIL  ERS.f19_g16.I1850CLM45BGC.yellowstone_intel.rtm-rtmOnIceOn.GC.4515preIntel.memcomp.clm4_5_14 
      FAIL  ERS.f19_g16_r01.I1850CLM45BGC.yellowstone_intel.rtm-rtmOnFloodOnEffvelOff.GC.4515preIntel.memcomp.clm4_5_14 

Code reviewed by: self, mvertens

List any svn externals directories updated (csm_share, mct, etc.): N/A

List all files eliminated: N/A

List all files added and what they do: 

A       models/lnd/clm/tools/clm4_5/refactorTools/associate/refactor_new.pl
A       models/lnd/clm/tools/clm4_5/refactorTools/associate/README

List all existing files that have been modified, and describe the changes:

M       models/lnd/clm/src/clm4_5/biogeochem/CNCStateUpdate2Mod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNGapMortalityMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNNitrifDenitrifMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNGRespMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CropRestMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/initch4Mod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNNStateUpdate1Mod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNBalanceCheckMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNNStateUpdate3Mod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNFireMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNMRespMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNDecompCascadeMod_BGC.F90
M       models/lnd/clm/src/clm4_5/biogeochem/MEGANFactorsMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNVerticalProfileMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNCIsoFluxMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNPrecisionControlMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/ch4Mod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNSummaryMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/DUSTMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNDVLightMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNPhenologyMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNDecompMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNCStateUpdate1Mod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNDVMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNCStateUpdate3Mod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/VOCEmissionMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNrestMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNAnnualUpdateMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNNStateUpdate2Mod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNDecompCascadeMod_CENTURY.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNNDynamicsMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNAllocationMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/DryDepVelocity.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNEcosystemDynMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNSetValueMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNVegStructUpdateMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNSoilLittVertTranspMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNDVEstablishmentMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNC14DecayMod.F90
M       models/lnd/clm/src/clm4_5/main/clmtypeInitMod.F90
M       models/lnd/clm/src/clm4_5/main/pftdynMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_atmlnd.F90
M       models/lnd/clm/src/clm4_5/main/mkarbinitMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/BalanceCheckMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SoilTemperatureMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SLakeFluxesMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/UrbanInputMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SnowHydrologyMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/Biogeophysics1Mod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/FrictionVelocityMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/TridiagonalMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SLakeHydrologyMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/Hydrology1Mod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/BiogeophysRestMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/UrbanMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/ActiveLayerMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/clm_driverInitMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/CLMVICMapMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SLakeTemperatureMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/BareGroundFluxesMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SNICARMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/CanopyFluxesMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SurfaceRadiationMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/initSLakeMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/H2OSfcMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/Biogeophysics2Mod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/FracWetMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/UrbanInitMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SLakeRestMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SurfaceAlbedoMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/Hydrology2Mod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SoilHydrologyMod.F90

Machines testing ran on:  (Tests in priority order)
  build-namelist unit tester:   OK

  CESM test lists:

    yellowstone/aux_clm     intel       OK
    yellowstone/aux_clm     pgi         OK
    frankfurt/aux_clm       intel       OK
    frankfurt/aux_clm       pgi         OK
    frankfurt/aux_clm       nag         OK

  CESM history file comparison:

    yellowstone/aux_clm                 OK

CLM tag used for the baseline comparison tests if applicable: clm4_5_14

Changes answers relative to baseline: NO

===============================================================
===============================================================
Tag name:  clm4_5_14
Originator(s):  muszala (Stefan Muszala)
Date:  Thu Jun 20 07:51:54 MDT 2013
One-line Summary: preparation for associate refactor in clm4_5_15

Purpose of changes:
         Most work by mvertens.
         - prep. work for modifying associate
         - refactor subgridAveMod.F90 to accept upper and lower bounds
         - remove duplicate pointer uses
         - remove inicPerpMod.F90 and is_perpetual use

Requirements for tag: N/A

Test level of tag: standard

Bugs fixed (include bugzilla ID): N/A

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: N/A

Describe any changes made to the namelist: N/A

List any changes to the defaults for the boundary datasets: N/A

Describe any substantial timing or memory changes: N/A

Code reviewed by: self, mvertens

List any svn externals directories updated (csm_share, mct, etc.): N/A

List all files eliminated: 

D       models/lnd/clm/src/clm4_5/main/inicPerpMod.F90

List all files added and what they do: N/A

List all existing files that have been modified, and describe the changes:

M       models/lnd/clm/src/clm4_5/biogeochem/CNFireMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNVerticalProfileMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/ch4Mod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNSummaryMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/STATICEcosysDynMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNAnnualUpdateMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNNDynamicsMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNAllocationMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNEcosystemDynMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNSoilLittVertTranspMod.F90
M       models/lnd/clm/src/clm4_5/main/pft2colMod.F90
M       models/lnd/clm/src/clm4_5/main/controlMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_driver.F90
M       models/lnd/clm/src/clm4_5/main/subgridAveMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/BalanceCheckMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SLakeHydrologyMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/Hydrology1Mod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/Biogeophysics2Mod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/Hydrology2Mod.F90

Machines testing ran on:  (Tests in priority order)

  build-namelist unit tester:  OK.  Fixed generate numbering.

  CESM test lists:

    yellowstone/aux_clm     intel  OK
    yellowstone/aux_clm     pgi    OK
    frankfurt/aux_clm       intel  OK
    frankfurt/aux_clm       pgi    OK
    frankfurt/aux_clm       nag    OK

  CESM history file comparison:
  (ccsm_utils/Tools/component_gen_comp -compare $oldtag -generate $newtag -testid $testid -baselineroot $CESMDATAROOT/ccsm_baselines/ -model clm2)

    yellowstone/aux_clm     intel  OK

CLM tag used for the baseline comparison tests if applicable: clm4_5_13

Changes answers relative to baseline: No

===============================================================
===============================================================
Tag name:  clm4_5_13
Originator(s):  andre (Benjamin Andre,LAWRENCE BERKELEY NATIONAL LABORATORY,510-486-4617)
Date: Fri Jun 14 15:01:33 MDT 2013
One-line Summary: hydrology reordering from Jinyun Tang

Purpose of changes:
    reordering the operations of the hydrology. hydrology with and without drainage

Requirements for tag: N/A

Test level of tag: standard

Bugs fixed (include bugzilla ID): N/A

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: N/A

Describe any changes made to the namelist: N/A

List any changes to the defaults for the boundary datasets: N/A

Describe any substantial timing or memory changes: N/A

Code reviewed by: Jinyun Tang, Dave Lawrence

List any svn externals directories updated (csm_share, mct, etc.): N/A

List all files eliminated: N/A

List all files added and what they do: N/A

List all existing files that have been modified, and describe the changes:

    M       models/lnd/clm/src/clm4_5/biogeochem/CNEcosystemDynMod.F90 - splits out leaching
    M       models/lnd/clm/src/clm4_5/main/clmtypeInitMod.F90 - add icefrac and qflx_deficit
    M       models/lnd/clm/src/clm4_5/main/initSurfAlbMod.F90 - update calls to CNEcosystemDyn
    M       models/lnd/clm/src/clm4_5/main/clm_driver.F90 - update calls to CNEcosystemDyn and Hydrology
    M       models/lnd/clm/src/clm4_5/main/clmtype.F90 - add icefrac and qflx_deficit
    M       models/lnd/clm/src/clm4_5/biogeophys/Hydrology2Mod.F90 - splits out drainage calculations
    M       models/lnd/clm/src/clm4_5/biogeophys/SoilHydrologyMod.F90 - calculate water table before subsurface drainage, icefraction, water deficit

Machines testing ran on:  (Tests in priority order)

  build-namelist unit tester:   yes/no ***

  CESM test lists:

    yellowstone/aux_clm     intel       yes OK
    yellowstone/aux_clm     pgi         yes OK
    frankfurt/aux_clm       intel       no
    frankfurt/aux_clm       pgi         no
    frankfurt/aux_clm       nag         no

  CESM history file comparison:
  (ccsm_utils/Tools/component_gen_comp -compare $oldtag -generate $newtag -testid $testid -baselineroot $CESMDATAROOT/ccsm_baselines/ -model clm2)

  test_driver.sh tools testing: N/A

  yellowstone/PTCLM:            no

CLM tag used for the baseline comparison tests if applicable: clm4_5_12

Changes answers relative to baseline: yes

IF tag changes answers relative to baseline comparison the
following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: all clm 4.5 with hydrology
    - what platforms/compilers: all
    - nature of change (roundoff; larger than roundoff/same climate; new climate): new climate

   If bitwise differences were observed, how did you show they were no worse
   than roundoff?

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)

	casename: ERS_D.f19_g16.ICLM45 - an 11-year base line simulation
	was created with the standard trunk version, then a comparison run
	was created with the version including hydrology re-ordering.  The
	comparisons were evaluated by looking at the relative differences
	for hydrologic variables as QDRAI, EFLX_LH_TOT, QRUNOFF.  Large
	relative differences were found for these variables in a few grid
	cells, but their absolute magnitudes in those grid cells were
	small.  Tests were also conducted with VIC hydrology on, the
	change in results were similar as that when VIC hydrology was off.

   URL for LMWG diagnostics output used to validate new climate: N/A

===============================================================
===============================================================
Tag name:  clm4_5_12
Originator(s):  muszala (Stefan Muszala)
Date: Thu Jun 13 09:41:56 MDT 2013
One-line Summary: NoVS test, NAG mods and remove TWS from restart file

Purpose of changes: 
     
   -Fix (from jedwards) for ERS_D.f10_f10.ICLM45BGCNoVS.yellowstone_intel.clm-rootlit test
      Previous tags using ICLM45BGCNoVS are suspect!
   -Since I tested this with NAG there are also port mods to CLM that I had to put in.
   -Remove TWS from BiogeophysRestMod.F90 per sacks request.  OK'd by swenson.
   -Update to rtm1_0_29

Requirements for tag: N/A

Test level of tag: standard

Bugs fixed (include bugzilla ID): 1746

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: N/A

Describe any changes made to the namelist: N/A

List any changes to the defaults for the boundary datasets: N/A

Describe any substantial timing or memory changes: N/A

Code reviewed by: self, NoVs error: Charlie Koven and jedwards

List any svn externals directories updated (csm_share, mct, etc.): rtm1_0_28 -> rtm1_0_29

List all files eliminated: N/A

List all files added and what they do: N/A

List all existing files that have been modified, and describe the changes:

-NoVS fix and NAG mods
M       models/lnd/clm/src/clm4_5/biogeochem/ch4Mod.F90
-Nag mods
M       models/lnd/clm/src/clm4_5/biogeochem/CNNitrifDenitrifMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/ch4varcon.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNAllocationMod.F90
M       models/lnd/clm/src/clm4_5/main/histFldsMod.F90
-remove TWS from restart
M       models/lnd/clm/src/clm4_5/biogeophys/BiogeophysRestMod.F90
-update to rtm1_0_29
M       SVN_EXTERNAL_DIRECTORIES

Machines testing ran on:  (Tests in priority order)

  build-namelist unit tester:   no

  CESM test lists:

    yellowstone/aux_clm     intel OK 
    yellowstone/aux_clm     pgi   OK  
    frankfurt/aux_clm       intel OK    
    frankfurt/aux_clm       pgi   OK
    frankfurt/aux_clm       nag   OK

  CESM history file comparison:
  (ccsm_utils/Tools/component_gen_comp -compare $oldtag -generate $newtag -testid $testid -baselineroot $CESMDATAROOT/ccsm_baselines/ -model clm2)

    yellowstone/aux_clm     intel  OK.  The only differences are in ERS_D.f10_f10.ICLM45BGCNoVS.yellowstone_intel.clm-rootlit.
         These are expected due to the fix in ch4Mod.F90.

CLM tag used for the baseline comparison tests if applicable: clm4_5_11

Changes answers relative to baseline: Only for ERS_D.f10_f10.ICLM45BGCNoVS.yellowstone_intel.clm-rootlit.  Previous
   versions of this compset should be considered suspect.  Fields that change (119 in total) for this test are:

   ACTUAL_IMMOB, CH4STRESS_SAT, CH4STRESS_UNSAT, CH4_AERE_DEPTH_SAT, CH4_AERE_DEPTH_UNSAT, CH4_EBUL_DEPTH_SAT,
   CH4_OXID_DEPTH_SAT, CH4_OXID_DEPTH_UNSAT, CH4_PROD_DEPTH_SAT, CH4_SURF_AERE_SAT, CH4_SURF_AERE_UNSAT,
   CH4_SURF_DIFF_SAT, CH4_SURF_DIFF_UNSAT, CH4_SURF_EBUL_SAT, CH4_TRAN_DEPTH_SAT, CH4_TRAN_DEPTH_UNSAT,
   COL_CTRUNC, COL_NTRUNC, CONC_CH4_SAT, CONC_CH4_UNSAT, CONC_O2_SAT, CONC_O2_UNSAT, CWDC, CWDC_LOSS,
   CWDC_TO_LITR2C, CWDC_TO_LITR3C, CWDN, CWDN_TO_LITR2N, CWDN_TO_LITR3N, DENIT, ER, FCH4, FCH4TOCO2,
   FUELC, F_DENIT, F_N2O_DENIT, F_N2O_NIT, F_NIT, GROSS_NMIN, HR, LAND_UPTAKE, LITHR, LITR1C, LITR1C_TO_SOIL1C,
   LITR1N, LITR1N_TO_SOIL1N, LITR1_HR, LITR2C, LITR2C_TO_SOIL1C, LITR2N, LITR2N_TO_SOIL1N, LITR2_HR, LITR3C,
   LITR3C_TO_SOIL2C, LITR3N, LITR3N_TO_SOIL2N, LITR3_HR, LITTERC, LITTERC_HR, LITTERC_LOSS, NBP, NEE, NEM, NEP,
   NET_NMIN, O2STRESS_SAT, O2_AERE_DEPTH_SAT, O2_DECOMP_DEPTH_SAT, O2_DECOMP_DEPTH_UNSAT, POTENTIAL_IMMOB,
   POT_F_DENIT, POT_F_NIT, SMINN_TO_SOIL1N_L1, SMINN_TO_SOIL1N_L2, SMINN_TO_SOIL1N_S2, SMINN_TO_SOIL1N_S3,
   SMINN_TO_SOIL2N_L3, SMINN_TO_SOIL2N_S1, SMINN_TO_SOIL3N_S1, SMINN_TO_SOIL3N_S2, SMIN_NH4, SMIN_NO3,
   SMIN_NO3_LEACHED, SOIL1C, SOIL1C_TO_SOIL2C, SOIL1C_TO_SOIL3C, SOIL1N, SOIL1N_TO_SOIL2N, SOIL1N_TO_SOIL3N,
   SOIL1_HR_S2, SOIL1_HR_S3, SOIL2C, SOIL2C_TO_SOIL1C, SOIL2C_TO_SOIL3C, SOIL2N, SOIL2N_TO_SOIL1N,
   SOIL2N_TO_SOIL3N, SOIL2_HR_S1, SOIL2_HR_S3, SOIL3C, SOIL3C_TO_SOIL1C, SOIL3N, SOIL3N_TO_SOIL1N, SOIL3_HR,
   SOILC, SOILC_HR, SOILC_LOSS, SOMHR, SR, TOTCOLC, TOTCOLCH4, TOTCOLN, TOTECOSYSC, TOTECOSYSN, TOTLITC, TOTLITN,
   TOTSOMC, TOTSOMN

===============================================================
===============================================================
Tag name:  clm4_5_11
Originator(s):  sacks (Bill Sacks,UCAR/CGD,303-497-1762)
Date: Tue Jun 11 20:54:11 MDT 2013
One-line Summary: Change pct_pft and related surface dataset variables to be % of landunit

Purpose of changes:

Main purpose is to change pct_pft and related surface dataset variables to be %
of landunit rather than % of grid cell. This is needed to support transient PFTs
with dynamic landunits. This required substantial changes in both mksurfdata_map
and CLM. This also required generating all new surface datasets.

A very related change is the separation of PCT_PFT in the surface dataset into
PCT_NAT_PFT and PCT_CFT; in addition to these two variables, there are also new
PCT_NATVEG (% of natural veg landunit on the gridcell) and PCT_CROP (% of crop
landunit on the gridcell) variables. Note that the separation of PCT_PFT into
natural vs crop was only done on the surface dataset -- raw datasets to
mksurfdata_map have not been changed, nor have most of the CLM data structures.

In addition, this tag includes the following:

(1) Renumbered landunits to (a) add separate landunit numbers for each urban
landunit, (b) do away with the obsolete shallow lake, and (c) group together
similar landunits

(2) In any urban landunit, allocate space for ALL urban columns. Previously,
there were some urban landunits with only one of the two road types. This change
simplifies the code and only adds a relatively small number of columns in memory.

(3) Modified interpinic, partly to have compatibility with (1), partly to fix
urban bug (allowed by (1)), and partly to fix an unrelated bug

(4) All new initial conditions for CLM4.5, to have compatibility with (1) and (2)

(5) Check _OPENMP in initialization rather than driver

(6) Tighten error check in reweightMod: checkWeights. It seems like this error
check can be stricter with the new pct_pft formulation


Requirements for tag: Standard test + tools

Test level of tag: standard

Bugs fixed (include bugzilla ID):
     1621 (normalization issue in ne120np4 datasets and in CLM)
     1675 (need to relax error tolerance in reweightMod: weightsOkay) -- note
          that I have actually TIGHTENED the tolerance, but that seems to be
          okay now
     1702- PARTIAL FIX (clm4.5 interpinic doesn't work right for urban)

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

    1747 - need 1x1_tropicAtl surface dataset and pftdyn dataset for clm4_5_11 and later

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: None

Describe any changes made to the namelist: Changes to fsurdat and finidat for
CLM4.5, as described below

List any changes to the defaults for the boundary datasets: 

   For CLM4.5, all surface datasets and initial conditions files have been
   recreated. For surface datasets, changes result in only roundoff-level
   differences in the pct_* fields. For initial conditions, the new initial
   conditions are effectively the same as the old, but bugs in interpinic
   prevent them from being exactly the same.

Describe any substantial timing or memory changes: 

   Slight (probably < 1%) increase in memory for all CLM4.5 cases, due to
   allocation of ALL urban columns wherever there is an urban landunit

Code reviewed by: self

List any svn externals directories updated (csm_share, mct, etc.): NONE

List all files eliminated:

========= Remove unneeded modules (iulog moved to fileutils.F90)
D       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/clm_varpar.F90
D       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/clm_varctl.F90

========= Now differs for clm4_0 and clm4_5, so copied to those two places
D       models/lnd/clm/src/util_share/clm_varsur.F90

========= Replaced with new file for testing interpinic
D       models/lnd/clm/tools/clm4_5/interpinic/clmi.BCN.1949-01-01_10x15_USGS_simyr1850_c121113.nc


List all files added and what they do:

========= New file for testing interpinic
A       models/lnd/clm/tools/clm4_5/interpinic/clmi.I2000CLM45BGC.2000-01-01.10x15_simyr2000_c130607.nc

========= Add tests
A       models/lnd/clm/tools/clm4_5/mksurfdata_map/unit_testers/test_mkpftMod.F90

========= Moved from util_share
A       models/lnd/clm/src/clm4_0/main/clm_varsur.F90

========= Moved from util_share, and modified extensively to support new surface
          dataset format
A       models/lnd/clm/src/clm4_5/main/clm_varsur.F90

========= Add module to do some initialization that doesn't fit well elsewhere,
          and/or can't go elsewhere because of circular dependencies
A       models/lnd/clm/src/clm4_5/main/initParametersMod.F90


List all existing files that have been modified, and describe the changes:

========= Change pct_pft and related variables on surface dataset to be % of
          landunit; this requires significant changes for mkpftMod, mkglcmecMod
          and the error checks / corrections done in mksurfdat.F90
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/mkutilsMod.F90
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/fileutils.F90
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/mkfileMod.F90
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/mkglcmecMod.F90
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/mkvarpar.F90
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/mksurfdat.F90
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/Srcfiles
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/mkpftMod.F90

========= Add tests
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/unit_testers/test_mkutilsMod.F90
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/unit_testers/Srcfiles
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/unit_testers/test_mksurfdata_map.F90

========= Update crop landunit numbering, fix urban bug for column-level
          variables, take code out of a conditional to prevent floating point
          exceptions
M       models/lnd/clm/tools/clm4_5/interpinic/src/interpinic.F90

========= New files for testing interpinic
M       models/lnd/clm/tools/clm4_5/interpinic/interpinic.runoptions

========= Change landunit and column numbering; delete udenstype
M       models/lnd/clm/src/clm4_5/main/clm_varcon.F90
M       models/lnd/clm/src/clm4_5/main/subgridRestMod.F90

========= Add variables for determining number of natural & crop PFTs
M       models/lnd/clm/src/clm4_5/main/clm_varpar.F90

========= Major changes to handle pct_pft being specified as % of landunit
          rather than % of gridcell
M       models/lnd/clm/src/clm4_5/main/surfrdMod.F90
M       models/lnd/clm/src/clm4_5/main/pftdynMod.F90
M       models/lnd/clm/src/clm4_5/main/subgridMod.F90
M       models/lnd/clm/src/clm4_5/main/initGridCellsMod.F90

========= Initialize new surface variables, check _OPENMP here instead of driver
M       models/lnd/clm/src/clm4_5/main/clm_initializeMod.F90

========= Update comments, remove udenstype
M       models/lnd/clm/src/clm4_5/main/clmtype.F90

========= Change 'use' statements, use ltype instead of udenstype, fix
          initialization for 0-weight columns
M       models/lnd/clm/src/clm4_5/biogeophys/UrbanMod.F90

========= Add some consistency checks (moved here from clmtypeInitMod), change others
M       models/lnd/clm/src/clm4_5/main/clm_varctl.F90

========= Change 'use' statements; use urbpoi rather than isturb; remove
          references to 'istslak'
M       models/lnd/clm/src/clm4_5/biogeochem/CNNStateUpdate1Mod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNBalanceCheckMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNFireMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNPrecisionControlMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNSummaryMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNPhenologyMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNCStateUpdate1Mod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNAllocationMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNEcosystemDynMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNSetValueMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/DryDepVelocity.F90
M       models/lnd/clm/src/clm4_5/biogeophys/BalanceCheckMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SoilTemperatureMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/UrbanInputMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SnowHydrologyMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/Biogeophysics1Mod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/Hydrology1Mod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/BiogeophysRestMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/Biogeophysics2Mod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/UrbanInitMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/Hydrology2Mod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SoilHydrologyMod.F90
M       models/lnd/clm/src/clm4_5/main/CNiniTimeVar.F90
M       models/lnd/clm/src/clm4_5/main/dynlandMod.F90
M       models/lnd/clm/src/clm4_5/main/accFldsMod.F90
M       models/lnd/clm/src/clm4_5/main/clmtypeInitMod.F90
          -- also, remove udenstype, and move some consistency checks elsewhere
M       models/lnd/clm/src/clm4_5/main/iniTimeConst.F90
M       models/lnd/clm/src/clm4_5/main/restFileMod.F90
M       models/lnd/clm/src/clm4_5/main/controlMod.F90
M       models/lnd/clm/src/clm4_5/main/initSurfAlbMod.F90
M       models/lnd/clm/src/clm4_5/main/filterMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_driver.F90
          -- also, move _OPENMP check to initialization
M       models/lnd/clm/src/clm4_5/main/subgridAveMod.F90
M       models/lnd/clm/src/clm4_5/main/CNiniSpecial.F90
M       models/lnd/clm/src/clm4_5/main/inicPerpMod.F90
M       models/lnd/clm/src/clm4_5/main/mkarbinitMod.F90
M       models/lnd/clm/src/clm4_5/main/histFldsMod.F90

========= Tighten tolerance for error check
M       models/lnd/clm/src/clm4_5/main/reweightMod.F90

========= Use 'crop_prog' rather than the CROP CPP def
M       models/lnd/clm/src/clm4_5/biogeochem/CNrestMod.F90

========= New surface datasets and initial conditions
M       models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_5.xml

========= Change environment variable in component_gen_comp command to something universal
M       .ChangeLog_template

========= Restore a failing test (see bug 1658)
M       models/lnd/clm/bld/unit_testers/xFail/expectedClmTestFails.xml



Machines testing ran on:  (Tests in priority order)

  build-namelist unit tester:   yes

     All PASS or xFail except for the following expected baseline failures:
     418/444 < FAIL> <Test Id: 418> <Desc: lnd_in file the same as expected for phys45>  
     423/444 < FAIL> <Test Id: 423> <Desc: lnd_in file the same as expected for phys45>  
     428/444 < FAIL> <Test Id: 428> <Desc: lnd_in file the same as expected for phys45>  
     433/444 < FAIL> <Test Id: 433> <Desc: lnd_in file the same as expected for phys45>  
     438/444 < FAIL> <Test Id: 438> <Desc: lnd_in file the same as expected for phys45>  
     443/444 < FAIL> <Test Id: 443> <Desc: lnd_in file the same as expected for phys45-crop>  


  CESM test lists:

    yellowstone/aux_clm     intel       yes
       Tests themselves: All PASS or xFail, except
       ERB.ne30_g16.I_1948-2004.yellowstone_intel, which I have re-added to the
       xFail list (see bugz 1658)
       
       Comparisons: Some nlcomp and compare_hist failures, as expected

    yellowstone/aux_clm     pgi         yes
       All PASS or xFail except for some nlcomp & compare_hist failures (expected)

    frankfurt/aux_clm       intel       yes
       All PASS or xFail except for some nlcomp & compare_hist failures (expected)

    frankfurt/aux_clm       pgi         NO

    frankfurt/aux_clm       nag         yes
       All PASS or xFail except for nlcomp failures (expected)

  CESM history file comparison:
  (ccsm_utils/Tools/component_gen_comp -compare $oldtag -generate $newtag -testid $testid -baselineroot $CESMDATAROOT/ccsm_baselines/ -model clm2)

    yellowstone/aux_clm     intel       yes

       Some compare_hist failures for CLM4.5 tests, as expected

  test_driver.sh tools testing:

    yellowstone interactive:    yes
       All PASS except for expected baseline failures:
       012 blg54 TBLtools.sh clm4_5 mksurfdata_map tools__s namelist ...................................rc=7 FAIL
       016 blh54 TBLtools.sh clm4_5 interpinic tools__ds runoptions ....................................rc=7 FAIL
       020 bli24 TBLscript_tools.sh clm4_5 mksurfdata_map mksurfdata.pl mksrfdt_T31_crpglc_2000^tools__ds rc=7 FAIL
       022 bli53 TBLscript_tools.sh clm4_5 mksurfdata_map mksurfdata.pl mksrfdt_10x15_1850^tools__o ....rc=7 FAIL
       024 bli54 TBLscript_tools.sh clm4_5 mksurfdata_map mksurfdata.pl mksrfdt_10x15_1850^tools__ds ...rc=7 FAIL
       026 bli57 TBLscript_tools.sh clm4_5 mksurfdata_map mksurfdata.pl mksrfdt_10x15_1850^tools__do ...rc=7 FAIL
       032 bliT4 TBLscript_tools.sh clm4_5 mksurfdata_map mksurfdata.pl mksrfdt_1x1_numaIA_mp24_2000^tools_rc=7 FAIL

       and expected failures:
       027 smiS4 TSMscript_tools.sh shared ncl_scripts getregional_datasets.pl getregional .............rc=6 FAIL
       028 bliS4 TBLscript_tools.sh shared ncl_scripts getregional_datasets.pl getregional .............rc=4 FAIL


    frankfurt interactive:      NO

  yellowstone/PTCLM:            NO

CLM tag used for the baseline comparison tests if applicable: clm4_5_10

Changes answers relative to baseline: YES

IF tag changes answers relative to baseline comparison the
following should be filled in (otherwise remove this section):

  Summarize any changes to answers, i.e.,
    - what code configurations: Changes in all CLM4.5 configurations. See below
      for details
    - what platforms/compilers: All
    - nature of change (roundoff; larger than roundoff/same climate; new climate):
      Mostly roundoff, but some larger than roundoff -- see below for details.

      Changes are limited to CLM4.5. Where the below notes refer to "all
      configurations", this is really limited to CLM4.5 configurations.

      For all configurations, there are roundoff-level changes due to
      roundoff-level differences in subgrid weights. These changes can quickly
      grow to greater than roundoff (which I believe is due to nonlinear
      feedbacks with snow variables), but as described below, I have verified
      that the root cause of differences is this roundoff-level change.

      For cases that use initial conditions, where these initial conditions were
      previously interpinic'ed, there are greater-than-roundoff level changes
      due to various bugs and limitations of interpinic (for example, some
      fields, like tsai, are skipped). I took pains to ensure that, for cases
      using original (non-interpinic'ed) initial conditions in clm4_5_10 and
      prior, the new initial conditions are nearly identical to the old (but not
      entirely identical, due to bug 1702 - see comment 2); this applies to most
      f09 initial conditions. However, this was not practical for cases that
      used interpinic'ed files; this applies to f19, ne30 and hcru initial
      conditions, as well as f09 BGCDV initial conditions. So for this latter
      set of cases, there can be large differences from clm4_5_10, especially at
      the start of the simulation.

      There are also greater than roundoff-level changes for some glc_mec
      virtual columns, because we now use information on topo_glc_mec whenever
      we can.

      There are also greater than roundoff-level changes in subgrid weights in
      virtual (0-weight) glc_mec and crop landunits, now that we no longer use
      arbitrary subgrid weights there; I don't think this will affect anything
      important, though.

      Some tests that exhibited larger-than-usual changes from baseline, in cpl
      hist and/or clm hist files, were the following (ignoring changes that can
      be explained by the above notes):
      
      ERS_Lm3.f19_g16.IGRCP60CLM45CN.yellowstone_intel
      ERS_D.f19_g16.ICLM45GLCMEC.yellowstone_intel.clm-glcMEC
      ERS_D.f10_f10.ICLM45BGCNoVS.yellowstone_intel.clm-rootlit
      ERS_Ld3_D_P64x1.ne30_g16.ICLM45CN.yellowstone_intel.clm-default

      From these results, it seems that large changes may occur more often in
      glc_mec runs, even above and beyond the virtual column changes that are
      expected, as noted above.

      For the four above tests, I verified that differences were attributable to
      the roundoff-level changes in subgrid weights, using the procedure
      documented below.


   If bitwise differences were observed, how did you show they were no worse
   than roundoff?

      In order to confirm that answers only differed by roundoff, I ran 7
      additional tests (these tests all had nl_dirs, but that was not central to
      these tests, so I'm not listing them here):

          SMS_Lm1.f19_g16.I_1850_CLM45_BGC
          SMS_Ly2.T31_g37.IG1850CLM45CN
          SMS_Ly5.T31_g37.I20TRCRUCLM45BGC
          SMS_Ly5.T31_g37.ICLM45BGCDV
          SMS_Ly5.T31_g37.I_2000_CLM45_BGC
          SMS_Ly5.f10_f10.ICLM45BGCDVCROP
          SMS_Ly5.f10_f10.I_2000_CLM45_BGC_CROP

      Each test was done as follows:

      (1) Created baselines from clm4_5_04

      (2) Ran tests from a branch (allocate_all_urban_cols), where all I changed
      from the baseline was (a) wherever we have an urban landunit, create ALL
      urban landunits, and (b) for f19, change finidat files to use a new,
      interpinic'ed file based on the original. Confirmed that this was bfb with
      (1) except for (a) 1-d history files (now have extra urban columns), and
      (b) any CLM4.5 test that uses initial conditions, since interpinic is
      currently broken for urban.

      Side-note: I actually confirmed bfb behavior for the full yellowstone
      aux_clm test suite, in addition to the above 7 tests

      This extra branch was necessary because I cannot compare 1-d history files
      directly between my main branch and the trunk, because of the extra urban
      columns present in the new code.


      (3) Ran these 7 tests from my main branch, off of clm4_5_04, comparing
      with (2). For this comparison, I only confirmed that the subgrid weights
      were the same within roundoff (up to about 1e-12 differences for the
      transient case; smaller for other cases). Note that greater than
      roundoff-level changes are seen in many other fields, presumably because
      small differences in subgrid pft weights can cause differences in how
      variables are averaged from pft to column. This, in turn, can lead to
      larger changes due to nonlinearities in the system (e.g., snow). The
      following steps were taken to confirm that other differences between my
      branch and the trunk were only due to these small differences in subgrid
      weights.

      That is, I am confirming that:
      (a) the only differences in the branch are subgrid weights
      (b) these subgrid weights only differ by roundoff


      (4) Reran (2), but with extra code to write out subgrid weights (including
      writing these weights at every time step for pftdyn) -- from branch
      allocate_all_urban_cols_writeWeights

      (5) Reran (3), but with extra code to read the subgrid weights written in
      (4). Confirmed that, with this one-off, my branch was bfb with (4).


===============================================================
===============================================================
Tag name:  clm4_5_10
Originator(s):  muszala (Stefan Muszala)
Date: Mon Jun 10 13:10:31 MDT 2013
One-line Summary: refactor clmtype

Purpose of changes: Refactor clmtype so that there is only one level of indirection.

     call hist_addfld1d (fname='SNOOCFRCL', units='W/m^2', &
          avgflag='A', long_name='surface forcing of OC in snow (land) ', &
-         ptr_pft=clm3%g%l%c%p%pef%sfc_frc_oc, set_urb=spval)
+         ptr_pft=pef%sfc_frc_oc, set_urb=spval)

There is a README (with more detailed information) and a script to help with future merges in:

  models/lnd/clm/tools/clm4_5/refactorTools/clmType/{README & renameClmType.pl}

Requirements for tag: N/A

Test level of tag: standard

Bugs fixed (include bugzilla ID): N/A

Known bugs (include bugzilla ID): N/A
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: N/A

Describe any changes made to the namelist: N/A

List any changes to the defaults for the boundary datasets: N/A

Describe any substantial timing or memory changes: N/A

Code reviewed by: self, mvertens

List any svn externals directories updated (csm_share, mct, etc.): N/A

List all files eliminated: N/A

List all files added and what they do:

- script and README for refactoring clmType
A       models/lnd/clm/tools/clm4_5/refactorTools
A       models/lnd/clm/tools/clm4_5/refactorTools/associate
A       models/lnd/clm/tools/clm4_5/refactorTools/clmType
A       models/lnd/clm/tools/clm4_5/refactorTools/clmType/renameClmType.pl
A       models/lnd/clm/tools/clm4_5/refactorTools/clmType/README

List all existing files that have been modified, and describe the changes:

- major refactor in these to flatten clmtype
M       models/lnd/clm/src/clm4_5/main/clmtypeInitMod.F90
M       models/lnd/clm/src/clm4_5/main/clmtype.F90

- change derived type access to match those of clmtype
M       models/lnd/clm/src/clm4_5/biogeochem/CNCStateUpdate2Mod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNGapMortalityMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNNitrifDenitrifMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNGRespMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CropRestMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/initch4Mod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNNStateUpdate1Mod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNBalanceCheckMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNNStateUpdate3Mod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNFireMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNMRespMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNDecompCascadeMod_BGC.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNVerticalProfileMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/ch4RestMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNWoodProductsMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNCIsoFluxMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNPrecisionControlMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/ch4Mod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNSummaryMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/DUSTMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNDVLightMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNPhenologyMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/STATICEcosysDynMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNDecompMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNCStateUpdate1Mod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNDVMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNCStateUpdate3Mod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/VOCEmissionMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNrestMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNDVEcosystemDynIniMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNAnnualUpdateMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNNStateUpdate2Mod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNDecompCascadeMod_CENTURY.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNNDynamicsMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNAllocationMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/DryDepVelocity.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNSetValueMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNVegStructUpdateMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNSoilLittVertTranspMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNDVEstablishmentMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNC14DecayMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_varcon.F90
M       models/lnd/clm/src/clm4_5/main/CNiniTimeVar.F90
M       models/lnd/clm/src/clm4_5/main/dynlandMod.F90
M       models/lnd/clm/src/clm4_5/main/subgridRestMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_glclnd.F90
M       models/lnd/clm/src/clm4_5/main/accFldsMod.F90
M       models/lnd/clm/src/clm4_5/main/pftdynMod.F90
M       models/lnd/clm/src/clm4_5/main/iniTimeConst.F90
M       models/lnd/clm/src/clm4_5/main/histFileMod.F90
M       models/lnd/clm/src/clm4_5/main/pft2colMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_atmlnd.F90
M       models/lnd/clm/src/clm4_5/main/initSurfAlbMod.F90
M       models/lnd/clm/src/clm4_5/main/filterMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_driver.F90
M       models/lnd/clm/src/clm4_5/main/subgridAveMod.F90
M       models/lnd/clm/src/clm4_5/main/initGridCellsMod.F90
M       models/lnd/clm/src/clm4_5/main/initSoilParVICMod.F90
M       models/lnd/clm/src/clm4_5/main/CNiniSpecial.F90
M       models/lnd/clm/src/clm4_5/main/inicPerpMod.F90
M       models/lnd/clm/src/clm4_5/main/reweightMod.F90
M       models/lnd/clm/src/clm4_5/main/mkarbinitMod.F90
M       models/lnd/clm/src/clm4_5/main/histFldsMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/BalanceCheckMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SoilTemperatureMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SLakeFluxesMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SnowHydrologyMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/Biogeophysics1Mod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/FrictionVelocityMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/TridiagonalMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SLakeHydrologyMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/Hydrology1Mod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/BiogeophysRestMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/UrbanMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/ActiveLayerMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/clm_driverInitMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/CLMVICMapMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SLakeTemperatureMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/BareGroundFluxesMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SNICARMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/CanopyFluxesMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SurfaceRadiationMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/initSLakeMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/H2OSfcMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/Biogeophysics2Mod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/FracWetMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/UrbanInitMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SLakeRestMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SurfaceAlbedoMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/Hydrology2Mod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SoilHydrologyMod.F90

Machines testing ran on:  (Tests in priority order)
  Standard Tag Pretag ***                    Standard Tag Posttag **

  build-namelist unit tester:   no

  CESM test lists:

    yellowstone/aux_clm     intel    OK    
    yellowstone/aux_clm     pgi      OK
    frankfurt/aux_clm       intel    OK
    frankfurt/aux_clm       pgi      OK
    frankfurt/aux_clm       nag      OK

  CESM history file comparison:

    yellowstone/aux_clm     intel       

CLM tag used for the baseline comparison tests if applicable: clm4_5_09

Changes answers relative to baseline: No.  Everything in this refactor should be BFB.

===============================================================
===============================================================
Tag name:  clm4_5_09
Originator(s):  muszala (Stefan Muszala,UCAR/CGD,303-497-1320)
Date: Tue Jun  4 15:59:07 MDT 2013
One-line Summary: volr and vic fix, update mct and rtm

Purpose of changes: add volr area correction, minor vic fix from maoyi, update mct and
                    rtm externals

Requirements for tag: N/A

Test level of tag: standard

Bugs fixed (include bugzilla ID): N/A

Known bugs (include bugzilla ID): N/A
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: N/A

Describe any changes made to the namelist: N/A

List any changes to the defaults for the boundary datasets: N/A

Describe any substantial timing or memory changes: N/A

Code reviewed by: self, swenson

List any svn externals directories updated (csm_share, mct, etc.):
-models/rof/rtm                  https://svn-ccsm-models.cgd.ucar.edu/rivrtm/trunk_tags/rtm1_0_27
+models/rof/rtm                  https://svn-ccsm-models.cgd.ucar.edu/rivrtm/trunk_tags/rtm1_0_28

-models/utils/mct                https://github.com/MCSclimate/MCT/tags/MCT_2.8.3
+models/utils/mct                https://github.com/quantheory/MCT/tags/compiler_fixes_n01_MCT_2.8.3

List all files eliminated: N/A

List all files added and what they do: N/A

List all existing files that have been modified, and describe the changes:

- fix for VIC hydrology
M       models/lnd/clm/src/clm4_5/biogeophys/SoilHydrologyMod.F90
- volr area correction
M       models/lnd/clm/src/cpl_mct/lnd_comp_mct.F90
M       models/lnd/clm/src/cpl_esmf/lnd_comp_esmf.F90
- mct and rtm update
M       SVN_EXTERNAL_DIRECTORIES
- clean up
M       models/lnd/clm/bld/unit_testers/xFail/expectedClmTestFails.xml

Machines testing ran on:  (Tests in priority order)

  build-namelist unit tester:   OK

  CESM test lists:

    yellowstone/aux_clm     intel  OK
    yellowstone/aux_clm     pgi    OK
    frankfurt/aux_clm       intel  OK     
    frankfurt/aux_clm       pgi    OK
    frankfurt/aux_clm       nag    OK

CLM tag used for the baseline comparison tests if applicable: clm4_5_08

Changes answers relative to baseline: only for VIC compsets.  VOLR diagnostic changes.

===============================================================
===============================================================
Tag name:  clm4_5_08
Originator(s):  muszala (Stefan Muszala,UCAR/CGD,303-497-1320)
Date: Mon Jun  3 13:29:30 MDT 2013
One-line Summary: port for NAG compiler

Purpose of changes: Bring in Sean Santos mods, port clm4_5 and test with the NAG compiler on Frankfurt.

Requirements for tag: N/A

Test level of tag: standard

Bugs fixed (include bugzilla ID): 1721 - Jim Edwards fixed problem in PIO

Known bugs (include bugzilla ID): 1722 - Error in some VIC tests starting in clm4_5_07
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: N/A

Describe any changes made to the namelist: N/A

List any changes to the defaults for the boundary datasets: N/A

Describe any substantial timing or memory changes: N/A

Code reviewed by: self, Santos

List any svn externals directories updated (csm_share, mct, etc.): PIO - update to pio1_7_2

List all files eliminated: 

D       models/lnd/clm/src/util_share/nanMod.F90

List all files added and what they do: N/A

List all existing files that have been modified, and describe the changes:

M       models/lnd/clm/bld/unit_testers/xFail/expectedFail.pm
M       models/lnd/clm/src/util_share/clm_time_manager.F90
M       models/lnd/clm/src/util_share/accumulMod.F90
M       models/lnd/clm/src/util_share/ndepStreamMod.F90
M       models/lnd/clm/src/util_share/ncdio_pio.F90
M       models/lnd/clm/src/util_share/spmdMod.F90
M       models/lnd/clm/src/util_share/domainMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNFireMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNCIsoFluxMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/ch4Mod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNSummaryMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/DUSTMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNPhenologyMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/ch4varcon.F90
M       models/lnd/clm/src/clm4_5/biogeochem/STATICEcosysDynMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNDecompMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNCStateUpdate1Mod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNrestMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNAllocationMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNDVEstablishmentMod.F90
M       models/lnd/clm/src/clm4_5/biogeochem/CNC14DecayMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_glclnd.F90
M       models/lnd/clm/src/clm4_5/main/subgridMod.F90
M       models/lnd/clm/src/clm4_5/main/accFldsMod.F90
M       models/lnd/clm/src/clm4_5/main/clmtypeInitMod.F90
M       models/lnd/clm/src/clm4_5/main/iniTimeConst.F90
M       models/lnd/clm/src/clm4_5/main/histFileMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_atmlnd.F90
M       models/lnd/clm/src/clm4_5/main/controlMod.F90
M       models/lnd/clm/src/clm4_5/main/clm_driver.F90
M       models/lnd/clm/src/clm4_5/main/pftvarcon.F90
M       models/lnd/clm/src/clm4_5/main/histFldsMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/BalanceCheckMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SoilTemperatureMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/Hydrology1Mod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SNICARMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/CanopyFluxesMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SurfaceRadiationMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/H2OSfcMod.F90
M       models/lnd/clm/src/clm4_5/biogeophys/SoilHydrologyMod.F90
M       models/lnd/clm/src/clm4_0/biogeochem/CropRestMod.F90
M       models/lnd/clm/src/clm4_0/biogeochem/DUSTMod.F90
M       models/lnd/clm/src/clm4_0/biogeochem/CNPhenologyMod.F90
M       models/lnd/clm/src/clm4_0/biogeochem/STATICEcosysDynMod.F90
M       models/lnd/clm/src/clm4_0/biogeochem/CNAllocationMod.F90
M       models/lnd/clm/src/clm4_0/biogeochem/CNDVEstablishmentMod.F90
M       models/lnd/clm/src/clm4_0/main/clm_glclnd.F90
M       models/lnd/clm/src/clm4_0/main/subgridMod.F90
M       models/lnd/clm/src/clm4_0/main/accFldsMod.F90
M       models/lnd/clm/src/clm4_0/main/clmtypeInitMod.F90
M       models/lnd/clm/src/clm4_0/main/pftvarcon.F90
M       models/lnd/clm/src/clm4_0/main/iniTimeConst.F90
M       models/lnd/clm/src/clm4_0/main/histFileMod.F90
M       models/lnd/clm/src/clm4_0/main/clm_atmlnd.F90
M       models/lnd/clm/src/clm4_0/biogeophys/SNICARMod.F90
M       SVN_EXTERNAL_DIRECTORIES

Machines testing ran on:  (Tests in priority order)

  build-namelist unit tester:            - OK.

    yellowstone/aux_clm     intel        - OK.
    yellowstone/aux_clm     pgi          - OK.
	    One BFAIL for hcru_hcru which should pass next time around.  Bug fixed when upgrading to pio1_7_2.
		 BFAIL ERS_D.hcru_hcru.I_2000_CRUFRC_CLM45_CN.yellowstone_pgi.GC.08testPgi.compare_hist.clm4_5_07
    frankfurt/aux_clm       intel        - OK.
    frankfurt/aux_clm       pgi          - OK.
    frankfurt/aux_clm       nag          - OK.  No baselines to compare against.

CLM tag used for the baseline comparison tests if applicable: clm4_5_07

Changes answers relative to baseline: No

===============================================================
===============================================================
Tag name:  clm4_5_07
Originator(s):  erik (Erik Kluzek)
Date: Fri May 31 02:49:45 MDT 2013
One-line Summary: New spinup files for CLM45 AND RTM, work on PTCLM, turn drydep off by default, update externals

Purpose of changes:

    Bring in new spinup finidat files (f09_g16@1850 for SP and BGC). interpinic to 2deg, hcru_hcru and ne30.
    New spinup finidat files for BGCCROP and BGCDV (f19 and f09 respectively)
    New spinup finidat files for 2000 (f09_g16 for SP and BGC)
    Update RTM to bring in finidat_rtm files for either 1850 or 2000.
    Update scripts, Machines, pio
    scripts includes update for CLM40CRU hybrid startup
    Turn drydep namelist off by default
    Do a lot of work on getting PTCLM working and tools working for single-point.

Requirements for tag:
    New spinup files, fix bugs: 1708, 1700

Test level of tag: standard

Bugs fixed (include bugzilla ID):
                                 1715 (rmdups.ncl fails for no-overlap case)
                                 1714 (mkscripgrid.ncl doesn't calculate corners correctly.)
                                 1708 (Need Initial conditions for RTM)
                                 1706 (VIC tests fail)
                                 1700 (Memory leak in MPI layer on yellowstone)

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: None

Describe any changes made to the namelist: drydep namelist now OFF by default

List any changes to the defaults for the boundary datasets: New initial conditions
          Native initial conditions for f09 for:
             I1850CLM45SP, I1850CLM45BGC, ICLM45SP, ICLM45BGC
          Interpinic for:
             I1850CLM45 & I1850CLM45BGC: f19, hcru_hcru, ne30
             ICLM45BGCCROP @ f19
             ICLM45BGCDB   @ f09

    ALSO NOTE THAT NOW RTM HAS INITIAL CONDITIONS FOR R05 -- SO RIVERFLOW CHANGES 
    FOR BOTH CLM45 AND CLM40

Describe any substantial timing or memory changes: None

Code reviewed by: self

List any svn externals directories updated (csm_share, mct, etc.): many
   csm_share, pio, scripts, Machines, RTM, cprnc, mapping
      

    scripts   to scripts4_130529 (update PTCLM, send simyr to RTM, new IC for CLM40CRUCN)
    csm_share to share3_130528
    rtm       to rtm1_0_27       (Set startup initial condition files by -simyr flag)
    Machines  to Machines_130529 (Set hcru_hcru PE-layout, and PE-layout on yellowstone for f09 I cases)
    pio       to pio1_7_1
    cprnc     to cprnc_130425
    mapping   to mapping_130509

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

    M  models/lnd/clm/test/tools/TBLCFGtools.sh --- Correctly point to TSMCFGtools rather than TSMtools.sh.

    M  models/lnd/clm/tools/clm4_5/mksurfdata_map/mksurfdata.pl - Add -usr_mapdir option

    M  models/lnd/clm/tools/shared/mkmapdata/rmdups.ncl ------ Exit early if n_s==0
    M  models/lnd/clm/tools/shared/mkmapdata/mkmapdata.sh ---- Skip if file already exists, give 
          directory for rmdups.ncl
    M  models/lnd/clm/tools/shared/mkmapdata/mknoocnmap.pl --- Don't hide NCL output
    M  models/lnd/clm/tools/shared/mkmapgrids/mkscripgrid.ncl  Explicitly calculate corners

    M  models/lnd/clm/bld/build-namelist - Set drydep to off by default, check crop setting for finidat files

    M  models/lnd/clm/bld/clm.buildnml.csh - Add back logic in about ignoring IC year or date

    M  models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_5.xml - New initial conditions for:
          Native initial conditions for f09 for:
             I1850CLM45SP, I1850CLM45BGC, ICLM45SP, ICLM45BGC
          Interpinic for:
             I1850CLM45SP & I1850CLM45BGC: f19, hcru_hcru, ne30
             ICLM45BGCCROP @ f19
             ICLM45BGCDB   @ f09
    M  models/lnd/clm/bld/namelist_files/namelist_defaults_usr_files.xml - Use surfdata_map rather than surfdata
          for CLM_USRDAT_NAME fsurdat files

    M  models/lnd/clm/bld/namelist_files/use_cases/stdurbpt_pd.xml - Remove setting of dtime, adjust hist output

      More work on readme files...

    M  README
    M  models/lnd/clm/doc/IMPORTANT_NOTES
    M  models/lnd/clm/doc/Quickstart.GUIDE
    M  models/lnd/clm/doc/Quickstart.userdatasets

Machines testing ran on:  (Tests in priority order)

  build-namelist unit tester:   yes

  CESM test lists:

    yellowstone/aux_clm     intel       yes
    yellowstone/aux_clm     pgi         yes
    frankfurt/aux_clm       intel       yes
    frankfurt/aux_clm       pgi         yes

  CESM history file comparison:
  (ccsm_utils/Tools/component_gen_comp -compare $oldtag -generate $newtag -testid $testid -baselineroot $GLDCSEG/ccsm_baselines/ -model clm2)

    yellowstone/aux_clm     intel       yes

  test_driver.sh tools testing:

    yellowstone interactive:    yes
    frankfurt interactive:      yes

  yellowstone/PTCLM:            yes!

CLM tag used for the baseline comparison tests if applicable: clm4_5_06

Changes answers relative to baseline:  Yes -- due to new initial condition files
     for I1850CLM45SP and I1850CLM45BGC      @ f09, f19, hcru, ne30
         ICLM45SP     and ICLM45BGC          @ f09
         ICLM45BGCCROP @ f19 and ICLM45BGCDB @ f09
     and ICLM40CRUCN   @ f09

   AND new initial conditions for RTM for ALL R05 grids

   And turning drydep namelist off in the driver causes answers to appear to be different
   when comparing coupler history files.

===============================================================
===============================================================
Tag name:  clm4_5_06
Originator(s):  erik (Erik Kluzek)
Date: Wed May 15 13:52:43 MDT 2013
One-line Summary: A few small bug fixes, more updates to README files

Purpose of changes:
   More work on README files and documentation.
   Fix from Danica/Bill for transient simulations.
   Fix from Zack for Lake output variables
   Another multi-instance script fix.
   Fix tropixAtl pftdyn filename.
   Remove models/lnd/clm/bld/config_query as doesn't work with new CESM scripts.

Requirements for tag:
   Requirements: Fix bug: 1697, 1691, 1675, fix tropicAtl fpftdyn file, minimal testing on frankfurt

Test level of tag: critical

Bugs fixed (include bugzilla ID):
                                 1675  (need to relax error tolerance in reweightMod: weightsOkay)
                                 1691  (Scripts issue for multi-instance for CLM/RTM)
                                 1697  (ZLAKE and DZLAKE are NOT set)

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: None

Describe any changes made to the namelist: None

List any changes to the defaults for the boundary datasets: Fix 1x1_tropicAtl fpftdyn file

Describe any substantial timing or memory changes: None

Code reviewed by: self, sacks (transient fix), dlawren/subin (lake fix), jedwards (multi-instance scripts)

List any svn externals directories updated (csm_share, mct, etc.): None

List all files eliminated: testing namelist files for old CLM standalone

   D   models/lnd/clm/bld/config_query --- no longer works with new CESM scripts

   D   models/lnd/clm/test/tools/nl_files/nl_ch4_set2_ciso
   D   models/lnd/clm/test/tools/nl_files/nl_ch4_set3_pftroot
   D   models/lnd/clm/test/tools/nl_files/nl_rootlit
   D   models/lnd/clm/test/tools/nl_files/nl_ciso
   D   models/lnd/clm/test/tools/nl_files/nl_anoxia_wtsat
   D   models/lnd/clm/test/tools/nl_files/nl_vrtlay
   D   models/lnd/clm/test/tools/nl_files/nl_oldhyd

List all files added and what they do:

   A   models/lnd/clm/tools/clm4_5/interpinic/addmetadata --- Add script to add important meta-data to finidat files.

List all existing files that have been modified, and describe the changes:

---------------- Work on README files documentation
   M   models/lnd/clm/test/tools/config_files/README
   M   models/lnd/clm/test/tools/README
   M   models/lnd/clm/test/tools/README.testnames
   M   models/lnd/clm/tools/README
   M   models/lnd/clm/doc/IMPORTANT_NOTES
   M   models/lnd/clm/doc/Quickstart.GUIDE
   M   models/lnd/clm/doc/README

---------------- 
   M   models/lnd/clm/bld/config_files/config_definition.xml ------------ Document experimental settings / fix syntax error
   M   models/lnd/clm/bld/clm.buildnml.csh ------------------------------ Multi-instance fix
   M   models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_5.xml --- Fix 1x1_tropicAtl fpftdyn filename
   M   models/lnd/clm/bld/namelist_files/namelist_definition_clm4_5.xml - Document experimental settings

---------------- 
   M   models/lnd/clm/src/clm4_5/main/histFileMod.F90 ---- ZLAKE/DZLAKE fix
   M   models/lnd/clm/src/clm4_5/main/subgridAveMod.F90 -- ZLAKE/DZLAKE fix
   M   models/lnd/clm/src/clm4_5/main/reweightMod.F90 ---- Increase tolerance to 1.e-7 so transient
             simulations can run their full course.

Machines testing ran on:  (Tests in priority order)

  build-namelist unit tester:   yes

  CESM test lists: (limited testing on yellowstone/aux_clm/intel)

    frankfurt/aux_clm       pgi         yes
    frankfurt/aux_clm       intel       yes

CLM tag used for the baseline comparison tests if applicable: clm4_5_04

Changes answers relative to baseline: no (bit-for-bit)

===============================================================
===============================================================
Tag name:  clm4_5_05
Originator(s):  muszala (Stefan Muszala,UCAR/CGD,303-497-1320)
Date:  Tue May 14 13:15:12 MDT 2013
One-line Summary: hcru bug fixes

Purpose of changes: update pio tag and nfire init. mod

Requirements for tag: N/A

Test level of tag: Only run hcru_hcru tests

Bugs fixed (include bugzilla ID): N/A

Known bugs (include bugzilla ID): N/A
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: N/A

Describe any changes made to the namelist: N/A

List any changes to the defaults for the boundary datasets: N/A

Describe any substantial timing or memory changes: N/A

Code reviewed by: self, Fang and Erik for nfire problem

List any svn externals directories updated (csm_share, mct, etc.): update pio to 1_7_0

List all files eliminated: N/A

List all files added and what they do: N/A

List all existing files that have been modified, and describe the changes: 

-- nfire init. changed from nan to spval to fix problem with hcru_hcru debug + intel runs
M    models/lnd/clm/src/clm4_5/main/clmtypeInitMod.F90

Machines testing ran on:  Only testing hcru_hcru resolutions

Yellowstone Tests:

   The following were run with DEBUG=TRUE and for 1 day initial + 1 day restart
      hcru_hcru_I_2000_CRUFRC_CLM45_CN_yellowstone_gnu_pioFixed/      PASS
      hcru_hcru_I_2000_CRUFRC_CLM45_CN_yellowstone_intel_pioFixed/    PASS
      hcru_hcru_I_2000_CRUFRC_CLM45_CN_yellowstone_pgi_pioFixed/      PASS

   ERS_D.hcru_hcru.I_2000_CRUFRC_CLM45_CN.yellowstone_intel.125102    PASS
   ERS_D.hcru_hcru.I_2000_CRUFRC_CLM45_CN.yellowstone_pgi.125128      PASS

Frankfurt Tests:

   The following were run with DEBUG=TRUE and for 1 day initial + 1 day restart
      hcru_hcru_I_2000_CRUFRC_CLM45_CN_frankfurt_pgi_pioFixed/        PASS
      hcru_hcru_I_2000_CRUFRC_CLM45_CN_frankfurt_intel_pioFixed/      FAIL initial run (this is
         likely related to other existing MPI problems on Frankfurt).

CLM tag used for the baseline comparison tests if applicable: N/A

Changes answers relative to baseline: No

===============================================================
===============================================================
Tag name:  clm4_5_04
Originator(s):  erik (Erik Kluzek)
Date: Mon May 13 12:25:14 MDT 2013
One-line Summary: Fix the previous broken tag

Purpose of changes:

Fix the problems in the clm4_5_03 untested tag.

Requirements for tag: Fix bug 1692, 1693

Test level of tag: standard

Bugs fixed (include bugzilla ID):
                                 1693 (Misc. issues with clm4_5_03)
                                 1692 (externals screwed up in clm4_5_03)

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: None

Describe any changes made to the namelist: None

List any changes to the defaults for the boundary datasets: None

Describe any substantial timing or memory changes: None

Code reviewed by: self

List any svn externals directories updated (csm_share, mct, etc.): externals updated to those in SVN_EXTERNAL_DIRECTORIES

List all files eliminated:  Remove test/system as replaced by CESM testing

  models/lnd/clm/test/system -- Delete the whole directory tree

List all files added and what they do: None

List all existing files that have been modified, and describe the changes: 

   M  models/lnd/clm/src/clm4_0/main/clm_initializeMod.F90 -- fixed screwed up code

Machines testing ran on:  (Tests in priority order)
  Standard Tag Pretag ***                    Standard Tag Posttag **

  build-namelist unit tester:           yes

  CESM test lists:

    yellowstone/aux_clm     intel       yes
    yellowstone/aux_clm     pgi         yes
    frankfurt/aux_clm       intel       yes
    frankfurt/aux_clm       pgi         yes

CLM tag used for the baseline comparison tests if applicable: clm4_5_01

Changes answers relative to baseline: No

===============================================================
===============================================================
Tag name:  clm4_5_03
Originator(s):  erik (Erik Kluzek)
Date: Fri May 10 17:29:56 MDT 2013
One-line Summary: Several bug fixes for release, urban and test single point surface datasets

Purpose of changes:

  Some work on IMPORTANT_NOTES file.
  Fix PTS_MODE restarts from John Truesdale. (implimented, but there are still issues)
  Fix history change number of tapes on startup issue.
  Bring in urban single pt surface datasets and single pt test: mexicocityMEX, vancouverCAN , urbanc_alpha, 1x1_tropicAtl, 1x1_smallvilleIA
  Drydep use before defined problem.
  Always bypass first two time-steps for CN/BGC.
  Fix gregorian calendar on history files.
  Remove two fields on clm45 fpftdata file as per Gordon Bonan.
  ncd_pio fix from Jim Edwards/Mariana V.
  set nsegspc=20 for HOMME and high resolution grids.
  Change documentation on CLM build-namelist -drydep, but keep it default on (will change to off in next tag)
  Remove a bunch of datm/drv fields in namelist_definition.
  Fix some issues with Crop and DV that Sam found.
  Fix a scripts issue with multi-instance.
  Update RTM (multi-instance fix, allow null grid).
  Update test list so that CLM45/DV/CROP are exercised.
  Update scripts/machines tag because of multiple problems.

Requirements for tag: fix bug 1488, 1673, 1677, 1682, 1653, 1689, 1690, 1687, 1688, 1685, 1691

Test level of tag: limited!

Bugs fixed (include bugzilla ID):

                                 1025  (partial -- implement changes from John Truesdale so SCAM can read global IC files)
                                 1488  (HOMME grids can not use nsegspc=20)
                                 1653  (Calls to PIO are not properly done)
                                 1673  (B compset gregorian calendar not reflected in CLM history)
                                 1677  (Remove bypass_CN_balance_check_on_restart in CLM45)
                                 1682  (Problem starting up CLM with no history files)
                                 1685  (use before define issue in DryDeposition)
                                 1687  (SBN scripts bug)
                                 1688  (misc. issues with new create_test)
                                 1689  (CLM45 dgvm does not build)
                                 1690  (CLM45 CNDV lightning namelist is missing)
                                 1691  (Scripts issue for multi-instance)

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: None

Describe any changes made to the namelist:
   Set nsegspc=20 for HOMME and f05/f02 resolutions
   Set stream_fldfilename_lightng for CLM45/CNDV

List any changes to the defaults for the boundary datasets: New single-point test and urban datasets
   New surface datsets for: mexicocityMEX, vancouverCAN, urbanc_alpha, 1x1_tropicAtl, 1x1_smallvilleIA
   New fpftdyn for: 1x1_tropicAtl 1850-2005
   New pft-physiology file for CLM45 with three fields removed that were NOT being read in (qe25, mp, and resist)

Describe any substantial timing or memory changes: None

Code reviewed by: self, jedwards/mvertens (fix for bug 1653), jet (fix for bug 1025), slevis (fixes for DV)

List any svn externals directories updated (csm_share, mct, etc.): Machines, scripts, rtm
   Machines to Machines_130509
   scripts  to scripts4_130510
   rtm      to rtm1_0_25

List all files eliminated: None

List all files added and what they do: None

List all existing files that have been modified, and describe the changes:

   M  models/lnd/clm/bld/build-namelist ---- Document drydep as if it's off (will actually become off in next tag)
   M  models/lnd/clm/bld/clm.buildnml.csh -- Multi-instance bug fix.

   M  models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_0.xml ----- nsegspc for ALL grids is 20
   M  models/lnd/clm/bld/namelist_files/namelist_definition_clm4_0.xml --- Remove datm/drv namelist crap
   M  models/lnd/clm/bld/namelist_files/namelist_defaults_clm4_5.xml ----- nsegspc for ALL grids is 20
            New pft-physiology file, new surface/fpftdyn datasets for single point test and urban
            Set stream_fldfilename_lightng for CNDV.
   M  models/lnd/clm/bld/namelist_files/namelist_definition_clm4_5.xml --- Remove datm/drv namelist crap

   M  models/lnd/clm/doc/IMPORTANT_NOTES -- updates

   M  models/lnd/clm/src/util_share/clm_time_manager.F90 - Set parameters for calendar type.
   M  models/lnd/clm/src/util_share/ncdio_pio.F90 -------- Fix so that type of data output on read is based
            on the variable type of the data rather than the type of data on the input file. (from mvertens/jedwards)

   M  models/lnd/clm/src/clm4_5/biogeochem/CNFireMod.F90 ------ Fix so CNDV can build.
   M  models/lnd/clm/src/clm4_5/biogeochem/CNrestMod.F90 ------ Remove bypass_CN_balance_check_on_restart
   M  models/lnd/clm/src/clm4_5/biogeochem/DryDepVelocity.F90 - Fix use before define error.
   M  models/lnd/clm/src/clm4_5/main/clm_initializeMod.F90 ---- On restart set fieldlist and later compare to make sure 
                                                                not screwed up.
   M  models/lnd/clm/src/clm4_5/main/histFileMod.F90 ---------- Make htapes_fieldlist public, check calendar for output files, 
                check that namelist didn't change number of tapes or fields on restart
   M  models/lnd/clm/src/clm4_5/main/clm_driver.F90 ----------- Remove bypass_CN_balance_check_on_restart, NEVER do balance check
                on first time-step

   M  models/lnd/clm/src/clm4_0/biogeochem/DryDepVelocity.F90 - Fix use before define error.
   M  models/lnd/clm/src/clm4_0/main/histFileMod.F90 ---------- Make htapes_fieldlist public, check calendar for output files, 
                check that namelist didn't change number of tapes or fields on restart
   M  models/lnd/clm/src/clm4_5/main/clm_initializeMod.F90 ---- On restart set fieldlist and later compare to make sure 
                                                                not screwed up.

Machines testing ran on:  Limited! (watch out for this tag!)

  I ran preliminary testing, with versions on the cbugfixclm450 ranch. We will fix other issues with the entire
  package as we find them.

CLM tag used for the baseline comparison tests if applicable: clm4_5_02

Changes answers relative to baseline: No bit-for-bit

===============================================================
===============================================================
Tag name:  clm4_5_02
Originator(s):  sacks (Bill Sacks,UCAR/CGD,303-497-1762)
Date: Tue May  7 21:04:35 MDT 2013
One-line Summary: make 'shared' tools directory, and other minor tools fixes

Purpose of changes:

- Make separate 'shared' tools directory, move some tools from the clm4_5
  directory into there.

- Change interpinic so that htop and hbot are skipped

- Change Makefile.common files in tools to use ifort by default on yellowstone,
  so users can just type 'gmake' without needing to do 'gmake USER_FC=ifort'. 
  For simplicity, this has been implemented by defaulting to ifort for ALL Linux
  machines. 

- Fix minor mksurfdata.pl bugs (1669, 1681).

Requirements for tag:
- fix bug 1669, 1681*
- only tools testing needed

Test level of tag: tools only

Bugs fixed (include bugzilla ID):
- 1669: change needed for mksurfdata.pl for smallville (or crop PFT override anyway)
- Changes to get mksurfdata.pl working with urban single point datasets

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: None for CLM; tools builds changed to
use ifort by default on Linux machines

Describe any changes made to the namelist: None

List any changes to the defaults for the boundary datasets: None

Describe any substantial timing or memory changes: None

Code reviewed by: self

List any svn externals directories updated (csm_share, mct, etc.): None

List all files eliminated:

========= Moved to 'shared' directory
D       models/lnd/clm/tools/clm4_5/mkmapdata
D       models/lnd/clm/tools/clm4_5/mkprocdata_map
D       models/lnd/clm/tools/clm4_5/ncl_scripts
D       models/lnd/clm/tools/clm4_5/mkmapgrids

List all files added and what they do:

========= Tools moved from clm4_5 directory to shared directory
A       models/lnd/clm/tools/shared
A       models/lnd/clm/tools/shared/mkmapdata/mvNimport.sh
A       models/lnd/clm/tools/shared/mkmapdata/rmdups.ncl
A       models/lnd/clm/tools/shared/mkmapdata/regridbatch.sh
A       models/lnd/clm/tools/shared/mkmapdata/createXMLEntries.pl
A       models/lnd/clm/tools/shared/mkmapdata/mkmapdata.sh
A       models/lnd/clm/tools/shared/mkmapdata/mkunitymap.ncl
A       models/lnd/clm/tools/shared/mkmapdata/mknoocnmap.pl
A       models/lnd/clm/tools/shared/mkmapdata/README
A       models/lnd/clm/tools/shared/mkmapdata
A       models/lnd/clm/tools/shared/mkprocdata_map/clm4054_ne30g16_I2000.clm2.h0.2000-01_c121107.nc
A       models/lnd/clm/tools/shared/mkprocdata_map/map_ne30np4_nomask_to_fv1.9x2.5_nomask_aave_da_c121107.nc
A       models/lnd/clm/tools/shared/mkprocdata_map/mkprocdata_map_functions.bash
A       models/lnd/clm/tools/shared/mkprocdata_map/src/mkprocdata_map.F90
A       models/lnd/clm/tools/shared/mkprocdata_map/src/gridmapMod.F90
A       models/lnd/clm/tools/shared/mkprocdata_map/src/constMod.F90
A       models/lnd/clm/tools/shared/mkprocdata_map/src/Makefile.common
A       models/lnd/clm/tools/shared/mkprocdata_map/src/fmain.F90
A       models/lnd/clm/tools/shared/mkprocdata_map/src/shr_file_mod.F90
A       models/lnd/clm/tools/shared/mkprocdata_map/src/nanMod.F90
A       models/lnd/clm/tools/shared/mkprocdata_map/src/Mkdepends
A       models/lnd/clm/tools/shared/mkprocdata_map/src/Srcfiles
A       models/lnd/clm/tools/shared/mkprocdata_map/src/Filepath
A       models/lnd/clm/tools/shared/mkprocdata_map/src/Makefile
A       models/lnd/clm/tools/shared/mkprocdata_map/src/fileutils.F90
A       models/lnd/clm/tools/shared/mkprocdata_map/src/shr_kind_mod.F90
A       models/lnd/clm/tools/shared/mkprocdata_map/src
A       models/lnd/clm/tools/shared/mkprocdata_map/mkprocdata_map_in
A       models/lnd/clm/tools/shared/mkprocdata_map/mkprocdata_map_all
A       models/lnd/clm/tools/shared/mkprocdata_map/clm
A       models/lnd/clm/tools/shared/mkprocdata_map/mkprocdata_map_wrap
A       models/lnd/clm/tools/shared/mkprocdata_map/clm4054_f19g16_I2000.clm2.h0.2000-01_c121107.nc
A       models/lnd/clm/tools/shared/mkprocdata_map/README
A       models/lnd/clm/tools/shared/mkprocdata_map
A       models/lnd/clm/tools/shared/ncl_scripts/cprnc.pl
A       models/lnd/clm/tools/shared/ncl_scripts/getco2_historical.ncl
A       models/lnd/clm/tools/shared/ncl_scripts/cprnc.ncl
A       models/lnd/clm/tools/shared/ncl_scripts/getregional_datasets.pl
A       models/lnd/clm/tools/shared/ncl_scripts/getregional_datasets.ncl
A       models/lnd/clm/tools/shared/ncl_scripts/README
A       models/lnd/clm/tools/shared/ncl_scripts
A       models/lnd/clm/tools/shared/mkmapgrids/src/Makefile.common
A       models/lnd/clm/tools/shared/mkmapgrids/src/domainMod.F90
A       models/lnd/clm/tools/shared/mkmapgrids/src/shr_sys_mod.F90
A       models/lnd/clm/tools/shared/mkmapgrids/src/shr_file_mod.F90
A       models/lnd/clm/tools/shared/mkmapgrids/src/nanMod.F90
A       models/lnd/clm/tools/shared/mkmapgrids/src/shr_log_mod.F90
A       models/lnd/clm/tools/shared/mkmapgrids/src/Mkdepends
A       models/lnd/clm/tools/shared/mkmapgrids/src/Srcfiles
A       models/lnd/clm/tools/shared/mkmapgrids/src/mkmapgrids.F90
A       models/lnd/clm/tools/shared/mkmapgrids/src/Filepath
A       models/lnd/clm/tools/shared/mkmapgrids/src/Makefile
A       models/lnd/clm/tools/shared/mkmapgrids/src/shr_kind_mod.F90
A       models/lnd/clm/tools/shared/mkmapgrids/src
A       models/lnd/clm/tools/shared/mkmapgrids/mkmapgrids.namelist
A       models/lnd/clm/tools/shared/mkmapgrids/mkscripgrid.ncl
A       models/lnd/clm/tools/shared/mkmapgrids/mkmapgrids.csh
A       models/lnd/clm/tools/shared/mkmapgrids/README
A       models/lnd/clm/tools/shared/mkmapgrids

========= Add test for mkmapdata using '-p clm4_0'
A       models/lnd/clm/test/tools/nl_files/mkmapdata_ne30np4_clm4_0

List all existing files that have been modified, and describe the changes:

========= Point to new 'shared' tools directory where appropriate
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/mksurfdata.pl
          - also fix mksurfdata.pl for crop PFT override (bug 1669)
          - also changes to get mksurfdata.pl working with urban single point datasets (bug 1681)
M       models/lnd/clm/tools/clm4_0/mksurfdata_map/mksurfdata.pl
          - also fix mksurfdata.pl for crop PFT override (bug 1669)
M       models/lnd/clm/test/tools/TBLCFGtools.sh
M       models/lnd/clm/test/tools/TOPtools.sh
M       models/lnd/clm/test/tools/TBLscript_tools.sh
M       models/lnd/clm/test/tools/TBLtools.sh
M       models/lnd/clm/test/tools/input_tests_master
          - also add test for mkmapdata using '-p clm4_0'
M       models/lnd/clm/tools/README
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/README.developers

========= Put gen_domain in 'shared' tools directory
M       SVN_EXTERNAL_DIRECTORIES

========= Use ifort by default on yellowstone (and other Linux machines)
M       models/lnd/clm/tools/clm4_5/interpinic/src/Makefile.common
M       models/lnd/clm/tools/clm4_5/mksurfdata_map/src/Makefile.common
M       models/lnd/clm/tools/clm4_0/interpinic/src/Makefile.common
M       models/lnd/clm/tools/clm4_0/mksurfdata_map/src/Makefile.common

========= Change interpinic so that htop and hbot are skipped
M       models/lnd/clm/tools/clm4_5/interpinic/src/interpinic.F90


Machines testing ran on:  (Tests in priority order)
  build-namelist unit tester:   no

  CESM test lists:

    yellowstone/aux_clm     intel       no
    frankfurt/aux_clm_int   intel       no
    yellowstone/aux_clm     pgi         no
    frankfurt/aux_clm       intel       no

  test_driver.sh tools testing:

    lynx interactive:           no
    yellowstone interactive:    yes
    
      All PASS except for the following expected failures (note that 006 & 008
      baselines are expected to always fail):

         006 ble14 TBLCFGtools.sh shared gen_domain CFGtools__ds T31.runoptions .......................... rc=4 FAIL
         008 ble@4 TBLCFGtools.sh shared gen_domain CFGtools__ds ne30.runoptions ......................... rc=4 FAIL
         027 smiS4 TSMscript_tools.sh shared ncl_scripts getregional_datasets.pl getregional ............. rc=6 FAIL
         028 bliS4 TBLscript_tools.sh shared ncl_scripts getregional_datasets.pl getregional ............. rc=4 FAIL


  yellowstone/PTCLM:            no

CLM tag used for the baseline comparison tests if applicable: clm4_5_01

Changes answers relative to baseline: NO

===============================================================
===============================================================
Tag name:  clm4_5_01
Originator(s):  muszala (Stefan Muszala,UCAR/CGD,303-497-1320)
Date: Mon May  6 16:52:27 MDT 2013
One-line Summary: update externals

Purpose of changes: update externals to alpha08b

Requirements for tag: N/A

Test level of tag: std-test

Bugs fixed (include bugzilla ID): N/A

Known bugs (include bugzilla ID): N/A
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system: N/A

Describe any changes made to the namelist: N/A

List any changes to the defaults for the boundary datasets: N/A

Describe any substantial timing or memory changes: N/A

Code reviewed by: self

List any svn externals directories updated (csm_share, mct, etc.):

< scripts                         https://svn-ccsm-models.cgd.ucar.edu/scripts/trunk_tags/scripts4_130502
< scripts/ccsm_utils/Machines     https://svn-ccsm-models.cgd.ucar.edu/Machines/trunk_tags/Machines_130502
< models/drv                      https://svn-ccsm-models.cgd.ucar.edu/drv/seq_mct/trunk_tags/drvseq4_2_33
---
> scripts                         https://svn-ccsm-models.cgd.ucar.edu/scripts/trunk_tags/scripts4_130422
> scripts/ccsm_utils/Machines     https://svn-ccsm-models.cgd.ucar.edu/Machines/trunk_tags/Machines_130412
> models/drv                      https://svn-ccsm-models.cgd.ucar.edu/drv/seq_mct/trunk_tags/drvseq4_2_29
13c13
< models/glc/cism                 https://svn-ccsm-models.cgd.ucar.edu/glc/trunk_tags/cism1_130502
---
> models/glc/cism                 https://svn-ccsm-models.cgd.ucar.edu/glc/trunk_tags/cism1_130405
16c16
< models/csm_share                https://svn-ccsm-models.cgd.ucar.edu/csm_share/trunk_tags/share3_130423
---
> models/csm_share                https://svn-ccsm-models.cgd.ucar.edu/csm_share/trunk_tags/share3_130226
18c18
< models/utils/timing             https://svn-ccsm-models.cgd.ucar.edu/timing/trunk_tags/timing_130417
---
> models/utils/timing             https://svn-ccsm-models.cgd.ucar.edu/timing/trunk_tags/timing_130214
20c20
< models/utils/pio                http://parallelio.googlecode.com/svn/trunk_tags/pio1_6_9/pio
---
> models/utils/pio                http://parallelio.googlecode.com/svn/trunk_tags/pio1_6_7/pio
23,25c23,25
< tools/cprnc                            https://svn-ccsm-models.cgd.ucar.edu/tools/cprnc/trunk_tags/cprnc_130425
< tools/mapping                          https://svn-ccsm-models.cgd.ucar.edu/tools/mapping/trunk_tags/mapping_130426a
< models/lnd/clm/tools/clm4_5/gen_domain https://svn-ccsm-models.cgd.ucar.edu/tools/mapping/trunk_tags/mapping_130426a/gen_domain_files
---
> tools/cprnc                            https://svn-ccsm-models.cgd.ucar.edu/tools/cprnc/trunk_tags/cprnc_130411 
> tools/mapping                          https://svn-ccsm-models.cgd.ucar.edu/tools/mapping/trunk_tags/mapping_130403
> models/lnd/clm/tools/clm4_5/gen_domain https://svn-ccsm-models.cgd.ucar.edu/tools/mapping/trunk_tags/mapping_130403/gen_domain_files

List all files eliminated:N/A

List all files added and what they do:N/A

List all existing files that have been modified, and describe the changes:

M       models/lnd/clm/bld/unit_testers/xFail/expectedClmTestFails.xml
- clean up test list

Machines testing ran on:  (Tests in priority order)

  build-namelist unit tester:   OK

  CESM test lists:

    yellowstone/aux_clm     intel       OK (detail of fails that should pass next time)

BFAIL ERI_D.f10_f10.I20TRCN.yellowstone_intel.GC.170226.compare_hist.clm4_0_81 
 -- no baseline, should pass next round
FAIL  ERS.f19_g16_r01.I1850CLM45CN4Me.nldir_rtmOnFloodOnEffvelOff.yellowstone_intel.GC.170226.compare_hist.clm4_0_81 
 -- No matching time found in cprnc? should pass next time.  
FAIL  ERS_D.f19_g16.ICLM45GLCMEC.nldir_glcMEC.yellowstone_intel.GC.170226.compare_hist.clm4_0_81 
 -- changes in g2x_Sg_frac01 and g2x_Sg_topo01
FAIL ERS_D.f19_g16.ICLM45GLCMEC.nldir_glcMEC.yellowstone_intel.GC.170226.nlcomp
 -- changes in cism namelist and cism config
FAIL  ERS_D.f19_g16.IGRCP26CLM45CN.yellowstone_intel.GC.170226.compare_hist.clm4_0_81 
 -- changes in g2x_Sg_frac01 and g2x_Sg_topo01
FAIL ERS_D.f19_g16.IGRCP26CLM45CN.yellowstone_intel.GC.170226.nlcomp
 -- changes in cism namelist and cism config
FAIL  ERS_D.f19_g16.IGRCP26CN.yellowstone_intel.GC.170226.compare_hist.clm4_0_81 
 -- changes in g2x_Sg_frac01 and g2x_Sg_topo01
FAIL ERS_D.f19_g16.IGRCP26CN.yellowstone_intel.GC.170226.nlcomp
 -- changes in cism namelist and cism config
BFAIL ERS_Ld3_D_P64x1.ne30_g16.ICLM45CN.nldir_default.yellowstone_intel.GC.170226.compare_hist.clm4_0_81 
 -- no baseline, should pass next round
BFAIL ERS_Ld3_D_P64x16.ne30_g16.ICN.nldir_default.yellowstone_intel.GC.170226.compare_hist.clm4_0_81 
 -- no baseline, should pass next round
FAIL  ERS_Lm3.f19_g16.IGRCP60CN.yellowstone_intel.GC.170226.compare_hist.clm4_0_81 
 -- changes in g2x_Sg_frac01 and g2x_Sg_topo01
FAIL ERS_Lm3.f19_g16.IGRCP60CN.yellowstone_intel.GC.170226.nlcomp
 -- changes in cism namelist and cism config
BFAIL PET_D_P1x30.ne30_g16.ICN.nldir_default.yellowstone_intel.GC.170226.compare_hist.clm4_0_81 
 -- no baseline, should pass next round
BFAIL SMS_RLA.f45_f45.I.yellowstone_intel.GC.170226.compare_hist.clm4_0_81 
 -- no baseline, should pass next round
BFAIL SMS_RLA.f45_f45.ICLM45.yellowstone_intel.GC.170226.compare_hist.clm4_0_81 
 -- no baseline, should pass next round
BFAIL SMS_ROA.f45_f45.I.yellowstone_intel.GC.170226.compare_hist.clm4_0_81 
 -- no baseline, should pass next round
BFAIL SMS_ROA.f45_f45.ICLM45.yellowstone_intel.GC.170226.compare_hist.clm4_0_81 
 -- no baseline, should pass next round

    yellowstone/aux_clm     pgi         OK (detail of fails that should pass next time)

FAIL  ERI.f19_g16.IG1850.yellowstone_pgi.GC.170137.compare_hist.clm4_0_81 
 -- changes in g2x_Sg_frac01 and g2x_Sg_topo01
FAIL ERI.f19_g16.IG1850.yellowstone_pgi.GC.170137.nlcomp
 -- changes in cism namelist and cism_config
FAIL  ERI.f19_g16.IG1850CLM45.yellowstone_pgi.GC.170137.compare_hist.clm4_0_81 
 -- changes in g2x_Sg_frac01 and g2x_Sg_topo01
FAIL ERI.f19_g16.IG1850CLM45.yellowstone_pgi.GC.170137.nlcomp
 -- changes in cism namelist and cism config
BFAIL ERI_D.f10_f10.I20TRCN.yellowstone_pgi.GC.170137.compare_hist.clm4_0_81 
 -- no baseline, should pass next round
FAIL  SMS.T31_g37.IG4804.yellowstone_pgi.GC.170137.compare_hist.clm4_0_81 
FAIL SMS.T31_g37.IG4804.yellowstone_pgi.GC.170137.nlcomp
 -- changes in cism namelist and cism config
 -- changes in drv_in (ocn_ntreades=2) 
FAIL  SMS.T31_g37.IG4804CLM45.yellowstone_pgi.GC.170137.compare_hist.clm4_0_81 
 -- changes in g2x_Sg_frac01 and g2x_Sg_topo01
BFAIL SMS_RLB.f45_f45.I.yellowstone_pgi.GC.170137.compare_hist.clm4_0_81 
 -- no baseline, should pass next round
BFAIL SMS_RLB.f45_f45.ICLM45.yellowstone_pgi.GC.170137.compare_hist.clm4_0_8
 -- no baseline, should pass next round

    frankfurt/aux_clm       intel       OK 

CLM tag used for the baseline comparison tests if applicable: clm4_0_81

Changes answers relative to baseline: yes 

IF tag changes answers relative to baseline comparison the
following should be filled in:

  Summarize any changes to answers, i.e.,
    - what code configurations: only changes in g2x_Sg_frac01 and g2x_Sg_topo01
    - what platforms/compilers: all

===============================================================
===============================================================
Tag name:  clm4_5_00
Originator(s):  erik (Erik Kluzek)
Date: Thu May  2 00:20:17 MDT 2013
One-line Summary: Official end to CLM4.5 development for CLM offline

Purpose of changes: Changes from clm4_0_54 to now...

Compsets and Scripts Changes:

Remove ability to set compset file on command line, and use a new expanded compset file definition that
allows user to create many compsets on the fly by defining a long name with the "-user_compset" option
to "create_newcase". "-user_compset" is in the form of...

TIME_DATM[%phys]_CLM[40|45][%phys]_SICE_SOCN_RTM[%phys]_GLC[%phys]_SWAV[_BGC%phys]

Where
   TIME = Time period (e.g. 2000, 20TR, RCP8...)
   GLC  = [CISM1, SGLC]
   BGC  = optional BGC scenario
The OPTIONAL %phys attributes specify submodes of the given system

So for example 

./create_newcase -user_compset 1850_DATM%CRU_CLM45%BGC_SICE_SOCN_RTM_SGLC_SWAV -case cru1850 -res f19_g16 -mach yellowstone -compiler intel

will setup a 1850 case at f19 resolution with CRUNCEP forcing with CLM4.5-BGC.

Changes for both clm4.0 and clm4.5:

* Bug fixes in MEGAN VOC emission fluxes and dry deposition velocities
* CRUNCEP is now an option for atmospheric forcing
* Change from Sam Levis for CROP to pft-physiology file so that CROP parameter is in Kelvin rather than Celsius.
* Don't re-weight pftdyn if weights are essentially identical.

CLM4.5 includes the following:

* Bring in flood capability to RTM.
* Bring LBNL-merge branch on with: vertical soil, Methane, CENTURY, split nitrification, new-lake model.
* Modifications to GPP, on gppdev branch, multilayer canopy and then single-layer version that reproduces it.
* Crop model updates. Irrigation included with crop model as an option. Fix CNDV-CROP.
* Urban model updates, multi-density, urban depth seperate from soil depth, wasteheat to zero.
* Bring in permafrostsims09 branch with Sean Swensons's flooding changes.
* Update pft-physiology file, change some CN defaults, change min flow slightly in RTM.
* Set ponding to zero, acclimation mods from Keith Oleson, a hydrology change from Sean Swenson.
* Add active flags, change subgrid weighting convention.
* Turn off subgrid topography snow parameterization for glc_mec landunits.
* Jinyun photosynthesis change impacting arid regions.
* Keith Oleson's photosynthesis change, changes canopy top: triose phosphate util. rate to be dependent on vcmax.
* VIC hydrology is an option.
* Update mksurfdata_map for CLM4.5 (also add support for glc_nec=36 although we have no datasets for this).
* Snow depth averaged over grid-cell (SNOWDP) on history file changed in favor of SNOW_DEPTH (averaged only over snow covered area).
* Spinup changes from Charlie Koven from build-time to run-time (spinup now option added to CLM_BLDNML_OPTS as "-spinup on|off").
* Bring the F. Li and S. Levis Fire model for CLMCN and CLMBGC based on Li et al. (2012a,b; 2013).
* BSW calculation changed affecting drought phenology and frozen temperature sensitivity (SP, CN, and BGC as well as DV)

Test level of tag: doc

Bugs fixed (include bugzilla ID):

Known bugs (include bugzilla ID):
    http://bugs.cgd.ucar.edu/

Known Limitations:
                                 1147 (mkgriddata can't straddle over Greenwich)
                                 1025 (SCM mode can NOT use a global finidat file)
                                 1017 (SCM mode can NOT restart)
                                  896 (T62 mode does not work)
                                  701 (svn keyword)
                                  452 (Problem with support of soil-colors != 8 or 20)

Describe any changes made to build system:
   Changes to CLM configure:
     -phys option to specify clm4_0 or clm4_5
     -pergro and -c13 option removed 
     -spinup option removed for CLM4_0
     New options for clm4_5: -clm4me, -vichydro, -exlaklayers, -vsoilc_centbgc

Describe any changes made to the namelist:
   For CLM4.0: WRF and 360x720cru resolutions added
   For CLM4.5: new namelists: popd_streams light_streams clm_hydrology1_inparm clm_soilhydrology_inparm
               irrigate is a namelist option rather than using different surface datasets
       New namelist items for clm_inparm:
           anoxia			no_frozen_nitrif_denitrif
           atm_c14_filename		override_bgc_restart_mismatch_dump
           cryoturb_diffusion_k		perchroot
           decomp_depth_efolding	perchroot_altk
           deepmixing_depthcrit		pftspecific_rootingprofile
           deepmixing_mixfact		rootprof_exp
           exponential_rooting_profile	rootprof_exp
           froz_q10			som_adv_flux
           hist_wrtch4diag		som_diffus
           lake_melt_icealb		spinup_state
           max_altdepth_cryoturbation	surfprof_exp
           max_depth_cryoturb		use_c13
           more_vertlayers		use_c14
           nfix_timeconst		use_c14_bombspike


List any changes to the defaults for the boundary datasets: 
   All CLM4.5 datasets are new.
   For CLM4.0, new ne120, ne240, and 360x720cru surface datasets (ne120 ne120 finidat files)
   new pft-physiology file

New history fields:
  Dozens of new fields for clm4_5.
  Three new fields for clm4_0:
+ <field name='QICE_FORC' units='mm/s' long_name='qice forcing sent to GLC'
+ <field name='TSRF_FORC' units='K'    long_name='surface temperature sent to GLC'
+ <field name='TOPO_FORC' units='m'    long_name='topographic height sent to GLC'

List any svn externals directories updated (csm_share, mct, etc.):
 Most of the externals are the same as in the cesm1_2_alpha08a tag:

   scripts     to scripts4_130422  (same as in cesm1_2_alpha07a)
   Machines    to Machines_130412  (same as in cesm1_2_beta06)
   datm        to datm8_130424
   stubs       to stubs1_4_02
   rtm         to rtm1_0_22
   cism        to cism1_130405      (same as in cesm1_2_beta06)
   csm_share   to share3_130226     (same as in cesm1_2_beta06)
   esmf_wrf    to esmf_wrf_timemgr_130213
   timing      to timing_130214     (same as in cesm1_2_beta06)
   MCT         to MCT_2.8.3
   pio         to pio_1_6_7         (older than in cesm1_2_alpha07b)
   cprnc       to cprnc_130411      (same as cesm1_2_beta07)
   mapping     to mapping_130403    (same as in cesm1_2_beta06)

CLM tag used for the baseline comparison tests if applicable: clm4_0_54 (in cesm1_1_1)

Changes answers relative to baseline:  Yes

IF tag changes answers relative to baseline comparison the
following should be filled in:

  Summarize any changes to answers, i.e.,
    - what code configurations: All
    - what platforms/compilers: All
    - nature of change CLM4.0 are similar climate, CLM4.5 is of course new climate

   If this tag changes climate describe the run(s) done to evaluate the new
   climate (put details of the simulations in the experiment database)

     /glade/scratch/erik/archive/clm4079_NewFire10f19_CRU_20TR_CN4Me

===============================================================
===============================================================
