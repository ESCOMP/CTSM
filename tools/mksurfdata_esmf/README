Updated on, by:
3/2/2022 slevis
2/23/2022 mvertens

================
Getting the code
================
> cd <user/work/area>
> git clone https://github.com/ESCOMP/CTSM.git <dir_name>
> cd <dir_name>
> git checkout feature/new_toolchain

# Save time by checking out ccs_config only
> ./manage_externals/checkout_externals ccs_config

=======================
building the executable
=======================
> cd tools/mksurfdata_esmf
> rm -rf bld  # (or the contents of /bld) before rerunning CC=...
> mkdir ./bld
> cd bld
> module load intel  # I found I need the latest version of intel
> module load python  # in case need latest version of python
> module load cmake
> bash
> CC=mpicc FC=mpif90 cmake -DCMAKE_BUILD_TYPE=debug ../src/
> make VERBOSE=1
> export MKSURFDATA_BLD=`pwd`  # needed once; execute in /bld

# IF YOU MODIFY .F90 files, start here first, though more than once
# I have found it necessary to go back to the "rm -rf bld" step
> cd ../src
> make clean  # REMEMBER to be in bash
> make VERBOSE=1

=======================
running for a single submission: 
=======================
> cd ../
> run ./gen_mksurfdata_namelist.py to generate your target namelist (call it foo.namelist here)
> run ./gen_mksurfdata_jobscript_single.py --help to see commands - as an example
> run ./gen_mksurfdata_jobscript_single.py --mpi-tasks 768 --namelist-file foo.namelist
> qsub mksurfdata_jobscript

=======================
running for the generation of multiple datasets
=======================
> cd ../
Note that gen_mksurfdata_jobscript_multi.py runs ./gen_mksurfdata_namelist.py
> run ./gen_mksurfdata_jobscript_multi.py --help to see commands - as an example
> run ./gen_mksurfdata_jobscript_multi.py --mpi-tasks 768 --namelist-file foo.namelist
> run ./gen_mksurfdata_jobscript_multi.py --mpi-tasks 768 --scenario all
> qsub mksurfdata_jobscript

================
NOTES
================

------------------------------------------------------------
slevis HAS RUN THESE CASES and HAS LISTED ISSUES ENCOUNTERED
------------------------------------------------------------
1) ./gen_mksurfdata_namelist.py --start-year 2000 --end-year 2000 --res 1.9x2.5 --vic --glc

.nc file issues:
- URBAN vars have bigger diffs likely bc using newer raw datasets
- abm, std elev, organic have some bigger diffs
- glacier region MV confirmed w BillS that Greenland diff is ok

.log file issues:
- Successfully made PFTs, harvest and grazing, glacier, urban,
  topo stats, and organic don't show input/output for comparison
- soil texture category 3 and soil color category 15 inputs/outputs
  problematic or just that we set ocean to loam?
- agricultural fire peak month: output areas increase for all categories
- voc emission factors all zero

------------------------------------------------------
DYNAMIC LU: NOT ALL FILES HAVE BEEN TRANSLATED to cdf5
------------------------------------------------------
Coordinate with Peter Lawrence. Use this command to translate:
> nccopy -k cdf5 oldfile newfile

--------------------------------------------------------
Python script for generating namelists has NOT ADDRESSED:
--------------------------------------------------------
* Regional/1x1: handled by subset.py
* hires_pft: should work
* ssp_rcp: should work; needs files converted to cdf5 first?
* potveg: needs file(s) converted to cdf5 first?
* merge_gis

--------------------------------------------------------
Override options removed:
--------------------------------------------------------
-- all_veg = .true. handled by fsurdat_modifier zero_nonveg = .true.
-- all_urban = .true. handle w fsurdat_modifier new option
-- no_inlandwet = .false. same
-- soil_...
-- pft_...

